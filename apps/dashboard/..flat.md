# Contents of . source tree

## README

```markdown
Welcome to your new TanStack app! 

# Getting Started

To run this application:

```bash
pnpm install
pnpm start  
```

# Building For Production

To build this application for production:

```bash
pnpm build
```

## Testing

This project uses [Vitest](https://vitest.dev/) for testing. You can run the tests with:

```bash
pnpm test
```

## Styling

This project uses [Tailwind CSS](https://tailwindcss.com/) for styling.




## Shadcn

Add components using the canary version of [Shadcn](https://ui.shadcn.com/).

```bash
pnpx shadcn@canary add button
```



## Routing
This project uses [TanStack Router](https://tanstack.com/router). The initial setup is a file based router. Which means that the routes are managed as files in `src/routes`.

### Adding A Route

To add a new route to your application just add another a new file in the `./src/routes` directory.

TanStack will automatically generate the content of the route file for you.

Now that you have two routes you can use a `Link` component to navigate between them.

### Adding Links

To use SPA (Single Page Application) navigation you will need to import the `Link` component from `@tanstack/react-router`.

```tsx
import { Link } from "@tanstack/react-router";
```

Then anywhere in your JSX you can use it like so:

```tsx
<Link to="/about">About</Link>
```

This will create a link that will navigate to the `/about` route.

More information on the `Link` component can be found in the [Link documentation](https://tanstack.com/router/v1/docs/framework/react/api/router/linkComponent).

### Using A Layout

In the File Based Routing setup the layout is located in `src/routes/__root.tsx`. Anything you add to the root route will appear in all the routes. The route content will appear in the JSX where you use the `<Outlet />` component.

Here is an example layout that includes a header:

```tsx
import { Outlet, createRootRoute } from '@tanstack/react-router'
import { TanStackRouterDevtools } from '@tanstack/react-router-devtools'

import { Link } from "@tanstack/react-router";

export const Route = createRootRoute({
  component: () => (
    <>
      <header>
        <nav>
          <Link to="/">Home</Link>
          <Link to="/about">About</Link>
        </nav>
      </header>
      <Outlet />
      <TanStackRouterDevtools />
    </>
  ),
})
```

The `<TanStackRouterDevtools />` component is not required so you can remove it if you don't want it in your layout.

More information on layouts can be found in the [Layouts documentation](https://tanstack.com/router/latest/docs/framework/react/guide/routing-concepts#layouts).


## Data Fetching

There are multiple ways to fetch data in your application. You can use TanStack Query to fetch data from a server. But you can also use the `loader` functionality built into TanStack Router to load the data for a route before it's rendered.

For example:

```tsx
const peopleRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/people",
  loader: async () => {
    const response = await fetch("https://swapi.dev/api/people");
    return response.json() as Promise<{
      results: {
        name: string;
      }[];
    }>;
  },
  component: () => {
    const data = peopleRoute.useLoaderData();
    return (
      <ul>
        {data.results.map((person) => (
          <li key={person.name}>{person.name}</li>
        ))}
      </ul>
    );
  },
});
```

Loaders simplify your data fetching logic dramatically. Check out more information in the [Loader documentation](https://tanstack.com/router/latest/docs/framework/react/guide/data-loading#loader-parameters).

### React-Query

React-Query is an excellent addition or alternative to route loading and integrating it into you application is a breeze.

First add your dependencies:

```bash
pnpm add @tanstack/react-query @tanstack/react-query-devtools
```

Next we'll need to create a query client and provider. We recommend putting those in `main.tsx`.

```tsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

// ...

const queryClient = new QueryClient();

// ...

if (!rootElement.innerHTML) {
  const root = ReactDOM.createRoot(rootElement);

  root.render(
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
    </QueryClientProvider>
  );
}
```

You can also add TanStack Query Devtools to the root route (optional).

```tsx
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";

const rootRoute = createRootRoute({
  component: () => (
    <>
      <Outlet />
      <ReactQueryDevtools buttonPosition="top-right" />
      <TanStackRouterDevtools />
    </>
  ),
});
```

Now you can use `useQuery` to fetch your data.

```tsx
import { useQuery } from "@tanstack/react-query";

import "./App.css";

function App() {
  const { data } = useQuery({
    queryKey: ["people"],
    queryFn: () =>
      fetch("https://swapi.dev/api/people")
        .then((res) => res.json())
        .then((data) => data.results as { name: string }[]),
    initialData: [],
  });

  return (
    <div>
      <ul>
        {data.map((person) => (
          <li key={person.name}>{person.name}</li>
        ))}
      </ul>
    </div>
  );
}

export default App;
```

You can find out everything you need to know on how to use React-Query in the [React-Query documentation](https://tanstack.com/query/latest/docs/framework/react/overview).

## State Management

Another common requirement for React applications is state management. There are many options for state management in React. TanStack Store provides a great starting point for your project.

First you need to add TanStack Store as a dependency:

```bash
pnpm add @tanstack/store
```

Now let's create a simple counter in the `src/App.tsx` file as a demonstration.

```tsx
import { useStore } from "@tanstack/react-store";
import { Store } from "@tanstack/store";
import "./App.css";

const countStore = new Store(0);

function App() {
  const count = useStore(countStore);
  return (
    <div>
      <button onClick={() => countStore.setState((n) => n + 1)}>
        Increment - {count}
      </button>
    </div>
  );
}

export default App;
```

One of the many nice features of TanStack Store is the ability to derive state from other state. That derived state will update when the base state updates.

Let's check this out by doubling the count using derived state.

```tsx
import { useStore } from "@tanstack/react-store";
import { Store, Derived } from "@tanstack/store";
import "./App.css";

const countStore = new Store(0);

const doubledStore = new Derived({
  fn: () => countStore.state * 2,
  deps: [countStore],
});
doubledStore.mount();

function App() {
  const count = useStore(countStore);
  const doubledCount = useStore(doubledStore);

  return (
    <div>
      <button onClick={() => countStore.setState((n) => n + 1)}>
        Increment - {count}
      </button>
      <div>Doubled - {doubledCount}</div>
    </div>
  );
}

export default App;
```

We use the `Derived` class to create a new store that is derived from another store. The `Derived` class has a `mount` method that will start the derived store updating.

Once we've created the derived store we can use it in the `App` component just like we would any other store using the `useStore` hook.

You can find out everything you need to know on how to use TanStack Store in the [TanStack Store documentation](https://tanstack.com/store/latest).

# Demo files

Files prefixed with `demo` can be safely deleted. They are there to provide a starting point for you to play around with the features you've installed.

# Learn More

You can learn more about all of the offerings from TanStack in the [TanStack documentation](https://tanstack.com).

```

## File: postcss.config.ts

```typescript
export default {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

```

## File: app.config.ts

```typescript
import { defineConfig } from '@tanstack/react-start/config'
import viteTsConfigPaths from 'vite-tsconfig-paths'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  tsr: {
    appDirectory: 'src',
  },
  vite: {
    plugins: [
      viteTsConfigPaths({
        projects: ['./tsconfig.json'],
      }),
      tailwindcss(),
    ],
    ssr: {
      external: ['@prisma/client', 'better-auth']
    }
  },
})
```

## File: package.json

```json
{
  "name": "@app/dashboard",
  "private": true,
  "type": "module",
  "scripts": {
    "start": "vinxi start",
    "build": "vinxi build",
    "serve": "vite preview",
    "test": "vitest run",
    "dev": "vinxi dev",
    "lint": "biome check .",
    "lint:fix": "biome check --write .",
    "format": "biome format .",
    "format:fix": "biome format --write ."
  },
  "dependencies": {
    "@app/auth": "workspace:*",
    "@app/layout": "workspace:*",
    "@app/ui": "workspace:*",
    "@hookform/resolvers": "^4.1.3",
    "@tailwindcss/postcss": "^4.0.15",
    "@tailwindcss/vite": "^4.0.15",
    "@tanstack/react-query": "^5.69.0",
    "@tanstack/react-query-devtools": "^5.69.0",
    "@tanstack/react-router": "^1.114.27",
    "@tanstack/react-router-devtools": "^1.114.27",
    "@tanstack/react-router-with-query": "^1.114.27",
    "@tanstack/react-start": "^1.114.27",
    "@tanstack/router-plugin": "^1.114.27",
    "dexie": "^4.0.11",
    "dexie-react-hooks": "^1.1.7",
    "framer-motion": "^12.5.0",
    "localforage": "^1.10.0",
    "lucide-react": "0.483.0",
    "postcss": "^8.5.3",
    "react": "^19.0.0",
    "react-complex-tree": "^2.6.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.54.2",
    "sonner": "^2.0.1",
    "tailwind-merge": "^3.0.2",
    "tailwindcss": "^4.0.15",
    "tailwindcss-animate": "^1.0.7",
    "vinxi": "^0.5.3",
    "vite-tsconfig-paths": "^5.1.4",
    "zod": "^3.24.2",
    "zustand": "^5.0.3"
  },
  "devDependencies": {
    "@biomejs/biome": "^1.9.4",
    "@testing-library/dom": "^10.4.0",
    "@testing-library/react": "^16.2.0",
    "@types/react": "^19.0.12",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "jsdom": "^26.0.0",
    "typescript": "^5.8.2",
    "vite": "^6.2.2",
    "vitest": "^3.0.9",
    "web-vitals": "^4.2.4"
  }
}

```

## File: components.json

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "../../packages/ui/src/styles/globals.css",
    "baseColor": "zinc",
    "cssVariables": true
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "hooks": "@/hooks",
    "lib": "@/lib",
    "utils": "@app/ui/lib/utils",
    "ui": "@app/ui/components"
  }
}

```

## File: tsconfig.json

```json
{
  "include": ["**/*.ts", "**/*.tsx", "../../index.tsx"],
  "compilerOptions": {
    "target": "ES2022",
    "jsx": "react-jsx",
    "module": "ESNext",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "types": ["vite/client"],

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "noEmit": true,

    /* Linting */
    "skipLibCheck": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}

```

## File: biome.json

```json
{
	"extends": ["../../biome.json"]
}

```

## File: public/manifest.json

```json
{
  "short_name": "TanStack App",
  "name": "Create TanStack App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}

```

## File: src/ssr.tsx

```tsx
import { getRouterManifest } from "@tanstack/react-start/router-manifest";
import {
	createStartHandler,
	defaultStreamHandler,
} from "@tanstack/react-start/server";

import { createRouter } from "./router";

export default createStartHandler({
	createRouter,
	getRouterManifest,
})(defaultStreamHandler);

```

## File: src/api.ts

```typescript
import {
	createStartAPIHandler,
	defaultAPIFileRouteHandler,
} from "@tanstack/react-start/api";

export default createStartAPIHandler(defaultAPIFileRouteHandler);

```

## File: src/router.tsx

```tsx
import { QueryClient } from '@tanstack/react-query';
import { createRouter as createTanStackRouter } from '@tanstack/react-router';
import { routerWithQueryClient } from '@tanstack/react-router-with-query';

import { NotFound } from '@/components/not-found';
import { CatchBoundary } from '@/components/catch-boundary';

import { routeTree } from '@/routeTree.gen';

export function createRouter() {
	const queryClient: QueryClient = new QueryClient({
		defaultOptions: {},
	});

	return routerWithQueryClient(
		createTanStackRouter({
			routeTree,
			defaultPreload: 'intent',
			context: { queryClient, user: null },
			defaultPreloadStaleTime: 0,
			defaultErrorComponent: CatchBoundary,
			defaultNotFoundComponent: NotFound,
			scrollRestoration: true,
			defaultStructuralSharing: true,
		}),
		queryClient,
	);
}

declare module '@tanstack/react-router' {
	interface Register {
		router: ReturnType<typeof createRouter>;
	}
}

```

## File: src/routeTree.gen.ts

```typescript
/* eslint-disable */

// @ts-nocheck

// noinspection JSUnusedGlobalSymbols

// This file was automatically generated by TanStack Router.
// You should NOT make any changes in this file as it will be overwritten.
// Additionally, you should also exclude this file from your linter and/or formatter to prevent it from being checked or modified.

// Import Routes

import { Route as rootRoute } from './routes/__root'
import { Route as AuthRouteImport } from './routes/auth/route'
import { Route as appRouteImport } from './routes/(app)/route'
import { Route as appIndexImport } from './routes/(app)/index'
import { Route as AuthSignupImport } from './routes/auth/signup'
import { Route as AuthSigninImport } from './routes/auth/signin'
import { Route as AuthResetPasswordImport } from './routes/auth/reset-password'
import { Route as AuthForgotPasswordImport } from './routes/auth/forgot-password'
import { Route as appToolsImport } from './routes/(app)/tools'
import { Route as appSettingsImport } from './routes/(app)/settings'
import { Route as appLibraryImport } from './routes/(app)/library'
import { Route as appIntegrationImport } from './routes/(app)/integration'
import { Route as appInsightsImport } from './routes/(app)/insights'
import { Route as appHelpImport } from './routes/(app)/help'
import { Route as appContactsImport } from './routes/(app)/contacts'
import { Route as appViewItemIdImport } from './routes/(app)/view.$itemId'

// Create/Update Routes

const AuthRouteRoute = AuthRouteImport.update({
  id: '/auth',
  path: '/auth',
  getParentRoute: () => rootRoute,
} as any)

const appRouteRoute = appRouteImport.update({
  id: '/(app)',
  getParentRoute: () => rootRoute,
} as any)

const appIndexRoute = appIndexImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => appRouteRoute,
} as any)

const AuthSignupRoute = AuthSignupImport.update({
  id: '/signup',
  path: '/signup',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthSigninRoute = AuthSigninImport.update({
  id: '/signin',
  path: '/signin',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthResetPasswordRoute = AuthResetPasswordImport.update({
  id: '/reset-password',
  path: '/reset-password',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthForgotPasswordRoute = AuthForgotPasswordImport.update({
  id: '/forgot-password',
  path: '/forgot-password',
  getParentRoute: () => AuthRouteRoute,
} as any)

const appToolsRoute = appToolsImport.update({
  id: '/tools',
  path: '/tools',
  getParentRoute: () => appRouteRoute,
} as any)

const appSettingsRoute = appSettingsImport.update({
  id: '/settings',
  path: '/settings',
  getParentRoute: () => appRouteRoute,
} as any)

const appLibraryRoute = appLibraryImport.update({
  id: '/library',
  path: '/library',
  getParentRoute: () => appRouteRoute,
} as any)

const appIntegrationRoute = appIntegrationImport.update({
  id: '/integration',
  path: '/integration',
  getParentRoute: () => appRouteRoute,
} as any)

const appInsightsRoute = appInsightsImport.update({
  id: '/insights',
  path: '/insights',
  getParentRoute: () => appRouteRoute,
} as any)

const appHelpRoute = appHelpImport.update({
  id: '/help',
  path: '/help',
  getParentRoute: () => appRouteRoute,
} as any)

const appContactsRoute = appContactsImport.update({
  id: '/contacts',
  path: '/contacts',
  getParentRoute: () => appRouteRoute,
} as any)

const appViewItemIdRoute = appViewItemIdImport.update({
  id: '/view/$itemId',
  path: '/view/$itemId',
  getParentRoute: () => appRouteRoute,
} as any)

// Populate the FileRoutesByPath interface

declare module '@tanstack/react-router' {
  interface FileRoutesByPath {
    '/(app)': {
      id: '/(app)'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof appRouteImport
      parentRoute: typeof rootRoute
    }
    '/auth': {
      id: '/auth'
      path: '/auth'
      fullPath: '/auth'
      preLoaderRoute: typeof AuthRouteImport
      parentRoute: typeof rootRoute
    }
    '/(app)/contacts': {
      id: '/(app)/contacts'
      path: '/contacts'
      fullPath: '/contacts'
      preLoaderRoute: typeof appContactsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/help': {
      id: '/(app)/help'
      path: '/help'
      fullPath: '/help'
      preLoaderRoute: typeof appHelpImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/insights': {
      id: '/(app)/insights'
      path: '/insights'
      fullPath: '/insights'
      preLoaderRoute: typeof appInsightsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/integration': {
      id: '/(app)/integration'
      path: '/integration'
      fullPath: '/integration'
      preLoaderRoute: typeof appIntegrationImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/library': {
      id: '/(app)/library'
      path: '/library'
      fullPath: '/library'
      preLoaderRoute: typeof appLibraryImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/settings': {
      id: '/(app)/settings'
      path: '/settings'
      fullPath: '/settings'
      preLoaderRoute: typeof appSettingsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/tools': {
      id: '/(app)/tools'
      path: '/tools'
      fullPath: '/tools'
      preLoaderRoute: typeof appToolsImport
      parentRoute: typeof appRouteImport
    }
    '/auth/forgot-password': {
      id: '/auth/forgot-password'
      path: '/forgot-password'
      fullPath: '/auth/forgot-password'
      preLoaderRoute: typeof AuthForgotPasswordImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/reset-password': {
      id: '/auth/reset-password'
      path: '/reset-password'
      fullPath: '/auth/reset-password'
      preLoaderRoute: typeof AuthResetPasswordImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/signin': {
      id: '/auth/signin'
      path: '/signin'
      fullPath: '/auth/signin'
      preLoaderRoute: typeof AuthSigninImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/signup': {
      id: '/auth/signup'
      path: '/signup'
      fullPath: '/auth/signup'
      preLoaderRoute: typeof AuthSignupImport
      parentRoute: typeof AuthRouteImport
    }
    '/(app)/': {
      id: '/(app)/'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof appIndexImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/view/$itemId': {
      id: '/(app)/view/$itemId'
      path: '/view/$itemId'
      fullPath: '/view/$itemId'
      preLoaderRoute: typeof appViewItemIdImport
      parentRoute: typeof appRouteImport
    }
  }
}

// Create and export the route tree

interface appRouteRouteChildren {
  appContactsRoute: typeof appContactsRoute
  appHelpRoute: typeof appHelpRoute
  appInsightsRoute: typeof appInsightsRoute
  appIntegrationRoute: typeof appIntegrationRoute
  appLibraryRoute: typeof appLibraryRoute
  appSettingsRoute: typeof appSettingsRoute
  appToolsRoute: typeof appToolsRoute
  appIndexRoute: typeof appIndexRoute
  appViewItemIdRoute: typeof appViewItemIdRoute
}

const appRouteRouteChildren: appRouteRouteChildren = {
  appContactsRoute: appContactsRoute,
  appHelpRoute: appHelpRoute,
  appInsightsRoute: appInsightsRoute,
  appIntegrationRoute: appIntegrationRoute,
  appLibraryRoute: appLibraryRoute,
  appSettingsRoute: appSettingsRoute,
  appToolsRoute: appToolsRoute,
  appIndexRoute: appIndexRoute,
  appViewItemIdRoute: appViewItemIdRoute,
}

const appRouteRouteWithChildren = appRouteRoute._addFileChildren(
  appRouteRouteChildren,
)

interface AuthRouteRouteChildren {
  AuthForgotPasswordRoute: typeof AuthForgotPasswordRoute
  AuthResetPasswordRoute: typeof AuthResetPasswordRoute
  AuthSigninRoute: typeof AuthSigninRoute
  AuthSignupRoute: typeof AuthSignupRoute
}

const AuthRouteRouteChildren: AuthRouteRouteChildren = {
  AuthForgotPasswordRoute: AuthForgotPasswordRoute,
  AuthResetPasswordRoute: AuthResetPasswordRoute,
  AuthSigninRoute: AuthSigninRoute,
  AuthSignupRoute: AuthSignupRoute,
}

const AuthRouteRouteWithChildren = AuthRouteRoute._addFileChildren(
  AuthRouteRouteChildren,
)

export interface FileRoutesByFullPath {
  '/': typeof appIndexRoute
  '/auth': typeof AuthRouteRouteWithChildren
  '/contacts': typeof appContactsRoute
  '/help': typeof appHelpRoute
  '/insights': typeof appInsightsRoute
  '/integration': typeof appIntegrationRoute
  '/library': typeof appLibraryRoute
  '/settings': typeof appSettingsRoute
  '/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
  '/view/$itemId': typeof appViewItemIdRoute
}

export interface FileRoutesByTo {
  '/auth': typeof AuthRouteRouteWithChildren
  '/contacts': typeof appContactsRoute
  '/help': typeof appHelpRoute
  '/insights': typeof appInsightsRoute
  '/integration': typeof appIntegrationRoute
  '/library': typeof appLibraryRoute
  '/settings': typeof appSettingsRoute
  '/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
  '/': typeof appIndexRoute
  '/view/$itemId': typeof appViewItemIdRoute
}

export interface FileRoutesById {
  __root__: typeof rootRoute
  '/(app)': typeof appRouteRouteWithChildren
  '/auth': typeof AuthRouteRouteWithChildren
  '/(app)/contacts': typeof appContactsRoute
  '/(app)/help': typeof appHelpRoute
  '/(app)/insights': typeof appInsightsRoute
  '/(app)/integration': typeof appIntegrationRoute
  '/(app)/library': typeof appLibraryRoute
  '/(app)/settings': typeof appSettingsRoute
  '/(app)/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
  '/(app)/': typeof appIndexRoute
  '/(app)/view/$itemId': typeof appViewItemIdRoute
}

export interface FileRouteTypes {
  fileRoutesByFullPath: FileRoutesByFullPath
  fullPaths:
    | '/'
    | '/auth'
    | '/contacts'
    | '/help'
    | '/insights'
    | '/integration'
    | '/library'
    | '/settings'
    | '/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
    | '/view/$itemId'
  fileRoutesByTo: FileRoutesByTo
  to:
    | '/auth'
    | '/contacts'
    | '/help'
    | '/insights'
    | '/integration'
    | '/library'
    | '/settings'
    | '/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
    | '/'
    | '/view/$itemId'
  id:
    | '__root__'
    | '/(app)'
    | '/auth'
    | '/(app)/contacts'
    | '/(app)/help'
    | '/(app)/insights'
    | '/(app)/integration'
    | '/(app)/library'
    | '/(app)/settings'
    | '/(app)/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
    | '/(app)/'
    | '/(app)/view/$itemId'
  fileRoutesById: FileRoutesById
}

export interface RootRouteChildren {
  appRouteRoute: typeof appRouteRouteWithChildren
  AuthRouteRoute: typeof AuthRouteRouteWithChildren
}

const rootRouteChildren: RootRouteChildren = {
  appRouteRoute: appRouteRouteWithChildren,
  AuthRouteRoute: AuthRouteRouteWithChildren,
}

export const routeTree = rootRoute
  ._addFileChildren(rootRouteChildren)
  ._addFileTypes<FileRouteTypes>()

/* ROUTE_MANIFEST_START
{
  "routes": {
    "__root__": {
      "filePath": "__root.tsx",
      "children": [
        "/(app)",
        "/auth"
      ]
    },
    "/(app)": {
      "filePath": "(app)/route.tsx",
      "children": [
        "/(app)/contacts",
        "/(app)/help",
        "/(app)/insights",
        "/(app)/integration",
        "/(app)/library",
        "/(app)/settings",
        "/(app)/tools",
        "/(app)/",
        "/(app)/view/$itemId"
      ]
    },
    "/auth": {
      "filePath": "auth/route.tsx",
      "children": [
        "/auth/forgot-password",
        "/auth/reset-password",
        "/auth/signin",
        "/auth/signup"
      ]
    },
    "/(app)/contacts": {
      "filePath": "(app)/contacts.tsx",
      "parent": "/(app)"
    },
    "/(app)/help": {
      "filePath": "(app)/help.tsx",
      "parent": "/(app)"
    },
    "/(app)/insights": {
      "filePath": "(app)/insights.tsx",
      "parent": "/(app)"
    },
    "/(app)/integration": {
      "filePath": "(app)/integration.tsx",
      "parent": "/(app)"
    },
    "/(app)/library": {
      "filePath": "(app)/library.tsx",
      "parent": "/(app)"
    },
    "/(app)/settings": {
      "filePath": "(app)/settings.tsx",
      "parent": "/(app)"
    },
    "/(app)/tools": {
      "filePath": "(app)/tools.tsx",
      "parent": "/(app)"
    },
    "/auth/forgot-password": {
      "filePath": "auth/forgot-password.tsx",
      "parent": "/auth"
    },
    "/auth/reset-password": {
      "filePath": "auth/reset-password.tsx",
      "parent": "/auth"
    },
    "/auth/signin": {
      "filePath": "auth/signin.tsx",
      "parent": "/auth"
    },
    "/auth/signup": {
      "filePath": "auth/signup.tsx",
      "parent": "/auth"
    },
    "/(app)/": {
      "filePath": "(app)/index.tsx",
      "parent": "/(app)"
    },
    "/(app)/view/$itemId": {
      "filePath": "(app)/view.$itemId.tsx",
      "parent": "/(app)"
    }
  }
}
ROUTE_MANIFEST_END */

```

## File: src/client.tsx

```tsx
import { StartClient } from "@tanstack/react-start";
import { hydrateRoot } from "react-dom/client";

import { createRouter } from "./router";

const router = createRouter();

hydrateRoot(document, <StartClient router={router} />);

```

## File: src/components/search-form.tsx

```tsx
import { Search } from "lucide-react";
import { Input } from "@app/ui/components/input";

interface SearchFormProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'onChange'> {
    value: string;
    onChange: (event: React.ChangeEvent<HTMLInputElement>) => void;
}

export function SearchForm({ value, onChange, ...props }: SearchFormProps) {
    return (
        <form onSubmit={(e) => e.preventDefault()} className="py-1 px-2">
            <div className="relative">
                <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                <Input
                    type="search"
                    placeholder="Search..."
                    className="w-full rounded-md bg-background pl-8 h-8 text-sm"
                    value={value}
                    onChange={onChange}
                    {...props}
                />
            </div>
        </form>
    );
}
```

## File: src/components/workspace-switcher.tsx

```tsx
import {
    ChevronsUpDown,
    LogOut,
    Plus,
    Settings,
    User as UserIcon,
    Check,
    MoonIcon,
    SunIcon,
} from 'lucide-react';
import * as React from 'react';
import { useNavigate, useRouteContext } from '@tanstack/react-router';

import { Avatar, AvatarFallback, AvatarImage } from '@app/ui/components/avatar';
import { Button } from '@app/ui/components/button';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger,
} from '@app/ui/components/dropdown-menu';
import {
    Tooltip,
    TooltipContent,
    TooltipProvider,
    TooltipTrigger,
} from '@app/ui/components/tooltip';
import {
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
} from "@app/ui/components/sidebar"; // Using your sidebar structure
import { useTheme } from '@/lib/hooks/use-theme';
import type { User } from '@/lib/providers/session';


// Define the Workspace type (or import it)
export type Workspace = {
    id: string;
    name: string;
    icon?: React.ElementType;
    color?: string;
    role: 'Owner' | 'Admin' | 'Member';
    members: number;
};

// --- Mock Data (Replace with your actual data fetching/props) ---
const MOCK_WORKSPACES: Workspace[] = [
    { id: 'research', name: 'Research Workspace', role: 'Owner', members: 5, color: 'hsl(210, 80%, 60%)', icon: UserIcon }, // Example icon/color
    { id: 'personal', name: 'Personal Space', role: 'Owner', members: 1, color: 'hsl(140, 50%, 60%)' },
    { id: 'team-alpha', name: 'Team Alpha', role: 'Member', members: 8, color: 'hsl(30, 80%, 60%)', icon: UserIcon },
];
// --- End Mock Data ---

// --- Helper Function for Initials ---
function getInitials(name?: string | null): string {
    if (!name) return '?';
    const names = name.split(' ');
    if (names.length === 1) return names[0].charAt(0).toUpperCase();
    return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
}

const WorkspaceIcon: React.FC<{ workspace: Workspace; className?: string }> = ({ workspace, className = 'size-5' }) => {
    const IconComponent = workspace.icon ?? UserIcon;
    const bgColor = workspace.color ?? 'hsl(var(--muted))';

    return (
        <Avatar className={` ${className}`}>
            <AvatarFallback
                className="text-[9px] font-medium text-white"
                style={{ backgroundColor: bgColor }}
            >
                <IconComponent className="size-3/5" />
            </AvatarFallback>
        </Avatar>
    );
};

interface WorkSpaceSwitcherProps {
    onSignOut: () => Promise<void>;
}

export function WorkSpaceSwitcher({
    onSignOut,
}: WorkSpaceSwitcherProps) {
    const navigate = useNavigate();

    const { user } = useRouteContext({
        from: '__root__',
        select: (context) => ({ user: context.user }),
    });

    const { toggleTheme, theme } = useTheme();

    // --- State for current workspace (replace with your logic) ---
    // This might come from a global state, URL param, or prop
    const [currentWorkspaceId, setCurrentWorkspaceId] = React.useState<string | null>(MOCK_WORKSPACES[0]?.id ?? null);
    const workspaces = MOCK_WORKSPACES; // Use mock or fetched data
    // --- End State ---

    const currentWorkspace = React.useMemo(
        () => workspaces.find((w) => w.id === currentWorkspaceId),
        [workspaces, currentWorkspaceId]
    );

    // --- Action Handlers (Implement or pass as props) ---
    const handleSwitchWorkspace = (workspaceId: string) => {
        console.log(`Switching to workspace: ${workspaceId}`);
        setCurrentWorkspaceId(workspaceId);
        // Add logic: Update global state, refetch data, navigate, etc.
        // toast.success(`Switched to ${workspaces.find(w => w.id === workspaceId)?.name}`); // Optional: Add toast notifications
    };

    const handleCreateWorkspace = () => {
        console.log('Trigger Create Workspace action');
        // Add logic: Open modal, navigate to create page, etc.
        // pushModal('CreateWorkspace'); // If using a modal system
        // toast.info('Create Workspace dialog would open here'); // Optional notification
    };
    // --- End Action Handlers ---


    // Signed Out State (Optional: Can be handled by router redirect)
    if (!user) {
        return (
            <SidebarMenu>
                <SidebarMenuItem>
                    <SidebarMenuButton
                        size="md"
                        className="gap-3"
                        onClick={() => navigate({ to: '/auth/signin' })} // Navigate to your login route
                    >
                        <UserIcon className="size-5 text-muted-foreground" /> {/* Use a generic user icon */}
                        <div className="grid flex-1 text-left">
                            <span className="font-medium">Sign In</span>
                        </div>
                    </SidebarMenuButton>
                </SidebarMenuItem>
            </SidebarMenu>
        );
    }

    // Signed In State
    return (
        <TooltipProvider delayDuration={150}>
            <SidebarMenu>
                <SidebarMenuItem>
                    <DropdownMenu>
                        <DropdownMenuTrigger asChild>
                            <SidebarMenuButton
                                size="md" // Or adjust size as needed
                                className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground gap-2.5 [&>svg]:size-auto"
                            >
                                {/* User Avatar */}
                                <Avatar className="size-6 border border-border">
                                    {/* <AvatarImage alt={user.name ?? ''} src={user.image ?? ''} /> */}
                                    <AvatarFallback className="text-[10px]">
                                        {/* {getInitials(user.name)} */}
                                    </AvatarFallback>
                                </Avatar>

                                {/* Current Workspace Info */}
                                <div className="grid flex-1 text-left text-sm leading-tight">
                                    <span className="truncate font-medium">
                                        {currentWorkspace?.name ?? 'Select Workspace'}
                                    </span>
                                </div>

                                {/* Dropdown Indicator */}
                                <ChevronsUpDown
                                    className="ms-auto text-muted-foreground/60"
                                    size={16}
                                    aria-hidden="true"
                                />
                            </SidebarMenuButton>
                        </DropdownMenuTrigger>

                        <DropdownMenuContent
                            className="w-[--radix-dropdown-menu-trigger-width] min-w-64 rounded-lg pb-2"
                            align="start"
                            side="bottom"
                            sideOffset={6}
                        >
                            {/* User Info Header */}
                            <div className="flex items-center space-x-3 p-3 relative">
                                <Avatar className="size-9 border border-border">
                                    <AvatarImage alt={user.name!} src={user.image!} />
                                    <AvatarFallback>{getInitials(user.name)}</AvatarFallback>
                                </Avatar>
                                <div className="flex flex-col items-start justify-center space-y-0.5 text-start">
                                    <p className="line-clamp-1 text-sm font-medium">{user.name ?? 'User'}</p>
                                    <p className="text-xs font-medium leading-none text-muted-foreground">{user.email ?? 'No email'}</p>
                                </div>
                                <Tooltip>
                                    <TooltipTrigger asChild>
                                        <Button
                                            variant="ghost"
                                            size="icon"
                                            className="absolute top-1 right-1 text-muted-foreground hover:text-foreground"
                                            onClick={() => navigate({ to: '/settings' })}
                                        >
                                            <Settings className="size-4" />
                                            <span className="sr-only">Account Settings</span>
                                        </Button>
                                    </TooltipTrigger>
                                    <TooltipContent side="bottom">Account Settings</TooltipContent>
                                </Tooltip>
                            </div>
                            <DropdownMenuSeparator />

                            {/* Workspace Selection */}
                            <DropdownMenuLabel className="px-2 py-1.5 text-xs font-semibold text-muted-foreground">
                                Workspaces
                            </DropdownMenuLabel>
                            <DropdownMenuGroup className="max-h-[250px] overflow-y-auto">
                                {workspaces.map((workspace) => (
                                    <DropdownMenuItem
                                        key={workspace.id}
                                        className="flex items-center gap-2.5 px-2 py-1.5 cursor-pointer"
                                        onClick={() => handleSwitchWorkspace(workspace.id)}
                                        disabled={workspace.id === currentWorkspaceId}
                                    >
                                        <WorkspaceIcon workspace={workspace} className="size-5" />
                                        <div className="flex flex-col flex-1">
                                            <span className="text-sm font-medium">{workspace.name}</span>
                                            <span className="text-xs text-muted-foreground">
                                                {workspace.role} • {workspace.members} member{workspace.members !== 1 ? 's' : ''}
                                            </span>
                                        </div>
                                        {workspace.id === currentWorkspaceId && (
                                            <Check className="size-4 ml-auto text-primary" />
                                        )}
                                    </DropdownMenuItem>
                                ))}
                            </DropdownMenuGroup>

                            {/* Create Workspace */}
                            <DropdownMenuItem
                                className="flex items-center gap-2.5 px-2 py-1.5 cursor-pointer"
                                onClick={handleCreateWorkspace}
                            >
                                <div className="flex size-5 items-center justify-center rounded-sm bg-muted"> {/* Subtle background for icon */}
                                    <Plus className="size-3.5 text-muted-foreground" />
                                </div>
                                <span className="text-sm">Create Workspace</span>
                            </DropdownMenuItem>

                            <DropdownMenuSeparator />

                            {/* Other Actions */}
                            <DropdownMenuGroup>
                                {/* Placeholder: Theme Toggle */}
                                <DropdownMenuItem
                                    onClick={toggleTheme}
                                    className="gap-2 h-7 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
                                >
                                    {theme === 'light' ? (
                                        <SunIcon
                                            className="text-muted-foreground"
                                            size={16}
                                            aria-hidden="true"
                                        />
                                    ) : (
                                        <MoonIcon
                                            className="text-muted-foreground"
                                            size={16}
                                            aria-hidden="true"
                                        />
                                    )}
                                    <span>Theme</span>
                                </DropdownMenuItem>

                                <DropdownMenuItem
                                    className="flex items-center gap-2.5 h-7 cursor-pointer"
                                    onClick={onSignOut}
                                >
                                    <LogOut className="size-3.5 text-muted-foreground" />
                                    <span className="text-xs">Sign Out</span>
                                </DropdownMenuItem>
                            </DropdownMenuGroup>
                        </DropdownMenuContent>
                    </DropdownMenu>
                </SidebarMenuItem>
            </SidebarMenu>
        </TooltipProvider>
    );
}
```

## File: src/components/app-sidebar.tsx

```tsx
import { Link, useMatches, useNavigate, useRouteContext } from "@tanstack/react-router";
import * as React from "react";
import * as Icons from 'lucide-react';
import type { TreeItemIndex } from 'react-complex-tree';

import { WorkSpaceSwitcher } from "./workspace-switcher";
import {
    Sidebar,
    SidebarContent,
    SidebarFooter,
    SidebarGroup,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarHeader,
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
    SidebarRail,
} from "@app/ui/components/sidebar";
import { HierarchicalSection } from "./hierarchical-section";
import { initialDocumentItems, initialLibraryItems, type ExtendedTreeItem } from "@/lib/mock/sidebar-data";
import { SearchForm } from "./search-form";
import { useLayoutStore } from "@/lib/store/useLayoutStore";

interface ViewSearch {
    name?: string;
    type?: string;
    icon?: string;
}

interface ViewParams {
    itemId: string;
}


const staticNavData = {
    navMain: [
        {
            title: "Sections",
            url: "#",
            items: [
                { title: "Dashboard", url: "/", icon: Icons.LayoutDashboard },
                { title: "Insights", url: "/insights", icon: Icons.BarChart2 },
                { title: "Contacts", url: "/contacts", icon: Icons.Users },
                { title: "Tools", url: "/tools", icon: Icons.Bot },
                { title: "Integration", url: "/integration", icon: Icons.Link },
                { title: "Library", url: "/library", icon: Icons.Library },
            ],
        },
        {
            title: "Other",
            url: "#",
            items: [
                { title: "Settings", url: "/settings", icon: Icons.Settings },
                { title: "Help Center", url: "/help", icon: Icons.HelpCircle },
            ],
        },
    ],
};


interface AppSidebarProps {
    onSignOut: () => Promise<void>;
}

export function AppSidebar({ onSignOut }: AppSidebarProps) {
    const { user } = useRouteContext({
        from: '__root__',
        select: (context) => ({ user: context.user }),
    });
    const matches = useMatches();
    const navigate = useNavigate();
    const [searchTerm, setSearchTerm] = React.useState("");
    const activeLayoutTabId = useLayoutStore((state) => state.activeTabId);

    // Function to check if a route (static or dynamic view) is active
    const isRouteActive = (urlOrItemId: string, isHierarchical = false) => {
        if (!matches || !Array.isArray(matches) || matches.length === 0) return false;

        const latestMatch = matches[matches.length - 1];
        if (!latestMatch) return false;

        const currentPathname = latestMatch.pathname;

        if (isHierarchical) {
            // FIX 1: Safely access params and ensure comparison is string vs string
            const currentItemIdParam = (latestMatch.params as ViewParams)?.itemId; // Explicitly type params
            const itemIdAsString = String(urlOrItemId); // Ensure we compare strings

            return (currentPathname.startsWith('/view/') && currentItemIdParam === itemIdAsString) ||
                (activeLayoutTabId === itemIdAsString);
        } else {
            // Handle static routes
            if (!urlOrItemId || urlOrItemId === '#') return false;
            if (urlOrItemId === "/") {
                return currentPathname === "/";
            }
            return currentPathname === urlOrItemId || currentPathname.startsWith(urlOrItemId + '/');
        }
    };


    // --- MODIFIED: Handle tree item click to navigate to the view route ---
    const handleTreeItemClick = (item: ExtendedTreeItem) => {
        console.log("Tree item clicked:", item.index, item.data.name);

        // FIX 2: Convert item.index to string for the parameter
        const itemIdStr = String(item.index);
        const targetPath = `/view/$itemId`;
        const params: ViewParams = { itemId: itemIdStr }; // Use ViewParams type

        let iconName: string | undefined = undefined;
        if (typeof item.data.icon === 'function') {
            iconName = item.data.icon.displayName || item.data.icon.name;
        } else if (typeof item.data.icon === 'string') {
            iconName = item.data.icon;
        }

        const searchParams: ViewSearch = {
            name: item.data.name,
            type: item.data.type,
            icon: iconName,
        };

        navigate({
            to: targetPath,
            params: params, // Pass explicitly typed params
            search: searchParams,
            replace: false
        });
    };
    // --- END MODIFICATION ---

    return (
        <Sidebar>
            <SidebarHeader>
                <WorkSpaceSwitcher onSignOut={onSignOut} />
                <hr className="border-t border-border" />
                {/* FIX 3: Correct event type for SearchForm onChange */}
                <SearchForm
                    value={searchTerm}
                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)} // Correct event type
                />
            </SidebarHeader>
            <SidebarContent>
                {/* Static Navigation */}
                {staticNavData.navMain.map((group) => (
                    <SidebarGroup key={group.title}>
                        <SidebarGroupLabel className="uppercase text-muted-foreground/60">
                            {group.title}
                        </SidebarGroupLabel>
                        <SidebarGroupContent>
                            <SidebarMenu>
                                {group.items.map((item) => (
                                    <SidebarMenuItem key={item.title}>
                                        <SidebarMenuButton
                                            asChild
                                            className="group/menu-button font-medium gap-3 h-8 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
                                            isActive={isRouteActive(item.url)}
                                        >
                                            <Link to={item.url}>
                                                {item.icon && (
                                                    <item.icon
                                                        className="text-muted-foreground/60 group-data-[active=true]/menu-button:text-primary flex-shrink-0"
                                                        size={16}
                                                        aria-hidden="true"
                                                    />
                                                )}
                                                <span className="truncate">{item.title}</span>
                                            </Link>
                                        </SidebarMenuButton>
                                    </SidebarMenuItem>
                                ))}
                            </SidebarMenu>
                        </SidebarGroupContent>
                    </SidebarGroup>
                ))}

                {/* Hierarchical Sections */}
                <HierarchicalSection
                    title="Documents"
                    treeId="documents-tree"
                    initialItems={initialDocumentItems}
                    rootItem="root"
                    searchTerm={searchTerm}
                    onPrimaryAction={handleTreeItemClick}
                    activeItemId={activeLayoutTabId}
                    // FIX 4: Ensure itemId passed to isRouteActive is a string
                    isItemActive={(itemId: TreeItemIndex) => isRouteActive(String(itemId), true)}
                />

                <HierarchicalSection
                    title="Library"
                    treeId="library-tree"
                    initialItems={initialLibraryItems}
                    rootItem="root"
                    searchTerm={searchTerm}
                    onPrimaryAction={handleTreeItemClick}
                    activeItemId={activeLayoutTabId}
                    // FIX 4: Ensure itemId passed to isRouteActive is a string
                    isItemActive={(itemId: TreeItemIndex) => isRouteActive(String(itemId), true)}
                />

            </SidebarContent>
            <SidebarFooter>
                {/* Footer content */}
            </SidebarFooter>
            <SidebarRail />
        </Sidebar>
    );
}

```


## File: src/components/theme-toggle.tsx

```tsx
import { useTheme } from "@/lib/hooks/use-theme";
import { SunIcon, MoonIcon } from "lucide-react";
import { SidebarMenuButton } from "@app/ui/components/sidebar";

export function ThemeToggle() {
    const { toggleTheme, theme } = useTheme();

    return (
        <SidebarMenuButton
            onClick={toggleTheme}
            className="font-medium gap-3 h-8 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
        >
            {theme === 'light' ? (
                <SunIcon
                    className="text-muted-foreground/60"
                    size={16}
                    aria-hidden="true"
                />
            ) : (
                <MoonIcon
                    className="text-muted-foreground/60"
                    size={16}
                    aria-hidden="true"
                />
            )}
            <span>Theme</span>
        </SidebarMenuButton>
    );
}
```


## File: src/components/view/placeholders.tsx

```tsx
// src/components/view/placeholders.tsx
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@app/ui/components/card';
import { FileText, Book, HelpCircle } from 'lucide-react';
import type { TabNode } from '@app/layout'; // Import TabNode type

interface PlaceholderProps {
    node: TabNode; // Receive the TabNode
}

const BasePlaceholder: React.FC<PlaceholderProps & { Icon: React.ElementType, typeLabel: string }> = ({ node, Icon, typeLabel }) => {
    const itemId = node.getConfig()?.itemId ?? node.getId(); // Get ID from config or node itself

    return (
        <div className="p-4 h-full w-full box-border overflow-auto">
            <Card>
                <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                        <Icon className="h-5 w-5 text-primary" />
                        {node.getName()}
                    </CardTitle>
                </CardHeader>
                <CardContent>
                    <p>This is a placeholder for a <span className='font-semibold'>{typeLabel}</span>.</p>
                    <p className="mt-2 text-sm text-muted-foreground">Item ID: {itemId}</p>
                    <p className="mt-1 text-sm text-muted-foreground">Component Type: {node.getComponent()}</p>
                    {/* Add more details or specific rendering later */}
                </CardContent>
            </Card>
        </div>
    );
};

export const DocumentPlaceholder: React.FC<PlaceholderProps> = (props) => (
    <BasePlaceholder {...props} Icon={FileText} typeLabel="Document" />
);

export const LibraryItemPlaceholder: React.FC<PlaceholderProps> = (props) => (
    <BasePlaceholder {...props} Icon={Book} typeLabel="Library Item" />
);

// Add more placeholders as needed (e.g., Dashboard, Settings)

export const UnknownPlaceholder: React.FC<PlaceholderProps> = (props) => (
    <BasePlaceholder {...props} Icon={HelpCircle} typeLabel={`Unknown (${props.node.getComponent()})`} />
);
```

## File: src/lib/providers/session.tsx

```tsx
import { createContext, useContext, useState, useEffect } from "react";
import { authClient } from "@app/auth/client";

export interface User {
    id: string;
    email: string;
    emailVerified: boolean;
    name: string;
    createdAt: Date;
    updatedAt: Date;
    image?: string | null;
    onboardingComplete?: boolean | null;
    banned: boolean;
    role?: string | null;
    metadata?: Record<string, any> | null;
    preferences?: Record<string, any> | null;
    banExpires?: Date | null;
}

interface SessionContextType {
    user: User | null;
    session: any | null;
    loaded: boolean;
    reloadSession: () => Promise<void>;
}

const SessionContext = createContext<SessionContextType>({
    user: null,
    session: null,
    loaded: false,
    reloadSession: async () => { },
});

export function SessionProvider({
    children,
    initialUser
}: {
    children: React.ReactNode;
    initialUser?: User | null;
}) {
    const [session, setSession] = useState<any | null>(null);
    const [user, setUser] = useState<User | null>(initialUser || null);
    const [loaded, setLoaded] = useState(false);

    const loadSession = async () => {
        try {
            const { data, error } = await authClient.getSession();

            if (error) {
                console.error("Failed to fetch session:", error);
                setUser(null);
                setSession(null);
            } else if (data) {
                const userData = data.user as User;

                if (userData) {
                    if (userData.banned === undefined) {
                        userData.banned = false;
                    }
                }

                setUser(userData);
                setSession(data.session);
            }

            setLoaded(true);
        } catch (error) {
            console.error("Error fetching session:", error);
            setLoaded(true);
        }
    };

    useEffect(() => {
        if (!initialUser) {
            loadSession();
        }
    }, [initialUser]);

    const reloadSession = async () => {
        await loadSession();
    };

    return (
        <SessionContext.Provider
            value={{
                user,
                session,
                loaded,
                reloadSession,
            }}
        >
            {children}
        </SessionContext.Provider>
    );
}

export function useSession() {
    const context = useContext(SessionContext);

    if (context === undefined) {
        throw new Error("useSession must be used within a SessionProvider");
    }

    return context;
}
```

## File: src/lib/mock/sidebar-data.ts

```typescript
// src/lib/sidebar-data.ts
import {
    type TreeItem,
    type TreeItemIndex
} from "react-complex-tree";
import {
    FileText,
    Folder,
    BookOpen,
    Briefcase,
    Users,
    FilePieChart,
    ClipboardList,
    Goal,
    CalendarDays,
    Paintbrush,
    Code2,
    Wrench,
    Palette,
    FunctionSquare,
    Database, Lightbulb,
    ShieldCheck, // Example, might not be used below
    Scale
} from "lucide-react";

export interface ItemData {
    name: string;
    type: 'folder' | 'document' | 'library-item';
    icon?: React.ElementType;
    emoji?: string;
    url?: string;
}

export type ExtendedTreeItem = TreeItem<ItemData>;
export type TreeItems = Record<TreeItemIndex, ExtendedTreeItem>;

let idCounter = 0;
const createItem = (
    name: string,
    type: ItemData['type'],
    childrenIds: TreeItemIndex[] = [],
    emoji?: string,
    url?: string,
    icon?: React.ElementType,
): Record<TreeItemIndex, ExtendedTreeItem> => {
    const id: TreeItemIndex = `${type}-${idCounter++}`;
    const isFolder = type === 'folder' || childrenIds.length > 0;
    const item: ExtendedTreeItem = {
        index: id,
        data: { name, type, emoji, url, icon: icon },
        isFolder: isFolder,
        children: childrenIds,
        canMove: true,
        canRename: true,
    };
    return { [id]: item };
};

// --- Default Icons ---
export const defaultIcons: { [key in ItemData['type']]: React.ElementType } = {
    folder: Folder,
    document: FileText,
    'library-item': BookOpen,
};

// --- MOCK DOCUMENTS DATA ---

// Level 3/4 Items (Deepest) - No change needed here
const doc_phoenix_proto_v1 = createItem("Mobile Prototype", "document", [], "📱", "/docs/projects/phoenix/design/proto-v1");
const doc_phoenix_proto_v2 = createItem("Desktop Prototype", "document", [], "💻", "/docs/projects/phoenix/design/proto-v2");
const doc_phoenix_interviews_raw = createItem("Raw Interview Notes", "document", [], "🗒️", "/docs/projects/phoenix/research/interviews-raw");
const doc_chimera_api_auth = createItem("Auth Endpoints", "document", [], "🔑", "/docs/projects/chimera/api/auth");
const doc_chimera_api_users = createItem("User Endpoints", "document", [], "👤", "/docs/projects/chimera/api/users");
const doc_hr_policy_pto = createItem("PTO Policy", "document", [], "🌴", "/docs/company/hr/pto");
const doc_legal_nda_vendor = createItem("Vendor NDA", "document", [], "✍️", "/docs/company/legal/nda-vendor");
const doc_finance_expense_guide = createItem("Expense Reporting Guide", "document", [], "🧾", "/docs/company/finance/expense-guide");
const doc_meetings_q3_kickoff_slides = createItem("Q3 Kickoff Slides", "document", [], "📊", "/docs/meetings/q3-2024/kickoff-slides");

// Level 2 Items - No change needed here
const doc_folder_phoenix_proto = createItem("Prototypes", "folder", [Object.keys(doc_phoenix_proto_v1)[0], Object.keys(doc_phoenix_proto_v2)[0]], "🖼️", undefined, Paintbrush);
const doc_phoenix_design_system = createItem("Design System Specs", "document", [], "🎨", "/docs/projects/phoenix/design/system");
const doc_phoenix_spec_core = createItem("Core Feature Spec", "document", [], "💡", "/docs/projects/phoenix/specs/core");
const doc_phoenix_spec_arch = createItem("Architecture Overview", "document", [], "🏗️", "/docs/projects/phoenix/specs/arch");
const doc_folder_phoenix_research_sum = createItem("Research Summaries", "folder", [], "📊");
const doc_folder_phoenix_interviews = createItem("User Interviews", "folder", [Object.keys(doc_phoenix_interviews_raw)[0]], "🗣️");
const doc_folder_chimera_api = createItem("API Docs", "folder", [Object.keys(doc_chimera_api_auth)[0], Object.keys(doc_chimera_api_users)[0]], "☁️");
const doc_chimera_backend_schema = createItem("DB Schema", "document", [], "💾", "/docs/projects/chimera/backend/schema", Database);
const doc_chimera_frontend_setup = createItem("Setup Guide", "document", [], "🛠️", "/docs/projects/chimera/frontend/setup");
const doc_hr_onboarding = createItem("Onboarding Checklist", "document", [], "✅", "/docs/company/hr/onboarding", ClipboardList);
const doc_folder_hr_policies = createItem("Policies", "folder", [Object.keys(doc_hr_policy_pto)[0]], "📜");
const doc_legal_tos = createItem("Terms of Service", "document", [], "📄", "/docs/company/legal/tos", Scale);
const doc_folder_legal_nda = createItem("NDAs", "folder", [Object.keys(doc_legal_nda_vendor)[0]], "🤫");
const doc_finance_report_q1 = createItem("Q1 Financial Report", "document", [], "📈", "/docs/company/finance/q1-report", FilePieChart);
const doc_finance_report_q2 = createItem("Q2 Financial Report", "document", [], "📉", "/docs/company/finance/q2-report", FilePieChart);
const doc_folder_finance_guides = createItem("Guides", "folder", [Object.keys(doc_finance_expense_guide)[0]], "📖");
const doc_meetings_q3_kickoff = createItem("Q3 Kickoff Meeting", "document", [Object.keys(doc_meetings_q3_kickoff_slides)[0]], "🚀", "/docs/meetings/q3-2024/kickoff");
const doc_meetings_product_sync_notes = createItem("Product Sync Notes", "document", [], "🗣️", "/docs/meetings/product-syncs/notes");
const doc_meetings_eng_sync_notes = createItem("Engineering Sync Notes", "document", [], "⚙️", "/docs/meetings/eng-syncs/notes");

// Level 1 Items - No change needed here
const doc_folder_phoenix_design = createItem("Design", "folder", [Object.keys(doc_folder_phoenix_proto)[0], Object.keys(doc_phoenix_design_system)[0]], "🎨", undefined, Paintbrush);
const doc_folder_phoenix_specs = createItem("Specifications", "folder", [Object.keys(doc_phoenix_spec_core)[0], Object.keys(doc_phoenix_spec_arch)[0]], "📝");
const doc_folder_phoenix_research = createItem("User Research", "folder", [Object.keys(doc_folder_phoenix_interviews)[0], Object.keys(doc_folder_phoenix_research_sum)[0]], "🧑‍🔬", undefined, Users);
const doc_folder_chimera_backend = createItem("Backend", "folder", [Object.keys(doc_chimera_backend_schema)[0]], "⚙️");
const doc_folder_chimera_frontend = createItem("Frontend", "folder", [Object.keys(doc_chimera_frontend_setup)[0]], "💻");
const doc_folder_hr = createItem("Human Resources", "folder", [Object.keys(doc_hr_onboarding)[0], Object.keys(doc_folder_hr_policies)[0]], "👥", undefined, Users);
const doc_folder_legal = createItem("Legal", "folder", [Object.keys(doc_legal_tos)[0], Object.keys(doc_folder_legal_nda)[0]], "⚖️", undefined, Scale);
const doc_folder_finance = createItem("Finance", "folder", [Object.keys(doc_finance_report_q1)[0], Object.keys(doc_finance_report_q2)[0], Object.keys(doc_folder_finance_guides)[0]], "💰", undefined, FilePieChart);
const doc_folder_meetings_q3 = createItem("Q3 2024", "folder", [Object.keys(doc_meetings_q3_kickoff)[0]], "📅");
const doc_folder_meetings_product = createItem("Product Syncs", "folder", [Object.keys(doc_meetings_product_sync_notes)[0]], "🎯");
const doc_folder_meetings_eng = createItem("Eng Syncs", "folder", [Object.keys(doc_meetings_eng_sync_notes)[0]], "🛠️");

// *** FIX STARTS HERE ***

// Create Level 1 Project Folders first
const doc_subfolder_phoenix = createItem("Project Phoenix", "folder", [Object.keys(doc_folder_phoenix_specs)[0], Object.keys(doc_folder_phoenix_design)[0], Object.keys(doc_folder_phoenix_research)[0]], "🔥", undefined, Briefcase);
const doc_subfolder_phoenix_id = Object.keys(doc_subfolder_phoenix)[0];

const doc_subfolder_chimera = createItem("Project Chimera", "folder", [Object.keys(doc_folder_chimera_api)[0], Object.keys(doc_folder_chimera_backend)[0], Object.keys(doc_folder_chimera_frontend)[0]], "🐉", undefined, Briefcase);
const doc_subfolder_chimera_id = Object.keys(doc_subfolder_chimera)[0];

// Level 0 Items (Under Root) - Now use the IDs from above
const doc_folder_projects = createItem("Projects", "folder", [
    doc_subfolder_phoenix_id, // Use the ID
    doc_subfolder_chimera_id, // Use the ID
], "🚀", undefined, Briefcase);

const doc_folder_company = createItem("Company Docs", "folder", [Object.keys(doc_folder_hr)[0], Object.keys(doc_folder_legal)[0], Object.keys(doc_folder_finance)[0]], "🏢");
const doc_folder_meetings = createItem("Meetings", "folder", [Object.keys(doc_folder_meetings_q3)[0], Object.keys(doc_folder_meetings_product)[0], Object.keys(doc_folder_meetings_eng)[0]], "🗓️", undefined, CalendarDays);
const doc_roadmap = createItem("Roadmap Q4 2024", "document", [], "🗺️", "/docs/roadmap-q4", Goal);
const doc_quick_notes = createItem("Quick Notes", "document", [], "✏️", "/docs/quick-notes");

export const initialDocumentItems: TreeItems = {
    root: {
        index: "root",
        data: { name: "Documents Root", type: "folder" },
        isFolder: true,
        children: [
            Object.keys(doc_folder_projects)[0], // Use the ID
            Object.keys(doc_folder_company)[0],
            Object.keys(doc_folder_meetings)[0],
            Object.keys(doc_roadmap)[0],
            Object.keys(doc_quick_notes)[0],
        ]
    },
    // Spread all created items - including the subfolders created above
    ...doc_folder_projects,
    ...doc_subfolder_phoenix, // Spread the intermediate folder
    ...doc_subfolder_chimera, // Spread the intermediate folder
    ...doc_folder_phoenix_specs, ...doc_folder_phoenix_design, ...doc_folder_phoenix_research,
    ...doc_folder_phoenix_proto, ...doc_phoenix_design_system, ...doc_phoenix_spec_core, ...doc_phoenix_spec_arch,
    ...doc_folder_phoenix_interviews, ...doc_folder_phoenix_research_sum, ...doc_phoenix_proto_v1, ...doc_phoenix_proto_v2, ...doc_phoenix_interviews_raw,
    ...doc_folder_chimera_api, ...doc_folder_chimera_backend, ...doc_folder_chimera_frontend,
    ...doc_chimera_api_auth, ...doc_chimera_api_users, ...doc_chimera_backend_schema, ...doc_chimera_frontend_setup,
    ...doc_folder_company, ...doc_folder_hr, ...doc_folder_legal, ...doc_folder_finance,
    ...doc_hr_onboarding, ...doc_folder_hr_policies, ...doc_hr_policy_pto,
    ...doc_legal_tos, ...doc_folder_legal_nda, ...doc_legal_nda_vendor,
    ...doc_finance_report_q1, ...doc_finance_report_q2, ...doc_folder_finance_guides, ...doc_finance_expense_guide,
    ...doc_folder_meetings, ...doc_folder_meetings_q3, ...doc_folder_meetings_product, ...doc_folder_meetings_eng,
    ...doc_meetings_q3_kickoff, ...doc_meetings_q3_kickoff_slides, ...doc_meetings_product_sync_notes, ...doc_meetings_eng_sync_notes,
    ...doc_roadmap, ...doc_quick_notes,
};


// --- MOCK LIBRARY DATA ---

// Level 3 Items - No change needed
const lib_comp_select_option = createItem("Select Option", "library-item", [], "", "/library/components/select-option", undefined);
const lib_hook_fetch_instance = createItem("useFetchInstance (Internal)", "library-item", [], "", "/library/hooks/fetch-instance", undefined);
const lib_token_color_primary_shades = createItem("Primary Shades", "library-item", [], "", "/library/tokens/colors/primary-shades", undefined);

// Level 2 Items - No change needed
const lib_comp_button_variants = createItem("Button Variants", "library-item", [], "✨", "/library/components/button-variants");
const lib_comp_input_types = createItem("Input Types", "library-item", [], "⌨️", "/library/components/input-types");
const lib_folder_comp_select = createItem("Select Components", "folder", [Object.keys(lib_comp_select_option)[0]], "🔽");
const lib_comp_card_example = createItem("Card Example", "library-item", [], "🖼️", "/library/components/card-example");
const lib_comp_alert_styles = createItem("Alert Styles", "library-item", [], "🎨", "/library/components/alert-styles");
const lib_comp_spinner_sizes = createItem("Spinner Sizes", "library-item", [], "⚙️", "/library/components/spinner-sizes");
const lib_hook_storage_local = createItem("useLocalStorage", "library-item", [], "💾", "/library/hooks/storage/local");
const lib_hook_storage_session = createItem("useSessionStorage", "library-item", [], "⏳", "/library/hooks/storage/session");
const lib_folder_hook_fetch = createItem("Data Fetching", "folder", [Object.keys(lib_hook_fetch_instance)[0]], "☁️");
const lib_hook_ui_debounce = createItem("useDebounce", "library-item", [], "⏳", "/library/hooks/ui/debounce");
const lib_hook_ui_throttle = createItem("useThrottle", "library-item", [], "⏱️", "/library/hooks/ui/throttle");
const lib_hook_auth_context = createItem("useAuthContext", "library-item", [], "🔒", "/library/hooks/auth/context", ShieldCheck);
const lib_util_date_format = createItem("formatDate", "library-item", [], "📅", "/library/utils/date/format");
const lib_util_string_slugify = createItem("slugify", "library-item", [], "🔗", "/library/utils/string/slugify");
const lib_util_validation_email = createItem("validateEmail", "library-item", [], "📧", "/library/utils/validation/email");
const lib_folder_token_colors = createItem("Colors", "folder", [Object.keys(lib_token_color_primary_shades)[0]], " C", undefined, Palette);
const lib_token_typography_scale = createItem("Typographic Scale", "library-item", [], " Aa", "/library/tokens/typography/scale");
const lib_token_spacing_units = createItem("Spacing Units", "library-item", [], "📏", "/library/tokens/spacing/units");


// *** FIX STARTS HERE ***

// Create Level 2 Form items first
const lib_item_button = createItem("Button", "library-item", [Object.keys(lib_comp_button_variants)[0]], "🔘", "/library/components/button", Code2);
const lib_item_button_id = Object.keys(lib_item_button)[0];
const lib_item_input = createItem("Input", "library-item", [Object.keys(lib_comp_input_types)[0]], "⌨️", "/library/components/input", Code2);
const lib_item_input_id = Object.keys(lib_item_input)[0];
const lib_item_checkbox = createItem("Checkbox", "library-item", [], "☑️", "/library/components/checkbox", Code2);
const lib_item_checkbox_id = Object.keys(lib_item_checkbox)[0];

// Create Level 2 Layout items first
const lib_item_card = createItem("Card", "library-item", [Object.keys(lib_comp_card_example)[0]], "🃏", "/library/components/card", Code2);
const lib_item_card_id = Object.keys(lib_item_card)[0];
const lib_item_grid = createItem("Grid", "library-item", [], "▦", "/library/components/grid", Code2);
const lib_item_grid_id = Object.keys(lib_item_grid)[0];

// Create Level 2 Feedback items first
const lib_item_alert = createItem("Alert", "library-item", [Object.keys(lib_comp_alert_styles)[0]], "⚠️", "/library/components/alert", Code2);
const lib_item_alert_id = Object.keys(lib_item_alert)[0];
const lib_item_spinner = createItem("Spinner", "library-item", [Object.keys(lib_comp_spinner_sizes)[0]], "⏳", "/library/components/spinner", Code2);
const lib_item_spinner_id = Object.keys(lib_item_spinner)[0];

// Level 1 Items - Use IDs from above
const lib_folder_comp_forms = createItem("Forms", "folder", [
    lib_item_button_id,
    lib_item_input_id,
    Object.keys(lib_folder_comp_select)[0],
    lib_item_checkbox_id,
], "📝");
const lib_folder_comp_layout = createItem("Layout", "folder", [
    lib_item_card_id,
    lib_item_grid_id,
], "📐");
const lib_folder_comp_feedback = createItem("Feedback", "folder", [
    lib_item_alert_id,
    lib_item_spinner_id,
], "📢");
const lib_folder_hook_storage = createItem("Storage", "folder", [Object.keys(lib_hook_storage_local)[0], Object.keys(lib_hook_storage_session)[0]], "💾", undefined, Database);
const lib_folder_hook_ui = createItem("UI Helpers", "folder", [Object.keys(lib_hook_ui_debounce)[0], Object.keys(lib_hook_ui_throttle)[0]], "✨");
const lib_folder_hook_auth = createItem("Authentication", "folder", [Object.keys(lib_hook_auth_context)[0]], "🔐", undefined, ShieldCheck);
const lib_folder_util_date = createItem("Date Utils", "folder", [Object.keys(lib_util_date_format)[0]], "📅");
const lib_folder_util_string = createItem("String Utils", "folder", [Object.keys(lib_util_string_slugify)[0]], "✂️");
const lib_folder_util_validation = createItem("Validation", "folder", [Object.keys(lib_util_validation_email)[0]], "✔️");
const lib_folder_token_typography = createItem("Typography", "folder", [Object.keys(lib_token_typography_scale)[0]], " T", undefined, Palette);
const lib_folder_token_spacing = createItem("Spacing", "folder", [Object.keys(lib_token_spacing_units)[0]], " S", undefined, Palette);

// Level 0 Items (Under Root) - Use IDs from above
const lib_folder_components = createItem("Components", "folder", [Object.keys(lib_folder_comp_forms)[0], Object.keys(lib_folder_comp_layout)[0], Object.keys(lib_folder_comp_feedback)[0]], "🧩", undefined, Code2);
const lib_folder_hooks = createItem("Hooks", "folder", [Object.keys(lib_folder_hook_storage)[0], Object.keys(lib_folder_hook_fetch)[0], Object.keys(lib_folder_hook_ui)[0], Object.keys(lib_folder_hook_auth)[0]], "⚓", undefined, FunctionSquare);
const lib_folder_utils = createItem("Utilities", "folder", [Object.keys(lib_folder_util_date)[0], Object.keys(lib_folder_util_string)[0], Object.keys(lib_folder_util_validation)[0]], "🔧", undefined, Wrench);
const lib_folder_tokens = createItem("Design Tokens", "folder", [Object.keys(lib_folder_token_colors)[0], Object.keys(lib_folder_token_typography)[0], Object.keys(lib_folder_token_spacing)[0]], "🎨", undefined, Palette);
const lib_contributing_guide = createItem("Contributing Guide", "library-item", [], "🤝", "/library/contributing", Lightbulb);

export const initialLibraryItems: TreeItems = {
    root: {
        index: "root",
        data: { name: "Library Root", type: "folder" },
        isFolder: true,
        children: [
            Object.keys(lib_folder_components)[0],
            Object.keys(lib_folder_hooks)[0],
            Object.keys(lib_folder_utils)[0],
            Object.keys(lib_folder_tokens)[0],
            Object.keys(lib_contributing_guide)[0],
        ]
    },
    // Spread all created items - including the intermediate items/folders
    ...lib_folder_components, ...lib_folder_hooks, ...lib_folder_utils, ...lib_folder_tokens, ...lib_contributing_guide,
    ...lib_folder_comp_forms, ...lib_folder_comp_layout, ...lib_folder_comp_feedback,
    ...lib_item_button, ...lib_comp_button_variants, // Spread item and its child
    ...lib_item_input, ...lib_comp_input_types, // Spread item and its child
    ...lib_folder_comp_select, ...lib_comp_select_option, // Spread folder and its child
    ...lib_item_checkbox,
    ...lib_item_card, ...lib_comp_card_example, // Spread item and its child
    ...lib_item_grid,
    ...lib_item_alert, ...lib_comp_alert_styles, // Spread item and its child
    ...lib_item_spinner, ...lib_comp_spinner_sizes, // Spread item and its child
    ...lib_folder_hook_storage, ...lib_folder_hook_fetch, ...lib_folder_hook_ui, ...lib_folder_hook_auth,
    ...lib_hook_storage_local, ...lib_hook_storage_session, ...lib_hook_fetch_instance, ...lib_hook_ui_debounce, ...lib_hook_ui_throttle, ...lib_hook_auth_context,
    ...lib_folder_util_date, ...lib_folder_util_string, ...lib_folder_util_validation,
    ...lib_util_date_format, ...lib_util_string_slugify, ...lib_util_validation_email,
    ...lib_folder_token_colors, ...lib_folder_token_typography, ...lib_folder_token_spacing,
    ...lib_token_color_primary_shades, ...lib_token_typography_scale, ...lib_token_spacing_units,
};

// *** FIX ENDS HERE ***
```

## File: src/lib/validations/auth.ts

```typescript
import { z } from "zod";

// Base email schema for reuse
const emailSchema = z.object({
    email: z
        .string()
        .min(1, { message: "Email is required" })
        .email({ message: "Must be a valid email address" }),
});

// Password validation with common requirements
const passwordSchema = z.object({
    password: z
        .string()
        .min(1, { message: "Password is required" })
        .min(8, { message: "Password must be at least 8 characters" })
        .regex(/[A-Z]/, { message: "Password must contain at least one uppercase letter" })
        .regex(/[a-z]/, { message: "Password must contain at least one lowercase letter" })
        .regex(/[0-9]/, { message: "Password must contain at least one number" }),
});

// Login schema combines email and password
export const loginSchema = emailSchema.extend({
    ...passwordSchema.shape,
});

export type LoginFormValues = z.infer<typeof loginSchema>;

// Registration schema adds name and password confirmation
export const registerSchema = emailSchema.extend({
    name: z.string().min(1, { message: "Name is required" }),
    ...passwordSchema.shape,
    confirmPassword: z.string().min(1, { message: "Please confirm your password" }),
}).refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match",
    path: ["confirmPassword"],
});

export type RegisterFormValues = z.infer<typeof registerSchema>;

// Forgot password just needs an email
export const forgotPasswordSchema = emailSchema;

export type ForgotPasswordFormValues = z.infer<typeof forgotPasswordSchema>;

// Reset password needs a new password and confirmation
export const resetPasswordSchema = passwordSchema.extend({
    confirmPassword: z.string().min(1, { message: "Please confirm your password" }),
}).refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match",
    path: ["confirmPassword"],
});

export type ResetPasswordFormValues = z.infer<typeof resetPasswordSchema>;
```

## File: src/lib/hooks/use-storage.ts

```typescript
import { useState, useEffect, useCallback } from 'react';
import localforage from 'localforage';

localforage.config({
    name: 'tanstack-forge',
    storeName: 'my-storage',
    description: 'Storage for my application'
});

/**
 * Hook for easy access to localforage with a React-friendly API
 * 
 * @param key - The storage key to use
 * @param initialValue - Default value if key doesn't exist in storage
 * @returns [storedValue, setValue, removeValue, error]
 */
export function useStorage<T>(
    key: string,
    initialValue: T
): [T, (value: T | ((val: T) => T)) => Promise<void>, () => Promise<void>, Error | null] {
    // State to store our value
    const [storedValue, setStoredValue] = useState<T>(initialValue);

    // State to track any errors
    const [error, setError] = useState<Error | null>(null);

    // Initialize: Read from localforage on mount
    useEffect(() => {
        const loadStoredValue = async () => {
            try {
                // Get from localforage
                const value = await localforage.getItem<T>(key);

                // Set state to either stored value or initial value
                setStoredValue(value !== null ? value : initialValue);
            } catch (err) {
                console.error(`Error reading from storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        };

        loadStoredValue();
    }, [key, initialValue]);

    // Define setter function
    const setValue = useCallback(
        async (value: T | ((val: T) => T)) => {
            try {
                // Allow value to be a function like React's setState
                const valueToStore =
                    value instanceof Function ? value(storedValue) : value;

                // Save to localforage
                await localforage.setItem(key, valueToStore);

                // Save state
                setStoredValue(valueToStore);
                setError(null);
            } catch (err) {
                console.error(`Error saving to storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        },
        [key, storedValue]
    );

    // Define remove function
    const removeValue = useCallback(
        async () => {
            try {
                // Remove from localforage
                await localforage.removeItem(key);

                // Reset to initial value
                setStoredValue(initialValue);
                setError(null);
            } catch (err) {
                console.error(`Error removing from storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        },
        [key, initialValue]
    );

    return [storedValue, setValue, removeValue, error];
}

/**
 * A simplified hook for cases where you only need to get data once
 * without subscribing to changes
 */
export async function getStoredValue<T>(key: string, defaultValue: T): Promise<T> {
    try {
        const value = await localforage.getItem<T>(key);
        return value !== null ? value : defaultValue;
    } catch (error) {
        console.error(`Error retrieving value for key "${key}":`, error);
        return defaultValue;
    }
}

/**
 * A utility function to set a value without hooks
 */
export async function setStoredValue<T>(key: string, value: T): Promise<void> {
    try {
        await localforage.setItem(key, value);
    } catch (error) {
        console.error(`Error setting value for key "${key}":`, error);
        throw error;
    }
}

/**
 * Example of creating a specialized version for specific data types
 */
export function useUserPreferences<T extends Record<string, any>>(
    userId: string,
    defaultPreferences: T
) {
    return useStorage<T>(`user_prefs_${userId}`, defaultPreferences);
}
```

## File: src/lib/hooks/use-theme.ts

```typescript
import { useState, useEffect } from "react";

const isClient = typeof window !== "undefined";

export function useTheme() {
    const [theme, setTheme] = useState("light"); // Default to light for SSR
    const [isDark, setIsDark] = useState(false); // Default to false for SSR

    // Initialize theme on component mount (client-side only)
    useEffect(() => {
        if (!isClient) return;

        // Check if dark mode is active
        const checkIsDark = () => {
            return (
                document.documentElement.classList.contains("dark") ||
                (!localStorage.theme &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            );
        };

        // Set initial states
        const initialIsDark = checkIsDark();
        setIsDark(initialIsDark);
        setTheme(initialIsDark ? "dark" : "light");

        // Also monitor for system preference changes
        const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
        const handleChange = () => {
            if (!localStorage.theme) {
                const newIsDark = mediaQuery.matches;
                setIsDark(newIsDark);
                setTheme(newIsDark ? "dark" : "light");
            }
        };

        mediaQuery.addEventListener("change", handleChange);
        return () => mediaQuery.removeEventListener("change", handleChange);
    }, []);

    // Toggle theme function
    const toggleTheme = () => {
        if (!isClient) return;

        const newTheme = theme === "dark" ? "light" : "dark";

        // Update DOM
        if (newTheme === "dark") {
            document.documentElement.classList.add("dark");
        } else {
            document.documentElement.classList.remove("dark");
        }

        // Save preference
        localStorage.theme = newTheme;

        // Update state
        setTheme(newTheme);
        setIsDark(newTheme === "dark");
    };

    return {
        theme,
        isDark,
        isLight: !isDark,
        toggleTheme,
    };
}
```

## File: src/lib/db/layout.ts

```typescript
import Dexie, { type Table } from 'dexie';
import type { IJsonModel } from '@app/layout';

// Use constants directly or import them if needed elsewhere
export const SIDEBAR_WIDTH_SETTING_KEY = "sidebarWidth";
export const SIDEBAR_OPEN_SETTING_KEY = "sidebarOpen";
export const MAIN_LAYOUT_KEY = 'mainLayoutState';
export const DEFAULT_SIDEBAR_WIDTH_DB = 256; // Define default here

export interface Setting {
    key: string; // Primary key
    value: any;
}

export interface LayoutDbState {
    id: string; // Primary key
    state: IJsonModel;
    timestamp: Date;
}

export class AppDatabase extends Dexie {
    settings!: Table<Setting, string>;
    layoutState!: Table<LayoutDbState, string>;

    constructor() {
        super('AppDatabase');
        this.version(1).stores({
            settings: 'key',
            layoutState: 'id',
        });
    }
}

export const db = new AppDatabase();

// --- Persistence Helpers (Keep these in the main app) ---
export async function saveSidebarWidth(width: number): Promise<void> {
    try {
        await db.settings.put({ key: SIDEBAR_WIDTH_SETTING_KEY, value: width });
    } catch (error) {
        console.error("Dexie: Failed to save sidebar width", error);
    }
}

export async function saveSidebarOpen(isOpen: boolean): Promise<void> {
    try {
        await db.settings.put({ key: SIDEBAR_OPEN_SETTING_KEY, value: isOpen });
    } catch (error) {
        console.error("Dexie: Failed to save sidebar open state", error);
    }
}

export async function saveLayoutState(layoutModel: IJsonModel): Promise<void> {
    // ... (implementation from previous step)
    try {
        const stateToSave: LayoutDbState = { id: MAIN_LAYOUT_KEY, state: layoutModel, timestamp: new Date() };
        await db.layoutState.put(stateToSave);
    } catch (error) { console.error("Dexie: Failed to save layout state", error); }
}

export async function loadLayoutState(): Promise<IJsonModel | null> {
    // ... (implementation from previous step)
    try {
        const savedState = await db.layoutState.get(MAIN_LAYOUT_KEY);
        return savedState?.state ?? null;
    } catch (error) { console.error("Dexie: Failed to load layout state", error); return null; }
}
```

## File: src/lib/api/user.ts

```typescript
import { authClient } from "@app/auth/client";
import { useQuery } from "@tanstack/react-query";

export const sessionQueryKey = ["user", "session"] as const;

export const useSessionQuery = () => {
    return useQuery({
        queryKey: sessionQueryKey,
        queryFn: async () => {
            const { data, error } = await authClient.getSession({
                query: {
                    disableCookieCache: true,
                },
            });

            if (error) {
                throw new Error(error.message || "Failed to fetch session");
            }

            return data;
        },
        staleTime: Number.POSITIVE_INFINITY,
        refetchOnWindowFocus: false,
        retry: false,
    });
};

const listAccountQueryKey = ["user", "accounts"] as const;

export const useUserAccountsQuery = () => {
    return useQuery({
        queryKey: listAccountQueryKey,
        queryFn: async () => {
            const { data, error } = await authClient.listAccounts();

            if (error) {
                throw error;
            }

            return data;
        },
    });
};

```

## File: src/lib/store/useLayoutStore.ts

```typescript
import { create } from 'zustand';
import {
    Actions,
    DockLocation,
    Layout,
    Model,
    Node,
    TabNode,
    TabSetNode,
    type IJsonModel,
    type IJsonTabNode,
    BorderNode
} from '@app/layout';

// Define the structure for tab data we want to manage
export interface TabData {
    id: string;
    name: string;
    component: string; // Corresponds to the component type (e.g., 'document', 'library-item')
    icon?: string; // Name of the Lucide icon (e.g., 'FileText', 'Book')
    // Add any other specific data needed per tab type later
    // e.g., documentId, libraryItemId
}

interface LayoutState {
    layoutRef: Layout | null;
    model: Model;
    tabs: Map<string, TabData>; // Store minimal tab data for reference
    activeTabId?: string;

    // Actions
    setLayoutRef: (layout: Layout | null) => void;
    setModel: (model: Model) => void; // Use cautiously, prefer actions
    setActiveTabId: (tabId: string | undefined) => void;
    addTab: (tabData: TabData, location?: DockLocation, select?: boolean) => TabNode | undefined; // Return added node
    selectTab: (tabId: string) => void;
    removeTab: (tabId: string) => string | undefined; // Return next active tabId
    renameTab: (tabId: string, newName: string) => void;
    // Add more actions later (openToSide, closeOtherTabs etc.)
}

// Define the initial layout structure
const initialLayoutJson: IJsonModel = {
    global: {
        tabEnableClose: true,
        tabSetEnableDrag: true,
        tabSetEnableDrop: true,
        tabEnableRename: false, // We'll handle rename via our store action
        tabSetEnableMaximize: true,
        splitterSize: 2, // Thinner splitter
        tabSetEnableSingleTabStretch: true, // Enable stretch for single tab
        borderSize: 0, // Hide borders initially if not used
    },
    borders: [],
    layout: {
        type: 'row',
        id: '#root-row', // Give root an ID
        weight: 100,
        children: [
            {
                type: 'tabset',
                id: '#main-tabset', // Give the main tabset an ID
                weight: 100,
                children: [], // Start empty
                active: true,
            },
        ],
    },
};


export const useLayoutStore = create<LayoutState>((set, get) => ({
    layoutRef: null,
    model: Model.fromJson(initialLayoutJson),
    tabs: new Map<string, TabData>(),
    activeTabId: undefined,

    setLayoutRef: (layout) => set({ layoutRef: layout }),

    setModel: (model) => set({ model }), // Direct model setting, use with care

    setActiveTabId: (tabId) => {
        if (get().activeTabId !== tabId) {
            console.log("Setting active tab:", tabId);
            set({ activeTabId: tabId });
        }
    },

    addTab: (tabData, location = DockLocation.CENTER, select = true) => {
        const { model, tabs } = get();
        const nodeId = tabData.id;
        let addedNode: Node | undefined;

        if (model.getNodeById(nodeId)) {
            // Tab already exists, just select it
            const existingNode = model.getNodeById(nodeId);
            if (existingNode instanceof TabNode) {
                addedNode = existingNode; // Return the existing node
                if (select) {
                    get().selectTab(nodeId); // Use the selectTab action
                }
            }
            return addedNode as TabNode | undefined;
        }

        // Add new tab data to our store map
        const newTabs = new Map(tabs);
        newTabs.set(nodeId, tabData);

        // Add node to the flexlayout model
        let targetNodeId = model.getActiveTabset()?.getId() ?? '#main-tabset';

        // Adjust target for side docking
        if (location !== DockLocation.CENTER) {
            const activeTabset = model.getActiveTabset();
            if (activeTabset) {
                targetNodeId = activeTabset.getParent()?.getId() ?? targetNodeId;
            }
            // If still main-tabset and trying to dock sideways, target the root row
            if (targetNodeId === '#main-tabset' && activeTabset?.getParent()?.getId() === '#root-row') {
                targetNodeId = '#root-row';
            }
        }

        const tabJson: IJsonTabNode = { // Use IJsonTabNode type
            type: 'tab', // Explicitly set type
            id: nodeId,
            name: tabData.name,
            component: tabData.component,
            icon: tabData.icon,
            config: { itemId: tabData.id },
        };

        // Perform the action and get the added node
        addedNode = model.doAction(Actions.addNode(
            tabJson,
            targetNodeId,
            location,
            -1, // Add to the end when location is CENTER, flexlayout handles index for side docks
            select
        ));

        set({
            tabs: newTabs,
            activeTabId: select && addedNode ? nodeId : get().activeTabId,
        });

        return addedNode as TabNode | undefined;
    },

    selectTab: (tabId) => {
        const { model, activeTabId } = get();
        const node = model.getNodeById(tabId);

        if (node && node.getType() === 'tab') {
            // Only perform action if not already active visually (model state might differ)
            const parentTabset = node.getParent() as TabSetNode;
            const currentSelected = parentTabset?.getSelected();
            const currentIndex = parentTabset?.getChildren().indexOf(node);

            if (parentTabset && currentIndex !== undefined && currentSelected !== currentIndex) {
                model.doAction(Actions.selectTab(tabId));
            }
            // Always update Zustand state
            get().setActiveTabId(tabId); // Use internal setter

        } else {
            console.warn(`Attempted to select non-existent or non-tab node: ${tabId}`);
            // If the node doesn't exist, clear activeTabId if it matches
            if (!node && activeTabId === tabId) {
                get().setActiveTabId(undefined);
            }
        }
    },

    removeTab: (tabId) => {
        const { model, tabs, activeTabId } = get();
        const node = model.getNodeById(tabId);
        let nextActiveTabId = activeTabId;

        if (node) {
            const parentTabset = node.getParent() as TabSetNode | BorderNode | undefined;
            model.doAction(Actions.deleteTab(tabId)); // This mutates the model
            const newTabs = new Map(tabs);
            newTabs.delete(tabId);

            // Determine the next active tab ONLY if the removed tab was active
            if (activeTabId === tabId) {
                // Try selecting the new selected tab in the *same* tabset (if it still exists)
                nextActiveTabId = parentTabset?.getSelectedNode()?.getId();

                // If the tabset is now empty or gone, find *any* other available tab
                if (!nextActiveTabId) {
                    // Check main tabset first
                    const mainTabset = model.getNodeById('#main-tabset') as TabSetNode | undefined;
                    nextActiveTabId = mainTabset?.getSelectedNode()?.getId();

                    // If still no active tab, try finding any tabset and its selected tab
                    if (!nextActiveTabId) {
                        model.visitNodes((node) => {
                            if (!nextActiveTabId && node instanceof TabSetNode && node.getChildren().length > 0) {
                                nextActiveTabId = node.getSelectedNode()?.getId();
                            }
                        });
                    }
                }
                console.log("Setting next active tab after remove:", nextActiveTabId);
                get().setActiveTabId(nextActiveTabId); // Update state immediately
            }

            set({
                tabs: newTabs,
                activeTabId: nextActiveTabId, // Update state with potentially new active tab
            });
            return nextActiveTabId; // Return the ID for potential navigation
        }
        return undefined;
    },

    renameTab: (tabId, newName) => {
        const { model, tabs } = get();
        const node = model.getNodeById(tabId);
        const currentTabData = tabs.get(tabId);

        if (node && currentTabData && currentTabData.name !== newName) {
            model.doAction(Actions.renameTab(tabId, newName));
            const newTabs = new Map(tabs);
            newTabs.set(tabId, { ...currentTabData, name: newName });
            set({ tabs: newTabs });
        }
    },
}));

// Function to get the active tab ID outside components if needed
export const getActiveTabId = () => useLayoutStore.getState().activeTabId;

// Function to get tab data outside components
export const getTabData = (tabId: string) => useLayoutStore.getState().tabs.get(tabId);
```

## File: src/routes/__root.tsx

```tsx
import {
	HeadContent,
	Outlet,
	ScriptOnce,
	Scripts,
	createRootRouteWithContext,
} from "@tanstack/react-router";
import { TanStackRouterDevtools } from "@tanstack/react-router-devtools";
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
import { Toaster } from "@app/ui/components/sonner"

import { auth } from "@app/auth";
import { getWebRequest } from "@tanstack/react-start/server";
import { createServerFn } from "@tanstack/react-start";
import type { QueryClient } from "@tanstack/react-query";

import globalsCss from "@app/ui/globals.css?url";
import layoutCss from '@app/layout/style.css?url'

const getUser = createServerFn({ method: "GET" }).handler(async () => {
	const { headers } = getWebRequest()!;
	const session = await auth.api.getSession({ headers });

	return session?.user || null;
});

export const Route = createRootRouteWithContext<{
	queryClient: QueryClient;
	user: Awaited<ReturnType<typeof getUser>>;
}>()({
	beforeLoad: async ({ context }) => {
		const user = await context.queryClient.fetchQuery({
			queryKey: ["user"],
			queryFn: ({ signal }) => getUser({ signal }),
		});
		return { user };
	},
	head: () => ({
		meta: [
			{
				charSet: "utf-8",
			},
			{
				name: "viewport",
				content: "width=device-width, initial-scale=1",
			},
			{
				title: "TanStack Forge",
			},
		],
		links: [
			{
				rel: "stylesheet",
				href: globalsCss,
			},
			{
				rel: "stylesheet",
				href: layoutCss,
			},
		],
	}),
	component: () => (
		<RootDocument>
			<Outlet />
			<TanStackRouterDevtools />
			<ReactQueryDevtools initialIsOpen={false} position="right" />
			<Toaster />
		</RootDocument>
	),
});

function RootDocument({ children }: { children: React.ReactNode }) {

	return (
		<html lang="en" suppressHydrationWarning>
			<head>
				<HeadContent />
			</head>
			<body>
				<ScriptOnce>
					{`document.documentElement.classList.toggle(
					'dark',
					localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
					)`}
				</ScriptOnce>
				<div className="min-h-screen font-sans antialiased">
					{children}
				</div>
				<Scripts />
			</body>
		</html>
	);
}

```

## File: src/routes/(app)/index.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import {
    Search,
    Plus,
    Library,
    BookOpen,
    Clock,
    Star,
    Calendar,
    Users,
    FileText,
    FolderOpen,
    Settings,
    TrendingUp,
    Bookmark,
    Tag,
    ChevronRight
} from 'lucide-react'

export const Route = createFileRoute('/(app)/')({
    component: DashboardComponent,
})

function DashboardComponent() {
    // Sample data for recently edited documents
    const recentDocuments = [
        {
            id: 1,
            title: "Research Methodology Notes",
            updatedAt: "2 hours ago",
            tags: ["Research", "Academia"],
            starred: true,
            preview: "The methodology section describes the rationale for the application of specific procedures or techniques used to identify, select, and analyze information..."
        },
        {
            id: 2,
            title: "Literature Review: Machine Learning in Healthcare",
            updatedAt: "Yesterday",
            tags: ["ML", "Healthcare", "Research"],
            starred: false,
            preview: "This review aims to explore the current landscape of machine learning applications in healthcare settings, with a focus on diagnostic tools..."
        },
        {
            id: 3,
            title: "Study Notes: Quantum Computing",
            updatedAt: "3 days ago",
            tags: ["Physics", "Computing"],
            starred: true,
            preview: "Quantum computing is an emerging field that uses quantum mechanical phenomena to perform operations on data..."
        },
        {
            id: 4,
            title: "Thesis Outline",
            updatedAt: "1 week ago",
            tags: ["Thesis", "Planning"],
            starred: false,
            preview: "Introduction, Literature Review, Methodology, Results, Discussion, Conclusion..."
        },
    ];

    // Sample data for collections
    const collections = [
        {
            id: 1,
            name: "Research Papers",
            count: 24,
            icon: Library,
            color: "bg-blue-500/10 text-blue-500"
        },
        {
            id: 2,
            name: "Study Notes",
            count: 42,
            icon: BookOpen,
            color: "bg-green-500/10 text-green-500"
        },
        {
            id: 3,
            name: "Project Materials",
            count: 15,
            icon: FolderOpen,
            color: "bg-purple-500/10 text-purple-500"
        },
        {
            id: 4,
            name: "Personal Journal",
            count: 28,
            icon: FileText,
            color: "bg-yellow-500/10 text-yellow-500"
        },
    ];

    // Sample suggested actions
    const suggestedActions = [
        {
            id: 1,
            title: "Continue writing your thesis outline",
            subtitle: "Last edited yesterday",
            icon: FileText,
            color: "bg-indigo-500/10 text-indigo-500"
        },
        {
            id: 2,
            title: "Upcoming literature review deadline",
            subtitle: "Due in 3 days",
            icon: Calendar,
            color: "bg-red-500/10 text-red-500"
        },
        {
            id: 3,
            title: "Collaborate on Chemistry notes",
            subtitle: "Shared with 3 peers",
            icon: Users,
            color: "bg-emerald-500/10 text-emerald-500"
        },
    ];

    // Sample statistics
    const statistics = [
        {
            title: "Total Documents",
            value: "164",
            change: "+12",
            icon: FileText,
            trend: "up"
        },
        {
            title: "Words Written",
            value: "53,842",
            change: "+2,451",
            icon: TrendingUp,
            trend: "up"
        },
        {
            title: "Research Sources",
            value: "87",
            change: "+5",
            icon: Bookmark,
            trend: "up"
        },
        {
            title: "Citations",
            value: "132",
            change: "+8",
            icon: Tag,
            trend: "up"
        },
    ];

    return (
        <div className="space-y-6 p-4">
            {/* Header with search and quick actions */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <h1 className="text-2xl font-bold tracking-tight">Dashboard</h1>
                <div className="flex items-center gap-2">
                    <div className="relative w-full sm:w-64">
                        <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                        <input
                            type="text"
                            placeholder="Search documents..."
                            className="w-full rounded-md border border-input bg-background pl-10 pr-4 py-2 text-sm"
                        />
                    </div>
                    <button className="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90">
                        <Plus className="h-4 w-4" />
                        New Document
                    </button>
                </div>
            </div>

            {/* Statistics cards */}
            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {statistics.map((stat, index) => (
                    <div key={index} className="rounded-lg border bg-card p-4">
                        <div className="flex justify-between">
                            <div>
                                <p className="text-sm text-muted-foreground">{stat.title}</p>
                                <p className="text-2xl font-bold">{stat.value}</p>
                            </div>
                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${stat.trend === 'up' ? 'bg-green-500/10' : 'bg-red-500/10'
                                }`}>
                                <stat.icon className={`h-5 w-5 ${stat.trend === 'up' ? 'text-green-500' : 'text-red-500'
                                    }`} />
                            </div>
                        </div>
                        <div className="mt-2 flex items-center text-sm">
                            <span className={stat.trend === 'up' ? 'text-green-500' : 'text-red-500'}>
                                {stat.change}
                            </span>
                            <span className="ml-1 text-muted-foreground">this week</span>
                        </div>
                    </div>
                ))}
            </div>

            {/* Two column layout for main content */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Left column - Recent documents */}
                <div className="lg:col-span-2 space-y-6">
                    {/* Recent documents */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="flex items-center justify-between p-4 border-b">
                            <h2 className="font-medium flex items-center">
                                <Clock className="h-4 w-4 mr-2 text-muted-foreground" />
                                Recent Documents
                            </h2>
                            <button className="text-sm text-primary hover:underline">
                                View all
                            </button>
                        </div>
                        <div className="divide-y">
                            {recentDocuments.map((doc) => (
                                <div key={doc.id} className="p-4 hover:bg-muted/50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2">
                                                <FileText className="h-4 w-4 text-muted-foreground" />
                                                <h3 className="font-medium">{doc.title}</h3>
                                                {doc.starred && (
                                                    <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                                                )}
                                            </div>
                                            <p className="mt-1 text-sm text-muted-foreground line-clamp-2">
                                                {doc.preview}
                                            </p>
                                            <div className="mt-2 flex items-center gap-2">
                                                <span className="text-xs text-muted-foreground">
                                                    Updated {doc.updatedAt}
                                                </span>
                                                <div className="flex gap-1">
                                                    {doc.tags.map((tag, idx) => (
                                                        <span
                                                            key={idx}
                                                            className="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary"
                                                        >
                                                            {tag}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        <button className="p-1 hover:bg-muted rounded-full">
                                            <ChevronRight className="h-4 w-4 text-muted-foreground" />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Collections grid */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="flex items-center justify-between p-4 border-b">
                            <h2 className="font-medium flex items-center">
                                <Library className="h-4 w-4 mr-2 text-muted-foreground" />
                                Collections
                            </h2>
                            <button className="text-sm text-primary hover:underline">
                                Manage collections
                            </button>
                        </div>
                        <div className="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            {collections.map((collection) => {
                                const IconComponent = collection.icon;
                                return (
                                    <div
                                        key={collection.id}
                                        className="rounded-lg border bg-card p-4 hover:border-primary/50 hover:shadow-md transition-shadow duration-150"
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${collection.color}`}>
                                                <IconComponent className="h-5 w-5" />
                                            </div>
                                            <div>
                                                <h3 className="font-medium">{collection.name}</h3>
                                                <p className="text-sm text-muted-foreground">
                                                    {collection.count} documents
                                                </p>
                                            </div>
                                            <button className="ml-auto p-1 hover:bg-muted rounded-full">
                                                <ChevronRight className="h-4 w-4 text-muted-foreground" />
                                            </button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>

                {/* Right column - Suggestions and quick access */}
                <div className="space-y-6">
                    {/* Suggested actions */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="p-4 border-b">
                            <h2 className="font-medium">Suggested Actions</h2>
                        </div>
                        <div className="divide-y">
                            {suggestedActions.map((action) => {
                                const IconComponent = action.icon;
                                return (
                                    <div key={action.id} className="p-4 hover:bg-muted/50 cursor-pointer ">
                                        <div className="flex items-center gap-3">
                                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${action.color}`}>
                                                <IconComponent className="h-5 w-5" />
                                            </div>
                                            <div>
                                                <h3 className="font-medium">{action.title}</h3>
                                                <p className="text-sm text-muted-foreground">
                                                    {action.subtitle}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Quick access */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="p-4 border-b">
                            <h2 className="font-medium">Quick Access</h2>
                        </div>
                        <div className="p-4 space-y-2">
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Star className="h-5 w-5 text-yellow-500" />
                                <span>Starred Documents</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Clock className="h-5 w-5 text-blue-500" />
                                <span>Recent Activity</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Users className="h-5 w-5 text-green-500" />
                                <span>Shared With Me</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Calendar className="h-5 w-5 text-purple-500" />
                                <span>Research Calendar</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Settings className="h-5 w-5 text-gray-500" />
                                <span>Preferences</span>
                            </button>
                        </div>
                    </div>

                    {/* Help & resources card */}
                    <div className="rounded-lg border bg-card p-4 shadow-sm">
                        <h3 className="font-medium mb-2">Resources</h3>
                        <div className="space-y-2 text-sm">
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <BookOpen className="h-4 w-4" />
                                <span>Citation Guide</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <Library className="h-4 w-4" />
                                <span>Research Database Access</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <FileText className="h-4 w-4" />
                                <span>Academic Writing Templates</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <Users className="h-4 w-4" />
                                <span>Research Collaboration Tools</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            {/* Weekly progress section */}
            <div className="rounded-lg border bg-card shadow-sm">
                <div className="flex items-center justify-between p-4 border-b">
                    <h2 className="font-medium flex items-center">
                        <TrendingUp className="h-4 w-4 mr-2 text-muted-foreground" />
                        Weekly Progress
                    </h2>
                    <div className="flex items-center gap-2">
                        <select className="rounded-md border bg-background px-3 py-1 text-sm">
                            <option>This Week</option>
                            <option>Last Week</option>
                            <option>Last Month</option>
                        </select>
                    </div>
                </div>
                <div className="p-4">
                    <div className="h-64 w-full bg-muted/20 rounded flex items-center justify-center">
                        <div className="text-center">
                            <TrendingUp className="h-10 w-10 text-muted-foreground mx-auto mb-2" />
                            <p className="text-muted-foreground">Writing activity analytics would display here</p>
                        </div>
                    </div>
                </div>
                <div className="p-4 border-t grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Documents Created</p>
                        <p className="text-xl font-bold">7</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Study Hours</p>
                        <p className="text-xl font-bold">24.5</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Notes Taken</p>
                        <p className="text-xl font-bold">42</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Research Sources</p>
                        <p className="text-xl font-bold">15</p>
                    </div>
                </div>
            </div>

            {/* Research projects section */}
            <div className="rounded-lg border bg-card shadow-sm">
                <div className="flex items-center justify-between p-4 border-b">
                    <h2 className="font-medium flex items-center">
                        <BookOpen className="h-4 w-4 mr-2 text-muted-foreground" />
                        Active Research Projects
                    </h2>
                    <button className="text-sm text-primary hover:underline">
                        View all projects
                    </button>
                </div>
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead>
                            <tr className="border-b bg-muted/50">
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Project</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Status</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Deadline</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Collaborators</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Progress</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y">
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-purple-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-purple-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Neural Network Analysis</p>
                                            <p className="text-xs text-muted-foreground">AI & Machine Learning</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                                        In Progress
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">May 15, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-blue-500 flex items-center justify-center text-xs text-white">JD</div>
                                        <div className="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-xs text-white">MK</div>
                                        <div className="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-xs text-white">+1</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-green-500" style={{ width: "65%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">65% Complete</p>
                                </td>
                            </tr>
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-blue-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-blue-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Climate Change Literature Review</p>
                                            <p className="text-xs text-muted-foreground">Environmental Science</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                                        Pending Review
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">April 3, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-xs text-white">AR</div>
                                        <div className="h-6 w-6 rounded-full bg-indigo-500 flex items-center justify-center text-xs text-white">SL</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-yellow-500" style={{ width: "80%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">80% Complete</p>
                                </td>
                            </tr>
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-green-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-green-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Vaccine Efficacy Study</p>
                                            <p className="text-xs text-muted-foreground">Medical Sciences</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                                        Data Collection
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">June 22, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-orange-500 flex items-center justify-center text-xs text-white">BT</div>
                                        <div className="h-6 w-6 rounded-full bg-teal-500 flex items-center justify-center text-xs text-white">MC</div>
                                        <div className="h-6 w-6 rounded-full bg-pink-500 flex items-center justify-center text-xs text-white">+3</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-blue-500" style={{ width: "35%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">35% Complete</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    )
}

export default DashboardComponent;
```

## File: src/routes/(app)/view.$itemId.tsx

```tsx
// src/routes/(app)/view.$itemId.tsx
import * as React from 'react';
import { createFileRoute, useNavigate, useRouter } from '@tanstack/react-router';
import {
    Layout,
    TabNode,
    Action,
    Actions,
    Model,
    type ITabRenderValues
} from '@app/layout';
import * as Icons from 'lucide-react';

import { useLayoutStore, getTabData } from '@/lib/store/useLayoutStore';
import { DocumentPlaceholder, LibraryItemPlaceholder, UnknownPlaceholder } from '@/components/view/placeholders';
import { LoadingContainer } from '@app/ui/components/loading-container';
import { SidebarTrigger } from '@app/ui/components/sidebar';
import { cn } from '@app/ui/lib/utils';


interface ViewSearch {
    name?: string;
    type?: string;
    icon?: string;
}

export const Route = createFileRoute('/(app)/view/$itemId')({
    validateSearch: (search): ViewSearch => ({
        name: search.name as string | undefined,
        type: search.type as string | undefined,
        icon: search.icon as string | undefined,
    }),
    component: ViewPage,
});

const handleRenderTab = (node: TabNode, renderValues: ITabRenderValues) => {
    const nodeIconName = node.getIcon();
    const Icon = nodeIconName ? Icons[nodeIconName as keyof typeof Icons] as React.ElementType : null;

    if (Icon) {
        renderValues.leading = <Icon className="h-3.5 w-3.5 opacity-80 flex-shrink-0" />;
    }

    renderValues.content = <span className="truncate">{node.getName()}</span>;

    // You can also add buttons here if needed:
    // renderValues.buttons.push(<button key="mybutton">...</button>);
};


function ViewPage() {
    const params = Route.useParams();
    const search = Route.useSearch();

    const { itemId } = params;
    const { name, type: itemType = 'document', icon: iconName } = search;

    const navigate = useNavigate();
    const router = useRouter();

    // Get state and actions from Zustand store
    const model = useLayoutStore((state) => state.model);
    const setLayoutRef = useLayoutStore((state) => state.setLayoutRef);
    const addTab = useLayoutStore((state) => state.addTab);
    const selectTab = useLayoutStore((state) => state.selectTab);
    const removeTab = useLayoutStore((state) => state.removeTab);
    const setActiveTabId = useLayoutStore((state) => state.setActiveTabId);
    const isTabOpen = useLayoutStore((state) => !!state.tabs.get(itemId));

    const [isInitializing, setIsInitializing] = React.useState(true);

    // Effect to open or select the tab when the route loads/changes
    React.useEffect(() => {
        // ... (useEffect logic remains the same)
        if (!itemId) return;

        const tabName = name ?? `Item ${itemId.substring(0, 6)}`;
        const componentType = itemType ?? 'document';

        const tabData = {
            id: itemId,
            name: tabName,
            component: componentType,
            icon: iconName,
        };

        if (!isTabOpen) {
            addTab(tabData, undefined, true);
        } else {
            selectTab(itemId);
        }
        setActiveTabId(itemId);
        setIsInitializing(false);

        const currentTabData = getTabData(itemId);
        if (currentTabData && (currentTabData.name !== name || currentTabData.component !== itemType || currentTabData.icon !== iconName)) {
            const newSearchParams: ViewSearch = { name: currentTabData.name, type: currentTabData.component, icon: currentTabData.icon };
            if (JSON.stringify(newSearchParams) !== JSON.stringify(search)) {
                router.history.replace(location.pathname, newSearchParams);
            }
        }

    }, [itemId, name, itemType, iconName, isTabOpen, addTab, selectTab, setActiveTabId, router.history, location.pathname, search]); // Removed model dependency if not directly used

    // Factory function to render tab content
    const factory = (node: TabNode): React.ReactNode => {
        const component = node.getComponent();
        const nodeIconName = node.getIcon();
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        const Icon = nodeIconName ? Icons[nodeIconName as keyof typeof Icons] as React.ElementType : null;
        const props = { node, Icon };

        switch (component) {
            case 'document':
                return <DocumentPlaceholder {...props} />;
            case 'library-item':
                return <LibraryItemPlaceholder {...props} />;
            default:
                return <UnknownPlaceholder {...props} />;
        }
    };

    // Handle model changes from flexlayout actions
    const onModelChange = (currentModel: Model, action: Action) => {
        // ... (onModelChange logic remains the same)
        if (action.type === Actions.SELECT_TAB) {
            const selectedTabId = action.data.tabNode;
            setActiveTabId(selectedTabId);
            const activeTabData = getTabData(selectedTabId);
            if (activeTabData && selectedTabId !== itemId) {
                router.history.replace(`/view/${selectedTabId}`, {
                    name: activeTabData.name,
                    type: activeTabData.component,
                    icon: activeTabData.icon
                });
            }
        }
        else if (action.type === Actions.DELETE_TAB) {
            const deletedTabId = action.data.node;
            const nextActiveId = removeTab(deletedTabId);

            if (deletedTabId === itemId) {
                if (nextActiveId) {
                    const newActiveTabData = getTabData(nextActiveId);
                    if (newActiveTabData) {
                        navigate({
                            to: '/view/$itemId',
                            params: { itemId: nextActiveId },
                            search: { name: newActiveTabData.name, type: newActiveTabData.component, icon: newActiveTabData.icon },
                            replace: true
                        });
                    } else {
                        navigate({ to: '/', replace: true });
                    }
                } else {
                    navigate({ to: '/', replace: true });
                }
            }
        }
        else if (action.type === Actions.RENAME_TAB) {
            if (action.data.node === itemId && action.data.text !== name) {
                router.history.replace(location.pathname, { ...search, name: action.data.text });
            }
        }
    };


    return (
        <div className="flex flex-col h-full w-full relative bg-background">
            <SidebarTrigger
                className={cn(
                    "text-muted-foreground absolute left-2 top-2 z-50",
                )}
            />
            {isInitializing && (
                <div className="absolute inset-0 flex items-center justify-center z-40 bg-background/50 backdrop-blur-sm">
                    <LoadingContainer isLoading={true} />
                </div>
            )}
            <div className={cn("flex-grow overflow-hidden h-full", isInitializing ? 'opacity-0' : 'opacity-100 transition-opacity duration-200')}>
                <Layout
                    ref={setLayoutRef}
                    model={model}
                    factory={factory}
                    onModelChange={onModelChange}
                    // *** FIX: Use onRenderTab instead of titleFactory ***
                    onRenderTab={handleRenderTab}
                    // *** END FIX ***
                    icons={{
                        close: <Icons.X className="h-3 w-3" />,
                        maximize: <Icons.Maximize2 className="h-3 w-3" />,
                        restore: <Icons.Minimize2 className="h-3 w-3" />,
                        more: <Icons.MoreHorizontal className="h-4 w-4" />,
                        popout: <Icons.SquareArrowOutUpRight className="h-3 w-3" />,
                    }}
                // REMOVED titleFactory prop
                />
            </div>
        </div>
    );
}
```

## File: src/routes/(app)/route.tsx

```tsx
import { createFileRoute, Outlet, redirect, useRouter } from "@tanstack/react-router";
import { SidebarProvider, SidebarInset } from "@app/ui/components/sidebar";
import { AppSidebar } from "@/components/app-sidebar";
import { authClient } from "@app/auth/client";

export const Route = createFileRoute("/(app)")({
    component: AppLayout,
    beforeLoad: async ({ context }) => {
        const { user } = context;
        if (!user) {
            throw redirect({ to: "/auth/signin" });
        }
    },
});

function AppLayout() {
    const { queryClient } = Route.useRouteContext();
    const router = useRouter();

    const handleSignOut = async () => {
        try {
            await authClient.signOut();
            await queryClient.invalidateQueries({ queryKey: ["user"] });
            await router.invalidate();
        } catch (error) {
            console.error("Sign out failed:", error);
        }
    };

    return (
        <SidebarProvider defaultOpen={true}>
            <div className="flex h-screen w-full overflow-hidden bg-sidebar">
                <AppSidebar onSignOut={handleSignOut} />
                <SidebarInset className="overflow-auto bg-background text-foreground">
                    <Outlet />
                </SidebarInset>
            </div>
        </SidebarProvider>
    );
}
```