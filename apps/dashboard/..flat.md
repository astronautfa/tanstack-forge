# Contents of . source tree

## README

```markdown
Welcome to your new TanStack app! 

# Getting Started

To run this application:

```bash
pnpm install
pnpm start  
```

# Building For Production

To build this application for production:

```bash
pnpm build
```

## Testing

This project uses [Vitest](https://vitest.dev/) for testing. You can run the tests with:

```bash
pnpm test
```

## Styling

This project uses [Tailwind CSS](https://tailwindcss.com/) for styling.




## Shadcn

Add components using the canary version of [Shadcn](https://ui.shadcn.com/).

```bash
pnpx shadcn@canary add button
```



## Routing
This project uses [TanStack Router](https://tanstack.com/router). The initial setup is a file based router. Which means that the routes are managed as files in `src/routes`.

### Adding A Route

To add a new route to your application just add another a new file in the `./src/routes` directory.

TanStack will automatically generate the content of the route file for you.

Now that you have two routes you can use a `Link` component to navigate between them.

### Adding Links

To use SPA (Single Page Application) navigation you will need to import the `Link` component from `@tanstack/react-router`.

```tsx
import { Link } from "@tanstack/react-router";
```

Then anywhere in your JSX you can use it like so:

```tsx
<Link to="/about">About</Link>
```

This will create a link that will navigate to the `/about` route.

More information on the `Link` component can be found in the [Link documentation](https://tanstack.com/router/v1/docs/framework/react/api/router/linkComponent).

### Using A Layout

In the File Based Routing setup the layout is located in `src/routes/__root.tsx`. Anything you add to the root route will appear in all the routes. The route content will appear in the JSX where you use the `<Outlet />` component.

Here is an example layout that includes a header:

```tsx
import { Outlet, createRootRoute } from '@tanstack/react-router'
import { TanStackRouterDevtools } from '@tanstack/react-router-devtools'

import { Link } from "@tanstack/react-router";

export const Route = createRootRoute({
  component: () => (
    <>
      <header>
        <nav>
          <Link to="/">Home</Link>
          <Link to="/about">About</Link>
        </nav>
      </header>
      <Outlet />
      <TanStackRouterDevtools />
    </>
  ),
})
```

The `<TanStackRouterDevtools />` component is not required so you can remove it if you don't want it in your layout.

More information on layouts can be found in the [Layouts documentation](https://tanstack.com/router/latest/docs/framework/react/guide/routing-concepts#layouts).


## Data Fetching

There are multiple ways to fetch data in your application. You can use TanStack Query to fetch data from a server. But you can also use the `loader` functionality built into TanStack Router to load the data for a route before it's rendered.

For example:

```tsx
const peopleRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: "/people",
  loader: async () => {
    const response = await fetch("https://swapi.dev/api/people");
    return response.json() as Promise<{
      results: {
        name: string;
      }[];
    }>;
  },
  component: () => {
    const data = peopleRoute.useLoaderData();
    return (
      <ul>
        {data.results.map((person) => (
          <li key={person.name}>{person.name}</li>
        ))}
      </ul>
    );
  },
});
```

Loaders simplify your data fetching logic dramatically. Check out more information in the [Loader documentation](https://tanstack.com/router/latest/docs/framework/react/guide/data-loading#loader-parameters).

### React-Query

React-Query is an excellent addition or alternative to route loading and integrating it into you application is a breeze.

First add your dependencies:

```bash
pnpm add @tanstack/react-query @tanstack/react-query-devtools
```

Next we'll need to create a query client and provider. We recommend putting those in `main.tsx`.

```tsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

// ...

const queryClient = new QueryClient();

// ...

if (!rootElement.innerHTML) {
  const root = ReactDOM.createRoot(rootElement);

  root.render(
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
    </QueryClientProvider>
  );
}
```

You can also add TanStack Query Devtools to the root route (optional).

```tsx
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";

const rootRoute = createRootRoute({
  component: () => (
    <>
      <Outlet />
      <ReactQueryDevtools buttonPosition="top-right" />
      <TanStackRouterDevtools />
    </>
  ),
});
```

Now you can use `useQuery` to fetch your data.

```tsx
import { useQuery } from "@tanstack/react-query";

import "./App.css";

function App() {
  const { data } = useQuery({
    queryKey: ["people"],
    queryFn: () =>
      fetch("https://swapi.dev/api/people")
        .then((res) => res.json())
        .then((data) => data.results as { name: string }[]),
    initialData: [],
  });

  return (
    <div>
      <ul>
        {data.map((person) => (
          <li key={person.name}>{person.name}</li>
        ))}
      </ul>
    </div>
  );
}

export default App;
```

You can find out everything you need to know on how to use React-Query in the [React-Query documentation](https://tanstack.com/query/latest/docs/framework/react/overview).

## State Management

Another common requirement for React applications is state management. There are many options for state management in React. TanStack Store provides a great starting point for your project.

First you need to add TanStack Store as a dependency:

```bash
pnpm add @tanstack/store
```

Now let's create a simple counter in the `src/App.tsx` file as a demonstration.

```tsx
import { useStore } from "@tanstack/react-store";
import { Store } from "@tanstack/store";
import "./App.css";

const countStore = new Store(0);

function App() {
  const count = useStore(countStore);
  return (
    <div>
      <button onClick={() => countStore.setState((n) => n + 1)}>
        Increment - {count}
      </button>
    </div>
  );
}

export default App;
```

One of the many nice features of TanStack Store is the ability to derive state from other state. That derived state will update when the base state updates.

Let's check this out by doubling the count using derived state.

```tsx
import { useStore } from "@tanstack/react-store";
import { Store, Derived } from "@tanstack/store";
import "./App.css";

const countStore = new Store(0);

const doubledStore = new Derived({
  fn: () => countStore.state * 2,
  deps: [countStore],
});
doubledStore.mount();

function App() {
  const count = useStore(countStore);
  const doubledCount = useStore(doubledStore);

  return (
    <div>
      <button onClick={() => countStore.setState((n) => n + 1)}>
        Increment - {count}
      </button>
      <div>Doubled - {doubledCount}</div>
    </div>
  );
}

export default App;
```

We use the `Derived` class to create a new store that is derived from another store. The `Derived` class has a `mount` method that will start the derived store updating.

Once we've created the derived store we can use it in the `App` component just like we would any other store using the `useStore` hook.

You can find out everything you need to know on how to use TanStack Store in the [TanStack Store documentation](https://tanstack.com/store/latest).

# Demo files

Files prefixed with `demo` can be safely deleted. They are there to provide a starting point for you to play around with the features you've installed.

# Learn More

You can learn more about all of the offerings from TanStack in the [TanStack documentation](https://tanstack.com).

```

## File: postcss.config.ts

```typescript
export default {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

```

## File: app.config.ts

```typescript
import { defineConfig } from '@tanstack/react-start/config'
import viteTsConfigPaths from 'vite-tsconfig-paths'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  tsr: {
    appDirectory: 'src',
  },
  vite: {
    plugins: [
      viteTsConfigPaths({
        projects: ['./tsconfig.json'],
      }),
      tailwindcss(),
    ],
    ssr: {
      external: ['@prisma/client', 'better-auth']
    }
  },
})
```

## File: package.json

```json
{
  "name": "@app/dashboard",
  "private": true,
  "type": "module",
  "scripts": {
    "start": "vinxi start",
    "build": "vinxi build",
    "serve": "vite preview",
    "test": "vitest run",
    "dev": "vinxi dev",
    "lint": "biome check .",
    "lint:fix": "biome check --write .",
    "format": "biome format .",
    "format:fix": "biome format --write ."
  },
  "dependencies": {
    "@app/auth": "workspace:*",
    "@app/ui": "workspace:*",
    "@app/layout": "workspace:*",
    "@hookform/resolvers": "^4.1.3",
    "@tailwindcss/postcss": "^4.0.15",
    "@tailwindcss/vite": "^4.0.15",
    "@tanstack/react-query": "^5.69.0",
    "@tanstack/react-query-devtools": "^5.69.0",
    "@tanstack/react-router": "^1.114.27",
    "@tanstack/react-router-devtools": "^1.114.27",
    "@tanstack/react-router-with-query": "^1.114.27",
    "@tanstack/react-start": "^1.114.27",
    "@tanstack/router-plugin": "^1.114.27",
    "framer-motion": "^12.5.0",
    "localforage": "^1.10.0",
    "lucide-react": "0.483.0",
    "postcss": "^8.5.3",
    "react": "^19.0.0",
    "react-complex-tree": "^2.6.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.54.2",
    "sonner": "^2.0.1",
    "tailwind-merge": "^3.0.2",
    "tailwindcss": "^4.0.15",
    "tailwindcss-animate": "^1.0.7",
    "vinxi": "^0.5.3",
    "vite-tsconfig-paths": "^5.1.4",
    "zod": "^3.24.2",
    "zustand": "^5.0.3"
  },
  "devDependencies": {
    "@biomejs/biome": "^1.9.4",
    "@testing-library/dom": "^10.4.0",
    "@testing-library/react": "^16.2.0",
    "@types/react": "^19.0.12",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "jsdom": "^26.0.0",
    "typescript": "^5.8.2",
    "vite": "^6.2.2",
    "vitest": "^3.0.9",
    "web-vitals": "^4.2.4"
  }
}

```

## File: components.json

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "../../packages/ui/src/styles/globals.css",
    "baseColor": "zinc",
    "cssVariables": true
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "hooks": "@/hooks",
    "lib": "@/lib",
    "utils": "@app/ui/lib/utils",
    "ui": "@app/ui/components"
  }
}

```

## File: tsconfig.json

```json
{
  "include": ["**/*.ts", "**/*.tsx", "../../index.tsx"],
  "compilerOptions": {
    "target": "ES2022",
    "jsx": "react-jsx",
    "module": "ESNext",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "types": ["vite/client"],

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "noEmit": true,

    /* Linting */
    "skipLibCheck": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}

```

## File: biome.json

```json
{
	"extends": ["../../biome.json"]
}

```

## File: public/manifest.json

```json
{
  "short_name": "TanStack App",
  "name": "Create TanStack App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}

```

## File: src/ssr.tsx

```tsx
import { getRouterManifest } from "@tanstack/react-start/router-manifest";
import {
	createStartHandler,
	defaultStreamHandler,
} from "@tanstack/react-start/server";

import { createRouter } from "./router";

export default createStartHandler({
	createRouter,
	getRouterManifest,
})(defaultStreamHandler);

```

## File: src/api.ts

```typescript
import {
	createStartAPIHandler,
	defaultAPIFileRouteHandler,
} from "@tanstack/react-start/api";

export default createStartAPIHandler(defaultAPIFileRouteHandler);

```

## File: src/router.tsx

```tsx
import { QueryClient } from '@tanstack/react-query';
import { createRouter as createTanStackRouter } from '@tanstack/react-router';
import { routerWithQueryClient } from '@tanstack/react-router-with-query';

import { NotFound } from '@/components/not-found';
import { CatchBoundary } from '@/components/catch-boundary';

import { routeTree } from '@/routeTree.gen';

export function createRouter() {
	const queryClient: QueryClient = new QueryClient({
		defaultOptions: {},
	});

	return routerWithQueryClient(
		createTanStackRouter({
			routeTree,
			defaultPreload: 'intent',
			context: { queryClient, user: null },
			defaultPreloadStaleTime: 0,
			defaultErrorComponent: CatchBoundary,
			defaultNotFoundComponent: NotFound,
			scrollRestoration: true,
			defaultStructuralSharing: true,
		}),
		queryClient,
	);
}

declare module '@tanstack/react-router' {
	interface Register {
		router: ReturnType<typeof createRouter>;
	}
}

```

## File: src/routeTree.gen.ts

```typescript
/* eslint-disable */

// @ts-nocheck

// noinspection JSUnusedGlobalSymbols

// This file was automatically generated by TanStack Router.
// You should NOT make any changes in this file as it will be overwritten.
// Additionally, you should also exclude this file from your linter and/or formatter to prevent it from being checked or modified.

// Import Routes

import { Route as rootRoute } from './routes/__root'
import { Route as AuthRouteImport } from './routes/auth/route'
import { Route as appRouteImport } from './routes/(app)/route'
import { Route as appIndexImport } from './routes/(app)/index'
import { Route as AuthSignupImport } from './routes/auth/signup'
import { Route as AuthSigninImport } from './routes/auth/signin'
import { Route as AuthResetPasswordImport } from './routes/auth/reset-password'
import { Route as AuthForgotPasswordImport } from './routes/auth/forgot-password'
import { Route as appToolsImport } from './routes/(app)/tools'
import { Route as appSettingsImport } from './routes/(app)/settings'
import { Route as appLibraryImport } from './routes/(app)/library'
import { Route as appLayoutImport } from './routes/(app)/layout'
import { Route as appIntegrationImport } from './routes/(app)/integration'
import { Route as appInsightsImport } from './routes/(app)/insights'
import { Route as appHelpImport } from './routes/(app)/help'
import { Route as appContactsImport } from './routes/(app)/contacts'

// Create/Update Routes

const AuthRouteRoute = AuthRouteImport.update({
  id: '/auth',
  path: '/auth',
  getParentRoute: () => rootRoute,
} as any)

const appRouteRoute = appRouteImport.update({
  id: '/(app)',
  getParentRoute: () => rootRoute,
} as any)

const appIndexRoute = appIndexImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => appRouteRoute,
} as any)

const AuthSignupRoute = AuthSignupImport.update({
  id: '/signup',
  path: '/signup',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthSigninRoute = AuthSigninImport.update({
  id: '/signin',
  path: '/signin',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthResetPasswordRoute = AuthResetPasswordImport.update({
  id: '/reset-password',
  path: '/reset-password',
  getParentRoute: () => AuthRouteRoute,
} as any)

const AuthForgotPasswordRoute = AuthForgotPasswordImport.update({
  id: '/forgot-password',
  path: '/forgot-password',
  getParentRoute: () => AuthRouteRoute,
} as any)

const appToolsRoute = appToolsImport.update({
  id: '/tools',
  path: '/tools',
  getParentRoute: () => appRouteRoute,
} as any)

const appSettingsRoute = appSettingsImport.update({
  id: '/settings',
  path: '/settings',
  getParentRoute: () => appRouteRoute,
} as any)

const appLibraryRoute = appLibraryImport.update({
  id: '/library',
  path: '/library',
  getParentRoute: () => appRouteRoute,
} as any)

const appLayoutRoute = appLayoutImport.update({
  id: '/layout',
  path: '/layout',
  getParentRoute: () => appRouteRoute,
} as any)

const appIntegrationRoute = appIntegrationImport.update({
  id: '/integration',
  path: '/integration',
  getParentRoute: () => appRouteRoute,
} as any)

const appInsightsRoute = appInsightsImport.update({
  id: '/insights',
  path: '/insights',
  getParentRoute: () => appRouteRoute,
} as any)

const appHelpRoute = appHelpImport.update({
  id: '/help',
  path: '/help',
  getParentRoute: () => appRouteRoute,
} as any)

const appContactsRoute = appContactsImport.update({
  id: '/contacts',
  path: '/contacts',
  getParentRoute: () => appRouteRoute,
} as any)

// Populate the FileRoutesByPath interface

declare module '@tanstack/react-router' {
  interface FileRoutesByPath {
    '/(app)': {
      id: '/(app)'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof appRouteImport
      parentRoute: typeof rootRoute
    }
    '/auth': {
      id: '/auth'
      path: '/auth'
      fullPath: '/auth'
      preLoaderRoute: typeof AuthRouteImport
      parentRoute: typeof rootRoute
    }
    '/(app)/contacts': {
      id: '/(app)/contacts'
      path: '/contacts'
      fullPath: '/contacts'
      preLoaderRoute: typeof appContactsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/help': {
      id: '/(app)/help'
      path: '/help'
      fullPath: '/help'
      preLoaderRoute: typeof appHelpImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/insights': {
      id: '/(app)/insights'
      path: '/insights'
      fullPath: '/insights'
      preLoaderRoute: typeof appInsightsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/integration': {
      id: '/(app)/integration'
      path: '/integration'
      fullPath: '/integration'
      preLoaderRoute: typeof appIntegrationImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/layout': {
      id: '/(app)/layout'
      path: '/layout'
      fullPath: '/layout'
      preLoaderRoute: typeof appLayoutImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/library': {
      id: '/(app)/library'
      path: '/library'
      fullPath: '/library'
      preLoaderRoute: typeof appLibraryImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/settings': {
      id: '/(app)/settings'
      path: '/settings'
      fullPath: '/settings'
      preLoaderRoute: typeof appSettingsImport
      parentRoute: typeof appRouteImport
    }
    '/(app)/tools': {
      id: '/(app)/tools'
      path: '/tools'
      fullPath: '/tools'
      preLoaderRoute: typeof appToolsImport
      parentRoute: typeof appRouteImport
    }
    '/auth/forgot-password': {
      id: '/auth/forgot-password'
      path: '/forgot-password'
      fullPath: '/auth/forgot-password'
      preLoaderRoute: typeof AuthForgotPasswordImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/reset-password': {
      id: '/auth/reset-password'
      path: '/reset-password'
      fullPath: '/auth/reset-password'
      preLoaderRoute: typeof AuthResetPasswordImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/signin': {
      id: '/auth/signin'
      path: '/signin'
      fullPath: '/auth/signin'
      preLoaderRoute: typeof AuthSigninImport
      parentRoute: typeof AuthRouteImport
    }
    '/auth/signup': {
      id: '/auth/signup'
      path: '/signup'
      fullPath: '/auth/signup'
      preLoaderRoute: typeof AuthSignupImport
      parentRoute: typeof AuthRouteImport
    }
    '/(app)/': {
      id: '/(app)/'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof appIndexImport
      parentRoute: typeof appRouteImport
    }
  }
}

// Create and export the route tree

interface appRouteRouteChildren {
  appContactsRoute: typeof appContactsRoute
  appHelpRoute: typeof appHelpRoute
  appInsightsRoute: typeof appInsightsRoute
  appIntegrationRoute: typeof appIntegrationRoute
  appLayoutRoute: typeof appLayoutRoute
  appLibraryRoute: typeof appLibraryRoute
  appSettingsRoute: typeof appSettingsRoute
  appToolsRoute: typeof appToolsRoute
  appIndexRoute: typeof appIndexRoute
}

const appRouteRouteChildren: appRouteRouteChildren = {
  appContactsRoute: appContactsRoute,
  appHelpRoute: appHelpRoute,
  appInsightsRoute: appInsightsRoute,
  appIntegrationRoute: appIntegrationRoute,
  appLayoutRoute: appLayoutRoute,
  appLibraryRoute: appLibraryRoute,
  appSettingsRoute: appSettingsRoute,
  appToolsRoute: appToolsRoute,
  appIndexRoute: appIndexRoute,
}

const appRouteRouteWithChildren = appRouteRoute._addFileChildren(
  appRouteRouteChildren,
)

interface AuthRouteRouteChildren {
  AuthForgotPasswordRoute: typeof AuthForgotPasswordRoute
  AuthResetPasswordRoute: typeof AuthResetPasswordRoute
  AuthSigninRoute: typeof AuthSigninRoute
  AuthSignupRoute: typeof AuthSignupRoute
}

const AuthRouteRouteChildren: AuthRouteRouteChildren = {
  AuthForgotPasswordRoute: AuthForgotPasswordRoute,
  AuthResetPasswordRoute: AuthResetPasswordRoute,
  AuthSigninRoute: AuthSigninRoute,
  AuthSignupRoute: AuthSignupRoute,
}

const AuthRouteRouteWithChildren = AuthRouteRoute._addFileChildren(
  AuthRouteRouteChildren,
)

export interface FileRoutesByFullPath {
  '/': typeof appIndexRoute
  '/auth': typeof AuthRouteRouteWithChildren
  '/contacts': typeof appContactsRoute
  '/help': typeof appHelpRoute
  '/insights': typeof appInsightsRoute
  '/integration': typeof appIntegrationRoute
  '/layout': typeof appLayoutRoute
  '/library': typeof appLibraryRoute
  '/settings': typeof appSettingsRoute
  '/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
}

export interface FileRoutesByTo {
  '/auth': typeof AuthRouteRouteWithChildren
  '/contacts': typeof appContactsRoute
  '/help': typeof appHelpRoute
  '/insights': typeof appInsightsRoute
  '/integration': typeof appIntegrationRoute
  '/layout': typeof appLayoutRoute
  '/library': typeof appLibraryRoute
  '/settings': typeof appSettingsRoute
  '/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
  '/': typeof appIndexRoute
}

export interface FileRoutesById {
  __root__: typeof rootRoute
  '/(app)': typeof appRouteRouteWithChildren
  '/auth': typeof AuthRouteRouteWithChildren
  '/(app)/contacts': typeof appContactsRoute
  '/(app)/help': typeof appHelpRoute
  '/(app)/insights': typeof appInsightsRoute
  '/(app)/integration': typeof appIntegrationRoute
  '/(app)/layout': typeof appLayoutRoute
  '/(app)/library': typeof appLibraryRoute
  '/(app)/settings': typeof appSettingsRoute
  '/(app)/tools': typeof appToolsRoute
  '/auth/forgot-password': typeof AuthForgotPasswordRoute
  '/auth/reset-password': typeof AuthResetPasswordRoute
  '/auth/signin': typeof AuthSigninRoute
  '/auth/signup': typeof AuthSignupRoute
  '/(app)/': typeof appIndexRoute
}

export interface FileRouteTypes {
  fileRoutesByFullPath: FileRoutesByFullPath
  fullPaths:
    | '/'
    | '/auth'
    | '/contacts'
    | '/help'
    | '/insights'
    | '/integration'
    | '/layout'
    | '/library'
    | '/settings'
    | '/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
  fileRoutesByTo: FileRoutesByTo
  to:
    | '/auth'
    | '/contacts'
    | '/help'
    | '/insights'
    | '/integration'
    | '/layout'
    | '/library'
    | '/settings'
    | '/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
    | '/'
  id:
    | '__root__'
    | '/(app)'
    | '/auth'
    | '/(app)/contacts'
    | '/(app)/help'
    | '/(app)/insights'
    | '/(app)/integration'
    | '/(app)/layout'
    | '/(app)/library'
    | '/(app)/settings'
    | '/(app)/tools'
    | '/auth/forgot-password'
    | '/auth/reset-password'
    | '/auth/signin'
    | '/auth/signup'
    | '/(app)/'
  fileRoutesById: FileRoutesById
}

export interface RootRouteChildren {
  appRouteRoute: typeof appRouteRouteWithChildren
  AuthRouteRoute: typeof AuthRouteRouteWithChildren
}

const rootRouteChildren: RootRouteChildren = {
  appRouteRoute: appRouteRouteWithChildren,
  AuthRouteRoute: AuthRouteRouteWithChildren,
}

export const routeTree = rootRoute
  ._addFileChildren(rootRouteChildren)
  ._addFileTypes<FileRouteTypes>()

/* ROUTE_MANIFEST_START
{
  "routes": {
    "__root__": {
      "filePath": "__root.tsx",
      "children": [
        "/(app)",
        "/auth"
      ]
    },
    "/(app)": {
      "filePath": "(app)/route.tsx",
      "children": [
        "/(app)/contacts",
        "/(app)/help",
        "/(app)/insights",
        "/(app)/integration",
        "/(app)/layout",
        "/(app)/library",
        "/(app)/settings",
        "/(app)/tools",
        "/(app)/"
      ]
    },
    "/auth": {
      "filePath": "auth/route.tsx",
      "children": [
        "/auth/forgot-password",
        "/auth/reset-password",
        "/auth/signin",
        "/auth/signup"
      ]
    },
    "/(app)/contacts": {
      "filePath": "(app)/contacts.tsx",
      "parent": "/(app)"
    },
    "/(app)/help": {
      "filePath": "(app)/help.tsx",
      "parent": "/(app)"
    },
    "/(app)/insights": {
      "filePath": "(app)/insights.tsx",
      "parent": "/(app)"
    },
    "/(app)/integration": {
      "filePath": "(app)/integration.tsx",
      "parent": "/(app)"
    },
    "/(app)/layout": {
      "filePath": "(app)/layout.tsx",
      "parent": "/(app)"
    },
    "/(app)/library": {
      "filePath": "(app)/library.tsx",
      "parent": "/(app)"
    },
    "/(app)/settings": {
      "filePath": "(app)/settings.tsx",
      "parent": "/(app)"
    },
    "/(app)/tools": {
      "filePath": "(app)/tools.tsx",
      "parent": "/(app)"
    },
    "/auth/forgot-password": {
      "filePath": "auth/forgot-password.tsx",
      "parent": "/auth"
    },
    "/auth/reset-password": {
      "filePath": "auth/reset-password.tsx",
      "parent": "/auth"
    },
    "/auth/signin": {
      "filePath": "auth/signin.tsx",
      "parent": "/auth"
    },
    "/auth/signup": {
      "filePath": "auth/signup.tsx",
      "parent": "/auth"
    },
    "/(app)/": {
      "filePath": "(app)/index.tsx",
      "parent": "/(app)"
    }
  }
}
ROUTE_MANIFEST_END */

```

## File: src/client.tsx

```tsx
import { StartClient } from "@tanstack/react-start";
import { hydrateRoot } from "react-dom/client";

import { createRouter } from "./router";

const router = createRouter();

hydrateRoot(document, <StartClient router={router} />);

```

## File: src/components/search-form.tsx

```tsx
import { useId } from "react";
import { SidebarInput } from "@app/ui/components/sidebar";
import { SidebarGroup, SidebarGroupContent } from "@app/ui/components/sidebar";
import { Search } from "lucide-react";

export function SearchForm({ ...props }: React.ComponentProps<"form">) {
    const id = useId();

    return (
        <form {...props}>
            <SidebarGroup className="py-0 px-0">
                <SidebarGroupContent className="relative">
                    <div className="relative">
                        <SidebarInput id={id} className="ps-9 pe-9" aria-label="Search" />
                        <div className="pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-2 text-muted-foreground/60 peer-disabled:opacity-50">
                            <Search size={20} aria-hidden="true" />
                        </div>
                        <div className="pointer-events-none absolute inset-y-0 end-0 flex items-center justify-center pe-2 text-muted-foreground">
                            <kbd className="inline-flex size-5 max-h-full items-center justify-center rounded bg-input px-1 font-[inherit] text-[0.625rem] font-medium text-muted-foreground/70">
                                /
                            </kbd>
                        </div>
                    </div>
                </SidebarGroupContent>
            </SidebarGroup>
        </form>
    );
}
```

## File: src/components/workspace-switcher.tsx

```tsx
import {
    ChevronsUpDown,
    LogOut,
    Plus,
    Settings,
    User as UserIcon,
    Check,
    MoonIcon,
    SunIcon,
} from 'lucide-react';
import * as React from 'react';
import { useNavigate, useRouteContext } from '@tanstack/react-router';

import { Avatar, AvatarFallback, AvatarImage } from '@app/ui/components/avatar';
import { Button } from '@app/ui/components/button';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger,
} from '@app/ui/components/dropdown-menu';
import {
    Tooltip,
    TooltipContent,
    TooltipProvider,
    TooltipTrigger,
} from '@app/ui/components/tooltip';
import {
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
} from "@app/ui/components/sidebar"; // Using your sidebar structure
import { useTheme } from '@/lib/hooks/use-theme';
import type { User } from '@/lib/providers/session';


// Define the Workspace type (or import it)
export type Workspace = {
    id: string;
    name: string;
    icon?: React.ElementType;
    color?: string;
    role: 'Owner' | 'Admin' | 'Member';
    members: number;
};

// --- Mock Data (Replace with your actual data fetching/props) ---
const MOCK_WORKSPACES: Workspace[] = [
    { id: 'research', name: 'Research Workspace', role: 'Owner', members: 5, color: 'hsl(210, 80%, 60%)', icon: UserIcon }, // Example icon/color
    { id: 'personal', name: 'Personal Space', role: 'Owner', members: 1, color: 'hsl(140, 50%, 60%)' },
    { id: 'team-alpha', name: 'Team Alpha', role: 'Member', members: 8, color: 'hsl(30, 80%, 60%)', icon: UserIcon },
];
// --- End Mock Data ---

// --- Helper Function for Initials ---
function getInitials(name?: string | null): string {
    if (!name) return '?';
    const names = name.split(' ');
    if (names.length === 1) return names[0].charAt(0).toUpperCase();
    return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
}

const WorkspaceIcon: React.FC<{ workspace: Workspace; className?: string }> = ({ workspace, className = 'size-5' }) => {
    const IconComponent = workspace.icon ?? UserIcon;
    const bgColor = workspace.color ?? 'hsl(var(--muted))';

    return (
        <Avatar className={` ${className}`}>
            <AvatarFallback
                className="text-[9px] font-medium text-white"
                style={{ backgroundColor: bgColor }}
            >
                <IconComponent className="size-3/5" />
            </AvatarFallback>
        </Avatar>
    );
};

interface WorkSpaceSwitcherProps {
    onSignOut: () => Promise<void>;
}

export function WorkSpaceSwitcher({
    onSignOut,
}: WorkSpaceSwitcherProps) {
    const navigate = useNavigate();

    const { user } = useRouteContext({
        from: '__root__',
        select: (context) => ({ user: context.user }),
    });

    const { toggleTheme, theme } = useTheme();

    // --- State for current workspace (replace with your logic) ---
    // This might come from a global state, URL param, or prop
    const [currentWorkspaceId, setCurrentWorkspaceId] = React.useState<string | null>(MOCK_WORKSPACES[0]?.id ?? null);
    const workspaces = MOCK_WORKSPACES; // Use mock or fetched data
    // --- End State ---

    const currentWorkspace = React.useMemo(
        () => workspaces.find((w) => w.id === currentWorkspaceId),
        [workspaces, currentWorkspaceId]
    );

    // --- Action Handlers (Implement or pass as props) ---
    const handleSwitchWorkspace = (workspaceId: string) => {
        console.log(`Switching to workspace: ${workspaceId}`);
        setCurrentWorkspaceId(workspaceId);
        // Add logic: Update global state, refetch data, navigate, etc.
        // toast.success(`Switched to ${workspaces.find(w => w.id === workspaceId)?.name}`); // Optional: Add toast notifications
    };

    const handleCreateWorkspace = () => {
        console.log('Trigger Create Workspace action');
        // Add logic: Open modal, navigate to create page, etc.
        // pushModal('CreateWorkspace'); // If using a modal system
        // toast.info('Create Workspace dialog would open here'); // Optional notification
    };
    // --- End Action Handlers ---


    // Signed Out State (Optional: Can be handled by router redirect)
    if (!user) {
        return (
            <SidebarMenu>
                <SidebarMenuItem>
                    <SidebarMenuButton
                        size="md"
                        className="gap-3"
                        onClick={() => navigate({ to: '/auth/signin' })} // Navigate to your login route
                    >
                        <UserIcon className="size-5 text-muted-foreground" /> {/* Use a generic user icon */}
                        <div className="grid flex-1 text-left">
                            <span className="font-medium">Sign In</span>
                        </div>
                    </SidebarMenuButton>
                </SidebarMenuItem>
            </SidebarMenu>
        );
    }

    // Signed In State
    return (
        <TooltipProvider delayDuration={150}>
            <SidebarMenu>
                <SidebarMenuItem>
                    <DropdownMenu>
                        <DropdownMenuTrigger asChild>
                            <SidebarMenuButton
                                size="md" // Or adjust size as needed
                                className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground gap-2.5 [&>svg]:size-auto"
                            >
                                {/* User Avatar */}
                                <Avatar className="size-6 border border-border">
                                    {/* <AvatarImage alt={user.name ?? ''} src={user.image ?? ''} /> */}
                                    <AvatarFallback className="text-[10px]">
                                        {/* {getInitials(user.name)} */}
                                    </AvatarFallback>
                                </Avatar>

                                {/* Current Workspace Info */}
                                <div className="grid flex-1 text-left text-sm leading-tight">
                                    <span className="truncate font-medium">
                                        {currentWorkspace?.name ?? 'Select Workspace'}
                                    </span>
                                </div>

                                {/* Dropdown Indicator */}
                                <ChevronsUpDown
                                    className="ms-auto text-muted-foreground/60"
                                    size={16}
                                    aria-hidden="true"
                                />
                            </SidebarMenuButton>
                        </DropdownMenuTrigger>

                        <DropdownMenuContent
                            className="w-[--radix-dropdown-menu-trigger-width] min-w-64 rounded-lg pb-2"
                            align="start"
                            side="bottom"
                            sideOffset={6}
                        >
                            {/* User Info Header */}
                            <div className="flex items-center space-x-3 p-3 relative">
                                <Avatar className="size-9 border border-border">
                                    <AvatarImage alt={user.name!} src={user.image!} />
                                    <AvatarFallback>{getInitials(user.name)}</AvatarFallback>
                                </Avatar>
                                <div className="flex flex-col items-start justify-center space-y-0.5 text-start">
                                    <p className="line-clamp-1 text-sm font-medium">{user.name ?? 'User'}</p>
                                    <p className="text-xs font-medium leading-none text-muted-foreground">{user.email ?? 'No email'}</p>
                                </div>
                                <Tooltip>
                                    <TooltipTrigger asChild>
                                        <Button
                                            variant="ghost"
                                            size="icon"
                                            className="absolute top-1 right-1 text-muted-foreground hover:text-foreground"
                                            onClick={() => navigate({ to: '/settings' })}
                                        >
                                            <Settings className="size-4" />
                                            <span className="sr-only">Account Settings</span>
                                        </Button>
                                    </TooltipTrigger>
                                    <TooltipContent side="bottom">Account Settings</TooltipContent>
                                </Tooltip>
                            </div>
                            <DropdownMenuSeparator />

                            {/* Workspace Selection */}
                            <DropdownMenuLabel className="px-2 py-1.5 text-xs font-semibold text-muted-foreground">
                                Workspaces
                            </DropdownMenuLabel>
                            <DropdownMenuGroup className="max-h-[250px] overflow-y-auto">
                                {workspaces.map((workspace) => (
                                    <DropdownMenuItem
                                        key={workspace.id}
                                        className="flex items-center gap-2.5 px-2 py-1.5 cursor-pointer"
                                        onClick={() => handleSwitchWorkspace(workspace.id)}
                                        disabled={workspace.id === currentWorkspaceId}
                                    >
                                        <WorkspaceIcon workspace={workspace} className="size-5" />
                                        <div className="flex flex-col flex-1">
                                            <span className="text-sm font-medium">{workspace.name}</span>
                                            <span className="text-xs text-muted-foreground">
                                                {workspace.role} â€¢ {workspace.members} member{workspace.members !== 1 ? 's' : ''}
                                            </span>
                                        </div>
                                        {workspace.id === currentWorkspaceId && (
                                            <Check className="size-4 ml-auto text-primary" />
                                        )}
                                    </DropdownMenuItem>
                                ))}
                            </DropdownMenuGroup>

                            {/* Create Workspace */}
                            <DropdownMenuItem
                                className="flex items-center gap-2.5 px-2 py-1.5 cursor-pointer"
                                onClick={handleCreateWorkspace}
                            >
                                <div className="flex size-5 items-center justify-center rounded-sm bg-muted"> {/* Subtle background for icon */}
                                    <Plus className="size-3.5 text-muted-foreground" />
                                </div>
                                <span className="text-sm">Create Workspace</span>
                            </DropdownMenuItem>

                            <DropdownMenuSeparator />

                            {/* Other Actions */}
                            <DropdownMenuGroup>
                                {/* Placeholder: Theme Toggle */}
                                <DropdownMenuItem
                                    onClick={toggleTheme}
                                    className="gap-2 h-7 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
                                >
                                    {theme === 'light' ? (
                                        <SunIcon
                                            className="text-muted-foreground"
                                            size={16}
                                            aria-hidden="true"
                                        />
                                    ) : (
                                        <MoonIcon
                                            className="text-muted-foreground"
                                            size={16}
                                            aria-hidden="true"
                                        />
                                    )}
                                    <span>Theme</span>
                                </DropdownMenuItem>

                                <DropdownMenuItem
                                    className="flex items-center gap-2.5 h-7 cursor-pointer"
                                    onClick={onSignOut}
                                >
                                    <LogOut className="size-3.5 text-muted-foreground" />
                                    <span className="text-xs">Sign Out</span>
                                </DropdownMenuItem>
                            </DropdownMenuGroup>
                        </DropdownMenuContent>
                    </DropdownMenu>
                </SidebarMenuItem>
            </SidebarMenu>
        </TooltipProvider>
    );
}
```

## File: src/components/chat-settings-dialog.tsx

```tsx
import React, { useState, useEffect } from 'react';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogHeader,
    DialogTitle,
} from "@app/ui/components/dialog";
import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
} from "@app/ui/components/alert-dialog";
import {
    Tabs,
    TabsContent,
    TabsList,
    TabsTrigger,
} from "@app/ui/components/tabs";
import {
    Card,
    CardContent,
    CardDescription,
    CardHeader,
    CardTitle,
} from "@app/ui/components/card";
import { Button } from "@app/ui/components/button";
import { Badge } from "@app/ui/components/badge";
import { Slider } from "@app/ui/components/slider";
import { Switch } from "@app/ui/components/switch";
import { Input } from "@app/ui/components/input";
import { Textarea } from "@app/ui/components/textarea";
import { ScrollArea } from "@app/ui/components/scroll-area";
import {
    Tooltip,
    TooltipContent,
    TooltipProvider,
    TooltipTrigger
} from "@app/ui/components/tooltip";
import { cn } from "@app/ui/lib/utils";
import {
    Settings2,
    BrainCircuit,
    PanelLeft,
    Sparkles,
    MessageSquare,
    SlidersHorizontal,
    Info,
    RefreshCw,
    Download,
    Trash2,
    Undo2,
    Save,
    AlertTriangle,
} from 'lucide-react';

// --- Interface Definitions ---
export interface ModelSettings {
    systemPrompt: string;
    temperature: number;
    maxTokens: number;
    topP: number;
    frequencyPenalty: number;
    presencePenalty: number;
    modelId?: string;
}

export interface ChatUISettings {
    showTimestamps: boolean;
    compactMode: boolean;
    autoScroll: boolean;
    darkMode?: boolean;
    enableKeyboardShortcuts?: boolean;
    messageSounds?: boolean;
    enableMarkdown?: boolean;
}

export interface ModelOption {
    id: string;
    name: string;
    description?: string;
    capabilities?: string[];
    isDefault?: boolean;
}

export interface ChatSettingsDialogProps {
    isOpen: boolean;
    onOpenChange: (open: boolean) => void;
    modelSettings: ModelSettings;
    setModelSettings: (settings: ModelSettings) => void;
    uiSettings: ChatUISettings;
    setUISettings: (settings: ChatUISettings) => void;
    availableModels?: ModelOption[];
    onClearHistory?: () => void;
    onExportChat?: () => void;
    defaultModelSettings: ModelSettings;
    defaultUISettings: ChatUISettings;
}

const ChatSettingsDialog: React.FC<ChatSettingsDialogProps> = ({
    isOpen,
    onOpenChange,
    modelSettings,
    setModelSettings,
    uiSettings,
    setUISettings,
    availableModels = [],
    onClearHistory,
    onExportChat,
    defaultModelSettings,
    defaultUISettings,
}) => {
    const [localModelSettings, setLocalModelSettings] = useState<ModelSettings>({ ...modelSettings });
    const [localUISettings, setLocalUISettings] = useState<ChatUISettings>({ ...uiSettings });
    const [activeTab, setActiveTab] = useState("model");
    const [hasChanges, setHasChanges] = useState(false);
    const [showClearConfirm, setShowClearConfirm] = useState(false);
    const [showUnsavedWarning, setShowUnsavedWarning] = useState(false);
    const [pendingClose, setPendingClose] = useState(false);

    useEffect(() => {
        if (isOpen) {
            setLocalModelSettings({ ...modelSettings });
            setLocalUISettings({ ...uiSettings });
            setHasChanges(false);
        }
    }, [isOpen, modelSettings, uiSettings]);

    useEffect(() => {
        if (isOpen) {
            const modelSettingsChanged = JSON.stringify(localModelSettings) !== JSON.stringify(modelSettings);
            const uiSettingsChanged = JSON.stringify(localUISettings) !== JSON.stringify(uiSettings);
            setHasChanges(modelSettingsChanged || uiSettingsChanged);
        }
    }, [localModelSettings, localUISettings, modelSettings, uiSettings, isOpen]);

    useEffect(() => {
        if (!showUnsavedWarning && pendingClose) {
            onOpenChange(false);
            setPendingClose(false);
        }
    }, [showUnsavedWarning, pendingClose, onOpenChange]);

    const handleSave = () => {
        setModelSettings(localModelSettings);
        setUISettings(localUISettings);
        setHasChanges(false); // Explicitly set to false after saving
        onOpenChange(false);
    };

    const handleAttemptClose = () => {
        if (hasChanges) {
            setShowUnsavedWarning(true);
            setPendingClose(true);
        } else {
            onOpenChange(false);
        }
    };

    const handleCancelButton = () => {
        if (hasChanges) {
            setShowUnsavedWarning(true);
            setPendingClose(false); // Don't set pending close on explicit cancel click
        } else {
            onOpenChange(false);
        }
    };


    const handleConfirmDiscard = () => {
        setShowUnsavedWarning(false);
        // Reset state *before* closing if pending
        setLocalModelSettings({ ...modelSettings });
        setLocalUISettings({ ...uiSettings });
        setHasChanges(false); // Reset changes flag
        if (pendingClose) {
            onOpenChange(false);
            setPendingClose(false);
        }
    };

    const handleDialogInteraction = (open: boolean) => {
        if (!open) {
            handleAttemptClose();
        } else {
            onOpenChange(true);
        }
    };


    const handleReset = () => {
        if (activeTab === "model") {
            setLocalModelSettings({ ...defaultModelSettings, modelId: localModelSettings.modelId ?? modelSettings.modelId }); // Keep current model selection
        } else {
            setLocalUISettings({ ...defaultUISettings });
        }
    };


    const handleClearHistory = () => {
        setShowClearConfirm(true);
    };

    const handleConfirmClear = () => {
        setShowClearConfirm(false);
        if (onClearHistory) {
            onClearHistory();
        }
    };

    // UI helper components
    const SettingLabel = ({ children, tooltip }: { children: React.ReactNode; tooltip: string }) => (
        <div className="flex items-center gap-1.5">
            <span className="text-sm font-medium">{children}</span>
            <TooltipProvider>
                <Tooltip delayDuration={300}>
                    <TooltipTrigger asChild>
                        <Info className="h-3.5 w-3.5 text-muted-foreground cursor-help opacity-70 hover:opacity-100 transition-opacity" />
                    </TooltipTrigger>
                    <TooltipContent className="max-w-xs text-xs" side="top">{tooltip}</TooltipContent>
                </Tooltip>
            </TooltipProvider>
        </div>
    );

    const SettingSlider = ({
        id,
        label,
        value,
        min,
        max,
        step,
        onChange,
        tooltip,
        formatValue = (v: number) => v.toFixed(1),
    }: {
        id: string;
        label: string;
        value: number;
        min: number;
        max: number;
        step: number;
        onChange: (value: number[]) => void;
        tooltip: string;
        formatValue?: (value: number) => string;
    }) => (
        <div className="space-y-2 pb-2">
            <div className="flex justify-between items-center">
                <SettingLabel tooltip={tooltip}>{label}</SettingLabel>
                <Badge variant="outline" className="font-mono h-6 min-w-[48px] flex items-center justify-center">
                    {formatValue(value)}
                </Badge>
            </div>
            <Slider
                id={id}
                min={min}
                max={max}
                step={step}
                value={[value]}
                onValueChange={onChange}
                className="h-2 cursor-pointer"
            />
        </div>
    );

    // Quick setting presets (same as before)
    const presets = [
        {
            name: "Creative",
            settings: {
                temperature: 1.2,
                topP: 0.9,
                frequencyPenalty: 0.6,
                presencePenalty: 0.6,
            },
        },
        {
            name: "Balanced",
            settings: {
                temperature: 0.7,
                topP: 1.0,
                frequencyPenalty: 0.0,
                presencePenalty: 0.0,
            },
        },
        {
            name: "Precise",
            settings: {
                temperature: 0.2,
                topP: 0.5,
                frequencyPenalty: 0,
                presencePenalty: 0,
            },
        },
    ];

    return (
        <>
            <Dialog open={isOpen} onOpenChange={handleDialogInteraction}>
                {/* ---- MODIFICATION START ---- */}
                <DialogContent className="sm:max-w-[650px] p-0 gap-0 max-h-[90vh] flex flex-col overflow-hidden">
                    {/* 1. Header: Fixed at the top, remove bottom padding */}
                    <DialogHeader className="p-6 pb-4 shrink-0 border-b"> {/* Added border-b */}
                        {/* ... header content (no changes inside) ... */}
                        <div className="flex justify-between items-start">
                            <div>
                                <DialogTitle className="text-xl flex items-center gap-2">
                                    <Settings2 className="h-5 w-5" />
                                    Settings
                                </DialogTitle>
                                <DialogDescription className="mt-1.5">
                                    Customize your AI experience and interface preferences
                                </DialogDescription>
                            </div>
                            {hasChanges && (
                                <Badge variant="secondary" className="bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100">
                                    Unsaved Changes
                                </Badge>
                            )}
                        </div>
                    </DialogHeader>

                    {/* 2. Tabs Component: Takes remaining space, uses flex-col */}
                    <Tabs value={activeTab} onValueChange={setActiveTab} className="flex-1 flex flex-col min-h-0"> {/* Added min-h-0 */}
                        {/* 3. Tabs List: Fixed below header, outside ScrollArea */}
                        <div className="px-6 pt-4 pb-4 shrink-0"> {/* Adjusted padding */}
                            <TabsList className="w-full grid grid-cols-2">
                                <TabsTrigger value="model" className="flex items-center gap-2">
                                    <BrainCircuit className="h-4 w-4" />
                                    <span>AI Model</span>
                                </TabsTrigger>
                                <TabsTrigger value="interface" className="flex items-center gap-2">
                                    <PanelLeft className="h-4 w-4" />
                                    <span>Interface</span>
                                </TabsTrigger>
                            </TabsList>
                        </div>

                        {/* 4. Scroll Area: Wraps TabsContent, takes remaining space, provides padding */}
                        <ScrollArea className="flex-1 px-6 pb-6 h-full"> {/* Scrollable content area with padding */}
                            {/* TabsContent remains largely the same, just inside ScrollArea */}
                            <TabsContent value="model" className="mt-0 outline-none space-y-6"> {/* Use mt-0 */}
                                {/* Model Selection Card */}
                                {availableModels && availableModels.length > 0 && (
                                    <Card>
                                        <CardHeader>
                                            <CardTitle className="text-base flex items-center gap-2">
                                                <BrainCircuit className="h-4 w-4" />
                                                Model Selection
                                            </CardTitle>
                                            <CardDescription>Choose the AI model that best fits your needs</CardDescription>
                                        </CardHeader>
                                        <CardContent className="space-y-4">
                                            <div className="grid grid-cols-1 gap-3">
                                                {availableModels.map((model) => (
                                                    <div
                                                        key={model.id}
                                                        className={cn(
                                                            "border rounded-lg p-3 cursor-pointer transition-all hover:border-primary/50",
                                                            localModelSettings.modelId === model.id ? "border-primary bg-primary/5" : "border-border"
                                                        )}
                                                        onClick={() => setLocalModelSettings((s) => ({ ...s, modelId: model.id }))}
                                                    >
                                                        <div className="flex justify-between items-center">
                                                            <div className="font-medium">{model.name}</div>
                                                            {model.isDefault && <Badge variant="outline" className="text-xs">Default</Badge>}
                                                        </div>
                                                        {model.description && <p className="text-sm text-muted-foreground mt-1">{model.description}</p>}
                                                        {model.capabilities && (
                                                            <div className="flex flex-wrap gap-1.5 mt-2">
                                                                {model.capabilities.map((capability, i) => (
                                                                    <Badge key={i} variant="secondary" className="text-xs font-normal">
                                                                        {capability}
                                                                    </Badge>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </CardContent>
                                    </Card>
                                )}

                                {/* Parameter Presets */}
                                <Card>
                                    <CardHeader className="pb-3">
                                        <CardTitle className="text-base flex items-center gap-2">
                                            <Sparkles className="h-4 w-4" />
                                            Quick Presets
                                        </CardTitle>
                                        <CardDescription>Apply preset parameter combinations for different use cases</CardDescription>
                                    </CardHeader>
                                    <CardContent>
                                        <div className="grid grid-cols-3 gap-3">
                                            {presets.map((preset) => (
                                                <Button
                                                    key={preset.name}
                                                    variant="outline"
                                                    className="h-auto py-2 flex flex-col items-center justify-center text-center"
                                                    onClick={() => setLocalModelSettings((s) => ({ ...s, ...preset.settings }))}
                                                >
                                                    <span className="font-medium">{preset.name}</span>
                                                    <span className="text-xs text-muted-foreground mt-1">
                                                        {preset.name === "Creative" && "More varied"}
                                                        {preset.name === "Balanced" && "Default"}
                                                        {preset.name === "Precise" && "More focused"}
                                                    </span>
                                                </Button>
                                            ))}
                                        </div>
                                    </CardContent>
                                </Card>

                                {/* System Prompt Card */}
                                <Card>
                                    <CardHeader className="pb-3">
                                        <CardTitle className="text-base flex items-center gap-2">
                                            <MessageSquare className="h-4 w-4" />
                                            System Prompt
                                        </CardTitle>
                                        <CardDescription>Define how the AI should behave and respond</CardDescription>
                                    </CardHeader>
                                    <CardContent>
                                        <Textarea
                                            id="system-prompt"
                                            placeholder="You are a helpful, creative, and knowledgeable AI assistant..."
                                            value={localModelSettings.systemPrompt}
                                            onChange={(e) => setLocalModelSettings((s) => ({ ...s, systemPrompt: e.target.value }))}
                                            className="min-h-[100px] text-sm font-mono"
                                            rows={4}
                                        />
                                        <p className="text-xs text-muted-foreground mt-1.5">Guides the overall tone and behavior of the AI.</p>
                                    </CardContent>
                                </Card>

                                {/* Model Parameters Card */}
                                <Card>
                                    <CardHeader className="pb-3">
                                        <CardTitle className="text-base flex items-center gap-2">
                                            <SlidersHorizontal className="h-4 w-4" />
                                            Response Parameters
                                        </CardTitle>
                                        <CardDescription>Fine-tune how the AI generates responses</CardDescription>
                                    </CardHeader>
                                    <CardContent className="space-y-5">
                                        <SettingSlider
                                            id="temperature"
                                            label="Temperature"
                                            value={localModelSettings.temperature}
                                            min={0}
                                            max={2.0}
                                            step={0.1}
                                            onChange={(value) => setLocalModelSettings((s) => ({ ...s, temperature: value[0] }))}
                                            tooltip="Controls randomness. Lower values make the output more focused and deterministic; higher values make it more creative."
                                        />
                                        <SettingSlider
                                            id="top-p"
                                            label="Top P"
                                            value={localModelSettings.topP}
                                            min={0}
                                            max={1}
                                            step={0.05}
                                            onChange={(value) => setLocalModelSettings((s) => ({ ...s, topP: value[0] }))}
                                            tooltip="Nucleus sampling parameter. The model considers only the tokens comprising the top P probability mass."
                                            formatValue={(v) => v.toFixed(2)}
                                        />
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-5">
                                            <SettingSlider
                                                id="freq-penalty"
                                                label="Frequency Penalty"
                                                value={localModelSettings.frequencyPenalty}
                                                min={-2.0}
                                                max={2.0}
                                                step={0.1}
                                                onChange={(value) => setLocalModelSettings((s) => ({ ...s, frequencyPenalty: value[0] }))}
                                                tooltip="Positive values penalize new tokens based on their existing frequency in the text so far, decreasing repetition."
                                            />
                                            <SettingSlider
                                                id="pres-penalty"
                                                label="Presence Penalty"
                                                value={localModelSettings.presencePenalty}
                                                min={-2.0}
                                                max={2.0}
                                                step={0.1}
                                                onChange={(value) => setLocalModelSettings((s) => ({ ...s, presencePenalty: value[0] }))}
                                                tooltip="Positive values penalize new tokens based on whether they appear in the text so far, increasing the likelihood of talking about new topics."
                                            />
                                        </div>
                                        <div className="flex justify-between items-center pt-1">
                                            <SettingLabel tooltip="Maximum number of tokens (roughly words/punctuation) the AI will generate in its response.">
                                                Max Response Tokens
                                            </SettingLabel>
                                            <Input
                                                id="max-tokens"
                                                type="number"
                                                min={1}
                                                max={16384}
                                                step={64}
                                                value={localModelSettings.maxTokens}
                                                onChange={(e) => {
                                                    const numValue = parseInt(e.target.value, 10);
                                                    if (!isNaN(numValue) && numValue > 0 && numValue <= 16384) {
                                                        setLocalModelSettings((s) => ({ ...s, maxTokens: numValue }));
                                                    } else if (e.target.value === '') { // Allow clearing the input
                                                        setLocalModelSettings((s) => ({ ...s, maxTokens: 1 })); // Or set to a default min
                                                    }
                                                }}
                                                className="w-24 h-8 text-sm text-right font-mono"
                                            />
                                        </div>
                                    </CardContent>
                                </Card>
                            </TabsContent>

                            <TabsContent value="interface" className="mt-0 outline-none space-y-6"> {/* Use mt-0 */}
                                <Card>
                                    <CardHeader className="pb-3">
                                        <CardTitle className="text-base flex items-center gap-2">
                                            <PanelLeft className="h-4 w-4" />
                                            Interface Preferences
                                        </CardTitle>
                                        <CardDescription>Customize your chat experience</CardDescription>
                                    </CardHeader>
                                    {/* Use Divs with border for structure */}
                                    <div className="divide-y border-t">
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Display timestamps for each message in the chat">
                                                Show Message Timestamps
                                            </SettingLabel>
                                            <Switch
                                                id="timestamps-switch"
                                                checked={!!localUISettings.showTimestamps}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, showTimestamps: checked }))}
                                            />
                                        </div>
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Use a more dense message layout to fit more content on screen">
                                                Compact Message Layout
                                            </SettingLabel>
                                            <Switch
                                                id="compact-switch"
                                                checked={!!localUISettings.compactMode}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, compactMode: checked }))}
                                            />
                                        </div>
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Automatically scroll to new messages as they appear">
                                                Auto-scroll to New Messages
                                            </SettingLabel>
                                            <Switch
                                                id="autoscroll-switch"
                                                checked={!!localUISettings.autoScroll}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, autoScroll: checked }))}
                                            />
                                        </div>
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Enable keyboard shortcuts for faster interaction (e.g., Ctrl+Enter to send)">
                                                Keyboard Shortcuts
                                            </SettingLabel>
                                            <Switch
                                                id="keyboard-shortcuts-switch"
                                                checked={!!localUISettings.enableKeyboardShortcuts}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, enableKeyboardShortcuts: checked }))}
                                            />
                                        </div>
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Render message content using Markdown formatting">
                                                Enable Markdown Rendering
                                            </SettingLabel>
                                            <Switch
                                                id="markdown-switch"
                                                checked={!!localUISettings.enableMarkdown}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, enableMarkdown: checked }))}
                                            />
                                        </div>
                                        <div className="flex items-center justify-between px-6 py-4">
                                            <SettingLabel tooltip="Play subtle sounds when new messages arrive or actions occur">
                                                Message Sound Effects
                                            </SettingLabel>
                                            <Switch
                                                id="sound-switch"
                                                checked={!!localUISettings.messageSounds}
                                                onCheckedChange={(checked) => setLocalUISettings((s) => ({ ...s, messageSounds: checked }))}
                                            />
                                        </div>
                                    </div>
                                </Card>

                                <Card>
                                    <CardHeader className="pb-3">
                                        <CardTitle className="text-base flex items-center gap-2">
                                            <RefreshCw className="h-4 w-4" />
                                            Session Management
                                        </CardTitle>
                                        <CardDescription>Manage your current chat session data</CardDescription>
                                    </CardHeader>
                                    <CardContent className="space-y-4">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <Button
                                                variant="outline"
                                                className="w-full justify-start"
                                                onClick={onExportChat}
                                                disabled={!onExportChat}
                                            >
                                                <Download className="h-4 w-4 mr-2" />
                                                Export Chat
                                            </Button>
                                            <Button
                                                variant="outline"
                                                className="w-full justify-start text-destructive hover:text-destructive hover:bg-destructive/10"
                                                onClick={handleClearHistory}
                                                disabled={!onClearHistory}
                                            >
                                                <Trash2 className="h-4 w-4 mr-2" />
                                                Clear History
                                            </Button>
                                        </div>
                                        <p className="text-xs text-muted-foreground px-1">Export downloads the current conversation. Clearing history cannot be undone.</p>
                                    </CardContent>
                                </Card>
                            </TabsContent>
                        </ScrollArea> {/* End ScrollArea */}

                        {/* 5. Footer: Fixed at the bottom */}
                        <div className="p-6 pt-4 border-t flex items-center justify-between shrink-0">
                            {/* ... footer content (no changes inside) ... */}
                            <div className="flex items-center gap-2">
                                <Button variant="ghost" size="sm" onClick={handleReset} className="text-muted-foreground">
                                    <Undo2 className="h-4 w-4 mr-1" /> Reset Tab
                                </Button>
                            </div>
                            <div className="flex items-center gap-3">
                                <Button variant="outline" onClick={handleCancelButton}>Cancel</Button>
                                <Button onClick={handleSave} disabled={!hasChanges}>
                                    <Save className="mr-2 h-4 w-4" /> Save Changes
                                </Button>
                            </div>
                        </div>
                    </Tabs> {/* End Tabs */}
                </DialogContent>
                {/* ---- MODIFICATION END ---- */}
            </Dialog>

            {/* --- Confirmation Dialogs (No changes needed here) --- */}
            <AlertDialog open={showUnsavedWarning} onOpenChange={setShowUnsavedWarning}>
                {/* ... content ... */}
                <AlertDialogContent>
                    <AlertDialogHeader>
                        <AlertDialogTitle className="flex items-center gap-2">
                            <AlertTriangle className="h-5 w-5 text-amber-500" />
                            Unsaved Changes
                        </AlertDialogTitle>
                        <AlertDialogDescription>
                            You have unsaved changes in the settings. Are you sure you want to close without saving? Your changes will be lost.
                        </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                        <AlertDialogCancel onClick={() => { setShowUnsavedWarning(false); setPendingClose(false); }}>
                            Keep Editing
                        </AlertDialogCancel>
                        <AlertDialogAction onClick={handleConfirmDiscard} variant='destructive'>
                            Discard Changes
                        </AlertDialogAction>
                    </AlertDialogFooter>
                </AlertDialogContent>
            </AlertDialog>

            <AlertDialog open={showClearConfirm} onOpenChange={setShowClearConfirm}>
                {/* ... content ... */}
                <AlertDialogContent>
                    <AlertDialogHeader>
                        <AlertDialogTitle className="flex items-center gap-2">
                            <AlertTriangle className="h-5 w-5 text-destructive" />
                            Clear Chat History?
                        </AlertDialogTitle>
                        <AlertDialogDescription>
                            This will permanently delete all messages in the current chat session. This action cannot be undone.
                        </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                        <AlertDialogCancel onClick={() => setShowClearConfirm(false)}>
                            Cancel
                        </AlertDialogCancel>
                        <AlertDialogAction onClick={handleConfirmClear} className={cn(
                            "bg-destructive text-destructive-foreground hover:bg-destructive/90"
                        )}>
                            Clear History
                        </AlertDialogAction>
                    </AlertDialogFooter>
                </AlertDialogContent>
            </AlertDialog>
        </>
    );
};

export default ChatSettingsDialog;
```

## File: src/components/app-sidebar.tsx

```tsx
import { Link, useMatches, useNavigate, useRouteContext } from "@tanstack/react-router";

import { WorkSpaceSwitcher } from "./workspace-switcher";
import {
    Sidebar,
    SidebarContent,
    SidebarFooter,
    SidebarGroup,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarHeader,
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
    SidebarRail,
} from "@app/ui/components/sidebar";
import {
    LayoutDashboard,
    BarChart2,
    Users,
    Code,
    Link as LinkIcon,
    Settings,
    HelpCircle,
} from "lucide-react";
import { HierarchicalSection } from "./hierarchical-section";
import { initialDocumentItems, initialLibraryItems, type ExtendedTreeItem } from "@/lib/mock/sidebar-data";

const staticNavData = {
    navMain: [
        {
            title: "Sections",
            url: "#",
            items: [
                { title: "Dashboard", url: "/", icon: LayoutDashboard },
                { title: "Insights", url: "/insights", icon: BarChart2 },
                { title: "Contacts", url: "/contacts", icon: Users },
                { title: "Tools", url: "/tools", icon: Code },
                { title: "Integration", url: "/integration", icon: LinkIcon },
            ],
        },
        {
            title: "Other",
            url: "#",
            items: [
                { title: "Settings", url: "/settings", icon: Settings },
                { title: "Help Center", url: "/help", icon: HelpCircle },
            ],
        },
    ],
};

interface AppSidebarProps {
    onSignOut: () => Promise<void>;
}

export function AppSidebar({ onSignOut }: AppSidebarProps) {
    const { user } = useRouteContext({
        from: '__root__',
        select: (context) => ({ user: context.user }),
    });
    const matches = useMatches();
    const navigate = useNavigate();
    const [searchTerm, setSearchTerm] = React.useState("");

    const isRouteActive = (url: string) => {
        if (!url || url === '#') return false;

        if (!matches || !Array.isArray(matches)) return false;

        const currentPathname = matches[matches.length - 1]?.pathname || '';

        if (url === "/") {
            return currentPathname === "/";
        }

        return matches.some(match => {
            if (match.pathname === url) return true;
            return url !== "/" && currentPathname.startsWith(url + "/");
        });
    };

    const handleTreeItemClick = (item: ExtendedTreeItem) => {
        if (item.data.url) {
            console.log("Navigating to:", item.data.url);
            navigate({ to: item.data.url });
        } else {
            console.log("Clicked item without URL:", item.data.name);
        }
    };

    return (
        <Sidebar>
            <SidebarHeader>
                <WorkSpaceSwitcher
                    onSignOut={onSignOut}
                />
                <hr className="border-t border-border" />
                <SearchForm
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
            </SidebarHeader>
            <SidebarContent>
                {staticNavData.navMain.map((group) => (
                    <SidebarGroup key={group.title}>
                        <SidebarGroupLabel className="uppercase text-muted-foreground/60">
                            {group.title}
                        </SidebarGroupLabel>
                        <SidebarGroupContent>
                            <SidebarMenu>
                                {group.items.map((item) => (
                                    <SidebarMenuItem key={item.title}>
                                        <SidebarMenuButton
                                            asChild
                                            className="group/menu-button font-medium gap-3 h-8 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
                                            isActive={isRouteActive(item.url)}
                                        >
                                            <Link to={item.url}>
                                                {item.icon && (
                                                    <item.icon
                                                        className="text-muted-foreground/60 group-data-[active=true]/menu-button:text-primary"
                                                        size={16}
                                                        aria-hidden="true"
                                                    />
                                                )}
                                                <span>{item.title}</span>
                                            </Link>
                                        </SidebarMenuButton>
                                    </SidebarMenuItem>
                                ))}
                            </SidebarMenu>
                        </SidebarGroupContent>
                    </SidebarGroup>
                ))}

                <HierarchicalSection
                    title="Documents"
                    treeId="documents-tree"
                    initialItems={initialDocumentItems}
                    rootItem="root"
                    searchTerm={searchTerm}
                    onPrimaryAction={handleTreeItemClick}
                />

                <HierarchicalSection
                    title="Library"
                    treeId="library-tree"
                    initialItems={initialLibraryItems}
                    rootItem="root"
                    searchTerm={searchTerm}
                    onPrimaryAction={handleTreeItemClick}
                />

            </SidebarContent>
            <SidebarFooter>
                <SidebarMenu>
                </SidebarMenu>
            </SidebarFooter>
            <SidebarRail />
        </Sidebar>
    );
}

// --- Update SearchForm to be controlled ---
// src/components/search-form.tsx (Example modification)
import * as React from "react";
import { Search } from "lucide-react";
import { Input } from "@app/ui/components/input"; // Adjust path

interface SearchFormProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'onChange'> {
    value: string;
    onChange: (event: React.ChangeEvent<HTMLInputElement>) => void;
}

export function SearchForm({ value, onChange, ...props }: SearchFormProps) {
    return (
        <form onSubmit={(e) => e.preventDefault()} className="py-1">
            <div className="relative">
                <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                <Input
                    type="search"
                    placeholder="Search..."
                    className="w-full rounded-md bg-background pl-8 h-8" // Adjusted height and padding
                    value={value}
                    onChange={onChange}
                    {...props}
                />
            </div>
        </form>
    );
}
```

## File: src/components/catch-boundary.tsx

```tsx
import { Link, rootRouteId, useMatch, useRouter } from '@tanstack/react-router'
import type { ErrorComponentProps } from '@tanstack/react-router'
import { ArrowLeft, Home } from "lucide-react"
import { Button } from "@app/ui/components/button"
import { Illustration } from './not-found'

export function CatchBoundary({ error }: ErrorComponentProps) {
    const router = useRouter()
    const isRoot = useMatch({
        strict: false,
        select: (state) => state.id === rootRouteId,
    })

    return (
        <div className="relative flex flex-col w-full justify-center min-h-svh bg-background p-6 md:p-10">
            <div className="relative max-w-5xl mx-auto w-full">
                <Illustration className="absolute inset-0 w-full h-[50vh] opacity-[0.04] dark:opacity-[0.03] text-foreground" />
                <div className="relative text-center z-[1] pt-52">
                    <h1 className="mt-4 text-balance text-5xl font-semibold tracking-tight text-primary sm:text-7xl">
                        Something went wrong
                    </h1>
                    <p className="mt-6 text-pretty text-lg font-medium text-muted-foreground sm:text-xl/8">
                        {error?.message || "We encountered an unexpected error."}
                    </p>
                    <div className="mt-10 flex flex-col sm:flex-row sm:items-center sm:justify-center gap-y-3 gap-x-6">
                        <Button
                            variant="secondary"
                            className="group"
                            onClick={() => window.history.back()}
                        >
                            <ArrowLeft
                                className="me-2 ms-0 opacity-60 transition-transform group-hover:-translate-x-0.5"
                                size={16}
                                strokeWidth={2}
                                aria-hidden="true"
                            />
                            Go back
                        </Button>
                        <Button
                            onClick={() => router.invalidate()}
                            className="flex items-center gap-2"
                        >
                            Try again
                        </Button>
                        {isRoot ? (
                            <Button variant="outline" asChild>
                                <Link to="/">
                                    <Home className="mr-2" size={16} />
                                    Home
                                </Link>
                            </Button>
                        ) : null}
                    </div>
                </div>
            </div>
        </div>
    )
}
```

## File: src/components/hierarchical-section.tsx

```tsx
import * as React from "react";
import type { HTMLProps } from 'react';
import {
    Tree,
    ControlledTreeEnvironment,
    type TreeItemIndex,
    type DraggingPosition,
    type TreeEnvironmentRef,
    type TreeItemRenderContext as LibraryTreeItemRenderContext,
    type TreeInformation,
    type TreeChangeHandlers,
    type ExplicitDataSource,
    type TreeCapabilities,
    type TreeItem,
} from "react-complex-tree";
import { ChevronRight, MoreHorizontal, FileText, Edit2, Copy, ArrowRight, Trash2, Link } from "lucide-react";
import { cn } from "@app/ui/lib/utils";
import {
    SidebarGroup,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarMenuItem,
} from "@app/ui/components/sidebar";
import { Button } from "@app/ui/components/button";
import { type ItemData, type ExtendedTreeItem, type TreeItems, defaultIcons } from "@/lib/mock/sidebar-data";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@app/ui/components/dropdown-menu";

type TreeItemRenderContext = LibraryTreeItemRenderContext<never>;

interface HierarchicalSectionProps {
    title: string;
    treeId: string;
    initialItems: TreeItems;
    rootItem?: TreeItemIndex;
    searchTerm?: string;
    onPrimaryAction?: (item: ExtendedTreeItem) => void;
}

// --- Helper functions (getTargetParentId, getTargetItemId, isDescendant) - Adjusted based on provided types ---
function getTargetParentId(target: DraggingPosition, rootId: TreeItemIndex): TreeItemIndex {
    // From provided types: DraggingPositionItem, DraggingPositionBetweenItems, DraggingPositionRoot
    if (target.targetType === 'root') {
        // According to DraggingPositionRoot type, targetItem IS the root item index
        return target.targetItem; // Or simply rootId, should be the same
    } else {
        // Both 'item' and 'between-items' have parentItem property
        return target.parentItem;
    }
}

function getTargetItemId(target: DraggingPosition): TreeItemIndex | undefined {
    // Only DraggingPositionItem has targetItem representing the item *dropped onto*
    if (target.targetType === 'item') {
        return target.targetItem;
    }
    return undefined;
}

function isDescendant(items: TreeItems, parentId: TreeItemIndex, potentialChildId: TreeItemIndex): boolean {
    const visited = new Set<TreeItemIndex>();
    const check = (currentParentId: TreeItemIndex): boolean => {
        if (visited.has(currentParentId) || currentParentId === potentialChildId) return false; // Added self-check
        visited.add(currentParentId);

        const parent = items[currentParentId];
        // Check if parent exists and has children array
        if (!parent || !Array.isArray(parent.children) || parent.children.length === 0) {
            return false;
        }
        if (parent.children.includes(potentialChildId)) {
            return true;
        }
        // Recurse only if children exist and are valid items
        return parent.children.some(childId => items[childId] && check(childId));
    };
    // Ensure parentId itself exists before starting
    return items[parentId] ? check(parentId) : false;
}

export function HierarchicalSection({
    title,
    treeId,
    initialItems,
    rootItem = "root",
    searchTerm = "",
    onPrimaryAction,
}: HierarchicalSectionProps) {
    const [items, setItems] = React.useState<TreeItems>(initialItems);
    const [focusedItem, setFocusedItem] = React.useState<TreeItemIndex>();
    const [expandedItems, setExpandedItems] = React.useState<TreeItemIndex[]>(() => {
        const root = items[rootItem];
        const initialExpanded = new Set<TreeItemIndex>([rootItem]);
        (root?.children ?? []).forEach(childId => {
            if (items[childId]) {
                initialExpanded.add(childId);
            }
        });
        initialExpanded.add(rootItem);
        return Array.from(initialExpanded);
    });
    const [selectedItems, setSelectedItems] = React.useState<TreeItemIndex[]>([]);

    const environmentRef = React.useRef<TreeEnvironmentRef<ItemData, never>>(null);

    const { filteredItems, itemsToExpand } = React.useMemo(() => {
        const rootExists = items[rootItem];
        const baseRootItem: ExtendedTreeItem = rootExists
            ? items[rootItem]
            : { index: rootItem, data: { name: 'Root', type: 'folder' }, isFolder: true, children: [] };

        if (!searchTerm) {
            return {
                filteredItems: items,
                itemsToExpand: []
            };
        }

        const lowerSearchTerm = searchTerm.toLowerCase();
        const matchingItemIds = new Set<TreeItemIndex>();
        const necessaryItemIds = new Set<TreeItemIndex>([rootItem]);

        for (const itemId in items) {
            if (items[itemId].data.name.toLowerCase().includes(lowerSearchTerm)) {
                matchingItemIds.add(itemId);
            }
        }

        if (matchingItemIds.size === 0) {
            const emptyRoot = items[rootItem] ? { [rootItem]: { ...items[rootItem], children: [] } } : { [rootItem]: baseRootItem };
            return {
                filteredItems: emptyRoot,
                itemsToExpand: [rootItem]
            };
        }

        const addAncestors = (itemId: TreeItemIndex) => {
            if (itemId === rootItem || necessaryItemIds.has(itemId)) return;
            necessaryItemIds.add(itemId);
            for (const potentialParentId in items) {
                if (items[potentialParentId].children?.includes(itemId)) {
                    addAncestors(potentialParentId);
                    break;
                }
            }
        };

        matchingItemIds.forEach(id => {
            addAncestors(id);
        });

        const resultItems: TreeItems = {};
        necessaryItemIds.forEach(id => {
            const originalItem = items[id];
            if (originalItem) {
                const originalChildren = originalItem.children || [];
                const filteredChildren = originalChildren.filter(childId => necessaryItemIds.has(childId));
                resultItems[id] = { ...originalItem, children: filteredChildren };
            } else if (id === rootItem && !originalItem) {
                resultItems[id] = { ...baseRootItem, children: (baseRootItem.children || []).filter(childId => necessaryItemIds.has(childId)) };
            }
        });

        if (!resultItems[rootItem] && items[rootItem]) {
            resultItems[rootItem] = { ...items[rootItem], children: (items[rootItem].children || []).filter(childId => necessaryItemIds.has(childId)) };
        } else if (!resultItems[rootItem]) {
            resultItems[rootItem] = baseRootItem;
        }

        const expansionSet = new Set<TreeItemIndex>();
        necessaryItemIds.forEach(id => {
            // Check if the item in the *filtered* result has children to determine if it should be expandable
            if (resultItems[id]?.isFolder && resultItems[id]?.children && resultItems[id].children.length > 0) {
                expansionSet.add(id);
            }
        });
        if (resultItems[rootItem]?.children && resultItems[rootItem].children.length > 0) {
            expansionSet.add(rootItem);
        }

        return { filteredItems: resultItems, itemsToExpand: Array.from(expansionSet) };
    }, [searchTerm, items, rootItem]);

    // --- Expand necessary parents effect ---
    // --- Expand necessary parents effect (MODIFIED) ---
    React.useEffect(() => {
        if (searchTerm && itemsToExpand.length > 0) {
            // Add necessary expansions for search results
            setExpandedItems(prev => {
                const newExpanded = new Set(prev ?? []);
                itemsToExpand.forEach(id => newExpanded.add(id));
                // Ensure root is expanded if search yields results
                if (Object.keys(filteredItems).length > 1) {
                    newExpanded.add(rootItem);
                }
                return Array.from(newExpanded);
            });
        }
        // Ensure 'items' is included if the reset logic depends on it, which it does.
    }, [searchTerm, itemsToExpand, rootItem, filteredItems]);
    // --- End Expand Effect ---
    // --- End Expand Effect ---


    // --- Drag and Drop Handler (Adjusted types for clarity) ---
    const handleDrop: TreeChangeHandlers<ItemData>['onDrop'] = (
        draggedItems: TreeItem<ItemData>[], // Use TreeItem<ItemData> as per handler type
        target: DraggingPosition
    ) => {
        if (!draggedItems || draggedItems.length === 0) return;

        const draggedItemIds = draggedItems.map(item => item.index);
        console.log("Attempting drop:", draggedItemIds, "onto target:", target);

        setItems(prevItems => {
            let newItems = { ...prevItems };

            // --- 1. Remove dragged items from original parents (immutable update) ---
            const sourceParentUpdates: Record<TreeItemIndex, Partial<ExtendedTreeItem>> = {};
            draggedItemIds.forEach(draggedId => {
                for (const parentId in newItems) {
                    const parent = newItems[parentId];
                    if (parent.children?.includes(draggedId)) {
                        // Ensure we don't modify the same parent multiple times in this loop inefficiently
                        if (!sourceParentUpdates[parentId]) {
                            sourceParentUpdates[parentId] = {
                                children: parent.children.filter(childId => !draggedItemIds.includes(childId)) // Filter all dragged items at once
                            };
                        }
                        // Found parent, break inner loop for this draggedId
                        // Note: This break assumes an item only has one parent.
                        // If multiple parents were possible (not a tree), logic needs adjustment.
                        break;
                    }
                }
            });

            // Apply parent updates
            for (const parentId in sourceParentUpdates) {
                newItems[parentId] = { ...newItems[parentId], ...sourceParentUpdates[parentId] };
            }


            // --- 2. Insert dragged items into new location ---
            let targetParentId: TreeItemIndex;
            let insertionIndex: number | undefined = undefined;
            let isDroppingOntoItem = false;

            if (target.targetType === 'root') {
                targetParentId = target.targetItem; // Use targetItem for root
            } else if (target.targetType === 'item') {
                targetParentId = target.targetItem; // Dropping ONTO this item
                isDroppingOntoItem = true;
            } else { // 'between-items'
                targetParentId = target.parentItem;
                insertionIndex = target.childIndex;
            }

            let targetParent = newItems[targetParentId];

            if (!targetParent) {
                // Handle cases where target parent might not exist (e.g., root not in initialItems)
                if (targetParentId === rootItem && !items[rootItem]) {
                    targetParent = { index: rootItem, data: { name: 'Root', type: 'folder' }, isFolder: true, children: [] };
                    newItems[rootItem] = targetParent; // Add the root if it was missing
                } else {
                    console.error("Drop failed: Target parent container not found or invalid:", targetParentId);
                    return prevItems; // Abort if target parent is truly missing
                }
            }

            // Ensure target IS a folder if dropping ONTO it
            if (isDroppingOntoItem) {
                targetParent = {
                    ...targetParent,
                    isFolder: true, // Make it a folder
                    children: targetParent.children ?? [], // Ensure children array exists
                };
            }


            const currentChildren = targetParent.children ?? [];
            let newChildren: TreeItemIndex[];

            // Filter out items already present (should be redundant due to step 1 but safe)
            const childrenToAdd = draggedItemIds.filter(id => !currentChildren.includes(id));

            if (insertionIndex !== undefined) { // 'between-items'
                newChildren = [
                    ...currentChildren.slice(0, insertionIndex),
                    ...childrenToAdd,
                    ...currentChildren.slice(insertionIndex),
                ];
            } else { // 'item' or 'root' target type (append to end)
                newChildren = [...currentChildren, ...childrenToAdd];
            }

            // Update the target parent immutably
            newItems[targetParentId] = { ...targetParent, children: newChildren };


            console.log("Drop successful. New items state:", newItems);
            return newItems;
        });
    };
    // --- End Drag and Drop Handler ---

    // --- Rename Handler (Corrected type) ---
    const handleRename: TreeChangeHandlers<ItemData>['onRenameItem'] = (
        item: TreeItem<ItemData>, // Use TreeItem<ItemData> as per handler type
        name: string
        // treeId is also available if needed: treeId: string
    ) => {
        setItems(prev => {
            // Find the item, ensure immutability
            const currentItem = prev[item.index];
            if (!currentItem) return prev; // Item not found

            return {
                ...prev,
                [item.index]: {
                    ...currentItem,
                    // Update data immutably
                    data: { ...(currentItem.data ?? {}), name }, // Ensure data exists before spreading
                },
            };
        });
    };
    // --- End Rename Handler ---


    // --- Render Item Function (CORRECTED based on provided types) ---
    const renderTreeItem = ({
        item, // Type is TreeItem<ItemData> from environment, cast to ExtendedTreeItem if needed
        depth,
        children, // The rendered children list (ul) or null
        title,    // The rendered title (string or component)
        context,  // Correctly typed TreeItemRenderContext
    }: {
        item: TreeItem<ItemData>; // Use base type from library prop
        depth: number;
        children: React.ReactNode | null;
        title: React.ReactNode;
        context: TreeItemRenderContext;
        info: TreeInformation;
    }) => {
        const [dropDownOpen, setDropDownOpen] = React.useState<boolean>(false)
        // Cast to ExtendedTreeItem if you need custom properties like 'emoji' or specific 'type'
        const extendedItem = item as ExtendedTreeItem;
        const IconComponent = extendedItem.data.icon || defaultIcons[extendedItem.data.type] || FileText;

        // Flags available on TreeItemRenderContext (use defaults for safety)
        const isRenaming = context.isRenaming ?? false;
        const isSelected = context.isSelected ?? false;
        const isFocused = context.isFocused ?? false;
        const isExpanded = context.isExpanded ?? false;
        const isDraggingOver = context.isDraggingOver ?? false; // Dragging over this item or its vicinity
        const canDropOn = context.canDropOn ?? false; // Can the current drag operation drop *onto* this item?

        const isActive = isSelected || isFocused;

        // *** CORRECTED: Drop target highlight logic ***
        // Highlight for dropping ONTO this specific item (making it a parent)
        // Relies on context flags: dragging over this item AND it's a valid drop target *onto* it
        const isDropTargetOnto = isDraggingOver && canDropOn;
        // Highlight when dragging nearby (for reordering, not directly onto) - subtle is okay
        const isDraggingOverArea = isDraggingOver && !isDropTargetOnto;

        return (
            <SidebarMenuItem
                key={item.index}
                className={cn(
                    "rct-tree-item-li group/item relative",
                    isDraggingOverArea && "bg-muted/20",
                    isDropTargetOnto && "bg-primary/10 outline-2 outline-offset-[-1px] outline-primary rounded",
                )}
                style={{ paddingLeft: `${depth * 12}px` }}
                {...context.itemContainerWithChildrenProps}
            >
                <div
                    className={cn(
                        "flex items-center w-full h-8 px-2 rounded text-sm group/button py-2",
                        !isRenaming && "cursor-pointer hover:bg-muted",
                        isActive && !isDraggingOver && "bg-accent text-accent-foreground",
                        isDropTargetOnto && "bg-transparent",
                    )}
                    {...context.itemContainerWithoutChildrenProps}
                    {...context.interactiveElementProps}
                >
                    <div
                        className="w-4 h-4 mr-1 flex items-center justify-center shrink-0"
                        {...context.arrowProps}
                    >
                        {(item.isFolder || (item.children && item.children.length > 0)) && (
                            <ChevronRight
                                size={14}
                                className={cn(
                                    "transition-transform duration-150 text-muted-foreground/80",
                                    isExpanded && "transform rotate-90"
                                )}
                            />
                        )}
                    </div>

                    <div className="w-4 h-4 mr-1.5 flex items-center justify-center shrink-0">
                        {extendedItem.data.emoji ? (
                            <span className="text-sm select-none">{extendedItem.data.emoji}</span>
                        ) : (
                            <IconComponent
                                size={14}
                                className={cn(
                                    "shrink-0",
                                    isActive && !isDraggingOver ? "text-accent-foreground" : "text-muted-foreground/90"
                                )}
                            />
                        )}
                    </div>

                    <span className="flex-grow overflow-hidden text-ellipsis whitespace-nowrap pr-1">
                        {isRenaming ? (
                            <input
                                type="text"
                                defaultValue={extendedItem.data.name}
                                onBlur={() => {
                                    context.stopRenamingItem();
                                }}
                                onKeyDown={(e) => {
                                    if (e.key === 'Enter') {
                                        e.preventDefault();
                                        context.stopRenamingItem();
                                    } else if (e.key === 'Escape') {
                                        context.stopRenamingItem();
                                    }
                                }}
                                autoFocus
                                className="w-full bg-transparent outline-none ring-1 ring-inset ring-input focus:ring-ring px-1 py-0 text-sm rounded-sm"
                                onClick={(e) => e.stopPropagation()}
                            />
                        ) : (
                            title
                        )}
                    </span>

                    {!isRenaming && (
                        <div className="ml-auto pl-1 opacity-0 group-hover/button:opacity-100 data-[state=open]:opacity-100">
                            <DropdownMenu open={dropDownOpen} onOpenChange={setDropDownOpen}>
                                <DropdownMenuTrigger asChild>
                                    <Button
                                        variant="ghost" size="icon" className="h-5 w-5"
                                        onClick={(e) => {
                                            setDropDownOpen(true)
                                            e.stopPropagation();
                                        }}
                                        aria-label="Actions"
                                    >
                                        <MoreHorizontal size={14} />
                                    </Button>
                                </DropdownMenuTrigger>
                                <DropdownMenuContent
                                    className="w-16 p-1" align="start" side="right" sideOffset={5}
                                    onClick={(e) => e.stopPropagation()}
                                >
                                    <div className="flex flex-col">
                                        <DropdownMenuItem>
                                            <Copy size={14} className="mr-1 text-muted-foreground" /> Duplicate
                                        </DropdownMenuItem>
                                        <DropdownMenuItem>
                                            <Edit2 size={14} className="mr-1 text-muted-foreground" /> Rename
                                        </DropdownMenuItem>

                                        <hr className="my-1" />

                                        <DropdownMenuItem>
                                            <ArrowRight size={14} className="mr-1 text-muted-foreground" /> Move to...
                                        </DropdownMenuItem>
                                        <DropdownMenuItem>
                                            <Link size={14} className="mr-1 text-muted-foreground" /> Copy link
                                        </DropdownMenuItem>
                                        <DropdownMenuItem variant="destructive">
                                            <Trash2 size={14} className="mr-1 text-muted-foreground" /> Delete
                                        </DropdownMenuItem>
                                    </div>
                                </DropdownMenuContent>
                            </DropdownMenu>
                        </div>
                    )}
                </div>
                {children}
            </SidebarMenuItem>
        );
    };

    const renderDragBetweenLine = ({ lineProps }: {
        draggingPosition: DraggingPosition;
        lineProps: HTMLProps<HTMLDivElement>;
    }) => (
        <div
            {...lineProps}
            style={{
                ...(lineProps.style ?? {}),
                height: '2px',
                top: typeof lineProps.style?.top === 'number' ? lineProps.style.top : 0 + 3,
                width: '100%', // Ensure width is still set if needed
                position: 'absolute',
                zIndex: 9999,
                backgroundColor: 'var(--primary)', // Use your theme variable
                opacity: 0.6,
                display: 'block', // Ensure it's visible
                // Optional: Add pointer-events none if it interferes with hover
                // pointerEvents: 'none',
            }}
            // --- END OF CHANGE ---
            data-testid="rct-drag-line-debug"
            className="rct-tree-drag-between-line" // Keep original class if needed
        />
    );
    // --- End Render Drag Placeholder Line ---

    // --- Tree Capabilities (CORRECTED - removed invalid canRename function) ---
    // The main canRename flag is set directly on the environment props
    const treeCapabilities: TreeCapabilities<ItemData, never> = {
        // Check if *all* selected items are draggable (and not the root)
        canDrag: (draggedItems: TreeItem<ItemData>[]) =>
            draggedItems.every(item => {
                // Assume ExtendedTreeItem if needed for canMove
                const extendedItem = item as ExtendedTreeItem;
                return (extendedItem.canMove ?? true) && item.index !== rootItem
            }),

        // Check if the drop target is valid
        canDropAt: (draggedItems: TreeItem<ItemData>[], target: DraggingPosition): boolean => {
            const draggedItemIds = draggedItems.map(item => item.index);
            const targetItemId = getTargetItemId(target); // ID of item being dropped ONTO

            // Cannot drop onto self
            if (targetItemId !== undefined && draggedItemIds.includes(targetItemId)) {
                return false;
            }

            // Cannot drop item into its own descendant or itself
            const targetParentId = getTargetParentId(target, rootItem);
            for (const draggedItemId of draggedItemIds) {
                if (targetParentId === draggedItemId) return false; // Cannot drop into self

                // Check original 'items' state for structure
                const draggedItem = items[draggedItemId];
                if (draggedItem?.isFolder) { // Check only if the dragged item is a folder
                    // Is target parent a descendant of the dragged folder?
                    if (isDescendant(items, draggedItemId, targetParentId)) {
                        return false;
                    }
                    // Is the specific item being dropped ONTO a descendant? (Redundant check, but safe)
                    if (target.targetType === 'item' && isDescendant(items, draggedItemId, target.targetItem)) {
                        return false;
                    }
                }
            }
            return true;
        },
    };

    const handlePrimaryAction = React.useCallback((item: TreeItem<ItemData>) => {
        if (onPrimaryAction) {
            const fullItem = items[item.index] as ExtendedTreeItem;
            if (fullItem) {
                onPrimaryAction(fullItem);
            } else {
                console.warn("Primary action triggered on item not found in state:", item.index);
            }
        }
    }, [onPrimaryAction, items]);

    return (
        <SidebarGroup className="group-data-[collapsible=icon]:hidden">
            <SidebarGroupLabel className="uppercase text-muted-foreground/60 px-2">
                {title}
            </SidebarGroupLabel>
            <SidebarGroupContent>
                <ControlledTreeEnvironment<ItemData, never>
                    ref={environmentRef}
                    items={filteredItems as ExplicitDataSource<ItemData>['items']}
                    getItemTitle={(item: TreeItem<ItemData>) => (item.data as ItemData)?.name ?? ''}
                    viewState={{
                        [treeId]: {
                            focusedItem: focusedItem,
                            expandedItems: expandedItems ?? [],
                            selectedItems: selectedItems ?? [],
                        },
                    }}
                    onFocusItem={(item) => setFocusedItem(item.index)}
                    onExpandItem={(item) => setExpandedItems(prev => [...new Set([...(prev ?? []), item.index])])}
                    onCollapseItem={(item) => setExpandedItems(prev => (prev ?? []).filter((id) => id !== item.index))}
                    onSelectItems={(items) => setSelectedItems(items)}
                    onDrop={handleDrop}
                    onRenameItem={handleRename}
                    onPrimaryAction={handlePrimaryAction}
                    canDragAndDrop={true}
                    canReorderItems={true}
                    canDropOnFolder={true}
                    canDropOnNonFolder={true}
                    {...treeCapabilities}

                    canRename={true}

                    renderItem={renderTreeItem}
                    renderDragBetweenLine={renderDragBetweenLine}

                    renderTreeContainer={({ children, containerProps }) => (
                        <div {...containerProps} className={cn("rct-tree-root pl-1 pr-1", containerProps?.className)}>
                            {children}
                        </div>
                    )}
                    renderItemsContainer={({ children, containerProps }) => (
                        <ul {...containerProps} className={cn("rct-tree-items-container", containerProps?.className)} style={{ paddingLeft: 0, listStyle: 'none', margin: 0 }}>
                            {children}
                        </ul>
                    )}
                >
                    <Tree
                        treeId={treeId}
                        rootItem={String(rootItem)}
                        treeLabel={title}
                    />
                </ControlledTreeEnvironment>
            </SidebarGroupContent>
        </SidebarGroup>
    );
}
```

## File: src/components/theme-toggle.tsx

```tsx
import { useTheme } from "@/lib/hooks/use-theme";
import { SunIcon, MoonIcon } from "lucide-react";
import { SidebarMenuButton } from "@app/ui/components/sidebar";

export function ThemeToggle() {
    const { toggleTheme, theme } = useTheme();

    return (
        <SidebarMenuButton
            onClick={toggleTheme}
            className="font-medium gap-3 h-8 rounded-md bg-gradient-to-r hover:bg-transparent hover:from-sidebar-accent hover:to-sidebar-accent/40 data-[active=true]:from-primary/20 data-[active=true]:to-primary/5 [&>svg]:size-auto"
        >
            {theme === 'light' ? (
                <SunIcon
                    className="text-muted-foreground/60"
                    size={16}
                    aria-hidden="true"
                />
            ) : (
                <MoonIcon
                    className="text-muted-foreground/60"
                    size={16}
                    aria-hidden="true"
                />
            )}
            <span>Theme</span>
        </SidebarMenuButton>
    );
}
```

## File: src/components/not-found.tsx

```tsx
import { Link } from '@tanstack/react-router'
import { Search, ArrowLeft } from "lucide-react"
import { Button } from "@app/ui/components/button"
import { Input } from "@app/ui/components/input"

export function Illustration(props: React.ComponentPropsWithoutRef<"svg">) {
    return (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 362 145" {...props}>
            <path
                fill="currentColor"
                d="M62.6 142c-2.133 0-3.2-1.067-3.2-3.2V118h-56c-2 0-3-1-3-3V92.8c0-1.333.4-2.733 1.2-4.2L58.2 4c.8-1.333 2.067-2 3.8-2h28c2 0 3 1 3 3v85.4h11.2c.933 0 1.733.333 2.4 1 .667.533 1 1.267 1 2.2v21.2c0 .933-.333 1.733-1 2.4-.667.533-1.467.8-2.4.8H93v20.8c0 2.133-1.067 3.2-3.2 3.2H62.6zM33 90.4h26.4V51.2L33 90.4zM181.67 144.6c-7.333 0-14.333-1.333-21-4-6.666-2.667-12.866-6.733-18.6-12.2-5.733-5.467-10.266-13-13.6-22.6-3.333-9.6-5-20.667-5-33.2 0-12.533 1.667-23.6 5-33.2 3.334-9.6 7.867-17.133 13.6-22.6 5.734-5.467 11.934-9.533 18.6-12.2 6.667-2.8 13.667-4.2 21-4.2 7.467 0 14.534 1.4 21.2 4.2 6.667 2.667 12.8 6.733 18.4 12.2 5.734 5.467 10.267 13 13.6 22.6 3.334 9.6 5 20.667 5 33.2 0 12.533-1.666 23.6-5 33.2-3.333 9.6-7.866 17.133-13.6 22.6-5.6 5.467-11.733 9.533-18.4 12.2-6.666 2.667-13.733 4-21.2 4zm0-31c9.067 0 15.6-3.733 19.6-11.2 4.134-7.6 6.2-17.533 6.2-29.8s-2.066-22.2-6.2-29.8c-4.133-7.6-10.666-11.4-19.6-11.4-8.933 0-15.466 3.8-19.6 11.4-4 7.6-6 17.533-6 29.8s2 22.2 6 29.8c4.134 7.467 10.667 11.2 19.6 11.2zM316.116 142c-2.134 0-3.2-1.067-3.2-3.2V118h-56c-2 0-3-1-3-3V92.8c0-1.333.4-2.733 1.2-4.2l56.6-84.6c.8-1.333 2.066-2 3.8-2h28c2 0 3 1 3 3v85.4h11.2c.933 0 1.733.333 2.4 1 .666.533 1 1.267 1 2.2v21.2c0 .933-.334 1.733-1 2.4-.667.533-1.467.8-2.4.8h-11.2v20.8c0 2.133-1.067 3.2-3.2 3.2h-27.2zm-29.6-51.6h26.4V51.2l-26.4 39.2z"
            />
        </svg>
    )
}

export function NotFound() {
    return (
        <div className="relative flex flex-col w-full justify-center min-h-svh bg-background p-6 md:p-10">
            <div className="relative max-w-5xl mx-auto w-full">
                <Illustration className="absolute inset-0 w-full h-[30vh] opacity-[0.04] dark:opacity-[0.03] text-foreground" />
                <div className="relative text-center z-[1]">
                    <h1 className="mt-4 text-balance text-4xl font-semibold tracking-tight text-primary sm:text-6xl">
                        Page not found
                    </h1>
                    <p className="mt-6 text-pretty text-lg font-medium text-muted-foreground sm:text-xl/8">
                        Lost, this page is. In another system, it may be.
                    </p>
                    <div className="mt-10 flex flex-col sm:flex-row gap-y-3 sm:space-x-2 mx-auto sm:max-w-sm">
                        <div className="relative w-full">
                            <Search className="absolute left-2 top-2.5 h-4 w-4 text-muted-foreground" />
                            <Input placeholder="Search" className="pl-8" />
                        </div>
                        <Button variant="outline">Search</Button>
                    </div>
                    <div className="mt-10 flex flex-col sm:flex-row sm:items-center sm:justify-center gap-y-3 gap-x-6">
                        <Button variant="secondary" className="group" onClick={() => window.history.back()}>
                            <ArrowLeft
                                className="ms-0 opacity-60 transition-transform group-hover:-translate-x-1"
                                size={16}
                                strokeWidth={2}
                                aria-hidden="true"
                            />
                            Go back
                        </Button>
                        <Button className="-order-1 sm:order-none" asChild>
                            <Link to="/">Take me home</Link>
                        </Button>
                    </div>
                </div>
            </div>
        </div>
    )
}


```

## File: src/components/auth/register-form.tsx

```tsx
import { useState, useId, useMemo } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { AlertCircle, EyeIcon, EyeOffIcon, Mail, Check, X } from "lucide-react";
import { Button } from "@app/ui/components/button";
import { Alert, AlertDescription, AlertTitle } from "@app/ui/components/alert";
import { Label } from "@app/ui/components/label";
import { registerSchema, type RegisterFormValues } from "@/lib/validations/auth";
import { authClient } from "@app/auth/client";
import { Form, FormControl, FormField, FormItem, FormMessage } from "@app/ui/components/form";
import { Input } from "@app/ui/components/input";
import { SocialAuthButtons } from "./social-auth-buttons";
import { useAuth } from "@/routes/auth/route";
import { motion, AnimatePresence } from "framer-motion";

interface RegisterFormProps {
    onSuccess?: () => void;
    redirectTo?: string;
    className?: string;
}

export function RegisterForm({
    onSuccess,
    redirectTo = "/",
    className = ""
}: RegisterFormProps) {
    const id = useId();
    const [isSubmitted, setIsSubmitted] = useState(false);
    const [serverError, setServerError] = useState<string | null>(null);
    const [showPassword, setShowPassword] = useState(false);
    const [showConfirmPassword, setShowConfirmPassword] = useState(false);

    const { isLoading, setIsLoading } = useAuth();

    const form = useForm<RegisterFormValues>({
        resolver: zodResolver(registerSchema),
        defaultValues: {
            name: "",
            email: "",
            password: "",
            confirmPassword: "",
        },
        mode: "onChange"
    });

    const passwordRequirements = [
        { regex: /.{8,}/, text: "At least 8 characters" },
        { regex: /[0-9]/, text: "At least 1 number" },
        { regex: /[a-z]/, text: "At least 1 lowercase letter" },
        { regex: /[A-Z]/, text: "At least 1 uppercase letter" }
    ];

    const password = form.watch("password");

    const requirementStatus = useMemo(() => {
        return passwordRequirements.map((req) => ({
            met: req.regex.test(password || ""),
            text: req.text,
        }));
    }, [password]);

    const confirmPassword = form.watch("confirmPassword");
    const passwordsMatch = password === confirmPassword && password !== "";

    const isFormValid = form.formState.isValid;

    async function onSubmit(data: RegisterFormValues) {
        setIsLoading(true);

        try {
            const callbackURL = new URL(
                redirectTo,
                window.location.origin
            ).toString();

            const { error } = await authClient.signUp.email({
                name: data.name,
                email: data.email,
                password: data.password,
                callbackURL,
            });

            if (error) {
                throw error;
            }

            setIsSubmitted(true);
            onSuccess?.();
        } catch (error) {
            setServerError(
                error instanceof Error
                    ? error.message
                    : "Failed to create account. Please try again."
            );
        } finally {
            setIsLoading(false);
        }
    }

    if (isSubmitted) {
        return (
            <Alert variant="success">
                <Mail className="h-5 w-5" />
                <AlertTitle>Verify your email</AlertTitle>
                <AlertDescription>
                    We've sent you an email with a link to verify your account. Please check your inbox and follow the instructions.
                </AlertDescription>
            </Alert>
        );
    }

    return (
        <Form {...form}>
            <form
                onSubmit={(e) => {
                    e.preventDefault();
                    form.handleSubmit(onSubmit)(e);
                }}
                method="post"
                className={`space-y-5 ${className}`}>
                {serverError && (
                    <Alert variant="destructive">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>Registration failed</AlertTitle>
                        <AlertDescription>{serverError}</AlertDescription>
                    </Alert>
                )}

                <div className="space-y-4">
                    <FormField
                        control={form.control}
                        name="name"
                        render={({ field }) => (
                            <FormItem>
                                <Label htmlFor={`${id}-name`}>Full Name</Label>
                                <FormControl>
                                    <Input
                                        id={`${id}-name`}
                                        {...field}
                                        placeholder="John Doe"
                                        autoComplete="name"
                                    />
                                </FormControl>
                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <FormField
                        control={form.control}
                        name="email"
                        render={({ field }) => (
                            <FormItem>
                                <Label htmlFor={`${id}-email`}>Email</Label>
                                <FormControl>
                                    <Input
                                        id={`${id}-email`}
                                        {...field}
                                        type="email"
                                        placeholder="hi@example.com"
                                        autoComplete="email"
                                    />
                                </FormControl>
                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <FormField
                        control={form.control}
                        name="password"
                        render={({ field }) => (
                            <FormItem>
                                <Label htmlFor={`${id}-password`}>Password</Label>
                                <FormControl>
                                    <div className="relative">
                                        <Input
                                            id={`${id}-password`}
                                            {...field}
                                            type={showPassword ? "text" : "password"}
                                            placeholder="Enter your password"
                                            autoComplete="new-password"
                                            className="pr-10"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => setShowPassword(!showPassword)}
                                            className="absolute inset-y-0 right-0 flex items-center pr-3 text-primary"
                                        >
                                            {showPassword ? (
                                                <EyeOffIcon className="h-4 w-4" />
                                            ) : (
                                                <EyeIcon className="h-4 w-4" />
                                            )}
                                        </button>
                                    </div>
                                </FormControl>

                                {/* Password requirements checklist */}
                                {password && (
                                    <AnimatePresence>
                                        <motion.ul
                                            className="mt-2 space-y-1"
                                            aria-label="Password requirements"
                                            initial={{ opacity: 0, height: 0 }}
                                            animate={{ opacity: 1, height: "auto" }}
                                            exit={{ opacity: 0, height: 0 }}
                                            transition={{ duration: 0.3 }}
                                        >
                                            {requirementStatus.map((req, index) => (
                                                <motion.li
                                                    key={index}
                                                    className="flex items-center gap-1.5"
                                                    initial={{ opacity: 0, x: 0 }}
                                                    animate={{ opacity: 1, x: 0 }}
                                                    transition={{ duration: 0.2 }}
                                                >
                                                    <AnimatePresence mode="wait" initial={false}>
                                                        <motion.div
                                                            key={req.met ? "check" : "x"}
                                                            initial={{ scale: 0.5, opacity: 0 }}
                                                            animate={{ scale: 1, opacity: 1 }}
                                                            exit={{ scale: 0.5, opacity: 0 }}
                                                            transition={{ duration: 0.2 }}
                                                        >
                                                            {req.met ? (
                                                                <Check size={16} className="text-emerald-500" aria-hidden="true" />
                                                            ) : (
                                                                <X size={16} className="text-muted-foreground/80" aria-hidden="true" />
                                                            )}
                                                        </motion.div>
                                                    </AnimatePresence>
                                                    <span className={`text-xs ${req.met ? "text-emerald-600" : "text-muted-foreground"}`}>
                                                        {req.text}
                                                        <span className="sr-only">
                                                            {req.met ? " - Requirement met" : " - Requirement not met"}
                                                        </span>
                                                    </span>
                                                </motion.li>
                                            ))}
                                        </motion.ul>
                                    </AnimatePresence>
                                )}

                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <FormField
                        control={form.control}
                        name="confirmPassword"
                        render={({ field }) => (
                            <FormItem>
                                <Label htmlFor={`${id}-confirm-password`}>Confirm Password</Label>
                                <FormControl>
                                    <div className="relative">
                                        <Input
                                            id={`${id}-confirm-password`}
                                            {...field}
                                            type={showConfirmPassword ? "text" : "password"}
                                            placeholder="Confirm your password"
                                            autoComplete="new-password"
                                            className="pr-10"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                                            className="absolute inset-y-0 right-0 flex items-center pr-3 text-primary"
                                        >
                                            {showConfirmPassword ? (
                                                <EyeOffIcon className="h-4 w-4" />
                                            ) : (
                                                <EyeIcon className="h-4 w-4" />
                                            )}
                                        </button>
                                    </div>
                                </FormControl>

                                {/* Show password match status only when both fields have values */}
                                {password && confirmPassword && (
                                    <AnimatePresence>
                                        <motion.div
                                            className="mt-2 flex items-center gap-1"
                                            initial={{ opacity: 0, y: -5 }}
                                            animate={{ opacity: 1, y: 0 }}
                                            exit={{ opacity: 0, y: -5 }}
                                            transition={{ duration: 0.2 }}
                                        >
                                            <AnimatePresence mode="wait" initial={false}>
                                                <motion.div
                                                    key={passwordsMatch ? "match" : "no-match"}
                                                    initial={{ scale: 1, opacity: 0 }}
                                                    animate={{ scale: 1, opacity: 1 }}
                                                    exit={{ scale: 1, opacity: 0 }}
                                                    transition={{ duration: 0.2 }}
                                                >
                                                    {passwordsMatch ? (
                                                        <div className="flex gap-1">
                                                            <Check size={16} className="text-emerald-500" aria-hidden="true" />
                                                            <span className="text-xs text-emerald-600">Passwords match</span>
                                                        </div>
                                                    ) : (
                                                        <div className="flex gap-1">
                                                            <X size={16} className="text-destructive/80" aria-hidden="true" />
                                                            <span className="text-xs text-destructive">Passwords do not match</span>
                                                        </div>
                                                    )}
                                                </motion.div>
                                            </AnimatePresence>
                                        </motion.div>
                                    </AnimatePresence>
                                )}
                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <Button
                        type="submit"
                        className="w-full"
                        disabled={isLoading || !isFormValid}
                    >
                        {isLoading ? "Creating account..." : "Sign up"}
                    </Button>
                </div>

                <div className="before:bg-border after:bg-border flex items-center gap-3 before:h-px before:flex-1 after:h-px after:flex-1">
                    <span className="text-muted-foreground text-xs">Or</span>
                </div>

                <SocialAuthButtons type='signup' />
            </form>
        </Form>
    );
}
```

## File: src/components/auth/reset-password-form.tsx

```tsx
import { useState, useId, useMemo } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { AlertCircle, CheckCircle2, EyeIcon, EyeOffIcon, Check, X } from "lucide-react";
import { Button } from "@app/ui/components/button";
import { Alert, AlertDescription, AlertTitle } from "@app/ui/components/alert";
import { resetPasswordSchema, type ResetPasswordFormValues } from "@/lib/validations/auth";
import { authClient } from "@app/auth/client";
import { Link, useNavigate } from "@tanstack/react-router";
import { Form, FormControl, FormField, FormItem, FormMessage } from "@app/ui/components/form";
import { Input } from "@app/ui/components/input";
import { Label } from "@app/ui/components/label";
import { useSession } from "@/lib/providers/session";
import { useAuth } from "@/routes/auth/route";
import { Route as ResetPasswordRoute } from "@/routes/auth/reset-password";

interface ResetPasswordFormProps {
    onSuccess?: () => void;
    redirectTo?: string;
    className?: string;
}

export function ResetPasswordForm({
    onSuccess,
    redirectTo = "/",
    className = ""
}: ResetPasswordFormProps) {
    const id = useId();
    const [isSubmitted, setIsSubmitted] = useState(false);
    const [serverError, setServerError] = useState<{ title: string; message?: string } | null>(null);
    const [showPassword, setShowPassword] = useState(false);
    const [showConfirmPassword, setShowConfirmPassword] = useState(false);
    const { user, reloadSession } = useSession();
    const navigate = useNavigate();

    const { token } = ResetPasswordRoute.useSearch();

    const { isLoading, setIsLoading } = useAuth();

    const form = useForm<ResetPasswordFormValues>({
        resolver: zodResolver(resetPasswordSchema),
        defaultValues: {
            password: "",
            confirmPassword: "",
        },
        mode: "onChange"
    });

    const passwordRequirements = [
        { regex: /.{8,}/, text: "At least 8 characters" },
        { regex: /[0-9]/, text: "At least 1 number" },
        { regex: /[a-z]/, text: "At least 1 lowercase letter" },
        { regex: /[A-Z]/, text: "At least 1 uppercase letter" }
    ];

    const password = form.watch("password");

    const requirementStatus = useMemo(() => {
        return passwordRequirements.map((req) => ({
            met: req.regex.test(password || ""),
            text: req.text,
        }));
    }, [password]);

    const confirmPassword = form.watch("confirmPassword");
    const passwordsMatch = password === confirmPassword && password !== "";

    const isFormValid = form.formState.isValid;

    async function onSubmit(data: ResetPasswordFormValues) {
        setIsLoading(true);

        try {
            const { error } = await authClient.resetPassword({
                newPassword: data.password,
                token: token || "",
            });

            if (error) {
                throw error;
            }

            setIsSubmitted(true);
            onSuccess?.();

            await reloadSession();

            if (user) {
                navigate({ to: redirectTo, replace: true });
            }
        } catch (error) {
            setServerError({
                title: "Password reset failed",
                message: error instanceof Error
                    ? error.message
                    : "Failed to reset password. The reset link may have expired. Please try requesting a new link."
            });
        } finally {
            setIsLoading(false);
        }
    }

    if (isSubmitted) {
        return (
            <div className={`space-y-4 ${className}`}>
                <Alert variant="success">
                    <CheckCircle2 className="h-4 w-4" />
                    <AlertTitle>Password reset successful</AlertTitle>
                    <AlertDescription>
                        Your password has been reset successfully. You can now sign in with your new password.
                    </AlertDescription>
                </Alert>
                <Button asChild className="w-full mt-4">
                    <Link to="/auth/signin">Return to Sign In</Link>
                </Button>
            </div>
        );
    }

    return (
        <Form {...form}>
            <form
                onSubmit={(e) => {
                    e.preventDefault();
                    form.handleSubmit(onSubmit)(e);
                }}
                method="post"
                className={`space-y-5 ${className}`}
            >
                {serverError && (
                    <Alert variant="destructive">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>{serverError.title}</AlertTitle>
                        {serverError.message && (
                            <AlertDescription>{serverError.message}</AlertDescription>
                        )}
                    </Alert>
                )}

                <div className="space-y-4">
                    <FormField
                        control={form.control}
                        name="password"
                        render={({ field }) => (
                            <FormItem >
                                <Label htmlFor={`${id}-password`}>New Password</Label>
                                <FormControl>
                                    <div className="relative">
                                        <Input
                                            id={`${id}-password`}
                                            {...field}
                                            type={showPassword ? "text" : "password"}
                                            placeholder="Enter your new password"
                                            autoComplete="new-password"
                                            className="pr-10"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => setShowPassword(!showPassword)}
                                            className="absolute inset-y-0 right-0 flex items-center pr-3 text-primary"
                                        >
                                            {showPassword ? (
                                                <EyeOffIcon className="h-4 w-4" />
                                            ) : (
                                                <EyeIcon className="h-4 w-4" />
                                            )}
                                        </button>
                                    </div>
                                </FormControl>

                                {/* Password requirements checklist */}
                                {password && (
                                    <ul className="mt-2 space-y-1" aria-label="Password requirements">
                                        {requirementStatus.map((req, index) => (
                                            <li key={index} className="flex items-center gap-2">
                                                {req.met ? (
                                                    <Check size={16} className="text-emerald-500" aria-hidden="true" />
                                                ) : (
                                                    <X size={16} className="text-muted-foreground/80" aria-hidden="true" />
                                                )}
                                                <span className={`text-xs ${req.met ? "text-emerald-600" : "text-muted-foreground"}`}>
                                                    {req.text}
                                                    <span className="sr-only">
                                                        {req.met ? " - Requirement met" : " - Requirement not met"}
                                                    </span>
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                )}

                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <FormField
                        control={form.control}
                        name="confirmPassword"
                        render={({ field }) => (
                            <FormItem >
                                <Label htmlFor={`${id}-confirm-password`}>Confirm Password</Label>
                                <FormControl>
                                    <div className="relative">
                                        <Input
                                            id={`${id}-confirm-password`}
                                            {...field}
                                            type={showConfirmPassword ? "text" : "password"}
                                            placeholder="Confirm your new password"
                                            autoComplete="new-password"
                                            className="pr-10"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                                            className="absolute inset-y-0 right-0 flex items-center pr-3 text-primary"
                                        >
                                            {showConfirmPassword ? (
                                                <EyeOffIcon className="h-4 w-4" />
                                            ) : (
                                                <EyeIcon className="h-4 w-4" />
                                            )}
                                        </button>
                                    </div>
                                </FormControl>

                                {/* Show password match status only when both fields have values */}
                                {password && confirmPassword && (
                                    <div className="mt-2 flex items-center gap-2">
                                        {passwordsMatch ? (
                                            <>
                                                <Check size={16} className="text-emerald-500" aria-hidden="true" />
                                                <span className="text-xs text-emerald-600">Passwords match</span>
                                            </>
                                        ) : (
                                            <>
                                                <X size={16} className="text-destructive/80" aria-hidden="true" />
                                                <span className="text-xs text-destructive">Passwords do not match</span>
                                            </>
                                        )}
                                    </div>
                                )}

                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <Button
                        type="submit"
                        className="w-full"
                        disabled={isLoading || !isFormValid}
                    >
                        {isLoading ? "Resetting..." : "Reset Password"}
                    </Button>
                </div>
            </form>
        </Form>
    );
}
```

## File: src/components/auth/forgot-password-form.tsx

```tsx
import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { AlertCircle, ArrowLeftIcon, Mail } from "lucide-react";
import { Button } from "@app/ui/components/button";
import { Alert, AlertDescription, AlertTitle } from "@app/ui/components/alert";
import { Input } from "@app/ui/components/input";
import { Label } from "@app/ui/components/label";
import { forgotPasswordSchema, type ForgotPasswordFormValues } from "@/lib/validations/auth";
import { authClient } from "@app/auth/client";
import { Link } from "@tanstack/react-router";
import { Form, FormControl, FormField, FormItem, FormMessage } from "@app/ui/components/form";
import { useAuth } from "@/routes/auth/route";

interface ForgotPasswordFormProps {
    onSuccess?: () => void;
    className?: string;
    defaultEmail?: string;
}

export function ForgotPasswordForm({
    onSuccess,
    className = "",
    defaultEmail = ""
}: ForgotPasswordFormProps) {
    const [isSubmitted, setIsSubmitted] = useState(false);
    const [serverError, setServerError] = useState<{ title: string; message?: string } | null>(null);

    const { isLoading, setIsLoading } = useAuth();

    const form = useForm<ForgotPasswordFormValues>({
        resolver: zodResolver(forgotPasswordSchema),
        defaultValues: {
            email: defaultEmail,
        },
        mode: "onChange"
    });

    useEffect(() => {
        if (defaultEmail) {
            form.setValue("email", defaultEmail);
        }
    }, [defaultEmail, form]);

    const email = form.watch("email");

    const hasEmailValue = !!email;

    const isFormValid = form.formState.isValid;

    async function onSubmit(data: ForgotPasswordFormValues) {
        setIsLoading(true);

        try {
            const redirectTo = new URL(
                "/auth/reset-password",
                window.location.origin
            ).toString();

            const { error } = await authClient.forgetPassword({
                email: data.email,
                redirectTo,
            });

            if (error) {
                throw error;
            }

            setIsSubmitted(true);
            onSuccess?.();
        } catch (error) {
            setServerError({
                title: "Password reset link could not be sent",
                message: "We couldn't send a password reset link to that email. Please check the email address and try again."
            });
        } finally {
            setIsLoading(false);
        }
    }

    if (isSubmitted) {
        return (
            <div className={`space-y-4 ${className}`}>
                <Alert variant="success">
                    <Mail className="h-4 w-4" />
                    <AlertTitle>Check your email</AlertTitle>
                    <AlertDescription>
                        Password reset instructions have been sent to your email.
                    </AlertDescription>
                </Alert>
                <Button asChild className="w-full mt-4 group">
                    <Link to="/auth/signin">
                        <ArrowLeftIcon
                            className="ms-0 opacity-60 transition-transform group-hover:-translate-x-1"
                            size={16}
                            strokeWidth={2}
                            aria-hidden="true"
                        />
                        Return to Sign In
                    </Link>
                </Button>
            </div>
        );
    }

    return (
        <Form {...form}>
            <form
                onSubmit={(e) => {
                    e.preventDefault();
                    form.handleSubmit(onSubmit)(e);
                }}
                method="post"
                className={`space-y-5 ${className}`}>
                {serverError && (
                    <Alert variant="destructive">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>{serverError.title}</AlertTitle>
                        {serverError.message && (
                            <AlertDescription>{serverError.message}</AlertDescription>
                        )}
                    </Alert>
                )}

                <div className="space-y-4">
                    <FormField
                        control={form.control}
                        name="email"
                        render={({ field }) => (
                            <FormItem>
                                <Label htmlFor="email">Email</Label>
                                <FormControl>
                                    <Input
                                        id="email"
                                        {...field}
                                        type="email"
                                        placeholder="hi@example.com"
                                        autoComplete="email"
                                    />
                                </FormControl>
                                {form.formState.submitCount > 0 && <FormMessage />}
                            </FormItem>
                        )}
                    />

                    <Button
                        type="submit"
                        className="w-full"
                        disabled={isLoading || !hasEmailValue || !isFormValid}
                    >
                        {isLoading ? "Sending..." : "Send Reset Link"}
                    </Button>
                </div>
            </form>
        </Form>
    );
}
```

## File: src/components/auth/login-form.tsx

```tsx
import { useState, useId, useEffect } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { useNavigate, useRouter } from "@tanstack/react-router";
import { AlertCircle, EyeIcon, EyeOffIcon, KeyRound, Mail } from "lucide-react";
import { Button } from "@app/ui/components/button";
import { Input } from "@app/ui/components/input";
import { Label } from "@app/ui/components/label";
import { Alert, AlertDescription, AlertTitle } from "@app/ui/components/alert";
import { loginSchema, type LoginFormValues } from "@/lib/validations/auth";
import { authClient } from "@app/auth/client";
import { useSession } from "@/lib/providers/session";
import { Form, FormControl, FormField, FormItem, FormMessage } from "@app/ui/components/form";
import { SocialAuthButtons } from "./social-auth-buttons";
import { useAuth } from "@/routes/auth/route";
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle
} from "@app/ui/components/dialog";

interface LoginFormProps {
    onSuccess?: () => void;
    redirectTo?: string;
    className?: string;
    onForgotPassword?: (email: string) => void;
}

export function LoginForm({
    onSuccess,
    redirectTo = "/",
    className = "",
    onForgotPassword
}: LoginFormProps) {
    const id = useId();
    const [serverError, setServerError] = useState<string | null>(null);
    const [showPassword, setShowPassword] = useState(false);
    const [failedAttempts, setFailedAttempts] = useState(0);
    const [showResetDialog, setShowResetDialog] = useState(false);
    const { reloadSession } = useSession();
    const navigate = useNavigate();
    const router = useRouter();

    const { isLoading, setIsLoading } = useAuth();

    const form = useForm<LoginFormValues>({
        resolver: zodResolver(loginSchema),
        defaultValues: {
            email: "",
            password: "",
        },
        mode: "onChange"
    });

    const email = form.watch("email");
    const password = form.watch("password");

    useEffect(() => {
        setFailedAttempts(0);
    }, [email]);

    const formHasValues = !!email && !!password;

    const handleForgotPasswordClick = () => {
        if (onForgotPassword && email) {
            onForgotPassword(email);
        } else {
            navigate({ to: "/auth/forgot-password" });
        }
    };

    const handleResetPasswordClick = () => {
        setShowResetDialog(false);
        handleForgotPasswordClick();
    };

    async function onSubmit(data: LoginFormValues) {
        setIsLoading(true);

        try {
            const { error } = await authClient.signIn.email({
                email: data.email,
                password: data.password,
            });

            if (error) {
                throw error;
            }

            setFailedAttempts(0);
            await reloadSession();
            onSuccess?.();
            await router.invalidate();
            navigate({
                to: redirectTo,
                replace: true
            });
        } catch (error) {
            const newAttemptCount = failedAttempts + 1;
            setFailedAttempts(newAttemptCount);

            setServerError("Invalid email or password. Please try again.");

            if (newAttemptCount >= 3) {
                setShowResetDialog(true);
            }
        } finally {
            setIsLoading(false); // End loading animation
        }
    }

    return (
        <>
            <Form {...form}>
                <form
                    onSubmit={(e) => {
                        e.preventDefault();
                        form.handleSubmit(onSubmit)(e);
                    }}
                    method="post"
                    className={`space-y-5 ${className}`}
                >
                    {serverError && (
                        <Alert variant="destructive">
                            <AlertCircle className="h-4 w-4" />
                            <AlertTitle>Sign in failed</AlertTitle>
                            <AlertDescription>{serverError}</AlertDescription>
                        </Alert>
                    )}

                    <div className="space-y-4">
                        <FormField
                            control={form.control}
                            name="email"
                            render={({ field }) => (
                                <FormItem>
                                    <Label htmlFor={`${id}-email`}>Email</Label>
                                    <FormControl>
                                        <Input
                                            id={`${id}-email`}
                                            {...field}
                                            type="email"
                                            placeholder="hi@yourcompany.com"
                                            autoComplete="email"
                                        />
                                    </FormControl>
                                    {form.formState.submitCount > 0 && <FormMessage />}
                                </FormItem>
                            )}
                        />

                        <FormField
                            control={form.control}
                            name="password"
                            render={({ field }) => (
                                <FormItem>
                                    <Label htmlFor={`${id}-password`}>Password</Label>
                                    <FormControl>
                                        <div className="relative">
                                            <Input
                                                id={`${id}-password`}
                                                {...field}
                                                type={showPassword ? "text" : "password"}
                                                placeholder="Enter your password"
                                                autoComplete="current-password"
                                                className="pr-10"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => setShowPassword(!showPassword)}
                                                className="absolute inset-y-0 right-0 flex items-center pr-3 text-primary"
                                            >
                                                {showPassword ? (
                                                    <EyeOffIcon className="h-4 w-4" />
                                                ) : (
                                                    <EyeIcon className="h-4 w-4" />
                                                )}
                                            </button>
                                        </div>
                                    </FormControl>
                                    {form.formState.submitCount > 0 && <FormMessage />}
                                </FormItem>
                            )}
                        />
                    </div>

                    <div className="flex justify-end">
                        <button
                            type="button"
                            onClick={handleForgotPasswordClick}
                            className="text-muted-foreground text-sm hover:underline"
                        >
                            Forgot password?
                        </button>
                    </div>

                    <Button
                        type="submit"
                        className="w-full"
                        disabled={isLoading || !formHasValues}
                    >
                        {isLoading ? "Signing in..." : "Sign in"}
                    </Button>

                    <div className="before:bg-border after:bg-border flex items-center gap-3 before:h-px before:flex-1 after:h-px after:flex-1">
                        <span className="text-muted-foreground text-xs">Or</span>
                    </div>

                    <SocialAuthButtons type="signin" />
                </form>
            </Form>

            <Dialog open={showResetDialog} onOpenChange={setShowResetDialog}>
                <DialogContent className="sm:max-w-md">
                    <DialogHeader>
                        <DialogTitle className="flex items-center gap-2">
                            <KeyRound className="h-5 w-5 text-primary" />
                            <span>Having trouble signing in?</span>
                        </DialogTitle>
                        <DialogDescription>
                            You've made multiple unsuccessful login attempts. Would you like to reset your password?
                        </DialogDescription>
                    </DialogHeader>

                    <div className="bg-secondary/50 p-4 rounded-lg my-2 flex gap-2">
                        <div>
                            <Mail className="size-4 mt-[2px]" />
                        </div>
                        <span className="text-sm">
                            We'll send a password reset link to <strong>{email}</strong> where you can create a new password.
                        </span>
                    </div>

                    <DialogFooter className="sm:justify-between flex-row gap-2 mt-2">
                        <Button
                            variant="outline"
                            onClick={() => setShowResetDialog(false)}
                        >
                            Try again
                        </Button>
                        <Button
                            variant={'default'}
                            onClick={handleResetPasswordClick}
                        >
                            Reset password
                        </Button>
                    </DialogFooter>
                </DialogContent>
            </Dialog>
        </>
    );
}
```

## File: src/components/auth/social-auth-buttons.tsx

```tsx
import { type ComponentProps } from "react";
import { Button } from "@app/ui/components/button";
import { cn } from "@app/ui/lib/utils";
import { authClient } from "@app/auth/client";
import {
    Tooltip,
    TooltipContent,
    TooltipProvider,
    TooltipTrigger
} from "@app/ui/components/tooltip";
import { Icons } from "@app/ui/icons"
import { Badge } from "@app/ui/components/badge";
import { useStorage } from "@/lib/hooks/use-storage";
import { useAuth } from "@/routes/auth/route";

export type SocialProvider = "google" | "github";

const LAST_LOGIN_METHOD_KEY = "last_login_method";

interface SocialAuthButtonProps extends ComponentProps<typeof Button> {
    provider: SocialProvider;
    label: string;
    isLastUsed?: boolean;
    onAuth: (provider: SocialProvider) => Promise<void>;
}

const getIcon = (provider: SocialProvider) => {
    switch (provider) {
        case "github":
            return <Icons.github size='sm' className="mr-2" />;
        case "google":
            return <Icons.google size='sm' className="mr-2" />;
        default:
            return null;
    }
};

function SocialAuthButton({
    provider,
    label,
    isLastUsed = false,
    className,
    onAuth,
    ...props
}: SocialAuthButtonProps) {
    const { isLoading } = useAuth();

    const handleAuth = async () => {
        if (isLoading) return;
        await onAuth(provider);
    };

    const buttonContent = (
        <div className="flex items-center justify-center w-full">
            {getIcon(provider)}
            <span>{props.children || `Sign in with ${label}`}</span>

            {isLastUsed && (
                <Badge
                    variant="secondary"
                    className="ml-2 md:hidden text-xs py-[4px] px-1.5 bg-primary/70 text-primary-foreground border border-primary"
                >
                    Previously used
                </Badge>
            )}
        </div>
    );

    if (isLastUsed) {
        return (
            <TooltipProvider delayDuration={0}>
                <Tooltip open={!isLoading}>
                    <TooltipTrigger asChild>
                        <Button
                            variant={isLastUsed ? 'default' : 'outline'}
                            onClick={handleAuth}
                            disabled={isLoading}
                            className={cn(
                                "flex w-full relative",
                                isLastUsed && "bg-primary/10 text-primary border-primary hover:bg-primary/20 hover:text-primary",
                                className
                            )}
                            {...props}
                        >
                            {buttonContent}
                        </Button>
                    </TooltipTrigger>
                    <TooltipContent side="right" sideOffset={5} className="hidden md:block">
                        <p className="text-sm">Previously used</p>
                    </TooltipContent>
                </Tooltip>
            </TooltipProvider>
        );
    }

    return (
        <Button
            variant="outline"
            onClick={handleAuth}
            disabled={isLoading}
            className={cn("flex w-full relative", className)}
            {...props}
        >
            {buttonContent}
        </Button>
    );
}

interface SocialAuthButtonsProps {
    type: "signin" | "signup";
}

export function SocialAuthButtons({ type }: SocialAuthButtonsProps) {
    const actionText = type === "signin" ? "Sign in" : "Sign up";

    const { setIsLoading } = useAuth();


    const [lastLoginMethod, setLastLoginMethod, _, storageError] = useStorage<SocialProvider | null>(
        LAST_LOGIN_METHOD_KEY,
        null
    );

    if (storageError) {
        console.error("Error accessing login method storage:", storageError);
    }

    const handleAuth = async (provider: SocialProvider) => {
        try {
            const callbackURL = new URL('/', window.location.origin);
            setIsLoading(true)
            const { error } = await authClient.signIn.social({
                provider,
                callbackURL: callbackURL.toString(),
            }, {
                onSuccess: () => {
                    setLastLoginMethod(provider);
                },
                onError: () => {
                    setIsLoading(false)
                    throw error
                },
            });

        } catch (error) {
            setIsLoading(false)
            console.error("Social auth error:", error);
        }
    };

    return (
        <div className="space-y-2">
            <div className="flex flex-col gap-2">
                <SocialAuthButton
                    provider="github"
                    label="GitHub"
                    isLastUsed={lastLoginMethod === "github"}
                    className={lastLoginMethod === "github" ? "order-first" : ""}
                    onAuth={handleAuth}
                >
                    {actionText} with GitHub
                </SocialAuthButton>

                <SocialAuthButton
                    provider="google"
                    label="Google"
                    isLastUsed={lastLoginMethod === "google"}
                    className={lastLoginMethod === "google" ? "order-first" : ""}
                    onAuth={handleAuth}
                >
                    {actionText} with Google
                </SocialAuthButton>
            </div>
        </div>
    );
}
```

## File: src/lib/providers/session.tsx

```tsx
import { createContext, useContext, useState, useEffect } from "react";
import { authClient } from "@app/auth/client";

export interface User {
    id: string;
    email: string;
    emailVerified: boolean;
    name: string;
    createdAt: Date;
    updatedAt: Date;
    image?: string | null;
    onboardingComplete?: boolean | null;
    banned: boolean;
    role?: string | null;
    metadata?: Record<string, any> | null;
    preferences?: Record<string, any> | null;
    banExpires?: Date | null;
}

interface SessionContextType {
    user: User | null;
    session: any | null;
    loaded: boolean;
    reloadSession: () => Promise<void>;
}

const SessionContext = createContext<SessionContextType>({
    user: null,
    session: null,
    loaded: false,
    reloadSession: async () => { },
});

export function SessionProvider({
    children,
    initialUser
}: {
    children: React.ReactNode;
    initialUser?: User | null;
}) {
    const [session, setSession] = useState<any | null>(null);
    const [user, setUser] = useState<User | null>(initialUser || null);
    const [loaded, setLoaded] = useState(false);

    const loadSession = async () => {
        try {
            const { data, error } = await authClient.getSession();

            if (error) {
                console.error("Failed to fetch session:", error);
                setUser(null);
                setSession(null);
            } else if (data) {
                const userData = data.user as User;

                if (userData) {
                    if (userData.banned === undefined) {
                        userData.banned = false;
                    }
                }

                setUser(userData);
                setSession(data.session);
            }

            setLoaded(true);
        } catch (error) {
            console.error("Error fetching session:", error);
            setLoaded(true);
        }
    };

    useEffect(() => {
        if (!initialUser) {
            loadSession();
        }
    }, [initialUser]);

    const reloadSession = async () => {
        await loadSession();
    };

    return (
        <SessionContext.Provider
            value={{
                user,
                session,
                loaded,
                reloadSession,
            }}
        >
            {children}
        </SessionContext.Provider>
    );
}

export function useSession() {
    const context = useContext(SessionContext);

    if (context === undefined) {
        throw new Error("useSession must be used within a SessionProvider");
    }

    return context;
}
```

## File: src/lib/mock/sidebar-data.ts

```typescript
// src/lib/sidebar-data.ts
import {
    type TreeItem,
    type TreeItemIndex
} from "react-complex-tree";
import {
    FileText,
    Folder,
    BookOpen,
    Briefcase,
    Users,
    FilePieChart,
    ClipboardList,
    Goal,
    CalendarDays,
    Paintbrush,
    Code2,
    Wrench,
    Palette,
    FunctionSquare,
    Database, Lightbulb,
    ShieldCheck, // Example, might not be used below
    Scale
} from "lucide-react";

export interface ItemData {
    name: string;
    type: 'folder' | 'document' | 'library-item';
    icon?: React.ElementType;
    emoji?: string;
    url?: string;
}

export type ExtendedTreeItem = TreeItem<ItemData>;
export type TreeItems = Record<TreeItemIndex, ExtendedTreeItem>;

let idCounter = 0;
const createItem = (
    name: string,
    type: ItemData['type'],
    childrenIds: TreeItemIndex[] = [],
    emoji?: string,
    url?: string,
    icon?: React.ElementType,
): Record<TreeItemIndex, ExtendedTreeItem> => {
    const id: TreeItemIndex = `${type}-${idCounter++}`;
    const isFolder = type === 'folder' || childrenIds.length > 0;
    const item: ExtendedTreeItem = {
        index: id,
        data: { name, type, emoji, url, icon: icon },
        isFolder: isFolder,
        children: childrenIds,
        canMove: true,
        canRename: true,
    };
    return { [id]: item };
};

// --- Default Icons ---
export const defaultIcons: { [key in ItemData['type']]: React.ElementType } = {
    folder: Folder,
    document: FileText,
    'library-item': BookOpen,
};

// --- MOCK DOCUMENTS DATA ---

// Level 3/4 Items (Deepest) - No change needed here
const doc_phoenix_proto_v1 = createItem("Mobile Prototype", "document", [], "ðŸ“±", "/docs/projects/phoenix/design/proto-v1");
const doc_phoenix_proto_v2 = createItem("Desktop Prototype", "document", [], "ðŸ’»", "/docs/projects/phoenix/design/proto-v2");
const doc_phoenix_interviews_raw = createItem("Raw Interview Notes", "document", [], "ðŸ—’ï¸", "/docs/projects/phoenix/research/interviews-raw");
const doc_chimera_api_auth = createItem("Auth Endpoints", "document", [], "ðŸ”‘", "/docs/projects/chimera/api/auth");
const doc_chimera_api_users = createItem("User Endpoints", "document", [], "ðŸ‘¤", "/docs/projects/chimera/api/users");
const doc_hr_policy_pto = createItem("PTO Policy", "document", [], "ðŸŒ´", "/docs/company/hr/pto");
const doc_legal_nda_vendor = createItem("Vendor NDA", "document", [], "âœï¸", "/docs/company/legal/nda-vendor");
const doc_finance_expense_guide = createItem("Expense Reporting Guide", "document", [], "ðŸ§¾", "/docs/company/finance/expense-guide");
const doc_meetings_q3_kickoff_slides = createItem("Q3 Kickoff Slides", "document", [], "ðŸ“Š", "/docs/meetings/q3-2024/kickoff-slides");

// Level 2 Items - No change needed here
const doc_folder_phoenix_proto = createItem("Prototypes", "folder", [Object.keys(doc_phoenix_proto_v1)[0], Object.keys(doc_phoenix_proto_v2)[0]], "ðŸ–¼ï¸", undefined, Paintbrush);
const doc_phoenix_design_system = createItem("Design System Specs", "document", [], "ðŸŽ¨", "/docs/projects/phoenix/design/system");
const doc_phoenix_spec_core = createItem("Core Feature Spec", "document", [], "ðŸ’¡", "/docs/projects/phoenix/specs/core");
const doc_phoenix_spec_arch = createItem("Architecture Overview", "document", [], "ðŸ—ï¸", "/docs/projects/phoenix/specs/arch");
const doc_folder_phoenix_research_sum = createItem("Research Summaries", "folder", [], "ðŸ“Š");
const doc_folder_phoenix_interviews = createItem("User Interviews", "folder", [Object.keys(doc_phoenix_interviews_raw)[0]], "ðŸ—£ï¸");
const doc_folder_chimera_api = createItem("API Docs", "folder", [Object.keys(doc_chimera_api_auth)[0], Object.keys(doc_chimera_api_users)[0]], "â˜ï¸");
const doc_chimera_backend_schema = createItem("DB Schema", "document", [], "ðŸ’¾", "/docs/projects/chimera/backend/schema", Database);
const doc_chimera_frontend_setup = createItem("Setup Guide", "document", [], "ðŸ› ï¸", "/docs/projects/chimera/frontend/setup");
const doc_hr_onboarding = createItem("Onboarding Checklist", "document", [], "âœ…", "/docs/company/hr/onboarding", ClipboardList);
const doc_folder_hr_policies = createItem("Policies", "folder", [Object.keys(doc_hr_policy_pto)[0]], "ðŸ“œ");
const doc_legal_tos = createItem("Terms of Service", "document", [], "ðŸ“„", "/docs/company/legal/tos", Scale);
const doc_folder_legal_nda = createItem("NDAs", "folder", [Object.keys(doc_legal_nda_vendor)[0]], "ðŸ¤«");
const doc_finance_report_q1 = createItem("Q1 Financial Report", "document", [], "ðŸ“ˆ", "/docs/company/finance/q1-report", FilePieChart);
const doc_finance_report_q2 = createItem("Q2 Financial Report", "document", [], "ðŸ“‰", "/docs/company/finance/q2-report", FilePieChart);
const doc_folder_finance_guides = createItem("Guides", "folder", [Object.keys(doc_finance_expense_guide)[0]], "ðŸ“–");
const doc_meetings_q3_kickoff = createItem("Q3 Kickoff Meeting", "document", [Object.keys(doc_meetings_q3_kickoff_slides)[0]], "ðŸš€", "/docs/meetings/q3-2024/kickoff");
const doc_meetings_product_sync_notes = createItem("Product Sync Notes", "document", [], "ðŸ—£ï¸", "/docs/meetings/product-syncs/notes");
const doc_meetings_eng_sync_notes = createItem("Engineering Sync Notes", "document", [], "âš™ï¸", "/docs/meetings/eng-syncs/notes");

// Level 1 Items - No change needed here
const doc_folder_phoenix_design = createItem("Design", "folder", [Object.keys(doc_folder_phoenix_proto)[0], Object.keys(doc_phoenix_design_system)[0]], "ðŸŽ¨", undefined, Paintbrush);
const doc_folder_phoenix_specs = createItem("Specifications", "folder", [Object.keys(doc_phoenix_spec_core)[0], Object.keys(doc_phoenix_spec_arch)[0]], "ðŸ“");
const doc_folder_phoenix_research = createItem("User Research", "folder", [Object.keys(doc_folder_phoenix_interviews)[0], Object.keys(doc_folder_phoenix_research_sum)[0]], "ðŸ§‘â€ðŸ”¬", undefined, Users);
const doc_folder_chimera_backend = createItem("Backend", "folder", [Object.keys(doc_chimera_backend_schema)[0]], "âš™ï¸");
const doc_folder_chimera_frontend = createItem("Frontend", "folder", [Object.keys(doc_chimera_frontend_setup)[0]], "ðŸ’»");
const doc_folder_hr = createItem("Human Resources", "folder", [Object.keys(doc_hr_onboarding)[0], Object.keys(doc_folder_hr_policies)[0]], "ðŸ‘¥", undefined, Users);
const doc_folder_legal = createItem("Legal", "folder", [Object.keys(doc_legal_tos)[0], Object.keys(doc_folder_legal_nda)[0]], "âš–ï¸", undefined, Scale);
const doc_folder_finance = createItem("Finance", "folder", [Object.keys(doc_finance_report_q1)[0], Object.keys(doc_finance_report_q2)[0], Object.keys(doc_folder_finance_guides)[0]], "ðŸ’°", undefined, FilePieChart);
const doc_folder_meetings_q3 = createItem("Q3 2024", "folder", [Object.keys(doc_meetings_q3_kickoff)[0]], "ðŸ“…");
const doc_folder_meetings_product = createItem("Product Syncs", "folder", [Object.keys(doc_meetings_product_sync_notes)[0]], "ðŸŽ¯");
const doc_folder_meetings_eng = createItem("Eng Syncs", "folder", [Object.keys(doc_meetings_eng_sync_notes)[0]], "ðŸ› ï¸");

// *** FIX STARTS HERE ***

// Create Level 1 Project Folders first
const doc_subfolder_phoenix = createItem("Project Phoenix", "folder", [Object.keys(doc_folder_phoenix_specs)[0], Object.keys(doc_folder_phoenix_design)[0], Object.keys(doc_folder_phoenix_research)[0]], "ðŸ”¥", undefined, Briefcase);
const doc_subfolder_phoenix_id = Object.keys(doc_subfolder_phoenix)[0];

const doc_subfolder_chimera = createItem("Project Chimera", "folder", [Object.keys(doc_folder_chimera_api)[0], Object.keys(doc_folder_chimera_backend)[0], Object.keys(doc_folder_chimera_frontend)[0]], "ðŸ‰", undefined, Briefcase);
const doc_subfolder_chimera_id = Object.keys(doc_subfolder_chimera)[0];

// Level 0 Items (Under Root) - Now use the IDs from above
const doc_folder_projects = createItem("Projects", "folder", [
    doc_subfolder_phoenix_id, // Use the ID
    doc_subfolder_chimera_id, // Use the ID
], "ðŸš€", undefined, Briefcase);

const doc_folder_company = createItem("Company Docs", "folder", [Object.keys(doc_folder_hr)[0], Object.keys(doc_folder_legal)[0], Object.keys(doc_folder_finance)[0]], "ðŸ¢");
const doc_folder_meetings = createItem("Meetings", "folder", [Object.keys(doc_folder_meetings_q3)[0], Object.keys(doc_folder_meetings_product)[0], Object.keys(doc_folder_meetings_eng)[0]], "ðŸ—“ï¸", undefined, CalendarDays);
const doc_roadmap = createItem("Roadmap Q4 2024", "document", [], "ðŸ—ºï¸", "/docs/roadmap-q4", Goal);
const doc_quick_notes = createItem("Quick Notes", "document", [], "âœï¸", "/docs/quick-notes");

export const initialDocumentItems: TreeItems = {
    root: {
        index: "root",
        data: { name: "Documents Root", type: "folder" },
        isFolder: true,
        children: [
            Object.keys(doc_folder_projects)[0], // Use the ID
            Object.keys(doc_folder_company)[0],
            Object.keys(doc_folder_meetings)[0],
            Object.keys(doc_roadmap)[0],
            Object.keys(doc_quick_notes)[0],
        ]
    },
    // Spread all created items - including the subfolders created above
    ...doc_folder_projects,
    ...doc_subfolder_phoenix, // Spread the intermediate folder
    ...doc_subfolder_chimera, // Spread the intermediate folder
    ...doc_folder_phoenix_specs, ...doc_folder_phoenix_design, ...doc_folder_phoenix_research,
    ...doc_folder_phoenix_proto, ...doc_phoenix_design_system, ...doc_phoenix_spec_core, ...doc_phoenix_spec_arch,
    ...doc_folder_phoenix_interviews, ...doc_folder_phoenix_research_sum, ...doc_phoenix_proto_v1, ...doc_phoenix_proto_v2, ...doc_phoenix_interviews_raw,
    ...doc_folder_chimera_api, ...doc_folder_chimera_backend, ...doc_folder_chimera_frontend,
    ...doc_chimera_api_auth, ...doc_chimera_api_users, ...doc_chimera_backend_schema, ...doc_chimera_frontend_setup,
    ...doc_folder_company, ...doc_folder_hr, ...doc_folder_legal, ...doc_folder_finance,
    ...doc_hr_onboarding, ...doc_folder_hr_policies, ...doc_hr_policy_pto,
    ...doc_legal_tos, ...doc_folder_legal_nda, ...doc_legal_nda_vendor,
    ...doc_finance_report_q1, ...doc_finance_report_q2, ...doc_folder_finance_guides, ...doc_finance_expense_guide,
    ...doc_folder_meetings, ...doc_folder_meetings_q3, ...doc_folder_meetings_product, ...doc_folder_meetings_eng,
    ...doc_meetings_q3_kickoff, ...doc_meetings_q3_kickoff_slides, ...doc_meetings_product_sync_notes, ...doc_meetings_eng_sync_notes,
    ...doc_roadmap, ...doc_quick_notes,
};


// --- MOCK LIBRARY DATA ---

// Level 3 Items - No change needed
const lib_comp_select_option = createItem("Select Option", "library-item", [], "", "/library/components/select-option", undefined);
const lib_hook_fetch_instance = createItem("useFetchInstance (Internal)", "library-item", [], "", "/library/hooks/fetch-instance", undefined);
const lib_token_color_primary_shades = createItem("Primary Shades", "library-item", [], "", "/library/tokens/colors/primary-shades", undefined);

// Level 2 Items - No change needed
const lib_comp_button_variants = createItem("Button Variants", "library-item", [], "âœ¨", "/library/components/button-variants");
const lib_comp_input_types = createItem("Input Types", "library-item", [], "âŒ¨ï¸", "/library/components/input-types");
const lib_folder_comp_select = createItem("Select Components", "folder", [Object.keys(lib_comp_select_option)[0]], "ðŸ”½");
const lib_comp_card_example = createItem("Card Example", "library-item", [], "ðŸ–¼ï¸", "/library/components/card-example");
const lib_comp_alert_styles = createItem("Alert Styles", "library-item", [], "ðŸŽ¨", "/library/components/alert-styles");
const lib_comp_spinner_sizes = createItem("Spinner Sizes", "library-item", [], "âš™ï¸", "/library/components/spinner-sizes");
const lib_hook_storage_local = createItem("useLocalStorage", "library-item", [], "ðŸ’¾", "/library/hooks/storage/local");
const lib_hook_storage_session = createItem("useSessionStorage", "library-item", [], "â³", "/library/hooks/storage/session");
const lib_folder_hook_fetch = createItem("Data Fetching", "folder", [Object.keys(lib_hook_fetch_instance)[0]], "â˜ï¸");
const lib_hook_ui_debounce = createItem("useDebounce", "library-item", [], "â³", "/library/hooks/ui/debounce");
const lib_hook_ui_throttle = createItem("useThrottle", "library-item", [], "â±ï¸", "/library/hooks/ui/throttle");
const lib_hook_auth_context = createItem("useAuthContext", "library-item", [], "ðŸ”’", "/library/hooks/auth/context", ShieldCheck);
const lib_util_date_format = createItem("formatDate", "library-item", [], "ðŸ“…", "/library/utils/date/format");
const lib_util_string_slugify = createItem("slugify", "library-item", [], "ðŸ”—", "/library/utils/string/slugify");
const lib_util_validation_email = createItem("validateEmail", "library-item", [], "ðŸ“§", "/library/utils/validation/email");
const lib_folder_token_colors = createItem("Colors", "folder", [Object.keys(lib_token_color_primary_shades)[0]], " C", undefined, Palette);
const lib_token_typography_scale = createItem("Typographic Scale", "library-item", [], " Aa", "/library/tokens/typography/scale");
const lib_token_spacing_units = createItem("Spacing Units", "library-item", [], "ðŸ“", "/library/tokens/spacing/units");


// *** FIX STARTS HERE ***

// Create Level 2 Form items first
const lib_item_button = createItem("Button", "library-item", [Object.keys(lib_comp_button_variants)[0]], "ðŸ”˜", "/library/components/button", Code2);
const lib_item_button_id = Object.keys(lib_item_button)[0];
const lib_item_input = createItem("Input", "library-item", [Object.keys(lib_comp_input_types)[0]], "âŒ¨ï¸", "/library/components/input", Code2);
const lib_item_input_id = Object.keys(lib_item_input)[0];
const lib_item_checkbox = createItem("Checkbox", "library-item", [], "â˜‘ï¸", "/library/components/checkbox", Code2);
const lib_item_checkbox_id = Object.keys(lib_item_checkbox)[0];

// Create Level 2 Layout items first
const lib_item_card = createItem("Card", "library-item", [Object.keys(lib_comp_card_example)[0]], "ðŸƒ", "/library/components/card", Code2);
const lib_item_card_id = Object.keys(lib_item_card)[0];
const lib_item_grid = createItem("Grid", "library-item", [], "â–¦", "/library/components/grid", Code2);
const lib_item_grid_id = Object.keys(lib_item_grid)[0];

// Create Level 2 Feedback items first
const lib_item_alert = createItem("Alert", "library-item", [Object.keys(lib_comp_alert_styles)[0]], "âš ï¸", "/library/components/alert", Code2);
const lib_item_alert_id = Object.keys(lib_item_alert)[0];
const lib_item_spinner = createItem("Spinner", "library-item", [Object.keys(lib_comp_spinner_sizes)[0]], "â³", "/library/components/spinner", Code2);
const lib_item_spinner_id = Object.keys(lib_item_spinner)[0];

// Level 1 Items - Use IDs from above
const lib_folder_comp_forms = createItem("Forms", "folder", [
    lib_item_button_id,
    lib_item_input_id,
    Object.keys(lib_folder_comp_select)[0],
    lib_item_checkbox_id,
], "ðŸ“");
const lib_folder_comp_layout = createItem("Layout", "folder", [
    lib_item_card_id,
    lib_item_grid_id,
], "ðŸ“");
const lib_folder_comp_feedback = createItem("Feedback", "folder", [
    lib_item_alert_id,
    lib_item_spinner_id,
], "ðŸ“¢");
const lib_folder_hook_storage = createItem("Storage", "folder", [Object.keys(lib_hook_storage_local)[0], Object.keys(lib_hook_storage_session)[0]], "ðŸ’¾", undefined, Database);
const lib_folder_hook_ui = createItem("UI Helpers", "folder", [Object.keys(lib_hook_ui_debounce)[0], Object.keys(lib_hook_ui_throttle)[0]], "âœ¨");
const lib_folder_hook_auth = createItem("Authentication", "folder", [Object.keys(lib_hook_auth_context)[0]], "ðŸ”", undefined, ShieldCheck);
const lib_folder_util_date = createItem("Date Utils", "folder", [Object.keys(lib_util_date_format)[0]], "ðŸ“…");
const lib_folder_util_string = createItem("String Utils", "folder", [Object.keys(lib_util_string_slugify)[0]], "âœ‚ï¸");
const lib_folder_util_validation = createItem("Validation", "folder", [Object.keys(lib_util_validation_email)[0]], "âœ”ï¸");
const lib_folder_token_typography = createItem("Typography", "folder", [Object.keys(lib_token_typography_scale)[0]], " T", undefined, Palette);
const lib_folder_token_spacing = createItem("Spacing", "folder", [Object.keys(lib_token_spacing_units)[0]], " S", undefined, Palette);

// Level 0 Items (Under Root) - Use IDs from above
const lib_folder_components = createItem("Components", "folder", [Object.keys(lib_folder_comp_forms)[0], Object.keys(lib_folder_comp_layout)[0], Object.keys(lib_folder_comp_feedback)[0]], "ðŸ§©", undefined, Code2);
const lib_folder_hooks = createItem("Hooks", "folder", [Object.keys(lib_folder_hook_storage)[0], Object.keys(lib_folder_hook_fetch)[0], Object.keys(lib_folder_hook_ui)[0], Object.keys(lib_folder_hook_auth)[0]], "âš“", undefined, FunctionSquare);
const lib_folder_utils = createItem("Utilities", "folder", [Object.keys(lib_folder_util_date)[0], Object.keys(lib_folder_util_string)[0], Object.keys(lib_folder_util_validation)[0]], "ðŸ”§", undefined, Wrench);
const lib_folder_tokens = createItem("Design Tokens", "folder", [Object.keys(lib_folder_token_colors)[0], Object.keys(lib_folder_token_typography)[0], Object.keys(lib_folder_token_spacing)[0]], "ðŸŽ¨", undefined, Palette);
const lib_contributing_guide = createItem("Contributing Guide", "library-item", [], "ðŸ¤", "/library/contributing", Lightbulb);

export const initialLibraryItems: TreeItems = {
    root: {
        index: "root",
        data: { name: "Library Root", type: "folder" },
        isFolder: true,
        children: [
            Object.keys(lib_folder_components)[0],
            Object.keys(lib_folder_hooks)[0],
            Object.keys(lib_folder_utils)[0],
            Object.keys(lib_folder_tokens)[0],
            Object.keys(lib_contributing_guide)[0],
        ]
    },
    // Spread all created items - including the intermediate items/folders
    ...lib_folder_components, ...lib_folder_hooks, ...lib_folder_utils, ...lib_folder_tokens, ...lib_contributing_guide,
    ...lib_folder_comp_forms, ...lib_folder_comp_layout, ...lib_folder_comp_feedback,
    ...lib_item_button, ...lib_comp_button_variants, // Spread item and its child
    ...lib_item_input, ...lib_comp_input_types, // Spread item and its child
    ...lib_folder_comp_select, ...lib_comp_select_option, // Spread folder and its child
    ...lib_item_checkbox,
    ...lib_item_card, ...lib_comp_card_example, // Spread item and its child
    ...lib_item_grid,
    ...lib_item_alert, ...lib_comp_alert_styles, // Spread item and its child
    ...lib_item_spinner, ...lib_comp_spinner_sizes, // Spread item and its child
    ...lib_folder_hook_storage, ...lib_folder_hook_fetch, ...lib_folder_hook_ui, ...lib_folder_hook_auth,
    ...lib_hook_storage_local, ...lib_hook_storage_session, ...lib_hook_fetch_instance, ...lib_hook_ui_debounce, ...lib_hook_ui_throttle, ...lib_hook_auth_context,
    ...lib_folder_util_date, ...lib_folder_util_string, ...lib_folder_util_validation,
    ...lib_util_date_format, ...lib_util_string_slugify, ...lib_util_validation_email,
    ...lib_folder_token_colors, ...lib_folder_token_typography, ...lib_folder_token_spacing,
    ...lib_token_color_primary_shades, ...lib_token_typography_scale, ...lib_token_spacing_units,
};

// *** FIX ENDS HERE ***
```

## File: src/lib/validations/auth.ts

```typescript
import { z } from "zod";

// Base email schema for reuse
const emailSchema = z.object({
    email: z
        .string()
        .min(1, { message: "Email is required" })
        .email({ message: "Must be a valid email address" }),
});

// Password validation with common requirements
const passwordSchema = z.object({
    password: z
        .string()
        .min(1, { message: "Password is required" })
        .min(8, { message: "Password must be at least 8 characters" })
        .regex(/[A-Z]/, { message: "Password must contain at least one uppercase letter" })
        .regex(/[a-z]/, { message: "Password must contain at least one lowercase letter" })
        .regex(/[0-9]/, { message: "Password must contain at least one number" }),
});

// Login schema combines email and password
export const loginSchema = emailSchema.extend({
    ...passwordSchema.shape,
});

export type LoginFormValues = z.infer<typeof loginSchema>;

// Registration schema adds name and password confirmation
export const registerSchema = emailSchema.extend({
    name: z.string().min(1, { message: "Name is required" }),
    ...passwordSchema.shape,
    confirmPassword: z.string().min(1, { message: "Please confirm your password" }),
}).refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match",
    path: ["confirmPassword"],
});

export type RegisterFormValues = z.infer<typeof registerSchema>;

// Forgot password just needs an email
export const forgotPasswordSchema = emailSchema;

export type ForgotPasswordFormValues = z.infer<typeof forgotPasswordSchema>;

// Reset password needs a new password and confirmation
export const resetPasswordSchema = passwordSchema.extend({
    confirmPassword: z.string().min(1, { message: "Please confirm your password" }),
}).refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match",
    path: ["confirmPassword"],
});

export type ResetPasswordFormValues = z.infer<typeof resetPasswordSchema>;
```

## File: src/lib/hooks/use-storage.ts

```typescript
import { useState, useEffect, useCallback } from 'react';
import localforage from 'localforage';

localforage.config({
    name: 'tanstack-forge',
    storeName: 'my-storage',
    description: 'Storage for my application'
});

/**
 * Hook for easy access to localforage with a React-friendly API
 * 
 * @param key - The storage key to use
 * @param initialValue - Default value if key doesn't exist in storage
 * @returns [storedValue, setValue, removeValue, error]
 */
export function useStorage<T>(
    key: string,
    initialValue: T
): [T, (value: T | ((val: T) => T)) => Promise<void>, () => Promise<void>, Error | null] {
    // State to store our value
    const [storedValue, setStoredValue] = useState<T>(initialValue);

    // State to track any errors
    const [error, setError] = useState<Error | null>(null);

    // Initialize: Read from localforage on mount
    useEffect(() => {
        const loadStoredValue = async () => {
            try {
                // Get from localforage
                const value = await localforage.getItem<T>(key);

                // Set state to either stored value or initial value
                setStoredValue(value !== null ? value : initialValue);
            } catch (err) {
                console.error(`Error reading from storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        };

        loadStoredValue();
    }, [key, initialValue]);

    // Define setter function
    const setValue = useCallback(
        async (value: T | ((val: T) => T)) => {
            try {
                // Allow value to be a function like React's setState
                const valueToStore =
                    value instanceof Function ? value(storedValue) : value;

                // Save to localforage
                await localforage.setItem(key, valueToStore);

                // Save state
                setStoredValue(valueToStore);
                setError(null);
            } catch (err) {
                console.error(`Error saving to storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        },
        [key, storedValue]
    );

    // Define remove function
    const removeValue = useCallback(
        async () => {
            try {
                // Remove from localforage
                await localforage.removeItem(key);

                // Reset to initial value
                setStoredValue(initialValue);
                setError(null);
            } catch (err) {
                console.error(`Error removing from storage for key "${key}":`, err);
                setError(err instanceof Error ? err : new Error(String(err)));
            }
        },
        [key, initialValue]
    );

    return [storedValue, setValue, removeValue, error];
}

/**
 * A simplified hook for cases where you only need to get data once
 * without subscribing to changes
 */
export async function getStoredValue<T>(key: string, defaultValue: T): Promise<T> {
    try {
        const value = await localforage.getItem<T>(key);
        return value !== null ? value : defaultValue;
    } catch (error) {
        console.error(`Error retrieving value for key "${key}":`, error);
        return defaultValue;
    }
}

/**
 * A utility function to set a value without hooks
 */
export async function setStoredValue<T>(key: string, value: T): Promise<void> {
    try {
        await localforage.setItem(key, value);
    } catch (error) {
        console.error(`Error setting value for key "${key}":`, error);
        throw error;
    }
}

/**
 * Example of creating a specialized version for specific data types
 */
export function useUserPreferences<T extends Record<string, any>>(
    userId: string,
    defaultPreferences: T
) {
    return useStorage<T>(`user_prefs_${userId}`, defaultPreferences);
}
```

## File: src/lib/hooks/use-theme.ts

```typescript
import { useState, useEffect } from "react";

const isClient = typeof window !== "undefined";

export function useTheme() {
    const [theme, setTheme] = useState("light"); // Default to light for SSR
    const [isDark, setIsDark] = useState(false); // Default to false for SSR

    // Initialize theme on component mount (client-side only)
    useEffect(() => {
        if (!isClient) return;

        // Check if dark mode is active
        const checkIsDark = () => {
            return (
                document.documentElement.classList.contains("dark") ||
                (!localStorage.theme &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            );
        };

        // Set initial states
        const initialIsDark = checkIsDark();
        setIsDark(initialIsDark);
        setTheme(initialIsDark ? "dark" : "light");

        // Also monitor for system preference changes
        const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
        const handleChange = () => {
            if (!localStorage.theme) {
                const newIsDark = mediaQuery.matches;
                setIsDark(newIsDark);
                setTheme(newIsDark ? "dark" : "light");
            }
        };

        mediaQuery.addEventListener("change", handleChange);
        return () => mediaQuery.removeEventListener("change", handleChange);
    }, []);

    // Toggle theme function
    const toggleTheme = () => {
        if (!isClient) return;

        const newTheme = theme === "dark" ? "light" : "dark";

        // Update DOM
        if (newTheme === "dark") {
            document.documentElement.classList.add("dark");
        } else {
            document.documentElement.classList.remove("dark");
        }

        // Save preference
        localStorage.theme = newTheme;

        // Update state
        setTheme(newTheme);
        setIsDark(newTheme === "dark");
    };

    return {
        theme,
        isDark,
        isLight: !isDark,
        toggleTheme,
    };
}
```

## File: src/lib/api/user.ts

```typescript
import { authClient } from "@app/auth/client";
import { useQuery } from "@tanstack/react-query";

export const sessionQueryKey = ["user", "session"] as const;

export const useSessionQuery = () => {
    return useQuery({
        queryKey: sessionQueryKey,
        queryFn: async () => {
            const { data, error } = await authClient.getSession({
                query: {
                    disableCookieCache: true,
                },
            });

            if (error) {
                throw new Error(error.message || "Failed to fetch session");
            }

            return data;
        },
        staleTime: Number.POSITIVE_INFINITY,
        refetchOnWindowFocus: false,
        retry: false,
    });
};

const listAccountQueryKey = ["user", "accounts"] as const;

export const useUserAccountsQuery = () => {
    return useQuery({
        queryKey: listAccountQueryKey,
        queryFn: async () => {
            const { data, error } = await authClient.listAccounts();

            if (error) {
                throw error;
            }

            return data;
        },
    });
};

```

## File: src/routes/__root.tsx

```tsx
import {
	HeadContent,
	Outlet,
	ScriptOnce,
	Scripts,
	createRootRouteWithContext,
} from "@tanstack/react-router";
import { TanStackRouterDevtools } from "@tanstack/react-router-devtools";
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
import { Toaster } from "@app/ui/components/sonner"

import { auth } from "@app/auth";
import { getWebRequest } from "@tanstack/react-start/server";
import { createServerFn } from "@tanstack/react-start";
import type { QueryClient } from "@tanstack/react-query";

import globalsCss from "@app/ui/globals.css?url";
import layoutCss from '@app/layout/style.css?url'

const getUser = createServerFn({ method: "GET" }).handler(async () => {
	const { headers } = getWebRequest()!;
	const session = await auth.api.getSession({ headers });

	return session?.user || null;
});

export const Route = createRootRouteWithContext<{
	queryClient: QueryClient;
	user: Awaited<ReturnType<typeof getUser>>;
}>()({
	beforeLoad: async ({ context }) => {
		const user = await context.queryClient.fetchQuery({
			queryKey: ["user"],
			queryFn: ({ signal }) => getUser({ signal }),
		});
		return { user };
	},
	head: () => ({
		meta: [
			{
				charSet: "utf-8",
			},
			{
				name: "viewport",
				content: "width=device-width, initial-scale=1",
			},
			{
				title: "TanStack Forge",
			},
		],
		links: [
			{
				rel: "stylesheet",
				href: globalsCss,
			},
			{
				rel: "stylesheet",
				href: layoutCss,
			},
		],
	}),
	component: () => (
		<RootDocument>
			<Outlet />
			<TanStackRouterDevtools />
			<ReactQueryDevtools initialIsOpen={false} position="right" />
			<Toaster />
		</RootDocument>
	),
});

function RootDocument({ children }: { children: React.ReactNode }) {

	return (
		<html lang="en" suppressHydrationWarning>
			<head>
				<HeadContent />
			</head>
			<body>
				<ScriptOnce>
					{`document.documentElement.classList.toggle(
					'dark',
					localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
					)`}
				</ScriptOnce>
				<div className="min-h-screen font-sans antialiased">
					{children}
				</div>
				<Scripts />
			</body>
		</html>
	);
}

```

## File: src/routes/(app)/settings.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import { useState } from 'react'
import {
    Bell,
    Lock,
    User,
    Shield,
    CreditCard,
    Globe,
    Moon,
    Save,
    Book,
    Blocks,
    FileText,
    LineChart,
    Mail,
    PersonStanding,
    Key,
    Clipboard,
    AlertTriangle
} from 'lucide-react'

import { Button } from '@app/ui/components/button'
import { Input } from '@app/ui/components/input'
import { Label } from '@app/ui/components/label'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@app/ui/components/tabs'
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@app/ui/components/card'
import { Switch } from '@app/ui/components/switch'
import { Avatar, AvatarFallback, AvatarImage } from '@app/ui/components/avatar'
import { Separator } from '@app/ui/components/separator'
import { Badge } from '@app/ui/components/badge'
import {
    Select,
    SelectContent,
    SelectItem,
    SelectTrigger,
    SelectValue,
} from '@app/ui/components/select'
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@app/ui/components/popover'
import {
    Command,
    CommandEmpty,
    CommandGroup,
    CommandInput,
    CommandItem,
} from '@app/ui/components/command'
import { Checkbox } from '@app/ui/components/checkbox'
import { Textarea } from '@app/ui/components/textarea'
import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
    AlertDialogTrigger,
} from '@app/ui/components/alert-dialog'
import { Alert, AlertDescription, AlertTitle } from '@app/ui/components/alert'

export const Route = createFileRoute('/(app)/settings')({
    component: SettingsComponent,
})

// Mock data
const institutions = [
    { value: 'stanford', label: 'Stanford University' },
    { value: 'mit', label: 'Massachusetts Institute of Technology' },
    { value: 'harvard', label: 'Harvard University' },
    { value: 'oxford', label: 'University of Oxford' },
    { value: 'cambridge', label: 'University of Cambridge' },
    { value: 'berkeley', label: 'UC Berkeley' },
]

const researchFields = [
    { value: 'ai', label: 'Artificial Intelligence' },
    { value: 'biology', label: 'Biology' },
    { value: 'chemistry', label: 'Chemistry' },
    { value: 'cs', label: 'Computer Science' },
    { value: 'physics', label: 'Physics' },
    { value: 'psychology', label: 'Psychology' },
]

function SettingsComponent() {
    const [, setActiveTab] = useState('account')
    const [institutionOpen, setInstitutionOpen] = useState(false)
    const [institution, setInstitution] = useState('stanford')
    const [researchFieldOpen, setResearchFieldOpen] = useState(false)
    const [researchField, setResearchField] = useState('ai')

    const tabs = [
        { id: 'account', icon: User, label: 'Account' },
        { id: 'password', icon: Lock, label: 'Password' },
        { id: 'notifications', icon: Bell, label: 'Notifications' },
        { id: 'security', icon: Shield, label: 'Security' },
        { id: 'billing', icon: CreditCard, label: 'Billing' },
        { id: 'research', icon: Book, label: 'Research' },
        { id: 'integrations', icon: Blocks, label: 'Integrations' },
        { id: 'preferences', icon: Globe, label: 'Preferences' },
    ]

    return (
        <div className="container mx-auto py-6 space-y-8 max-w-6xl p-4">
            <div className="flex items-center justify-between">
                <h1 className="text-3xl font-bold tracking-tight">Settings</h1>
                <Button>
                    <Save className="mr-2 h-4 w-4" />
                    Save Changes
                </Button>
            </div>

            <Tabs defaultValue="account" className="w-full" onValueChange={setActiveTab}>
                <div className="flex overflow-x-auto pb-2 mb-4">
                    <TabsList className="flex h-auto p-1 bg-muted/30">
                        {tabs.map(({ id, icon: Icon, label }) => (
                            <TabsTrigger
                                key={id}
                                value={id}
                                className="flex items-center gap-2 px-4 py-2.5 data-[state=active]:bg-background"
                            >
                                <Icon className="h-4 w-4" />
                                <span>{label}</span>
                            </TabsTrigger>
                        ))}
                    </TabsList>
                </div>

                {/* Account Tab */}
                <TabsContent value="account" className="space-y-6">
                    {/* Profile Card */}
                    <Card>
                        <CardHeader>
                            <CardTitle>Profile Information</CardTitle>
                            <CardDescription>Update your personal details and public profile information</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            {/* Profile picture */}
                            <div className="flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4 items-start sm:items-center">
                                <Avatar className="h-20 w-20">
                                    <AvatarImage src="/placeholder-avatar.jpg" alt="Profile" />
                                    <AvatarFallback>JD</AvatarFallback>
                                </Avatar>
                                <div className="flex flex-col space-y-2">
                                    <div className="flex space-x-2">
                                        <Button variant="secondary" size="sm">Change</Button>
                                        <Button variant="outline" size="sm">Remove</Button>
                                    </div>
                                    <p className="text-sm text-muted-foreground">
                                        Recommended: Square JPG, PNG, or GIF, at least 400x400 pixels.
                                    </p>
                                </div>
                            </div>
                            <Separator />

                            <div className="grid gap-5 md:grid-cols-2">
                                <div className="space-y-2">
                                    <Label htmlFor="firstName">First Name</Label>
                                    <Input id="firstName" defaultValue="John" />
                                </div>
                                <div className="space-y-2">
                                    <Label htmlFor="lastName">Last Name</Label>
                                    <Input id="lastName" defaultValue="Doe" />
                                </div>
                                <div className="space-y-2">
                                    <Label htmlFor="email">Email Address</Label>
                                    <Input id="email" type="email" defaultValue="john.doe@research.edu" />
                                </div>
                                <div className="space-y-2">
                                    <Label htmlFor="phone">Phone Number</Label>
                                    <Input id="phone" type="tel" defaultValue="+1 (555) 123-4567" />
                                </div>
                            </div>

                            <div className="space-y-2">
                                <Label htmlFor="bio">Professional Bio</Label>
                                <Textarea
                                    id="bio"
                                    placeholder="Write a short bio..."
                                    defaultValue="Researcher in AI with focus on natural language processing and computational linguistics. Passionate about educational technology and making research accessible."
                                    className="min-h-[120px]"
                                />
                                <p className="text-sm text-muted-foreground">This will be displayed on your public profile.</p>
                            </div>
                        </CardContent>
                        <CardFooter className="flex justify-between border-t pt-5">
                            <Button variant="outline">Cancel</Button>
                            <Button>Save Profile</Button>
                        </CardFooter>
                    </Card>

                    {/* Academic Information */}
                    <Card>
                        <CardHeader>
                            <CardTitle>Academic Information</CardTitle>
                            <CardDescription>Your university affiliation and research details</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div className="grid gap-5 md:grid-cols-2">
                                <div className="space-y-2">
                                    <Label>Institution</Label>
                                    <Popover open={institutionOpen} onOpenChange={setInstitutionOpen}>
                                        <PopoverTrigger asChild>
                                            <Button
                                                variant="outline"
                                                role="combobox"
                                                aria-expanded={institutionOpen}
                                                className="w-full justify-between"
                                            >
                                                {institutions.find(i => i.value === institution)?.label || "Select institution..."}
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    width="24"
                                                    height="24"
                                                    viewBox="0 0 24 24"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    strokeWidth="2"
                                                    strokeLinecap="round"
                                                    strokeLinejoin="round"
                                                    className="ml-2 h-4 w-4 shrink-0 opacity-50"
                                                >
                                                    <path d="m6 9 6 6 6-6" />
                                                </svg>
                                            </Button>
                                        </PopoverTrigger>
                                        <PopoverContent className="w-full p-0">
                                            <Command>
                                                <CommandInput placeholder="Search institutions..." />
                                                <CommandEmpty>No institution found.</CommandEmpty>
                                                <CommandGroup>
                                                    {institutions.map((inst) => (
                                                        <CommandItem
                                                            key={inst.value}
                                                            value={inst.value}
                                                            onSelect={(currentValue: string) => {
                                                                setInstitution(currentValue)
                                                                setInstitutionOpen(false)
                                                            }}
                                                        >
                                                            <svg
                                                                xmlns="http://www.w3.org/2000/svg"
                                                                width="24"
                                                                height="24"
                                                                viewBox="0 0 24 24"
                                                                fill="none"
                                                                stroke="currentColor"
                                                                strokeWidth="2"
                                                                strokeLinecap="round"
                                                                strokeLinejoin="round"
                                                                className={`mr-2 h-4 w-4 ${institution === inst.value ? "opacity-100" : "opacity-0"
                                                                    }`}
                                                            >
                                                                <path d="M20 6 9 17l-5-5" />
                                                            </svg>
                                                            {inst.label}
                                                        </CommandItem>
                                                    ))}
                                                </CommandGroup>
                                            </Command>
                                        </PopoverContent>
                                    </Popover>
                                </div>

                                <div className="space-y-2">
                                    <Label>Research Field</Label>
                                    <Popover open={researchFieldOpen} onOpenChange={setResearchFieldOpen}>
                                        <PopoverTrigger asChild>
                                            <Button
                                                variant="outline"
                                                role="combobox"
                                                aria-expanded={researchFieldOpen}
                                                className="w-full justify-between"
                                            >
                                                {researchFields.find(f => f.value === researchField)?.label || "Select field..."}
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    width="24"
                                                    height="24"
                                                    viewBox="0 0 24 24"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    strokeWidth="2"
                                                    strokeLinecap="round"
                                                    strokeLinejoin="round"
                                                    className="ml-2 h-4 w-4 shrink-0 opacity-50"
                                                >
                                                    <path d="m6 9 6 6 6-6" />
                                                </svg>
                                            </Button>
                                        </PopoverTrigger>
                                        <PopoverContent className="w-full p-0">
                                            <Command>
                                                <CommandInput placeholder="Search fields..." />
                                                <CommandEmpty>No field found.</CommandEmpty>
                                                <CommandGroup>
                                                    {researchFields.map((field) => (
                                                        <CommandItem
                                                            key={field.value}
                                                            value={field.value}
                                                            onSelect={(currentValue: string) => {
                                                                setResearchField(currentValue)
                                                                setResearchFieldOpen(false)
                                                            }}
                                                        >
                                                            <svg
                                                                xmlns="http://www.w3.org/2000/svg"
                                                                width="24"
                                                                height="24"
                                                                viewBox="0 0 24 24"
                                                                fill="none"
                                                                stroke="currentColor"
                                                                strokeWidth="2"
                                                                strokeLinecap="round"
                                                                strokeLinejoin="round"
                                                                className={`mr-2 h-4 w-4 ${researchField === field.value ? "opacity-100" : "opacity-0"
                                                                    }`}
                                                            >
                                                                <path d="M20 6 9 17l-5-5" />
                                                            </svg>
                                                            {field.label}
                                                        </CommandItem>
                                                    ))}
                                                </CommandGroup>
                                            </Command>
                                        </PopoverContent>
                                    </Popover>
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="department">Department</Label>
                                    <Input id="department" defaultValue="Computer Science" />
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="role">Academic Role</Label>
                                    <Select defaultValue="professor">
                                        <SelectTrigger>
                                            <SelectValue placeholder="Select role" />
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem value="student">Student</SelectItem>
                                            <SelectItem value="phd">PhD Candidate</SelectItem>
                                            <SelectItem value="researcher">Researcher</SelectItem>
                                            <SelectItem value="professor">Professor</SelectItem>
                                            <SelectItem value="other">Other</SelectItem>
                                        </SelectContent>
                                    </Select>
                                </div>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5 flex justify-between">
                            <Button variant="outline">Cancel</Button>
                            <Button>Save Academic Info</Button>
                        </CardFooter>
                    </Card>

                    {/* Social Profiles */}
                    <Card>
                        <CardHeader>
                            <CardTitle>Social & Professional Profiles</CardTitle>
                            <CardDescription>Link your professional and social accounts
                            </CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-4">
                            <div className="grid gap-4">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                                        <div>
                                            <p className="text-sm font-medium">LinkedIn</p>
                                            <p className="text-xs text-muted-foreground">Connect your professional network</p>
                                        </div>
                                    </div>
                                    <Button variant="outline" size="sm">Connect</Button>
                                </div>
                                <Separator />
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
                                        <div>
                                            <p className="text-sm font-medium">GitHub</p>
                                            <p className="text-xs text-muted-foreground">Link your GitHub account</p>
                                        </div>
                                    </div>
                                    <Button variant="outline" size="sm" className="text-green-600 bg-green-50">Connected</Button>
                                </div>
                                <Separator />
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><circle cx="17.5" cy="6.5" r="1.5"></circle></svg>
                                        <div>
                                            <p className="text-sm font-medium">Instagram</p>
                                            <p className="text-xs text-muted-foreground">Share your research visually</p>
                                        </div>
                                    </div>
                                    <Button variant="outline" size="sm">Connect</Button>
                                </div>
                                <Separator />
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <FileText className="h-5 w-5" />
                                        <div>
                                            <p className="text-sm font-medium">Google Scholar</p>
                                            <p className="text-xs text-muted-foreground">Sync your publications</p>
                                        </div>
                                    </div>
                                    <Button variant="outline" size="sm">Connect</Button>
                                </div>
                                <Separator />
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg>
                                        <div>
                                            <p className="text-sm font-medium">Twitter / X</p>
                                            <p className="text-xs text-muted-foreground">Connect for academic discussions</p>
                                        </div>
                                    </div>
                                    <Button variant="outline" size="sm">Connect</Button>
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </TabsContent>

                {/* Password Tab */}
                <TabsContent value="password" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Change Password</CardTitle>
                            <CardDescription>Update your account password securely</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-4">
                            <div className="space-y-2">
                                <Label htmlFor="current-password">Current Password</Label>
                                <Input id="current-password" type="password" />
                            </div>
                            <div className="space-y-2">
                                <Label htmlFor="new-password">New Password</Label>
                                <Input id="new-password" type="password" />
                            </div>
                            <div className="space-y-2">
                                <Label htmlFor="confirm-password">Confirm New Password</Label>
                                <Input id="confirm-password" type="password" />
                            </div>

                            <div className="pt-2">
                                <p className="text-sm font-medium mb-2">Password Requirements:</p>
                                <ul className="space-y-1 text-sm text-muted-foreground">
                                    <li className="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2 text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                        At least 10 characters
                                    </li>
                                    <li className="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2 text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                        At least one uppercase letter
                                    </li>
                                    <li className="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2 text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                        At least one number
                                    </li>
                                    <li className="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2 text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                        At least one special character
                                    </li>
                                </ul>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5">
                            <Button>Update Password</Button>
                        </CardFooter>
                    </Card>

                    <Card>
                        <CardHeader>
                            <CardTitle>Two-Factor Authentication</CardTitle>
                            <CardDescription>Add an extra layer of security to your account</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="font-medium">Two-Factor Authentication</p>
                                    <p className="text-sm text-muted-foreground">Protect your account with 2FA security.</p>
                                </div>
                                <Switch defaultChecked={true} />
                            </div>
                            <Separator />
                            <div>
                                <p className="font-medium mb-2">Recovery Methods</p>
                                <div className="space-y-2">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <Mail className="h-4 w-4" />
                                            <p className="text-sm">Email to j*****e@research.edu</p>
                                        </div>
                                        <Button variant="ghost" size="sm">Change</Button>
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <Key className="h-4 w-4" />
                                            <p className="text-sm">Recovery keys</p>
                                        </div>
                                        <Button variant="ghost" size="sm">View</Button>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5">
                            <Button variant="outline">Update Recovery Methods</Button>
                        </CardFooter>
                    </Card>
                </TabsContent>

                {/* Notifications Tab */}
                <TabsContent value="notifications" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Notification Preferences</CardTitle>
                            <CardDescription>Control how we communicate with you</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div>
                                <h4 className="text-sm font-medium mb-3">Email Notifications</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="email-research">Research Updates</Label>
                                            <p className="text-sm text-muted-foreground">Receive notifications about related research in your field</p>
                                        </div>
                                        <Switch id="email-research" defaultChecked={true} />
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="email-collab">Collaboration Requests</Label>
                                            <p className="text-sm text-muted-foreground">Get notified when someone invites you to collaborate</p>
                                        </div>
                                        <Switch id="email-collab" defaultChecked={true} />
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="email-mentions">Mentions & Comments</Label>
                                            <p className="text-sm text-muted-foreground">Receive notifications when you're mentioned or your work is commented on</p>
                                        </div>
                                        <Switch id="email-mentions" defaultChecked={true} />
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="email-newsletter">Newsletter & Updates</Label>
                                            <p className="text-sm text-muted-foreground">Receive our monthly newsletter and product updates</p>
                                        </div>
                                        <Switch id="email-newsletter" defaultChecked={false} />
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h4 className="text-sm font-medium mb-3">Platform Notifications</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="push-all">Push Notifications</Label>
                                            <p className="text-sm text-muted-foreground">Receive notifications on your device</p>
                                        </div>
                                        <Switch id="push-all" defaultChecked={true} />
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="desktop">Desktop Notifications</Label>
                                            <p className="text-sm text-muted-foreground">Show notifications in your browser</p>
                                        </div>
                                        <Switch id="desktop" defaultChecked={true} />
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5">
                            <Button>Save Notification Settings</Button>
                        </CardFooter>
                    </Card>
                </TabsContent>

                {/* Security Tab */}
                <TabsContent value="security" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Security Settings</CardTitle>
                            <CardDescription>Manage your account security preferences</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div>
                                <h4 className="text-sm font-medium mb-3">Login Security</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label>Session Timeout</Label>
                                            <p className="text-sm text-muted-foreground">Automatically log out after a period of inactivity</p>
                                        </div>
                                        <Select defaultValue="30">
                                            <SelectTrigger className="w-36">
                                                <SelectValue placeholder="Select timeout" />
                                            </SelectTrigger>
                                            <SelectContent>
                                                <SelectItem value="15">15 minutes</SelectItem>
                                                <SelectItem value="30">30 minutes</SelectItem>
                                                <SelectItem value="60">1 hour</SelectItem>
                                                <SelectItem value="120">2 hours</SelectItem>
                                                <SelectItem value="never">Never</SelectItem>
                                            </SelectContent>
                                        </Select>
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="login-alert">Login Alerts</Label>
                                            <p className="text-sm text-muted-foreground">Get notified about new login attempts</p>
                                        </div>
                                        <Switch id="login-alert" defaultChecked={true} />
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label htmlFor="trusted-devices">Trusted Devices</Label>
                                            <p className="text-sm text-muted-foreground">Manage devices that can access your account</p>
                                        </div>
                                        <Button variant="outline" size="sm">
                                            Manage
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-2"><path d="m9 18 6-6-6-6" /></svg>
                                        </Button>
                                    </div>
                                </div>
                            </div>

                            <Alert variant="destructive">
                                <AlertTriangle className="h-4 w-4" />
                                <AlertTitle>Important Security Notice</AlertTitle>
                                <AlertDescription>
                                    For your security, we recommend enabling two-factor authentication on your account.
                                </AlertDescription>
                            </Alert>

                            <div>
                                <h4 className="text-sm font-medium mb-3">Access Management</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label>API Key Access</Label>
                                            <p className="text-sm text-muted-foreground">Manage API keys for programmatic access</p>
                                        </div>
                                        <Button variant="outline" size="sm">
                                            Manage Keys
                                        </Button>
                                    </div>
                                    <Separator />
                                    <div className="flex items-center justify-between">
                                        <div className="space-y-0.5">
                                            <Label>App Authorizations</Label>
                                            <p className="text-sm text-muted-foreground">Manage third-party applications with access to your account</p>
                                        </div>
                                        <Button variant="outline" size="sm">
                                            View Apps
                                        </Button>
                                    </div>
                                </div>
                            </div>

                            <AlertDialog>
                                <AlertDialogTrigger asChild>
                                    <Button variant="destructive">Delete Account</Button>
                                </AlertDialogTrigger>
                                <AlertDialogContent>
                                    <AlertDialogHeader>
                                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
                                        <AlertDialogDescription>
                                            This action cannot be undone. This will permanently delete your account
                                            and remove all your data from our servers.
                                        </AlertDialogDescription>
                                    </AlertDialogHeader>
                                    <AlertDialogFooter>
                                        <AlertDialogCancel>Cancel</AlertDialogCancel>
                                        <AlertDialogAction className="bg-destructive text-destructive-foreground">
                                            Delete Account
                                        </AlertDialogAction>
                                    </AlertDialogFooter>
                                </AlertDialogContent>
                            </AlertDialog>
                        </CardContent>
                    </Card>
                </TabsContent>

                {/* Billing Tab */}
                <TabsContent value="billing" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Subscription Plan</CardTitle>
                            <CardDescription>Manage your subscription and billing information</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div className="rounded-lg border p-4 bg-muted/20">
                                <div className="flex items-start justify-between">
                                    <div>
                                        <Badge className="bg-primary/20 text-primary hover:bg-primary/20 mb-2">Current Plan</Badge>
                                        <h3 className="text-lg font-semibold">Research Pro</h3>
                                        <p className="text-muted-foreground text-sm mt-1">
                                            $29.99/month â€¢ Renews on April 15, 2025
                                        </p>
                                        <ul className="mt-3 space-y-1 text-sm">
                                            <li className="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                                Unlimited projects and collaborators
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                                50GB storage for research data
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                                Advanced analytics and visualizations
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500"><path d="M20 6 9 17l-5-5" /></svg>
                                                Publication-ready exports
                                            </li>
                                        </ul>
                                    </div>
                                    <div className="flex flex-col items-end gap-2">
                                        <Button variant="outline" size="sm">Change Plan</Button>
                                        <Button variant="ghost" size="sm" className="text-destructive hover:text-destructive">
                                            Cancel Subscription
                                        </Button>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h4 className="text-sm font-medium mb-3">Payment Method</h4>
                                <div className="flex items-center justify-between p-4 border rounded-lg">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-muted rounded p-1 w-12 h-8 flex items-center justify-center">
                                            <CreditCard className="h-5 w-5" />
                                        </div>
                                        <div>
                                            <p className="font-medium">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 4242</p>
                                            <p className="text-sm text-muted-foreground">Expires 09/2026</p>
                                        </div>
                                    </div>
                                    <Button variant="ghost" size="sm">Edit</Button>
                                </div>
                            </div>

                            <div>
                                <h4 className="text-sm font-medium mb-3">Billing History</h4>
                                <div className="border rounded-lg overflow-hidden">
                                    <div className="grid grid-cols-4 gap-4 p-3 bg-muted/30 text-sm font-medium">
                                        <div>Date</div>
                                        <div>Description</div>
                                        <div>Amount</div>
                                        <div className="text-right">Invoice</div>
                                    </div>
                                    <div className="divide-y">
                                        <div className="grid grid-cols-4 gap-4 p-3 text-sm items-center">
                                            <div>Mar 15, 2025</div>
                                            <div>Research Pro - Monthly</div>
                                            <div>$29.99</div>
                                            <div className="text-right">
                                                <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                                                    <Clipboard className="h-4 w-4" />
                                                </Button>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-4 gap-4 p-3 text-sm items-center">
                                            <div>Feb 15, 2025</div>
                                            <div>Research Pro - Monthly</div>
                                            <div>$29.99</div>
                                            <div className="text-right">
                                                <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                                                    <Clipboard className="h-4 w-4" />
                                                </Button>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-4 gap-4 p-3 text-sm items-center">
                                            <div>Jan 15, 2025</div>
                                            <div>Research Pro - Monthly</div>
                                            <div>$29.99</div>
                                            <div className="text-right">
                                                <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                                                    <Clipboard className="h-4 w-4" />
                                                </Button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </TabsContent>

                {/* Research Tab */}
                <TabsContent value="research" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Research Projects</CardTitle>
                            <CardDescription>Manage your ongoing and past research projects</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div className="rounded-lg border overflow-hidden">
                                <div className="p-4 bg-primary/5 flex items-center justify-between">
                                    <div>
                                        <h4 className="font-medium">Active Research Projects</h4>
                                        <p className="text-sm text-muted-foreground">Projects you're currently working on</p>
                                    </div>
                                    <Button size="sm">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-1"><path d="M5 12h14" /><path d="M12 5v14" /></svg>
                                        New Project
                                    </Button>
                                </div>
                                <div className="divide-y">
                                    <div className="p-4">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h5 className="font-medium">AI-Powered Educational Content Analysis</h5>
                                                <p className="text-sm text-muted-foreground mt-1">Analyzing educational materials using NLP to assess complexity and accessibility</p>
                                                <div className="flex items-center gap-2 mt-2">
                                                    <Badge>In Progress</Badge>
                                                    <p className="text-xs text-muted-foreground">Started: Jan 2025</p>
                                                </div>
                                            </div>
                                            <Button variant="ghost" size="sm">
                                                Manage
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-1"><path d="m9 18 6-6-6-6" /></svg>
                                            </Button>
                                        </div>
                                        <div className="mt-3 flex items-center gap-1">
                                            <Avatar className="h-6 w-6">
                                                <AvatarFallback className="text-xs">JD</AvatarFallback>
                                            </Avatar>
                                            <Avatar className="h-6 w-6">
                                                <AvatarFallback className="text-xs">AS</AvatarFallback>
                                            </Avatar>
                                            <Avatar className="h-6 w-6">
                                                <AvatarFallback className="text-xs">RK</AvatarFallback>
                                            </Avatar>
                                            <span className="text-xs text-muted-foreground ml-1">+2 collaborators</span>
                                        </div>
                                    </div>
                                    <div className="p-4">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h5 className="font-medium">Student Performance Prediction Model</h5>
                                                <p className="text-sm text-muted-foreground mt-1">ML model to predict student outcomes based on engagement metrics</p>
                                                <div className="flex items-center gap-2 mt-2">
                                                    <Badge>In Progress</Badge>
                                                    <p className="text-xs text-muted-foreground">Started: Feb 2025</p>
                                                </div>
                                            </div>
                                            <Button variant="ghost" size="sm">
                                                Manage
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-1"><path d="m9 18 6-6-6-6" /></svg>
                                            </Button>
                                        </div>
                                        <div className="mt-3 flex items-center gap-1">
                                            <Avatar className="h-6 w-6">
                                                <AvatarFallback className="text-xs">JD</AvatarFallback>
                                            </Avatar>
                                            <Avatar className="h-6 w-6">
                                                <AvatarFallback className="text-xs">LM</AvatarFallback>
                                            </Avatar>
                                            <span className="text-xs text-muted-foreground ml-1">+1 collaborator</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="rounded-lg border overflow-hidden">
                                <div className="p-4 bg-muted/30 flex items-center justify-between">
                                    <div>
                                        <h4 className="font-medium">Past Research Projects</h4>
                                        <p className="text-sm text-muted-foreground">Completed research projects</p>
                                    </div>
                                    <Button variant="ghost" size="sm">View All</Button>
                                </div>
                                <div className="divide-y">
                                    <div className="p-4">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h5 className="font-medium">Personalized Learning Pathways</h5>
                                                <p className="text-sm text-muted-foreground mt-1">Study on adaptive learning systems for K-12 education</p>
                                                <div className="flex items-center gap-2 mt-2">
                                                    <Badge variant="outline">Completed</Badge>
                                                    <p className="text-xs text-muted-foreground">Dec 2023 - Nov 2024</p>
                                                </div>
                                            </div>
                                            <Button variant="ghost" size="sm">
                                                View
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-1"><path d="m9 18 6-6-6-6" /></svg>
                                            </Button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-2">
                                <Label>Research Data Storage</Label>
                                <div className="border rounded-lg p-4">
                                    <div className="flex justify-between items-center mb-4">
                                        <div>
                                            <p className="font-medium">Storage Usage</p>
                                            <p className="text-sm text-muted-foreground">32.4 GB used of 50 GB</p>
                                        </div>
                                        <Button variant="outline" size="sm">Upgrade Storage</Button>
                                    </div>
                                    <div className="w-full bg-muted rounded-full h-2.5">
                                        <div className="bg-primary h-2.5 rounded-full" style={{ width: '65%' }}></div>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </TabsContent>

                {/* Integrations Tab */}
                <TabsContent value="integrations" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Research Tools & Integrations</CardTitle>
                            <CardDescription>Connect your favorite research and academic tools</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div className="rounded-lg border overflow-hidden">
                                <div className="p-4 bg-primary/5">
                                    <h4 className="font-medium">Connected Tools</h4>
                                    <p className="text-sm text-muted-foreground">Services you've already connected</p>
                                </div>
                                <div className="divide-y">
                                    <div className="p-4 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><path d="M4 1h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2h-4l-4 4-4-4H4c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2z" /></svg>
                                            </div>
                                            <div>
                                                <p className="font-medium">Mendeley</p>
                                                <p className="text-sm text-muted-foreground">Reference management</p>
                                            </div>
                                        </div>
                                        <Button variant="outline" size="sm">Disconnect</Button>
                                    </div>
                                    <div className="p-4 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>
                                            </div>
                                            <div>
                                                <p className="font-medium">Overleaf</p>
                                                <p className="text-sm text-muted-foreground">LaTeX collaboration</p>
                                            </div>
                                        </div>
                                        <Button variant="outline" size="sm">Disconnect</Button>
                                    </div>
                                </div>
                            </div>

                            <div className="rounded-lg border overflow-hidden">
                                <div className="p-4 bg-muted/30">
                                    <h4 className="font-medium">Available Integrations</h4>
                                    <p className="text-sm text-muted-foreground">Tools you can connect to enhance your research workflow</p>
                                </div>
                                <div className="divide-y">
                                    <div className="p-4 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                                                <Book className="h-5 w-5 text-purple-600" />
                                            </div>
                                            <div>
                                                <p className="font-medium">Zotero</p>
                                                <p className="text-sm text-muted-foreground">Reference management and sharing</p>
                                            </div>
                                        </div>
                                        <Button size="sm">Connect</Button>
                                    </div>
                                    <div className="p-4 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-600"><rect width="18" height="18" x="3" y="3" rx="2" /><path d="M3 9h18" /><path d="M9 21V9" /></svg>
                                            </div>
                                            <div>
                                                <p className="font-medium">Trello</p>
                                                <p className="text-sm text-muted-foreground">Project management</p>
                                            </div>
                                        </div>
                                        <Button size="sm">Connect</Button>
                                    </div>
                                    <div className="p-4 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-600"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48" /></svg>
                                            </div>
                                            <div>
                                                <p className="font-medium">Google Drive</p>
                                                <p className="text-sm text-muted-foreground">Cloud storage</p>
                                            </div>
                                        </div>
                                        <Button size="sm">Connect</Button>
                                    </div>
                                </div>
                            </div>

                            <div className="rounded-lg border p-4">
                                <h4 className="font-medium mb-2">API Access</h4>
                                <p className="text-sm text-muted-foreground mb-3">Generate an API key to integrate our platform with your custom tools</p>
                                <div className="flex items-center gap-2">
                                    <Input readOnly value="sk_research_2f9a8b3c7d1e5f6..." className="font-mono" />
                                    <Button variant="outline" size="sm">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-1"><path d="M20 9v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7"></path><path d="m9 15 3-3 3 3"></path><path d="M13 12V5"></path></svg>
                                        Generate New
                                    </Button>
                                    <Button variant="ghost" size="sm">
                                        <Clipboard className="h-4 w-4" />
                                    </Button>
                                </div>
                                <p className="text-xs text-muted-foreground mt-2">Treat your API key like a password. Never share it or store it in client-side code.</p>
                            </div>
                        </CardContent>
                    </Card>
                </TabsContent>

                {/* Preferences Tab */}
                <TabsContent value="preferences" className="space-y-6">
                    <Card>
                        <CardHeader>
                            <CardTitle>Interface Preferences</CardTitle>
                            <CardDescription>Customize your experience with the platform</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div className="space-y-3">
                                <div className="flex items-center justify-between rounded-lg border p-4">
                                    <div className="flex items-center gap-2">
                                        <Moon className="h-5 w-5 text-muted-foreground" />
                                        <div>
                                            <p className="text-sm font-medium">Dark Mode</p>
                                            <p className="text-xs text-muted-foreground">Switch between light and dark themes</p>
                                        </div>
                                    </div>
                                    <Switch defaultChecked />
                                </div>

                                <div className="flex items-center justify-between rounded-lg border p-4">
                                    <div className="flex items-center gap-2">
                                        <PersonStanding className="h-5 w-5 text-muted-foreground" />
                                        <div>
                                            <p className="text-sm font-medium">Accessibility Mode</p>
                                            <p className="text-xs text-muted-foreground">Enable high contrast and screen reader optimizations</p>
                                        </div>
                                    </div>
                                    <Switch />
                                </div>

                                <div className="flex items-center justify-between rounded-lg border p-4">
                                    <div className="flex items-center gap-2">
                                        <LineChart className="h-5 w-5 text-muted-foreground" />
                                        <div>
                                            <p className="text-sm font-medium">Auto-generate Data Visualizations</p>
                                            <p className="text-xs text-muted-foreground">Automatically visualize uploaded research data</p>
                                        </div>
                                    </div>
                                    <Switch defaultChecked />
                                </div>
                            </div>

                            <div>
                                <Label>Default Dashboard View</Label>
                                <Select defaultValue="research">
                                    <SelectTrigger className="mt-2">
                                        <SelectValue placeholder="Select default view" />
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem value="overview">Overview</SelectItem>
                                        <SelectItem value="research">Research Projects</SelectItem>
                                        <SelectItem value="publications">Publications</SelectItem>
                                        <SelectItem value="analytics">Analytics</SelectItem>
                                        <SelectItem value="collaborations">Collaborations</SelectItem>
                                    </SelectContent>
                                </Select>
                            </div>

                            <div>
                                <Label htmlFor="citation-style">Default Citation Style</Label>
                                <Select defaultValue="apa">
                                    <SelectTrigger className="mt-2">
                                        <SelectValue placeholder="Select citation style" />
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem value="apa">APA (7th Edition)</SelectItem>
                                        <SelectItem value="mla">MLA (8th Edition)</SelectItem>
                                        <SelectItem value="chicago">Chicago</SelectItem>
                                        <SelectItem value="harvard">Harvard</SelectItem>
                                        <SelectItem value="ieee">IEEE</SelectItem>
                                    </SelectContent>
                                </Select>
                            </div>

                            <div className="space-y-2">
                                <Label>Data Display Preferences</Label>
                                <div className="space-y-2">
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="charts" defaultChecked />
                                        <label
                                            htmlFor="charts"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Show interactive charts by default
                                        </label>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="tables" defaultChecked />
                                        <label
                                            htmlFor="tables"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Show data tables with charts
                                        </label>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="summaries" defaultChecked />
                                        <label
                                            htmlFor="summaries"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Auto-generate data summaries
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5">
                            <Button>Save Preferences</Button>
                        </CardFooter>
                    </Card>

                    <Card>
                        <CardHeader>
                            <CardTitle>Collaboration Preferences</CardTitle>
                            <CardDescription>Set your default collaboration settings</CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-6">
                            <div>
                                <Label>Default Sharing Permissions</Label>
                                <Select defaultValue="view">
                                    <SelectTrigger className="mt-2">
                                        <SelectValue placeholder="Select permission" />
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem value="view">View Only</SelectItem>
                                        <SelectItem value="comment">Comment</SelectItem>
                                        <SelectItem value="edit">Edit</SelectItem>
                                        <SelectItem value="admin">Admin</SelectItem>
                                    </SelectContent>
                                </Select>
                                <p className="text-xs text-muted-foreground mt-2">This will be the default permission when sharing research projects</p>
                            </div>

                            <div className="space-y-2">
                                <Label>Collaboration Notifications</Label>
                                <div className="space-y-2">
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="new-collaborator" defaultChecked />
                                        <label
                                            htmlFor="new-collaborator"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Notify when someone joins a project
                                        </label>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="project-edit" defaultChecked />
                                        <label
                                            htmlFor="project-edit"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Notify when a collaborator edits shared content
                                        </label>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Checkbox id="project-comment" defaultChecked />
                                        <label
                                            htmlFor="project-comment"
                                            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                                        >
                                            Notify on new comments
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                        <CardFooter className="border-t pt-5">
                            <Button>Save Collaboration Settings</Button>
                        </CardFooter>
                    </Card>
                </TabsContent>
            </Tabs>
        </div >)
}

export default SettingsComponent;
```

## File: src/routes/(app)/index.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import {
    Search,
    Plus,
    Library,
    BookOpen,
    Clock,
    Star,
    Calendar,
    Users,
    FileText,
    FolderOpen,
    Settings,
    TrendingUp,
    Bookmark,
    Tag,
    ChevronRight
} from 'lucide-react'

export const Route = createFileRoute('/(app)/')({
    component: DashboardComponent,
})

function DashboardComponent() {
    // Sample data for recently edited documents
    const recentDocuments = [
        {
            id: 1,
            title: "Research Methodology Notes",
            updatedAt: "2 hours ago",
            tags: ["Research", "Academia"],
            starred: true,
            preview: "The methodology section describes the rationale for the application of specific procedures or techniques used to identify, select, and analyze information..."
        },
        {
            id: 2,
            title: "Literature Review: Machine Learning in Healthcare",
            updatedAt: "Yesterday",
            tags: ["ML", "Healthcare", "Research"],
            starred: false,
            preview: "This review aims to explore the current landscape of machine learning applications in healthcare settings, with a focus on diagnostic tools..."
        },
        {
            id: 3,
            title: "Study Notes: Quantum Computing",
            updatedAt: "3 days ago",
            tags: ["Physics", "Computing"],
            starred: true,
            preview: "Quantum computing is an emerging field that uses quantum mechanical phenomena to perform operations on data..."
        },
        {
            id: 4,
            title: "Thesis Outline",
            updatedAt: "1 week ago",
            tags: ["Thesis", "Planning"],
            starred: false,
            preview: "Introduction, Literature Review, Methodology, Results, Discussion, Conclusion..."
        },
    ];

    // Sample data for collections
    const collections = [
        {
            id: 1,
            name: "Research Papers",
            count: 24,
            icon: Library,
            color: "bg-blue-500/10 text-blue-500"
        },
        {
            id: 2,
            name: "Study Notes",
            count: 42,
            icon: BookOpen,
            color: "bg-green-500/10 text-green-500"
        },
        {
            id: 3,
            name: "Project Materials",
            count: 15,
            icon: FolderOpen,
            color: "bg-purple-500/10 text-purple-500"
        },
        {
            id: 4,
            name: "Personal Journal",
            count: 28,
            icon: FileText,
            color: "bg-yellow-500/10 text-yellow-500"
        },
    ];

    // Sample suggested actions
    const suggestedActions = [
        {
            id: 1,
            title: "Continue writing your thesis outline",
            subtitle: "Last edited yesterday",
            icon: FileText,
            color: "bg-indigo-500/10 text-indigo-500"
        },
        {
            id: 2,
            title: "Upcoming literature review deadline",
            subtitle: "Due in 3 days",
            icon: Calendar,
            color: "bg-red-500/10 text-red-500"
        },
        {
            id: 3,
            title: "Collaborate on Chemistry notes",
            subtitle: "Shared with 3 peers",
            icon: Users,
            color: "bg-emerald-500/10 text-emerald-500"
        },
    ];

    // Sample statistics
    const statistics = [
        {
            title: "Total Documents",
            value: "164",
            change: "+12",
            icon: FileText,
            trend: "up"
        },
        {
            title: "Words Written",
            value: "53,842",
            change: "+2,451",
            icon: TrendingUp,
            trend: "up"
        },
        {
            title: "Research Sources",
            value: "87",
            change: "+5",
            icon: Bookmark,
            trend: "up"
        },
        {
            title: "Citations",
            value: "132",
            change: "+8",
            icon: Tag,
            trend: "up"
        },
    ];

    return (
        <div className="space-y-6 p-4">
            {/* Header with search and quick actions */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <h1 className="text-2xl font-bold tracking-tight">Dashboard</h1>
                <div className="flex items-center gap-2">
                    <div className="relative w-full sm:w-64">
                        <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                        <input
                            type="text"
                            placeholder="Search documents..."
                            className="w-full rounded-md border border-input bg-background pl-10 pr-4 py-2 text-sm"
                        />
                    </div>
                    <button className="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90">
                        <Plus className="h-4 w-4" />
                        New Document
                    </button>
                </div>
            </div>

            {/* Statistics cards */}
            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {statistics.map((stat, index) => (
                    <div key={index} className="rounded-lg border bg-card p-4">
                        <div className="flex justify-between">
                            <div>
                                <p className="text-sm text-muted-foreground">{stat.title}</p>
                                <p className="text-2xl font-bold">{stat.value}</p>
                            </div>
                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${stat.trend === 'up' ? 'bg-green-500/10' : 'bg-red-500/10'
                                }`}>
                                <stat.icon className={`h-5 w-5 ${stat.trend === 'up' ? 'text-green-500' : 'text-red-500'
                                    }`} />
                            </div>
                        </div>
                        <div className="mt-2 flex items-center text-sm">
                            <span className={stat.trend === 'up' ? 'text-green-500' : 'text-red-500'}>
                                {stat.change}
                            </span>
                            <span className="ml-1 text-muted-foreground">this week</span>
                        </div>
                    </div>
                ))}
            </div>

            {/* Two column layout for main content */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Left column - Recent documents */}
                <div className="lg:col-span-2 space-y-6">
                    {/* Recent documents */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="flex items-center justify-between p-4 border-b">
                            <h2 className="font-medium flex items-center">
                                <Clock className="h-4 w-4 mr-2 text-muted-foreground" />
                                Recent Documents
                            </h2>
                            <button className="text-sm text-primary hover:underline">
                                View all
                            </button>
                        </div>
                        <div className="divide-y">
                            {recentDocuments.map((doc) => (
                                <div key={doc.id} className="p-4 hover:bg-muted/50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2">
                                                <FileText className="h-4 w-4 text-muted-foreground" />
                                                <h3 className="font-medium">{doc.title}</h3>
                                                {doc.starred && (
                                                    <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                                                )}
                                            </div>
                                            <p className="mt-1 text-sm text-muted-foreground line-clamp-2">
                                                {doc.preview}
                                            </p>
                                            <div className="mt-2 flex items-center gap-2">
                                                <span className="text-xs text-muted-foreground">
                                                    Updated {doc.updatedAt}
                                                </span>
                                                <div className="flex gap-1">
                                                    {doc.tags.map((tag, idx) => (
                                                        <span
                                                            key={idx}
                                                            className="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary"
                                                        >
                                                            {tag}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        <button className="p-1 hover:bg-muted rounded-full">
                                            <ChevronRight className="h-4 w-4 text-muted-foreground" />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Collections grid */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="flex items-center justify-between p-4 border-b">
                            <h2 className="font-medium flex items-center">
                                <Library className="h-4 w-4 mr-2 text-muted-foreground" />
                                Collections
                            </h2>
                            <button className="text-sm text-primary hover:underline">
                                Manage collections
                            </button>
                        </div>
                        <div className="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            {collections.map((collection) => {
                                const IconComponent = collection.icon;
                                return (
                                    <div
                                        key={collection.id}
                                        className="rounded-lg border bg-card p-4 hover:border-primary/50 hover:shadow-md transition-shadow duration-150"
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${collection.color}`}>
                                                <IconComponent className="h-5 w-5" />
                                            </div>
                                            <div>
                                                <h3 className="font-medium">{collection.name}</h3>
                                                <p className="text-sm text-muted-foreground">
                                                    {collection.count} documents
                                                </p>
                                            </div>
                                            <button className="ml-auto p-1 hover:bg-muted rounded-full">
                                                <ChevronRight className="h-4 w-4 text-muted-foreground" />
                                            </button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>

                {/* Right column - Suggestions and quick access */}
                <div className="space-y-6">
                    {/* Suggested actions */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="p-4 border-b">
                            <h2 className="font-medium">Suggested Actions</h2>
                        </div>
                        <div className="divide-y">
                            {suggestedActions.map((action) => {
                                const IconComponent = action.icon;
                                return (
                                    <div key={action.id} className="p-4 hover:bg-muted/50 cursor-pointer ">
                                        <div className="flex items-center gap-3">
                                            <div className={`flex h-10 w-10 items-center justify-center rounded-full ${action.color}`}>
                                                <IconComponent className="h-5 w-5" />
                                            </div>
                                            <div>
                                                <h3 className="font-medium">{action.title}</h3>
                                                <p className="text-sm text-muted-foreground">
                                                    {action.subtitle}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Quick access */}
                    <div className="rounded-lg border bg-card shadow-sm">
                        <div className="p-4 border-b">
                            <h2 className="font-medium">Quick Access</h2>
                        </div>
                        <div className="p-4 space-y-2">
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Star className="h-5 w-5 text-yellow-500" />
                                <span>Starred Documents</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Clock className="h-5 w-5 text-blue-500" />
                                <span>Recent Activity</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Users className="h-5 w-5 text-green-500" />
                                <span>Shared With Me</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Calendar className="h-5 w-5 text-purple-500" />
                                <span>Research Calendar</span>
                            </button>
                            <button className="w-full flex items-center gap-3 rounded-md border p-3 hover:bg-muted/50 ">
                                <Settings className="h-5 w-5 text-gray-500" />
                                <span>Preferences</span>
                            </button>
                        </div>
                    </div>

                    {/* Help & resources card */}
                    <div className="rounded-lg border bg-card p-4 shadow-sm">
                        <h3 className="font-medium mb-2">Resources</h3>
                        <div className="space-y-2 text-sm">
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <BookOpen className="h-4 w-4" />
                                <span>Citation Guide</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <Library className="h-4 w-4" />
                                <span>Research Database Access</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <FileText className="h-4 w-4" />
                                <span>Academic Writing Templates</span>
                            </a>
                            <a href="#" className="flex items-center gap-2 text-primary hover:underline">
                                <Users className="h-4 w-4" />
                                <span>Research Collaboration Tools</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            {/* Weekly progress section */}
            <div className="rounded-lg border bg-card shadow-sm">
                <div className="flex items-center justify-between p-4 border-b">
                    <h2 className="font-medium flex items-center">
                        <TrendingUp className="h-4 w-4 mr-2 text-muted-foreground" />
                        Weekly Progress
                    </h2>
                    <div className="flex items-center gap-2">
                        <select className="rounded-md border bg-background px-3 py-1 text-sm">
                            <option>This Week</option>
                            <option>Last Week</option>
                            <option>Last Month</option>
                        </select>
                    </div>
                </div>
                <div className="p-4">
                    <div className="h-64 w-full bg-muted/20 rounded flex items-center justify-center">
                        <div className="text-center">
                            <TrendingUp className="h-10 w-10 text-muted-foreground mx-auto mb-2" />
                            <p className="text-muted-foreground">Writing activity analytics would display here</p>
                        </div>
                    </div>
                </div>
                <div className="p-4 border-t grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Documents Created</p>
                        <p className="text-xl font-bold">7</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Study Hours</p>
                        <p className="text-xl font-bold">24.5</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Notes Taken</p>
                        <p className="text-xl font-bold">42</p>
                    </div>
                    <div className="text-center">
                        <p className="text-sm text-muted-foreground">Research Sources</p>
                        <p className="text-xl font-bold">15</p>
                    </div>
                </div>
            </div>

            {/* Research projects section */}
            <div className="rounded-lg border bg-card shadow-sm">
                <div className="flex items-center justify-between p-4 border-b">
                    <h2 className="font-medium flex items-center">
                        <BookOpen className="h-4 w-4 mr-2 text-muted-foreground" />
                        Active Research Projects
                    </h2>
                    <button className="text-sm text-primary hover:underline">
                        View all projects
                    </button>
                </div>
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead>
                            <tr className="border-b bg-muted/50">
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Project</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Status</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Deadline</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Collaborators</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Progress</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y">
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-purple-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-purple-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Neural Network Analysis</p>
                                            <p className="text-xs text-muted-foreground">AI & Machine Learning</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                                        In Progress
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">May 15, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-blue-500 flex items-center justify-center text-xs text-white">JD</div>
                                        <div className="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-xs text-white">MK</div>
                                        <div className="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-xs text-white">+1</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-green-500" style={{ width: "65%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">65% Complete</p>
                                </td>
                            </tr>
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-blue-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-blue-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Climate Change Literature Review</p>
                                            <p className="text-xs text-muted-foreground">Environmental Science</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                                        Pending Review
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">April 3, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-xs text-white">AR</div>
                                        <div className="h-6 w-6 rounded-full bg-indigo-500 flex items-center justify-center text-xs text-white">SL</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-yellow-500" style={{ width: "80%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">80% Complete</p>
                                </td>
                            </tr>
                            <tr className="hover:bg-muted/50">
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex items-center gap-2">
                                        <div className="h-8 w-8 rounded-full bg-green-500/10 flex items-center justify-center">
                                            <FileText className="h-4 w-4 text-green-500" />
                                        </div>
                                        <div>
                                            <p className="font-medium">Vaccine Efficacy Study</p>
                                            <p className="text-xs text-muted-foreground">Medical Sciences</p>
                                        </div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <span className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                                        Data Collection
                                    </span>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm">June 22, 2025</td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="flex -space-x-2">
                                        <div className="h-6 w-6 rounded-full bg-orange-500 flex items-center justify-center text-xs text-white">BT</div>
                                        <div className="h-6 w-6 rounded-full bg-teal-500 flex items-center justify-center text-xs text-white">MC</div>
                                        <div className="h-6 w-6 rounded-full bg-pink-500 flex items-center justify-center text-xs text-white">+3</div>
                                    </div>
                                </td>
                                <td className="px-4 py-3 whitespace-nowrap">
                                    <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                                        <div className="h-full bg-blue-500" style={{ width: "35%" }}></div>
                                    </div>
                                    <p className="text-xs text-muted-foreground mt-1">35% Complete</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    )
}

export default DashboardComponent;
```

## File: src/routes/(app)/tools.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router';
import React, { useState, useRef, useEffect, useCallback } from 'react';
import {
  ArrowUp,
  Bot,
  Check,
  ChevronDown,
  Clipboard,
  ClipboardCheck,
  Loader2, Paperclip,
  Plus,
  RefreshCcw,
  Settings,
  Sparkles,
  ThumbsDown,
  ThumbsUp,
  User, Wand2,
  X,
  Zap,
  FileText,
  Edit3,
  Image as ImageIcon // Added for image file type icon
} from 'lucide-react';

import { Button } from "@app/ui/components/button";
import { Badge } from "@app/ui/components/badge";
import { Textarea } from "@app/ui/components/textarea";
import { ScrollArea } from "@app/ui/components/scroll-area";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger
} from "@app/ui/components/tooltip";
import { Card, CardContent } from "@app/ui/components/card";
import { Avatar, AvatarFallback } from "@app/ui/components/avatar";
import {
  Dialog,
  DialogTrigger,
} from "@app/ui/components/dialog";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@app/ui/components/popover";
import { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from "@app/ui/components/command";
import { cn } from "@app/ui/lib/utils";

import ChatSettingsDialog, {
  type ModelSettings as DialogModelSettings,
  type ChatUISettings as DialogChatUISettings,
  type ModelOption
} from '@/components/chat-settings-dialog'; // Assuming this path is correct

// --- Type Definitions ---

interface FilePreview {
  id: string;
  name: string;
  type: string;
  size: number;
  previewUrl?: string | null;
  fileObject: File;
}

interface MessageFile {
  name: string;
  type: string;
  size: number;
  previewUrl?: string | null;
}

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: string;
  modelUsed?: string;
  files?: MessageFile[];
  feedback?: 'good' | 'bad' | null;
  isLoading?: boolean;
}

interface Model {
  id: string;
  name: string;
  provider: string;
  description: string;
  tags: string[];
  icon?: React.ElementType;
  strengths: string[];
  limitations?: string[];
  contextWindow?: number;
  supportsFiles?: boolean;
}

interface ModelSettings extends DialogModelSettings { }
interface ChatUISettings extends DialogChatUISettings { }

// --- Mock Data & Defaults ---

const availableModels: Model[] = [
  { id: "claude-35-sonnet", name: "Claude 3.5 Sonnet", provider: "Anthropic", description: "Balanced intelligence and speed, strong vision capabilities.", tags: ["Vision", "Balanced", "Latest"], icon: Wand2, strengths: ["Complex reasoning", "Nuanced content creation", "Code generation", "Vision analysis"], limitations: ["Potential for verbosity"], contextWindow: 200000, supportsFiles: true },
  { id: "gpt-4o", name: "GPT-4o", provider: "OpenAI", description: "Flagship multimodal model, optimized for speed and cost.", tags: ["Multimodal", "Fast", "Flagship"], icon: Zap, strengths: ["Text, audio, image understanding", "Conversational AI", "Broad knowledge"], contextWindow: 128000, supportsFiles: true },
  { id: "claude-3-opus", name: "Claude 3 Opus", provider: "Anthropic", description: "Most powerful model for highly complex tasks.", tags: ["Powerful", "Reasoning", "Large Context"], icon: Sparkles, strengths: ["Top-tier reasoning", "Math & coding", "Long context understanding"], contextWindow: 200000, supportsFiles: true },
  { id: "llama-3-70b", name: "Llama 3 70B", provider: "Meta", description: "Large open-source model, great for research and customization.", tags: ["Open Source", "Large"], icon: Bot, strengths: ["Strong general performance", "Good instruction following"], contextWindow: 8000, supportsFiles: false },
  { id: "claude-3-haiku", name: "Claude 3 Haiku", provider: "Anthropic", description: "Fastest and most compact model for near-instant responsiveness.", tags: ["Fast", "Compact", "Affordable"], icon: Wand2, strengths: ["Quick responses", "Simple summarization", "Customer interactions"], contextWindow: 200000, supportsFiles: true },
];

const defaultModelSettings: ModelSettings = {
  temperature: 0.7,
  maxTokens: 4096,
  topP: 1.0,
  frequencyPenalty: 0.0,
  presencePenalty: 0.0,
  systemPrompt: "You are a helpful AI assistant.",
  modelId: availableModels[0].id,
};

const defaultUISettings: ChatUISettings = {
  showTimestamps: true,
  compactMode: false,
  autoScroll: true,
  darkMode: false, // Assuming default is light mode
  enableKeyboardShortcuts: true,
  messageSounds: false,
  enableMarkdown: true,
};

const MAX_FILE_SIZE_MB = 25;
const MAX_FILES = 5;
const ANIMATION_SPEED_MS = 15; // Lower value = faster animation

// --- Utility Functions ---
const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
};

const formatTimestamp = (timestamp: string): string => {
  try {
    const date = new Date(timestamp);
    const now = new Date();
    if (date.toDateString() !== now.toDateString()) {
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
    }
    return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
  } catch (e) {
    return "Invalid date";
  }
};

const generateUniqueId = (): string => crypto.randomUUID();

// --- Route Definition ---
export const Route = createFileRoute('/(app)/tools')({ // Make sure '/(app)/tools' matches your route structure
  component: ModernAIChatComponent,
});

// --- Main Component ---
function ModernAIChatComponent() {
  // --- State ---
  const [messages, setMessages] = useState<Message[]>([]);
  const [newMessage, setNewMessage] = useState('');
  const [isProcessing, setIsProcessing] = useState(false); // Covers initial API wait/placeholder
  const [isStreamingResponse, setIsStreamingResponse] = useState(false); // Covers text animation
  const [selectedFiles, setSelectedFiles] = useState<FilePreview[]>([]);
  const [selectedModel, setSelectedModel] = useState<Model>(availableModels[0]);
  const [modelSettings, setModelSettings] = useState<ModelSettings>(() => ({
    ...defaultModelSettings,
    modelId: availableModels[0].id,
  }));
  const [uiSettings, setUISettings] = useState<ChatUISettings>(defaultUISettings);
  const [isSettingsDialogOpen, setIsSettingsDialogOpen] = useState<boolean>(false);
  const [copiedMessageId, setCopiedMessageId] = useState<string | null>(null);
  const [chatTitle, setChatTitle] = useState<string>("New Chat");

  // --- Refs ---
  const inputRef = useRef<HTMLTextAreaElement>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const scrollAreaRef = useRef<HTMLDivElement>(null); // Ref for the ScrollArea's outer div

  // --- Effects ---
  useEffect(() => {
    if (messages.length === 0) {
      setMessages([createInitialAssistantMessage(selectedModel)]);
    }
  }, []); // Only on mount if messages are empty

  // Auto-scroll effect
  useEffect(() => {
    if (uiSettings.autoScroll && scrollAreaRef.current) {
      const scrollViewport = scrollAreaRef.current?.querySelector<HTMLElement>('[data-radix-scroll-area-viewport]');
      if (scrollViewport) {
        requestAnimationFrame(() => {
          scrollViewport.scrollTop = scrollViewport.scrollHeight;
        });
      }
    }
  }, [messages, isProcessing, isStreamingResponse, uiSettings.autoScroll]); // Trigger on state changes too

  // Update selectedModel when modelId changes in settings
  useEffect(() => {
    if (modelSettings.modelId && modelSettings.modelId !== selectedModel.id) {
      const newModel = availableModels.find(m => m.id === modelSettings.modelId);
      if (newModel) {
        setSelectedModel(newModel);
        if (messages.length === 1 && messages[0].role === 'assistant' && !messages[0].isLoading) {
          setMessages([createInitialAssistantMessage(newModel)]);
        }
      }
    }
  }, [modelSettings.modelId]); // Don't depend on `messages` here

  // Cleanup Object URLs on component unmount
  useEffect(() => {
    return () => {
      console.log("Chat component unmounting: Cleaning up Object URLs");
      messages.forEach(msg => {
        msg.files?.forEach(file => {
          if (file.previewUrl) { try { URL.revokeObjectURL(file.previewUrl); } catch (e) { console.warn(`Error revoking message file URL on unmount: ${file.previewUrl}`, e); } }
        });
      });
      selectedFiles.forEach(file => {
        if (file.previewUrl) { try { URL.revokeObjectURL(file.previewUrl); } catch (e) { console.warn(`Error revoking selected file URL on unmount: ${file.previewUrl}`, e); } }
      });
    };
  }, []); // Empty array ensures run only on unmount


  // --- Helper Functions ---
  const createInitialAssistantMessage = (model: Model): Message => ({
    id: generateUniqueId(),
    role: 'assistant',
    content: `Hello! I'm ${model.name}. How can I assist you today? I'm using the current settings. System Prompt: "${modelSettings.systemPrompt.substring(0, 50)}..."`,
    timestamp: new Date().toISOString(),
    modelUsed: model.name,
    isLoading: false,
  });

  // generateDummyResponse remains the same - it generates the *final* text
  const generateDummyResponse = useCallback((input: string, files?: MessageFile[], currentModel?: Model, settings?: ModelSettings): string => {
    const modelName = currentModel?.name || "AI";
    const temp = settings?.temperature ?? defaultModelSettings.temperature;
    const maxTok = settings?.maxTokens ?? defaultModelSettings.maxTokens;
    const sysPrompt = settings?.systemPrompt ?? defaultModelSettings.systemPrompt;
    const creativity = temp > 1.0 ? "highly creative" : temp > 0.5 ? "balanced" : "focused";
    const baseResponses = [
      `(${modelName}, ${creativity}) Re: "${input.substring(0, 30)}...", considering the prompt "${sysPrompt.substring(0, 40)}...", my analysis suggests a few key points based on the information provided. Firstly, the core concept revolves around... Secondly, we need to consider the implications of... Finally, a potential path forward involves... (Settings: temp=${temp}, max_tokens=${maxTok})`,
      `(${modelName}, ${creativity}) Interesting point: "${input.substring(0, 30)}...". Based on my instructions ("${sysPrompt.substring(0, 40)}..."), I'd approach this by breaking it down. The primary aspect is X. The secondary consideration involves Y. Therefore, the synthesized answer points towards Z. This is a complex topic with many nuances. (Settings: temp=${temp}, max_tokens=${maxTok})`,
      `(${modelName}, ${creativity}) Processing "${input.substring(0, 30)}..." with prompt "${sysPrompt.substring(0, 40)}...". Output limited to ${maxTok} tokens. Here are my thoughts: The situation described implies several factors at play. We observe A, B, and C. Based on these observations and the system prompt, a logical conclusion is D. Further exploration might involve E and F. (Settings: temp=${temp}, max_tokens=${maxTok})`,
    ];
    const fileText = files && files.length > 0
      ? `\n\nRegarding the ${files.length} file(s) (${files.map(f => f.name).join(', ')}): ${currentModel?.supportsFiles ? 'I have considered their context in this response.' : `Please note: ${modelName} (simulated) cannot process file content.`}`
      : '';
    const randomResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
    return `${randomResponse}${fileText}\n\n_Disclaimer: Simulated response reflecting settings._`;
  }, []); // No dependencies needed as arguments cover variations


  // --- Event Handlers ---
  const handleAnimationComplete = useCallback(() => {
    setIsStreamingResponse(false);
    console.log("Animation complete, re-enabling input.");
    // Consider focusing input: inputRef.current?.focus();
  }, []);

  const handleSendMessage = useCallback(async () => {
    const trimmedMessage = newMessage.trim();
    if (!trimmedMessage && selectedFiles.length === 0) return;

    setIsProcessing(true); // Start processing (covers placeholder/delay)
    const timestamp = new Date().toISOString();
    const userMessageId = generateUniqueId();

    if (messages.length === 1 && messages[0].role === 'assistant' && !messages[0].isLoading) {
      const newTitle = trimmedMessage.substring(0, 50) || `Chat ${new Date().toLocaleDateString()}`;
      setChatTitle(newTitle);
    }

    const messageFiles: MessageFile[] = selectedFiles.map(f => ({
      name: f.name, type: f.type, size: f.size,
      previewUrl: f.type.startsWith('image/') ? f.previewUrl : null
    }));

    const userMessage: Message = {
      id: userMessageId, role: 'user', content: trimmedMessage, timestamp: timestamp, files: messageFiles,
    };

    const updatedMessages = [...messages, userMessage];
    setMessages(updatedMessages);

    setNewMessage('');
    setSelectedFiles([]); // Clear selection UI - URLs are kept in messageFiles
    if (fileInputRef.current) fileInputRef.current.value = "";

    const assistantMessageId = generateUniqueId();
    const assistantPlaceholder: Message = {
      id: assistantMessageId, role: 'assistant', content: "",
      timestamp: new Date().toISOString(), modelUsed: selectedModel.name,
      isLoading: true,
    };

    setMessages(prev => [...prev, assistantPlaceholder]);

    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));

    const aiResponseContent = generateDummyResponse(trimmedMessage, messageFiles, selectedModel, modelSettings);

    const finalAssistantMessage: Message = {
      ...assistantPlaceholder, content: aiResponseContent,
      timestamp: new Date().toISOString(), isLoading: false, // This triggers animation
    };

    setIsStreamingResponse(true); // Start streaming state just before showing final message
    setMessages(prev => prev.map(msg => msg.id === assistantMessageId ? finalAssistantMessage : msg));
    setIsProcessing(false); // Processing (API wait) is done, but streaming continues

  }, [newMessage, selectedFiles, messages, selectedModel, modelSettings, generateDummyResponse]); // Keep dependencies

  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (uiSettings.enableKeyboardShortcuts && e.key === 'Enter' && !e.shiftKey && !isProcessing && !isStreamingResponse) { // Check both states
      e.preventDefault();
      handleSendMessage();
    }
  };

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (!files || files.length === 0) return;

    const currentFileCount = selectedFiles.length;
    const availableSlots = MAX_FILES - currentFileCount;
    if (availableSlots <= 0) return;

    const addedFiles: FilePreview[] = [];
    let filesRejected = 0;

    Array.from(files).slice(0, availableSlots).forEach(file => {
      if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) { filesRejected++; return; }
      if (!selectedModel.supportsFiles) { filesRejected++; return; }

      const fileId = generateUniqueId();
      const isImage = file.type.startsWith('image/');
      let previewUrl: string | null = null;

      if (isImage) { try { previewUrl = URL.createObjectURL(file); } catch (error) { console.error("Error creating object URL:", error); } }

      addedFiles.push({ id: fileId, name: file.name, type: file.type, size: file.size, previewUrl, fileObject: file });
    });

    if (files.length > availableSlots + filesRejected) { console.warn(`Added ${addedFiles.length} files. ${files.length - addedFiles.length} files were rejected.`); }
    else if (filesRejected > 0) { console.warn(`${filesRejected} files were rejected.`); }

    setSelectedFiles(prev => [...prev, ...addedFiles]);
    if (addedFiles.length > 0 && e.target) { e.target.value = ""; }
  };

  const removeFile = (fileId: string) => {
    setSelectedFiles(prev => {
      const fileToRemove = prev.find(f => f.id === fileId);
      if (fileToRemove?.previewUrl) {
        URL.revokeObjectURL(fileToRemove.previewUrl); // Clean up URL
      }
      return prev.filter(f => f.id !== fileId);
    });
    if (selectedFiles.length === 1 && fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  const handleStartNewChat = () => {
    // Clean up Object URLs before clearing
    messages.forEach(msg => { msg.files?.forEach(file => { if (file.previewUrl) { URL.revokeObjectURL(file.previewUrl); } }); });
    selectedFiles.forEach(file => { if (file.previewUrl) { URL.revokeObjectURL(file.previewUrl); } }); // Also clear selection URLs

    setMessages([createInitialAssistantMessage(selectedModel)]);
    setNewMessage('');
    setSelectedFiles([]);
    setChatTitle("New Chat");
    setIsProcessing(false); // Reset states
    setIsStreamingResponse(false);
    inputRef.current?.focus();
  };

  const handleCopyMessage = (content: string, messageId: string) => {
    navigator.clipboard.writeText(content).then(() => {
      setCopiedMessageId(messageId);
      setTimeout(() => setCopiedMessageId(null), 1500);
    });
  };

  const handleRegenerateResponse = useCallback(() => {
    if (isProcessing || isStreamingResponse) return; // Prevent during any activity

    let lastUserMessageIndex = -1;
    for (let i = messages.length - 1; i >= 0; i--) {
      if (messages[i].role === 'user') {
        lastUserMessageIndex = i;
        break;
      }
    }
    if (lastUserMessageIndex === -1) return;

    const lastUserMessage = messages[lastUserMessageIndex];
    const filesForRegen = lastUserMessage.files;
    const messagesToKeep = messages.slice(0, lastUserMessageIndex + 1);

    setIsProcessing(true); // Start processing state for regeneration delay
    setMessages(messagesToKeep);

    setTimeout(async () => {
      const assistantMessageId = generateUniqueId();
      const assistantPlaceholder: Message = {
        id: assistantMessageId, role: 'assistant', content: "", timestamp: new Date().toISOString(),
        modelUsed: selectedModel.name, isLoading: true,
      };
      setMessages(prev => [...prev, assistantPlaceholder]);

      await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 800));
      const aiResponseContent = generateDummyResponse(lastUserMessage.content, filesForRegen, selectedModel, modelSettings);

      const finalAssistantMessage: Message = {
        ...assistantPlaceholder, content: aiResponseContent + "\n\n_(Regenerated response)_",
        timestamp: new Date().toISOString(), isLoading: false, // Triggers animation
      };

      setIsStreamingResponse(true); // Start streaming state
      setMessages(prev => prev.map(msg => msg.id === assistantMessageId ? finalAssistantMessage : msg));
      setIsProcessing(false); // Processing delay finished

    }, 50);
  }, [messages, selectedModel, modelSettings, generateDummyResponse, isProcessing, isStreamingResponse]); // Added state dependencies

  const handleFeedback = (messageId: string, feedback: 'good' | 'bad') => {
    setMessages(prevMessages =>
      prevMessages.map(msg =>
        msg.id === messageId ? { ...msg, feedback: msg.feedback === feedback ? null : feedback } : msg
      )
    );
  };

  const handleClearHistory = useCallback(() => {
    // Clean up Object URLs
    messages.forEach(msg => { msg.files?.forEach(file => { if (file.previewUrl) { URL.revokeObjectURL(file.previewUrl); } }); });
    selectedFiles.forEach(file => { if (file.previewUrl) { URL.revokeObjectURL(file.previewUrl); } }); // Also clear selection URLs

    setMessages([createInitialAssistantMessage(selectedModel)]);
    setChatTitle("New Chat");
    setSelectedFiles([]); // Ensure selection is cleared
    setIsProcessing(false); // Reset states
    setIsStreamingResponse(false);
    setIsSettingsDialogOpen(false);
  }, [selectedModel, modelSettings.systemPrompt, messages, selectedFiles]); // Added dependencies for cleanup

  const handleExportChat = useCallback(() => {
    const chatContent = messages.map(m => {
      let fileInfo = m.files && m.files.length > 0 ? ` [Files: ${m.files.map(f => f.name).join(', ')}]` : "";
      return `[${m.role} - ${formatTimestamp(m.timestamp)}]${fileInfo}\n${m.content}`;
    }).join('\n\n---\n\n');
    const blob = new Blob([chatContent], { type: 'text/plain;charset=utf-8' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `${chatTitle.replace(/[^a-z0-9]/gi, '_')}_export_${new Date().toISOString().split('T')[0]}.txt`; // Sanitize filename
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
  }, [messages, chatTitle]);

  const modelOptions: ModelOption[] = availableModels.map(model => ({
    id: model.id, name: model.name, description: model.description,
    capabilities: [...model.tags, ...(model.strengths?.slice(0, 1) || [])],
    isDefault: model.id === availableModels[0].id
  }));


  // --- Render ---
  const isInputDisabled = isProcessing || isStreamingResponse; // Combined input disabled state

  return (
    <TooltipProvider delayDuration={100}>
      <div className="flex flex-col h-screen bg-background text-foreground overflow-hidden">

        {/* Header */}
        <header className="border-b p-3 flex items-center justify-between h-14 shrink-0 z-10 bg-background">
          <div className="flex items-center gap-2 flex-shrink min-w-0">
            <ModelIcon model={selectedModel} className="size-5 text-muted-foreground shrink-0" />
            <span className="text-sm font-medium truncate flex-shrink mr-1" title={chatTitle}>{chatTitle}</span>
            <Tooltip><TooltipTrigger asChild>
              <Button variant="ghost" size="icon" className="h-7 w-7 shrink-0"><Edit3 className="h-3.5 w-3.5 text-muted-foreground hover:text-foreground" /></Button>
            </TooltipTrigger><TooltipContent>Rename Chat</TooltipContent></Tooltip>
            <Tooltip><TooltipTrigger asChild>
              <Button variant="ghost" size="icon" onClick={handleStartNewChat} className="h-7 w-7 shrink-0"><Plus className="h-4 w-4" /></Button>
            </TooltipTrigger><TooltipContent>New Chat</TooltipContent></Tooltip>
          </div>
          <div className="flex items-center gap-2 shrink-0">
            <ModelSelector
              availableModels={availableModels} selectedModel={selectedModel}
              onSelectModel={(model) => {
                setSelectedModel(model); setModelSettings(prev => ({ ...prev, modelId: model.id }));
                if (messages.length <= 1 && messages[0]?.role === 'assistant' && !messages[0]?.isLoading) { setMessages([createInitialAssistantMessage(model)]); }
              }}
            />
            <Dialog open={isSettingsDialogOpen} onOpenChange={setIsSettingsDialogOpen}>
              <Tooltip><TooltipTrigger asChild><DialogTrigger asChild>
                <Button variant="ghost" size="icon" className="h-9 w-9"><Settings className="h-5 w-5" /></Button>
              </DialogTrigger></TooltipTrigger><TooltipContent>Settings</TooltipContent></Tooltip>
              <ChatSettingsDialog
                isOpen={isSettingsDialogOpen} onOpenChange={setIsSettingsDialogOpen}
                modelSettings={modelSettings} setModelSettings={setModelSettings}
                uiSettings={uiSettings} setUISettings={setUISettings}
                availableModels={modelOptions}
                onClearHistory={handleClearHistory} onExportChat={handleExportChat}
                defaultModelSettings={defaultModelSettings} defaultUISettings={defaultUISettings}
              />
            </Dialog>
          </div>
        </header>

        {/* Messages Area */}
        <ScrollArea className="flex-1 min-h-0" ref={scrollAreaRef}>
          <div className="max-w-4xl mx-auto px-4 pt-6 pb-10 space-y-4">
            {messages.length <= 1 && !isProcessing && !isStreamingResponse && !messages.some(m => m.role === 'user') && (
              <ChatWelcomeSuggestions onSuggestionClick={(text) => { setNewMessage(text); inputRef.current?.focus(); }} />
            )}
            {messages.map((message, index) => (
              <MessageItem
                key={message.id}
                message={message}
                selectedModel={selectedModel}
                isLastAssistantMessage={index === messages.length - 1 && message.role === 'assistant'}
                onCopy={handleCopyMessage}
                copiedMessageId={copiedMessageId}
                onRegenerate={handleRegenerateResponse}
                onFeedback={handleFeedback}
                showTimestamp={uiSettings.showTimestamps}
                isCompact={uiSettings.compactMode}
                enableMarkdown={uiSettings.enableMarkdown}
                isProcessingOrStreaming={isInputDisabled} // Combined state for Regenerate button
                onAnimationComplete={handleAnimationComplete}
              />
            ))}
            <div id="message-end-anchor" className="h-px" /> {/* Use ID for potential scroll targeting */}
          </div>
        </ScrollArea>

        {/* Input Area */}
        <footer className="border-t pt-3 pb-2 shrink-0 bg-background/95 backdrop-blur-sm">
          <div className="max-w-4xl mx-auto px-4 space-y-3">
            {/* File Preview Area */}
            {selectedFiles.length > 0 && (
              <ScrollArea className="max-h-40 w-full">
                <div className="flex items-center gap-2 p-2 border rounded-lg bg-muted/40 w-max">
                  {selectedFiles.map((file) =>
                    file.previewUrl && file.type.startsWith('image/') ? (
                      <ImagePreviewBadge key={file.id} file={file} onRemove={removeFile} />
                    ) : (
                      <FilePreviewBadge key={file.id} file={file} onRemove={removeFile} />
                    )
                  )}
                </div>
                <div className="h-2"></div> {/* Scrollbar padding */}
              </ScrollArea>
            )}
            {/* Input Form */}
            <div className="relative flex items-end gap-2">
              <Tooltip><TooltipTrigger asChild>
                <Button type="button" variant="ghost" size="icon" className="shrink-0 h-10 w-10 rounded-full disabled:opacity-50"
                  onClick={() => fileInputRef.current?.click()}
                  disabled={isInputDisabled || selectedFiles.length >= MAX_FILES || (!selectedModel.supportsFiles && selectedFiles.length > 0)}
                  aria-label="Attach file">
                  <Paperclip className="h-5 w-5" />
                </Button>
              </TooltipTrigger><TooltipContent>{
                !selectedModel.supportsFiles ? `${selectedModel.name} does not support files`
                  : selectedFiles.length >= MAX_FILES ? `Max ${MAX_FILES} files` : `Attach files (Max ${MAX_FILE_SIZE_MB}MB)`}
                </TooltipContent></Tooltip>
              <input type="file" ref={fileInputRef} multiple onChange={handleFileChange} className="hidden"
                accept="image/*,application/pdf,.txt,.csv,.json,.xml,.html,.css,.js,.ts,.jsx,.tsx,.py,.java,.c,.cpp,.cs,.rb,.php,.swift,.kt,.md,.docx,.xlsx,.pptx"
                disabled={isInputDisabled || !selectedModel.supportsFiles || selectedFiles.length >= MAX_FILES}
              />
              <div className="relative flex-1">
                <Textarea
                  ref={inputRef} value={newMessage}
                  onChange={(e) => setNewMessage(e.target.value)}
                  onKeyDown={handleKeyDown}
                  placeholder={isInputDisabled ? "Waiting for response..." : `Message ${selectedModel.name}...`}
                  className="min-h-[44px] max-h-[250px] pr-4 pl-3 py-2.5 resize-none overflow-y-auto rounded-xl border-border focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-0 shadow-sm bg-background disabled:cursor-not-allowed"
                  rows={1} disabled={isInputDisabled}
                />
              </div>
              <Button type="button" onClick={handleSendMessage}
                disabled={(!newMessage.trim() && selectedFiles.length === 0) || isInputDisabled}
                className="shrink-0 h-10 w-10 rounded-full p-0 flex items-center justify-center bg-primary hover:bg-primary/90 text-primary-foreground disabled:opacity-50"
                aria-label="Send message">
                {isProcessing ? <Loader2 className="h-5 w-5 animate-spin" /> : <ArrowUp className="h-5 w-5" />}
              </Button>
            </div>
            {/* Footer Info */}
            <p className="text-xs text-center text-muted-foreground px-4 pt-1">
              AI responses can be inaccurate. Verify important information. Model: {selectedModel.name} ({selectedModel.provider})
            </p>
          </div>
        </footer>
      </div>
    </TooltipProvider>
  );
}


// --- Prop Types for Subcomponents ---
interface ModelSelectorProps {
  availableModels: Model[];
  selectedModel: Model;
  onSelectModel: (model: Model) => void;
}

interface FilePreviewBadgeProps {
  file: FilePreview;
  onRemove: (fileId: string) => void;
}

interface ChatWelcomeSuggestionsProps {
  onSuggestionClick: (text: string) => void;
}

interface MessageItemProps {
  message: Message;
  selectedModel: Model;
  isLastAssistantMessage: boolean;
  onCopy: (content: string, messageId: string) => void;
  copiedMessageId: string | null;
  onRegenerate: () => void;
  onFeedback: (messageId: string, feedback: 'good' | 'bad') => void;
  showTimestamp: boolean;
  isCompact: boolean;
  enableMarkdown?: boolean;
  isProcessingOrStreaming: boolean; // Combined state from parent
  onAnimationComplete?: () => void;
}

// --- Sub Components ---

const ModelIcon: React.FC<{ model: Model, className?: string }> = ({ model, className }) => {
  const IconComponent = model.icon || Bot;
  return <IconComponent className={cn("h-4 w-4", className)} />;
};

const ModelSelector: React.FC<ModelSelectorProps> = ({ availableModels, selectedModel, onSelectModel }) => {
  const [isOpen, setIsOpen] = useState(false);
  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger asChild>
        <Button variant="ghost" size="sm" className="gap-1.5 px-2 h-9">
          <ModelIcon model={selectedModel} className="h-4 w-4 shrink-0" />
          <span className="font-medium truncate max-w-[100px] sm:max-w-[180px] text-sm">{selectedModel.name}</span>
          <ChevronDown className="h-4 w-4 text-muted-foreground ml-0.5 opacity-75 shrink-0" />
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-[380px] p-0" align="end">
        <Command><CommandInput placeholder="Search models..." /><CommandList><CommandEmpty>No model found.</CommandEmpty><CommandGroup heading="Available Models">
          {availableModels.map((model) => (
            <CommandItem key={model.id} value={model.name} onSelect={() => { onSelectModel(model); setIsOpen(false); }} className="cursor-pointer aria-selected:bg-accent group">
              <div className="flex items-center justify-between w-full">
                <div className="flex items-center gap-3">
                  <ModelIcon model={model} className="h-5 w-5 group-aria-selected:text-foreground text-muted-foreground" />
                  <div><p className="text-sm font-medium">{model.name}</p><p className="text-xs text-muted-foreground">{model.provider}</p></div>
                </div>
                <div className="flex flex-wrap gap-1 justify-end max-w-[45%]">
                  {model.tags.slice(0, 2).map((tag) => (<Badge key={tag} variant="secondary" className="text-xs px-1.5 py-0.5">{tag}</Badge>))}
                </div>
              </div>
              {selectedModel.id === model.id && (<Check className="ml-auto h-4 w-4 text-primary pl-2 shrink-0" />)}
            </CommandItem>
          ))}
        </CommandGroup></CommandList></Command>
      </PopoverContent>
    </Popover>
  );
};

const MessageItem: React.FC<MessageItemProps> = React.memo(({
  message, selectedModel, isLastAssistantMessage, onCopy, copiedMessageId,
  onRegenerate, onFeedback, showTimestamp, isCompact, enableMarkdown = true,
  isProcessingOrStreaming, onAnimationComplete
}) => {
  const isUser = message.role === 'user';
  const CopyIcon = copiedMessageId === message.id ? ClipboardCheck : Clipboard;
  const modelForMessage = availableModels.find(m => m.name === message.modelUsed) || selectedModel;
  const messagePadding = isCompact ? 'px-3 py-2' : 'px-4 py-3';

  const [displayedContent, setDisplayedContent] = useState(message.content || '');
  const [isAnimating, setIsAnimating] = useState(false);
  const prevIsLoadingRef = useRef<boolean | undefined>(message.isLoading);

  useEffect(() => {
    const finishedLoading = prevIsLoadingRef.current === true && message.isLoading === false;
    if (!isUser && finishedLoading && message.content) {
      setIsAnimating(true); setDisplayedContent('');
      let charIndex = 0; const fullContent = message.content;
      const intervalId = setInterval(() => {
        setDisplayedContent((prev) => prev + fullContent[charIndex]); charIndex++;
        if (charIndex === fullContent.length) {
          clearInterval(intervalId); setIsAnimating(false); onAnimationComplete?.();
        }
      }, ANIMATION_SPEED_MS);
      return () => clearInterval(intervalId);
    }
    if (!isUser && !message.isLoading && !isAnimating && displayedContent !== message.content) { setDisplayedContent(message.content || ''); }
    prevIsLoadingRef.current = message.isLoading;
  }, [message.isLoading, message.content, message.id, isUser, onAnimationComplete]);

  const renderContent = (content: string) => {
    if (!enableMarkdown) { return content.split('\n').map((p, i) => <p key={i} className={cn(i > 0 ? "mt-2" : "", "min-h-[1em]")}>{p || '\u00A0'}</p>); }
    let html = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/`(.*?)`/g, '<code class="bg-muted px-1 py-0.5 rounded text-sm">$1</code>');
    return html.split('\n').map((p, i) => <p key={i} className={cn(i > 0 ? "mt-2" : "", "min-h-[1em]")} dangerouslySetInnerHTML={{ __html: p || 'Â ' }} />);
  };

  const contentToRender = isUser ? message.content : displayedContent;
  const showActionButtons = !isUser && !message.isLoading && !isAnimating;

  return (
    <div className={cn('flex w-full', isUser ? 'justify-end' : 'justify-start', !isCompact ? 'mb-4' : 'mb-2')}>
      <div className={cn('flex gap-2.5 max-w-[85%]', isUser ? 'flex-row-reverse' : 'flex-row')}>
        {/* Avatar */}
        <Avatar className={cn('h-7 w-7 border shrink-0', isUser ? 'mt-auto mb-1' : 'mt-1')}>
          <AvatarFallback className={cn(isUser ? 'bg-primary/10' : 'bg-muted')}>
            {isUser ? <User className="h-4 w-4 text-primary" /> : <ModelIcon model={modelForMessage} className="h-4 w-4 text-foreground" />}
          </AvatarFallback>
        </Avatar>

        {/* Message Column */}
        <div className="flex flex-col w-full"> {/* Ensure this column takes full width */}
          {/* Message Bubble */}
          <div
            className={cn(
              "relative group flex flex-col rounded-xl shadow-sm min-w-[40px]",
              messagePadding,
              isUser
                ? 'bg-primary text-primary-foreground rounded-br-sm'
                // Force assistant bubble to take full width within its parent column
                : 'bg-muted text-foreground rounded-bl-sm w-full'
            )}
          >
            {!isUser && !isCompact && (<div className="text-xs font-medium mb-1.5 text-muted-foreground">{modelForMessage.name}</div>)}

            <div className="prose prose-sm dark:prose-invert max-w-none break-words leading-relaxed">
              {message.isLoading && !isUser ? (
                <div className="flex items-center space-x-1 py-1">
                  <div className="h-1.5 w-1.5 rounded-full bg-current animate-pulse animation-delay-[-0.3s]"></div><div className="h-1.5 w-1.5 rounded-full bg-current animate-pulse animation-delay-[-0.15s]"></div><div className="h-1.5 w-1.5 rounded-full bg-current animate-pulse"></div>
                </div>
              ) : (renderContent(contentToRender))}
              {!isUser && isAnimating && (<span className="inline-block w-1 h-4 bg-foreground ml-px animate-pulse"></span>)}
            </div>

            {/* Attached Files (User only) */}
            {isUser && message.files && message.files.length > 0 && (
              <div className="mt-2.5 border-t border-primary/30 pt-2.5 space-y-2">
                {message.files.map((file, index) => (
                  <div key={index} className="flex items-center gap-2 p-1.5 rounded-md bg-primary/10 hover:bg-primary/20 cursor-default text-sm text-primary-foreground/90">
                    {file.previewUrl && file.type.startsWith('image/') ? (
                      <img src={file.previewUrl} alt={file.name} className="h-8 w-8 rounded object-cover flex-shrink-0 border border-primary/20" loading="lazy" />
                    ) : (
                      <div className="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-primary/20 rounded">
                        {file.type.startsWith('image/') ? <ImageIcon className="h-4 w-4 text-primary-foreground/70" /> : <FileText className="h-4 w-4 text-primary-foreground/70" />}
                      </div>
                    )}
                    <div className="flex-1 min-w-0">
                      <p className="truncate font-medium text-xs" title={file.name}>{file.name}</p>
                      <p className="text-xs text-primary-foreground/70">{formatFileSize(file.size)} - {file.type.split('/')[1] || 'file'}</p>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Action Buttons */}
            {showActionButtons && (
              <div className="absolute -bottom-7 right-0 flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <Tooltip><TooltipTrigger asChild>
                  <Button variant="ghost" size="icon" className="h-6 w-6 text-muted-foreground hover:text-foreground" onClick={() => onCopy(message.content, message.id)}><CopyIcon className="h-3.5 w-3.5" /></Button>
                </TooltipTrigger><TooltipContent side="bottom">{copiedMessageId === message.id ? "Copied!" : "Copy"}</TooltipContent></Tooltip>
                <Tooltip><TooltipTrigger asChild>
                  <Button variant="ghost" size="icon" className={cn("h-6 w-6 text-muted-foreground hover:text-emerald-500", message.feedback === 'good' ? 'text-emerald-500 bg-emerald-500/10' : '')} onClick={() => onFeedback(message.id, 'good')}><ThumbsUp className="h-3.5 w-3.5" /></Button>
                </TooltipTrigger><TooltipContent side="bottom">Good</TooltipContent></Tooltip>
                <Tooltip><TooltipTrigger asChild>
                  <Button variant="ghost" size="icon" className={cn("h-6 w-6 text-muted-foreground hover:text-red-500", message.feedback === 'bad' ? 'text-red-500 bg-red-500/10' : '')} onClick={() => onFeedback(message.id, 'bad')}><ThumbsDown className="h-3.5 w-3.5" /></Button>
                </TooltipTrigger><TooltipContent side="bottom">Bad</TooltipContent></Tooltip>
                {isLastAssistantMessage && (
                  <Tooltip><TooltipTrigger asChild>
                    {/* Disable Regenerate if processing or streaming */}
                    <Button variant="ghost" size="icon" className="h-6 w-6 text-muted-foreground hover:text-foreground disabled:opacity-50" onClick={onRegenerate} disabled={isProcessingOrStreaming}>
                      <RefreshCcw className="h-3.5 w-3.5" />
                    </Button>
                  </TooltipTrigger><TooltipContent side="bottom">{isProcessingOrStreaming ? "Processing..." : "Regenerate"}</TooltipContent></Tooltip>
                )}
              </div>
            )}
          </div>
          {/* Timestamp */}
          {showTimestamp && (<div className={cn('text-xs text-muted-foreground mt-1', isUser ? 'text-right' : 'text-left')}>{formatTimestamp(message.timestamp)}</div>)}
        </div>
      </div>
    </div>
  );
});
MessageItem.displayName = 'MessageItem';


const FilePreviewBadge: React.FC<FilePreviewBadgeProps> = ({ file, onRemove }) => {
  return (
    <div className="relative group flex items-center gap-1.5 pl-2 pr-1 py-1 h-8 rounded-md bg-background border hover:border-border text-xs max-w-[180px] shadow-sm">
      <FileText className="h-4 w-4 text-muted-foreground shrink-0" />
      <span className="truncate shrink" title={file.name}>{file.name}</span>
      <span className="text-muted-foreground/80 text-[10px] shrink-0 ml-auto mr-1">({formatFileSize(file.size)})</span>
      <Button
        variant="ghost" size="icon"
        className="absolute -top-1.5 -right-1.5 h-5 w-5 p-0 rounded-full bg-background border border-border text-muted-foreground hover:bg-muted focus:opacity-100 opacity-0 group-hover:opacity-100 z-20"
        onClick={() => onRemove(file.id)} aria-label={`Remove ${file.name}`}>
        <X className="h-3 w-3" />
      </Button>
    </div>
  );
};

const ImagePreviewBadge: React.FC<FilePreviewBadgeProps> = ({ file, onRemove }) => {
  return (
    <div className="relative group w-20 h-20 rounded-md overflow-hidden border bg-muted shadow-sm">
      {file.previewUrl && (<img src={file.previewUrl} alt={file.name} className="object-cover w-full h-full" loading="lazy" />)}
      <div className="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent p-1 pt-2">
        <p className="text-[10px] text-white truncate leading-tight" title={file.name}>{file.name}</p>
        <p className="text-[9px] text-white/80 leading-tight">{formatFileSize(file.size)}</p>
      </div>
      {/* UPDATED Remove Button: Subtle hover, positioned above */}
      <Button
        variant="ghost" size="icon"
        className="absolute -top-1.5 -right-1.5 h-5 w-5 p-0 rounded-full bg-background border border-border text-muted-foreground hover:bg-muted focus:opacity-100 opacity-0 group-hover:opacity-100 z-20"
        onClick={() => onRemove(file.id)} aria-label={`Remove ${file.name}`}>
        <X className="h-3 w-3" />
      </Button>
    </div>
  );
};

const ChatWelcomeSuggestions: React.FC<ChatWelcomeSuggestionsProps> = ({ onSuggestionClick }) => {
  const suggestions = ['Explain quantum computing simply', 'Python script to scrape website data', 'Ideas for a 10-day trip to Japan', 'Compare React and Vue',];
  return (
    <div className="flex flex-col items-center justify-center py-16 text-center">
      <div className="rounded-full border bg-background p-4 mb-6 shadow-sm"><Wand2 className="h-10 w-10 text-primary" /></div>
      <h2 className="text-2xl font-semibold mb-4">How can I help you today?</h2>
      <p className="text-muted-foreground mb-6 max-w-md">Start chatting or try one of these examples:</p>
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-xl mt-4">
        {suggestions.map((suggestion, index) => (
          <Card key={index} className="cursor-pointer hover:bg-accent  group text-left shadow-sm hover:shadow-md" onClick={() => onSuggestionClick(suggestion)}>
            <CardContent className="p-4 flex items-center gap-3">
              <p className="text-sm font-medium flex-1">{suggestion}</p>
              <ArrowUp className="h-4 w-4 text-muted-foreground ml-auto shrink-0 opacity-0 group-hover:opacity-100 transition-opacity -rotate-45 group-hover:rotate-0" />
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
};

export default ModernAIChatComponent;
```

## File: src/routes/(app)/library.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router';
import React, { useState, useMemo, useCallback } from 'react';
import {
    Book, List, Grid, Search, Filter, Plus, FileText, Globe, Code, Star,
    Clock, MoreHorizontal, Download, Share2, CheckCircle2,
    X, Tag, Library as ShelfIcon, Pencil, Highlighter, Trash2, Info, Eye, ArrowUpDown,
    Folder as FolderIcon
} from 'lucide-react';

import { Button } from "@app/ui/components/button";
import { Input } from "@app/ui/components/input";
import {
    Select, SelectContent, SelectItem, SelectTrigger, SelectValue
} from "@app/ui/components/select";
import {
    Card, CardContent, CardHeader, CardTitle, CardDescription
} from "@app/ui/components/card";
import { Badge } from "@app/ui/components/badge";
import { Progress } from "@app/ui/components/progress";
import {
    Table, TableBody, TableCell, TableHead, TableHeader, TableRow
} from "@app/ui/components/table";
import {
    Popover, PopoverContent, PopoverTrigger,
} from "@app/ui/components/popover";
import {
    DropdownMenu, DropdownMenuContent, DropdownMenuItem,
    DropdownMenuSeparator, DropdownMenuTrigger, DropdownMenuSub, DropdownMenuSubTrigger,
    DropdownMenuSubContent, DropdownMenuPortal, DropdownMenuCheckboxItem
} from "@app/ui/components/dropdown-menu";
import {
    Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger,
} from "@app/ui/components/dialog";
import {
    AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent,
    AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle,
    AlertDialogTrigger,
} from "@app/ui/components/alert-dialog";
import { Checkbox } from "@app/ui/components/checkbox";
import { ScrollArea } from "@app/ui/components/scroll-area";
import { Separator } from "@app/ui/components/separator";
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@app/ui/components/tooltip";

// --- Data Types ---
type ResourceType = 'pdf' | 'epub' | 'web' | 'snippet';

interface LibraryItem {
    id: string;
    title: string;
    author: string;
    type: ResourceType;
    tags: string[];
    dateAdded: string; // ISO Date string ideally, e.g., "2024-03-27T10:00:00Z"
    lastOpened: string; // ISO Date string ideally
    progress: number; // 0-100
    favorite: boolean;
    category?: string;
    cover?: string; // URL for pdf/epub cover
    url?: string; // URL for web type
    shelf: string; // Represents the primary folder/shelf
    annotations: number;
    highlights: number;
    notes: number;
    description?: string; // Added for more detail
    publisher?: string; // Added for more detail
    year?: number; // Added for more detail
}

// --- Sample Data (Use your actual data fetching logic) ---
const SAMPLE_LIBRARY_ITEMS: LibraryItem[] = [
    // ... (Keep your existing sample data, ensuring it matches the LibraryItem interface)
    // Example update for one item:
    {
        id: '1',
        title: 'Machine Learning: A Probabilistic Perspective',
        author: 'Kevin P. Murphy',
        type: 'pdf',
        tags: ['Machine Learning', 'Statistics', 'Computer Science', 'AI'],
        dateAdded: '2024-02-15T10:00:00Z',
        lastOpened: '2024-03-20T14:30:00Z',
        progress: 67,
        favorite: true,
        category: 'Textbook',
        // cover: 'https://via.placeholder.com/150x220/3498db/FFFFFF?text=ML',
        annotations: 24,
        highlights: 36,
        notes: 8,
        shelf: 'Computer Science',
        description: 'A comprehensive introduction to machine learning from a probabilistic perspective.',
        publisher: 'MIT Press',
        year: 2012
    },
    {
        id: '2',
        title: 'The Design of Everyday Things',
        author: 'Don Norman',
        type: 'epub',
        tags: ['Design', 'UX', 'Psychology', 'Usability'],
        dateAdded: '2024-01-10T09:00:00Z',
        lastOpened: '2024-03-25T11:00:00Z',
        progress: 91,
        favorite: false,
        category: 'Design',
        // cover: 'https://via.placeholder.com/150x220/e74c3c/FFFFFF?text=Design',
        annotations: 15,
        highlights: 22,
        notes: 5,
        shelf: 'Design Resources',
        description: 'Explores the principles of human-centered design and usability.',
        publisher: 'Basic Books',
        year: 2013 // Revised edition year
    },
    {
        id: '3',
        title: 'Research Methods in Education',
        author: 'Louis Cohen, Lawrence Manion, Keith Morrison',
        type: 'pdf',
        tags: ['Education', 'Research', 'Methodology'],
        dateAdded: '2024-03-01T12:00:00Z',
        lastOpened: '2024-03-25T09:15:00Z',
        progress: 23,
        favorite: true,
        category: 'Reference',
        // cover: 'https://via.placeholder.com/150x220/2ecc71/FFFFFF?text=Research',
        annotations: 8,
        highlights: 14,
        notes: 3,
        shelf: 'Education Studies',
        description: 'A standard text for students and researchers in education.',
        publisher: 'Routledge',
        year: 2017 // 8th Edition
    },
    {
        id: '5',
        title: 'Deep Learning Trends in 2024',
        author: 'AI Research Blog',
        type: 'web',
        url: 'https://example.com/ai-trends-2024',
        tags: ['AI', 'Deep Learning', 'Trends', 'Blog Post'],
        dateAdded: '2024-03-15T16:00:00Z',
        lastOpened: '2024-03-26T10:00:00Z',
        progress: 100, // Assume read if it's a blog post? Or track scroll?
        favorite: false,
        category: 'Article',
        // No cover for web, icon will be used
        annotations: 3,
        highlights: 7,
        notes: 1,
        shelf: 'AI Articles',
        description: 'An overview of the latest trends and advancements in deep learning.'
    },
    {
        id: '8',
        title: 'Python List Comprehensions',
        author: 'Code Snippets',
        type: 'snippet',
        tags: ['Python', 'Code', 'List Comprehension'],
        dateAdded: '2024-03-12T08:30:00Z',
        lastOpened: '2024-03-24T17:00:00Z',
        progress: 100, // Snippets are usually small
        favorite: true,
        category: 'Code Snippets',
        // No cover for snippet, icon will be used
        annotations: 1,
        highlights: 0, // Might not highlight code snippets often
        notes: 2,
        shelf: 'Python Cheatsheets',
        description: 'Quick examples of using list comprehensions in Python.'
    }
    // ... Add more diverse items
];

// --- Constants (Derived from data or predefined) ---
const ALL_TYPES: Array<'All' | ResourceType> = ['All', 'pdf', 'epub', 'web', 'snippet'];
type SortOption = 'title' | 'author' | 'dateAdded' | 'lastOpened' | 'progress';
type SortDirection = 'asc' | 'desc';

// --- Helper Functions ---
const getFileIcon = (type: ResourceType): React.ReactNode => {
    switch (type) {
        case 'pdf': return <FileText className="h-5 w-5 text-red-500" />;
        case 'epub': return <Book className="h-5 w-5 text-blue-500" />;
        case 'web': return <Globe className="h-5 w-5 text-green-500" />;
        case 'snippet': return <Code className="h-5 w-5 text-purple-500" />;
        default: return <FileText className="h-5 w-5 text-gray-500" />;
    }
};

const formatDate = (dateString: string): string => {
    try {
        return new Date(dateString).toLocaleDateString(undefined, {
            year: 'numeric', month: 'short', day: 'numeric'
        });
    } catch (e) {
        return 'Invalid Date';
    }
};

// --- Reusable Components ---

interface ItemActionsProps {
    item: LibraryItem;
    onToggleFavorite: (id: string) => void;
    onDelete: (id: string) => void;
    availableShelves: string[];
    availableTags: string[];
    onAddToShelf: (itemId: string, shelf: string) => void; // Placeholder
    onAddToTag: (itemId: string, tag: string) => void; // Placeholder
    onRemoveTag: (itemId: string, tag: string) => void; // Placeholder
}

const ItemActions: React.FC<ItemActionsProps> = ({
    item, onToggleFavorite, onDelete, availableShelves, availableTags,
    onAddToShelf, onAddToTag, onRemoveTag
}) => {
    // Placeholder actions - replace with your actual logic
    const handleOpen = () => {
        console.log("Opening item:", item.id);
        // Example navigation: navigate({ to: `/library/${item.id}` });
    };
    const handleDownload = () => console.log("Download item:", item.id);
    const handleShare = () => console.log("Share item:", item.id);

    return (
        <Dialog>
            <AlertDialog>
                <DropdownMenu>
                    <DropdownMenuTrigger asChild>
                        <Button variant="ghost" size="icon" className="h-8 w-8">
                            <MoreHorizontal className="h-4 w-4" />
                            <span className="sr-only">More actions</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent align="end" className="w-56">
                        <DropdownMenuItem onClick={handleOpen}>
                            <Eye className="mr-2 h-4 w-4" /> Open
                        </DropdownMenuItem>
                        <DialogTrigger asChild>
                            <DropdownMenuItem>
                                <Info className="mr-2 h-4 w-4" /> View Details
                            </DropdownMenuItem>
                        </DialogTrigger>
                        <DropdownMenuItem onClick={() => onToggleFavorite(item.id)}>
                            <Star className={`mr-2 h-4 w-4 ${item.favorite ? 'fill-yellow-400 text-yellow-500' : ''}`} />
                            {item.favorite ? 'Remove from Favorites' : 'Add to Favorites'}
                        </DropdownMenuItem>
                        <DropdownMenuSeparator />
                        <DropdownMenuSub>
                            <DropdownMenuSubTrigger>
                                <ShelfIcon className="mr-2 h-4 w-4" /> Move to Shelf
                            </DropdownMenuSubTrigger>
                            <DropdownMenuPortal>
                                <DropdownMenuSubContent>
                                    <ScrollArea className="h-[200px]">
                                        {availableShelves.map(shelf => (
                                            <DropdownMenuCheckboxItem
                                                key={shelf}
                                                checked={item.shelf === shelf}
                                                onCheckedChange={() => onAddToShelf(item.id, shelf)}
                                            >
                                                {shelf}
                                            </DropdownMenuCheckboxItem>
                                        ))}
                                    </ScrollArea>
                                </DropdownMenuSubContent>
                            </DropdownMenuPortal>
                        </DropdownMenuSub>
                        <DropdownMenuSub>
                            <DropdownMenuSubTrigger>
                                <Tag className="mr-2 h-4 w-4" /> Manage Tags
                            </DropdownMenuSubTrigger>
                            <DropdownMenuPortal>
                                <DropdownMenuSubContent>
                                    <ScrollArea className="h-[200px]">
                                        {availableTags.map(tag => (
                                            <DropdownMenuCheckboxItem
                                                key={tag}
                                                checked={item.tags.includes(tag)}
                                                onCheckedChange={(checked) => {
                                                    if (checked) {
                                                        onAddToTag(item.id, tag);
                                                    } else {
                                                        onRemoveTag(item.id, tag);
                                                    }
                                                }}
                                            >
                                                {tag}
                                            </DropdownMenuCheckboxItem>
                                        ))}
                                    </ScrollArea>
                                </DropdownMenuSubContent>
                            </DropdownMenuPortal>
                        </DropdownMenuSub>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem onClick={handleDownload} disabled={item.type === 'web' || item.type === 'snippet'}>
                            <Download className="mr-2 h-4 w-4" /> Download
                        </DropdownMenuItem>
                        <DropdownMenuItem onClick={handleShare}>
                            <Share2 className="mr-2 h-4 w-4" /> Share
                        </DropdownMenuItem>
                        <DropdownMenuSeparator />
                        <AlertDialogTrigger asChild>
                            <DropdownMenuItem variant='destructive'>
                                <Trash2 className="mr-2 h-4 w-4" /> Delete Resource
                            </DropdownMenuItem>
                        </AlertDialogTrigger>
                    </DropdownMenuContent>
                </DropdownMenu>

                {/* Item Details Dialog Content */}
                <ItemDetailsDialog item={item} />

                {/* Delete Confirmation Dialog Content */}
                <AlertDialogContent>
                    <AlertDialogHeader>
                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
                        <AlertDialogDescription>
                            This action cannot be undone. This will permanently delete
                            "{item.title}" and all associated annotations and notes.
                        </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                        <AlertDialogCancel>Cancel</AlertDialogCancel>
                        <AlertDialogAction
                            onClick={() => onDelete(item.id)}
                            className="bg-red-600 hover:bg-red-700 text-white"
                        >
                            Yes, delete it
                        </AlertDialogAction>
                    </AlertDialogFooter>
                </AlertDialogContent>
            </AlertDialog>
        </Dialog>
    );
};

interface ItemDetailsDialogProps {
    item: LibraryItem;
}
const ItemDetailsDialog: React.FC<ItemDetailsDialogProps> = ({ item }) => (
    <DialogContent className="sm:max-w-[600px]">
        <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
                {getFileIcon(item.type)} {item.title}
            </DialogTitle>
            <DialogDescription>
                By {item.author} {item.year ? `(${item.year})` : ''}
                {item.publisher ? ` - ${item.publisher}` : ''}
            </DialogDescription>
        </DialogHeader>
        <div className="grid gap-4 py-4">
            {item.description && (
                <p className="text-sm text-muted-foreground">{item.description}</p>
            )}
            <Separator />
            <div className="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                <div className="font-medium text-muted-foreground">Category:</div>
                <div>{item.category || 'N/A'}</div>

                <div className="font-medium text-muted-foreground">Shelf:</div>
                <div>{item.shelf || 'Uncategorized'}</div>

                <div className="font-medium text-muted-foreground">Date Added:</div>
                <div>{formatDate(item.dateAdded)}</div>

                <div className="font-medium text-muted-foreground">Last Opened:</div>
                <div>{formatDate(item.lastOpened)}</div>

                <div className="font-medium text-muted-foreground">Progress:</div>
                <div className="flex items-center gap-2">
                    <Progress value={item.progress} className="h-2 w-24" />
                    <span>{item.progress}%</span>
                </div>

                <div className="font-medium text-muted-foreground">Annotations:</div>
                <div>{item.annotations}</div>

                <div className="font-medium text-muted-foreground">Highlights:</div>
                <div>{item.highlights}</div>

                <div className="font-medium text-muted-foreground">Notes:</div>
                <div>{item.notes}</div>
            </div>
            {item.tags.length > 0 && (
                <>
                    <Separator />
                    <div>
                        <div className="font-medium text-muted-foreground mb-2">Tags:</div>
                        <div className="flex flex-wrap gap-2">
                            {item.tags.map(tag => (
                                <Badge key={tag} variant="secondary">{tag}</Badge>
                            ))}
                        </div>
                    </div>
                </>
            )}
            {item.url && item.type === 'web' && (
                <>
                    <Separator />
                    <div>
                        <div className="font-medium text-muted-foreground mb-1">URL:</div>
                        <a href={item.url} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:underline break-all">
                            {item.url}
                        </a>
                    </div>
                </>
            )}
        </div>
        <DialogFooter>
            <Button type="button" variant="secondary" onClick={() => { /* Add close logic if needed, Shadcn Dialog closes by default */ }}>
                Close
            </Button>
            {/* Could add an Edit button here */}
        </DialogFooter>
    </DialogContent>
);

interface LibraryCardProps extends ItemActionsProps {
    item: LibraryItem;
}

const LibraryCard: React.FC<LibraryCardProps> = ({ item, ...actionProps }) => (
    <Card className="flex flex-col overflow-hidden transition-shadow duration-200 hover:shadow-lg pt-0 pb-5">
        <CardHeader className="p-0 relative">
            {item.cover ? (
                <img
                    src={item.cover}
                    alt={item.title}
                    className="w-full h-48 object-cover" // Increased height
                />
            ) : (
                <div className="w-full h-48 bg-muted flex items-center justify-center">
                    <div className="scale-[2]">{getFileIcon(item.type)}</div> {/* Make icon larger */}
                </div>
            )}
            {/* Favorite button positioned top-right */}
            <Button
                variant="ghost"
                size="icon"
                onClick={() => actionProps.onToggleFavorite(item.id)}
                className="absolute top-2 left-2 h-8 w-8 bg-background/70 hover:bg-background rounded-full"
                aria-label={item.favorite ? 'Remove from favorites' : 'Add to favorites'}
            >
                <Star className={`h-4 w-4 ${item.favorite ? 'fill-yellow-400 text-yellow-500' : 'text-muted-foreground'}`} />
            </Button>
            <div
                className="absolute top-2 right-2 h-8 w-8 bg-background/70 hover:bg-background rounded-full"
            >
                <ItemActions item={item} {...actionProps} />
            </div>
        </CardHeader>
        <CardContent className="px-4 flex-grow flex flex-col justify-between">
            <div>
                <CardTitle className="text-base font-semibold leading-tight mb-1 line-clamp-2" title={item.title}>
                    {item.title}
                </CardTitle>
                <CardDescription className="text-xs text-muted-foreground mb-3 line-clamp-1" title={item.author}>
                    {item.author}
                </CardDescription>

                {/* Tags */}
                <div className="flex flex-wrap gap-1 mb-3">
                    {item.tags.slice(0, 3).map(tag => (
                        <Badge key={tag} variant="secondary" className="text-xs px-1.5 py-0.5">{tag}</Badge>
                    ))}
                    {item.tags.length > 3 && (
                        <TooltipProvider>
                            <Tooltip>
                                <TooltipTrigger>
                                    <Badge variant="outline" className="text-xs px-1.5 py-0.5">+{item.tags.length - 3}</Badge>
                                </TooltipTrigger>
                                <TooltipContent>
                                    <p>{item.tags.slice(3).join(', ')}</p>
                                </TooltipContent>
                            </Tooltip>
                        </TooltipProvider>
                    )}
                </div>

                {/* Annotations & Highlights */}
                <div className="flex items-center justify-between gap-4 text-xs text-muted-foreground mb-3">
                    <div className='flex gap-2'>
                        <TooltipProvider>
                            <Tooltip>
                                <TooltipTrigger className='flex items-center'>
                                    <Pencil className="h-3.5 w-3.5 mr-1" /> {item.annotations}
                                </TooltipTrigger>
                                <TooltipContent>{item.annotations} Annotations</TooltipContent>
                            </Tooltip>
                            <Tooltip>
                                <TooltipTrigger className='flex items-center'>
                                    <Highlighter className="h-3.5 w-3.5 mr-1" /> {item.highlights}
                                </TooltipTrigger>
                                <TooltipContent>{item.highlights} Highlights</TooltipContent>
                            </Tooltip>
                        </TooltipProvider>
                    </div>
                    <TooltipProvider>
                        <Tooltip>
                            <TooltipTrigger className='flex items-center'>
                                <Clock className="h-3.5 w-3.5 mr-1" /> {formatDate(item.lastOpened)}
                            </TooltipTrigger>
                            <TooltipContent>Last Opened {formatDate(item.lastOpened)}</TooltipContent>
                        </Tooltip>
                    </TooltipProvider>
                </div>
            </div>

            {/* Progress */}
            <div className="">
                <div className="flex justify-between items-center text-xs text-muted-foreground mb-1">
                    <span>Progress</span>
                    <span>{item.progress}%</span>
                </div>
                <Progress value={item.progress} className="h-1.5" />
            </div>
        </CardContent>
    </Card >
);


interface LibraryListItemProps extends ItemActionsProps {
    item: LibraryItem;
    onSortChange: (option: SortOption) => void;
    currentSort: SortOption;
    sortDirection: SortDirection;
}

// Header Row Component (Optional but good for structure)
const LibraryListHeader: React.FC<Pick<LibraryListItemProps, 'onSortChange' | 'currentSort' | 'sortDirection'>> = ({ onSortChange, currentSort, sortDirection }) => {
    const SortableHeader: React.FC<{ children: React.ReactNode, sortKey: SortOption }> = ({ children, sortKey }) => (
        <TableHead className="px-4 py-3 whitespace-nowrap">
            <Button
                variant="ghost"
                size="sm"
                onClick={() => onSortChange(sortKey)}
                className="flex items-center gap-1 -ml-2 px-2"
            >
                {children}
                {currentSort === sortKey && (
                    <ArrowUpDown className={`h-3 w-3 transition-transform ${sortDirection === 'desc' ? 'rotate-180' : ''}`} />
                )}
            </Button>
        </TableHead>
    );

    return (
        <TableHeader>
            <TableRow className="bg-muted/50">
                <SortableHeader sortKey="title">Title / Author</SortableHeader>
                <TableHead className="px-4 py-3">Type / Shelf</TableHead>
                <TableHead className="px-4 py-3">Tags</TableHead>
                <SortableHeader sortKey="progress">Progress</SortableHeader>
                <TableHead className="px-4 py-3 text-center">Ann. / High.</TableHead>
                <SortableHeader sortKey="lastOpened">Last Opened</SortableHeader>
                <TableHead className="px-4 py-3 text-right">Actions</TableHead>
            </TableRow>
        </TableHeader>
    );
};

const LibraryListItem: React.FC<Omit<LibraryListItemProps, 'onSortChange' | 'currentSort' | 'sortDirection'>> = ({ item, ...actionProps }) => (
    <TableRow key={item.id} className="hover:bg-muted/50 align-top">
        {/* Title / Author / Favorite */}
        <TableCell className="px-4 py-3 font-medium align-top">
            <div className="flex items-start gap-3 max-w-xs">
                {item.cover ? (
                    <img src={item.cover} alt={item.title} className="h-12 w-9 object-cover rounded flex-shrink-0 mt-0.5" />
                ) : (
                    <div className="h-12 w-9 flex items-center justify-center rounded bg-muted flex-shrink-0 mt-0.5">
                        <div className="scale-110">{getFileIcon(item.type)}</div>
                    </div>
                )}
                <div className="flex-grow">
                    <div className="flex items-start gap-1">
                        <span className="font-semibold text-sm line-clamp-2 leading-snug" title={item.title}>{item.title}</span>
                        {item.favorite && (
                            <TooltipProvider>
                                <Tooltip>
                                    <TooltipTrigger>
                                        <Star className="h-3.5 w-3.5 fill-yellow-400 text-yellow-500 flex-shrink-0 mt-0.5" />
                                    </TooltipTrigger>
                                    <TooltipContent>Favorite</TooltipContent>
                                </Tooltip>
                            </TooltipProvider>
                        )}
                    </div>
                    <p className="text-xs text-muted-foreground line-clamp-1" title={item.author}>{item.author}</p>
                </div>
            </div>
        </TableCell>

        {/* Type / Shelf */}
        <TableCell className="px-4 py-3 align-top text-xs">
            <div className="flex items-center gap-1.5 mb-1" title={`Type: ${item.type}`}>
                {getFileIcon(item.type)}
                <span className="uppercase">{item.type}</span>
            </div>
            <div className="flex items-center gap-1.5 text-muted-foreground" title={`Shelf: ${item.shelf}`}>
                <FolderIcon className="h-4 w-4" />
                <span>{item.shelf}</span>
            </div>
        </TableCell>

        {/* Tags */}
        <TableCell className="px-4 py-3 align-top max-w-[150px]">
            <div className="flex flex-wrap gap-1">
                {item.tags.slice(0, 2).map(tag => (
                    <Badge key={tag} variant="secondary" className="text-xs px-1.5 py-0.5">{tag}</Badge>
                ))}
                {item.tags.length > 2 && (
                    <TooltipProvider>
                        <Tooltip>
                            <TooltipTrigger>
                                <Badge variant="outline" className="text-xs px-1.5 py-0.5">+{item.tags.length - 2}</Badge>
                            </TooltipTrigger>
                            <TooltipContent>
                                <p>{item.tags.slice(2).join(', ')}</p>
                            </TooltipContent>
                        </Tooltip>
                    </TooltipProvider>
                )}
            </div>
        </TableCell>

        {/* Progress */}
        <TableCell className="px-4 py-3 align-top">
            <div className="flex items-center gap-2">
                <Progress value={item.progress} className="w-20 h-1.5" />
                <span className="text-xs text-muted-foreground">{item.progress}%</span>
            </div>
        </TableCell>

        {/* Annotations / Highlights */}
        <TableCell className="px-4 py-3 align-top text-center">
            <div className="flex flex-col items-center">
                <div className="flex items-center gap-1 text-xs" title={`${item.annotations} Annotations`}>
                    <Pencil className="h-3 w-3 text-muted-foreground" /> {item.annotations}
                </div>
                <div className="flex items-center gap-1 text-xs mt-0.5" title={`${item.highlights} Highlights`}>
                    <Highlighter className="h-3 w-3 text-muted-foreground" /> {item.highlights}
                </div>
            </div>
        </TableCell>

        {/* Last Opened */}
        <TableCell className="px-4 py-3 align-top text-xs text-muted-foreground whitespace-nowrap">
            {formatDate(item.lastOpened)}
        </TableCell>

        {/* Actions */}
        <TableCell className="px-4 py-3 text-right align-top">
            <ItemActions item={item} {...actionProps} />
        </TableCell>
    </TableRow>
);

// --- Main Library Page Component ---
const LibraryPage = () => {
    // State management
    const [items, setItems] = useState<LibraryItem[]>(SAMPLE_LIBRARY_ITEMS); // Use fetched data
    const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
    const [searchQuery, setSearchQuery] = useState<string>('');
    const [sortOption, setSortOption] = useState<SortOption>('dateAdded');
    const [sortDirection, setSortDirection] = useState<SortDirection>('desc');
    const [selectedTags, setSelectedTags] = useState<string[]>([]);
    const [selectedCategory, setSelectedCategory] = useState<string>('All');
    const [selectedType, setSelectedType] = useState<string>('All');
    const [selectedShelf, setSelectedShelf] = useState<string>('All');
    const [showOnlyFavorites, setShowOnlyFavorites] = useState<boolean>(false);
    const [isFilterPopoverOpen, setIsFilterPopoverOpen] = useState<boolean>(false);

    // Memoized derived constants
    const availableTags = useMemo(() => Array.from(new Set(items.flatMap(item => item.tags))).sort(), [items]);
    const availableShelves = useMemo(() => Array.from(new Set(items.map(item => item.shelf))).sort(), [items]);
    const availableCategories = useMemo(() => ['All', ...Array.from(new Set(items.map(item => item.category).filter(Boolean) as string[]))].sort(), [items]);


    // Filter and sort items
    const filteredItems = useMemo(() => {
        let result = [...items];

        // Search
        if (searchQuery) {
            const lowerQuery = searchQuery.toLowerCase();
            result = result.filter(item =>
                item.title.toLowerCase().includes(lowerQuery) ||
                item.author.toLowerCase().includes(lowerQuery) ||
                item.tags.some(tag => tag.toLowerCase().includes(lowerQuery)) ||
                item.shelf.toLowerCase().includes(lowerQuery) ||
                (item.description && item.description.toLowerCase().includes(lowerQuery))
            );
        }

        // Filters
        if (selectedCategory !== 'All') result = result.filter(item => item.category === selectedCategory);
        if (selectedType !== 'All') result = result.filter(item => item.type === selectedType);
        if (selectedShelf !== 'All') result = result.filter(item => item.shelf === selectedShelf);
        if (selectedTags.length > 0) {
            result = result.filter(item => selectedTags.every(tag => item.tags.includes(tag)));
        }
        if (showOnlyFavorites) result = result.filter(item => item.favorite);

        // Sorting
        result.sort((a, b) => {
            let comparison = 0;
            const valA = a[sortOption];
            const valB = b[sortOption];

            if (sortOption === 'dateAdded' || sortOption === 'lastOpened') {
                // Handle potential invalid dates gracefully
                const dateA = new Date(valA as string).getTime();
                const dateB = new Date(valB as string).getTime();
                comparison = (isNaN(dateA) ? 0 : dateA) - (isNaN(dateB) ? 0 : dateB);
            } else if (typeof valA === 'string' && typeof valB === 'string') {
                comparison = valA.localeCompare(valB);
            } else if (typeof valA === 'number' && typeof valB === 'number') {
                comparison = valA - valB;
            }
            // Add more specific comparisons if needed (e.g., boolean)

            return sortDirection === 'asc' ? comparison : -comparison;
        });

        return result;
    }, [items, searchQuery, sortOption, sortDirection, selectedTags, selectedCategory, selectedType, selectedShelf, showOnlyFavorites]);

    // --- Action Handlers ---

    const handleSortChange = useCallback((option: SortOption) => {
        if (option === sortOption) {
            setSortDirection(prev => prev === 'asc' ? 'desc' : 'asc');
        } else {
            setSortOption(option);
            setSortDirection('desc'); // Default to descending for new sort column
        }
    }, [sortOption]);

    const toggleTag = useCallback((tag: string) => {
        setSelectedTags(prev =>
            prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]
        );
    }, []);

    const clearFilters = useCallback(() => {
        setSearchQuery('');
        setSelectedTags([]);
        setSelectedCategory('All');
        setSelectedType('All');
        setSelectedShelf('All');
        setShowOnlyFavorites(false);
        // Optionally reset sort:
        // setSortOption('dateAdded');
        // setSortDirection('desc');
        setIsFilterPopoverOpen(false); // Close popover on clear
    }, []);

    const removeFilter = useCallback((type: 'tag' | 'category' | 'type' | 'shelf' | 'favorites', value?: string) => {
        switch (type) {
            case 'tag':
                if (value) setSelectedTags(prev => prev.filter(t => t !== value));
                break;
            case 'category':
                setSelectedCategory('All');
                break;
            case 'type':
                setSelectedType('All');
                break;
            case 'shelf':
                setSelectedShelf('All');
                break;
            case 'favorites':
                setShowOnlyFavorites(false);
                break;
        }
    }, []);

    const toggleFavorite = useCallback((id: string) => {
        setItems(prevItems =>
            prevItems.map(item =>
                item.id === id ? { ...item, favorite: !item.favorite } : item
            )
        );
        // TODO: Add API call to update favorite status on the backend
    }, []);

    const deleteItem = useCallback((id: string) => {
        setItems(prevItems => prevItems.filter(item => item.id !== id));
        console.log("Deleted item:", id);
        // TODO: Add API call to delete the item on the backend
    }, []);

    // Placeholder functions for modifying items (replace with actual logic + API calls)
    const handleAddToShelf = useCallback((itemId: string, shelf: string) => {
        setItems(prev => prev.map(item => item.id === itemId ? { ...item, shelf: shelf } : item));
        console.log(`Moved item ${itemId} to shelf ${shelf}`);
        // API call here
    }, []);

    const handleAddToTag = useCallback((itemId: string, tag: string) => {
        setItems(prev => prev.map(item => item.id === itemId && !item.tags.includes(tag) ? { ...item, tags: [...item.tags, tag].sort() } : item));
        console.log(`Added tag ${tag} to item ${itemId}`);
        // API call here
    }, []);

    const handleRemoveTag = useCallback((itemId: string, tag: string) => {
        setItems(prev => prev.map(item => item.id === itemId ? { ...item, tags: item.tags.filter(t => t !== tag) } : item));
        console.log(`Removed tag ${tag} from item ${itemId}`);
        // API call here
    }, []);


    // --- Aggregate Stats ---
    const totalItems = items.length;
    const inProgressCount = useMemo(() => items.filter(item => item.progress > 0 && item.progress < 100).length, [items]);
    const completedCount = useMemo(() => items.filter(item => item.progress === 100).length, [items]);
    const favoriteCount = useMemo(() => items.filter(item => item.favorite).length, [items]);
    const activeFilterCount = useMemo(() =>
        selectedTags.length +
        (selectedCategory !== 'All' ? 1 : 0) +
        (selectedType !== 'All' ? 1 : 0) +
        (selectedShelf !== 'All' ? 1 : 0) +
        (showOnlyFavorites ? 1 : 0),
        [selectedTags, selectedCategory, selectedType, selectedShelf, showOnlyFavorites]
    );

    // --- Render Functions ---

    const renderActiveFilters = () => {
        const filters: Array<{ type: 'tag' | 'category' | 'type' | 'shelf' | 'favorites'; value: string; label: string }> = [];

        if (selectedCategory !== 'All') filters.push({ type: 'category', value: selectedCategory, label: `Category: ${selectedCategory}` });
        if (selectedType !== 'All') filters.push({ type: 'type', value: selectedType, label: `Type: ${selectedType}` });
        if (selectedShelf !== 'All') filters.push({ type: 'shelf', value: selectedShelf, label: `Shelf: ${selectedShelf}` });
        if (showOnlyFavorites) filters.push({ type: 'favorites', value: 'fav', label: 'Favorites Only' });
        selectedTags.forEach(tag => filters.push({ type: 'tag', value: tag, label: `Tag: ${tag}` }));

        if (filters.length === 0) return null;

        return (
            <div className="flex flex-wrap items-center gap-2 mb-4 px-1">
                <span className="text-sm font-medium text-muted-foreground">Active Filters:</span>
                {filters.map(filter => (
                    <Badge key={`${filter.type}-${filter.value}`} variant="secondary" className="flex items-center gap-1">
                        {filter.label}
                        <Button
                            variant="ghost"
                            size="icon"
                            className="h-4 w-4 rounded-full ml-1"
                            onClick={() => removeFilter(filter.type, filter.value)}
                            aria-label={`Remove filter ${filter.label}`}
                        >
                            <X className="h-3 w-3" />
                        </Button>
                    </Badge>
                ))}
                <Button variant="link" size="sm" onClick={clearFilters} className="px-1 h-auto text-xs">
                    Clear All
                </Button>
            </div>
        );
    };

    const renderFilterPopoverContent = () => (
        <PopoverContent className="w-80 p-0" align="end">
            <div className="p-4 border-b">
                <h4 className="font-medium leading-none">Filters</h4>
            </div>
            <ScrollArea className="">
                <div className="p-2 space-y-4">
                    {/* Category Filter */}
                    <div className='flex gap-1'>
                        <div>
                            <label htmlFor="filter-category" className="block text-sm font-medium text-muted-foreground mb-1">Category</label>
                            <Select value={selectedCategory} onValueChange={setSelectedCategory}>
                                <SelectTrigger id="filter-category">
                                    <SelectValue placeholder="Select category..." />
                                </SelectTrigger>
                                <SelectContent>
                                    {availableCategories.map(category => (
                                        <SelectItem key={category} value={category}>{category}</SelectItem>
                                    ))}
                                </SelectContent>
                            </Select>
                        </div>

                        {/* Type Filter */}
                        <div>
                            <label htmlFor="filter-type" className="block text-sm font-medium text-muted-foreground mb-1">File Type</label>
                            <Select value={selectedType} onValueChange={(value) => setSelectedType(value as 'All' | ResourceType)}>
                                <SelectTrigger id="filter-type">
                                    <SelectValue placeholder="Select type..." />
                                </SelectTrigger>
                                <SelectContent>
                                    {ALL_TYPES.map(type => (
                                        <SelectItem key={type} value={type}>{type === 'All' ? 'All Types' : type.toUpperCase()}</SelectItem>
                                    ))}
                                </SelectContent>
                            </Select>
                        </div>

                        {/* Shelf Filter */}
                        <div>
                            <label htmlFor="filter-shelf" className="block text-sm font-medium text-muted-foreground mb-1">Shelf</label>
                            <Select value={selectedShelf} onValueChange={setSelectedShelf}>
                                <SelectTrigger id="filter-shelf">
                                    <SelectValue placeholder="Select shelf..." />
                                </SelectTrigger>
                                <SelectContent>
                                    <SelectItem value="All">All Shelves</SelectItem>
                                    {availableShelves.map(shelf => (
                                        <SelectItem key={shelf} value={shelf}>{shelf}</SelectItem>
                                    ))}
                                </SelectContent>
                            </Select>
                        </div>
                    </div>

                    {/* Tags Filter */}
                    <div>
                        <label className="block text-sm font-medium text-muted-foreground mb-2">Tags</label>
                        <div className="max-h-40 overflow-y-auto space-y-1 pr-2">
                            {availableTags.map(tag => (
                                <div key={tag} className="flex items-center gap-2">
                                    <Checkbox
                                        id={`tag-${tag}`}
                                        checked={selectedTags.includes(tag)}
                                        onCheckedChange={() => toggleTag(tag)}
                                    />
                                    <label htmlFor={`tag-${tag}`} className="text-sm cursor-pointer">
                                        {tag}
                                    </label>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Favorites Filter */}
                    <div className="flex items-center gap-2 pt-2">
                        <Checkbox
                            id="showFavorites"
                            checked={showOnlyFavorites}
                            onCheckedChange={(checked) => setShowOnlyFavorites(!!checked)}
                        />
                        <label htmlFor="showFavorites" className="text-sm text-muted-foreground cursor-pointer">
                            Show only favorites
                        </label>
                    </div>
                </div>
            </ScrollArea>
            <div className="p-4 border-t flex justify-between">
                <Button variant="ghost" size="sm" onClick={clearFilters}>Clear Filters</Button>
                <Button size="sm" onClick={() => setIsFilterPopoverOpen(false)}>Apply</Button> {/* Apply is implicit, but good UX */}
            </div>
        </PopoverContent>
    );

    // --- Main Return ---
    return (
        <div className="space-y-6 p-4">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-2xl font-bold tracking-tight">Library</h1>
                    <p className="text-muted-foreground mt-1">Your personal knowledge base.</p>
                </div>
                <div className="flex gap-2 flex-shrink-0">
                    <Button className="flex items-center gap-2">
                        <Plus className="h-4 w-4" /> Add Resource
                    </Button>
                    {/* <Button variant="outline" className="flex items-center gap-2">
                        <FolderPlus className="h-4 w-4" /> New Shelf
                    </Button> */}
                </div>
            </div>

            {/* Stats Cards */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <Card>
                    <CardContent className="p-4 flex items-center justify-between">
                        <div>
                            <p className="text-sm text-muted-foreground">Total Resources</p>
                            <p className="text-2xl font-bold">{totalItems}</p>
                        </div>
                        <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary">
                            <ShelfIcon className="h-5 w-5" />
                        </div>
                    </CardContent>
                </Card>
                <Card>
                    <CardContent className="p-4 flex items-center justify-between">
                        <div>
                            <p className="text-sm text-muted-foreground">In Progress</p>
                            <p className="text-2xl font-bold">{inProgressCount}</p>
                        </div>
                        <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-yellow-500/10 text-yellow-600">
                            <Book className="h-5 w-5" />
                        </div>
                    </CardContent>
                </Card>
                <Card>
                    <CardContent className="p-4 flex items-center justify-between">
                        <div>
                            <p className="text-sm text-muted-foreground">Completed</p>
                            <p className="text-2xl font-bold">{completedCount}</p>
                        </div>
                        <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-green-500/10 text-green-600">
                            <CheckCircle2 className="h-5 w-5" />
                        </div>
                    </CardContent>
                </Card>
                <Card>
                    <CardContent className="p-4 flex items-center justify-between">
                        <div>
                            <p className="text-sm text-muted-foreground">Favorites</p>
                            <p className="text-2xl font-bold">{favoriteCount}</p>
                        </div>
                        <div className="flex h-10 w-10 items-center justify-center rounded-lg bg-red-500/10 text-red-600">
                            <Star className="h-5 w-5" />
                        </div>
                    </CardContent>
                </Card>
            </div>

            {/* Search and Controls Bar */}
            <div className="flex flex-col md:flex-row gap-3 items-start md:items-center justify-between">
                <div className="relative w-full md:flex-grow md:max-w-md">
                    <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                    <Input
                        placeholder="Search title, author, tag, shelf..."
                        value={searchQuery}
                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchQuery(e.target.value)}
                        className="pl-10"
                    />
                </div>
                <div className="flex items-center gap-2 w-full md:w-auto flex-wrap">
                    <Select value={sortOption} onValueChange={(value) => handleSortChange(value as SortOption)}>
                        <SelectTrigger className="w-full md:w-[180px]">
                            <span className="mr-1">Sort by:</span><SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                            <SelectItem value="title">Title</SelectItem>
                            <SelectItem value="author">Author</SelectItem>
                            <SelectItem value="dateAdded">Date Added</SelectItem>
                            <SelectItem value="lastOpened">Last Opened</SelectItem>
                            <SelectItem value="progress">Progress</SelectItem>
                        </SelectContent>
                    </Select>
                    {/* View Mode Toggle */}
                    <div className="flex items-center rounded-md border bg-background p-0.5">
                        <TooltipProvider>
                            <Tooltip>
                                <TooltipTrigger asChild>
                                    <Button
                                        variant={viewMode === 'grid' ? 'secondary' : 'ghost'}
                                        size="icon"
                                        onClick={() => setViewMode('grid')}
                                        className="h-8 w-8"
                                        aria-label="Grid view"
                                    >
                                        <Grid className="h-4 w-4" />
                                    </Button>
                                </TooltipTrigger>
                                <TooltipContent>Grid View</TooltipContent>
                            </Tooltip>
                            <Tooltip>
                                <TooltipTrigger asChild>
                                    <Button
                                        variant={viewMode === 'list' ? 'secondary' : 'ghost'}
                                        size="icon"
                                        onClick={() => setViewMode('list')}
                                        className="h-8 w-8"
                                        aria-label="List view"
                                    >
                                        <List className="h-4 w-4" />
                                    </Button>
                                </TooltipTrigger>
                                <TooltipContent>List View</TooltipContent>
                            </Tooltip>
                        </TooltipProvider>
                    </div>
                    {/* Filter Popover Trigger */}
                    <Popover open={isFilterPopoverOpen} onOpenChange={setIsFilterPopoverOpen}>
                        <PopoverTrigger asChild>
                            <Button
                                variant={activeFilterCount > 0 ? 'default' : 'outline'}
                                className="flex items-center gap-2"
                            >
                                <Filter className="h-4 w-4" />
                                Filter
                                {activeFilterCount > 0 && (
                                    <Badge variant="secondary" className="ml-1 rounded-full px-1.5">
                                        {activeFilterCount}
                                    </Badge>
                                )}
                            </Button>
                        </PopoverTrigger>
                        {renderFilterPopoverContent()}
                    </Popover>
                </div>
            </div>

            {/* Active Filters Display */}
            {renderActiveFilters()}

            {/* Main Content Area */}
            {filteredItems.length === 0 ? (
                <Card className="text-center py-16 bg-muted/30">
                    <CardContent>
                        <Search className="h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50" />
                        <h3 className="text-lg font-medium">No resources found</h3>
                        <p className="text-muted-foreground mt-2 max-w-md mx-auto">
                            {searchQuery || activeFilterCount > 0
                                ? 'Try adjusting your search or filters.'
                                : 'Your library is empty. Add some resources to get started!'}
                        </p>
                        {(searchQuery || activeFilterCount > 0) && (
                            <Button variant="outline" onClick={clearFilters} className="mt-6">
                                Clear Search & Filters
                            </Button>
                        )}
                    </CardContent>
                </Card>
            ) : (
                <>
                    {viewMode === 'grid' ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-5">
                            {filteredItems.map((item) => (
                                <LibraryCard
                                    key={item.id}
                                    item={item}
                                    onToggleFavorite={toggleFavorite}
                                    onDelete={deleteItem}
                                    availableShelves={availableShelves}
                                    availableTags={availableTags}
                                    onAddToShelf={handleAddToShelf}
                                    onAddToTag={handleAddToTag}
                                    onRemoveTag={handleRemoveTag}
                                />
                            ))}
                        </div>
                    ) : (
                        <div className="rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden">
                            <div className="overflow-x-auto">
                                <Table>
                                    <LibraryListHeader
                                        onSortChange={handleSortChange}
                                        currentSort={sortOption}
                                        sortDirection={sortDirection}
                                    />
                                    <TableBody>
                                        {filteredItems.map((item) => (
                                            <LibraryListItem
                                                key={item.id}
                                                item={item}
                                                onToggleFavorite={toggleFavorite}
                                                onDelete={deleteItem}
                                                availableShelves={availableShelves}
                                                availableTags={availableTags}
                                                onAddToShelf={handleAddToShelf}
                                                onAddToTag={handleAddToTag}
                                                onRemoveTag={handleRemoveTag}
                                            />
                                        ))}
                                    </TableBody>
                                </Table>
                            </div>
                        </div>
                    )}
                    {/* Pagination and Count (Simplified) */}
                    <div className="flex items-center justify-between mt-6 pt-4 border-t">
                        <div className="text-sm text-muted-foreground">
                            Showing <span className="font-medium">{filteredItems.length}</span> of{' '}
                            <span className="font-medium">{totalItems}</span> resources
                        </div>
                        {/* Add proper pagination controls if needed */}
                        {/* <div className="flex items-center gap-2">
                            <Button variant="outline" size="sm" disabled>Previous</Button>
                            <span className="text-sm p-2">Page 1</span>
                            <Button variant="outline" size="sm">Next</Button>
                        </div> */}
                    </div>
                </>
            )}
        </div>
    );
};

// TanStack Router Route Definition
export const Route = createFileRoute('/(app)/library')({
    component: LibraryPage,
    // Add loaders here if fetching data
    // loader: async () => {
    //   const libraryData = await fetchLibraryData(); // Your API call
    //   return { items: libraryData };
    // }
});
```

## File: src/routes/(app)/route.tsx

```tsx
import { createFileRoute, Outlet, redirect, useRouter } from "@tanstack/react-router";
import { SidebarProvider, SidebarInset } from "@app/ui/components/sidebar";
import { AppSidebar } from "@/components/app-sidebar";
import { authClient } from "@app/auth/client";

export const Route = createFileRoute("/(app)")({
    component: AppLayout,
    beforeLoad: async ({ context }) => {
        const { user } = context;
        if (!user) {
            throw redirect({ to: "/auth/signin" });
        }
    },
});

function AppLayout() {
    const { queryClient } = Route.useRouteContext();
    const router = useRouter();

    const handleSignOut = async () => {
        try {
            await authClient.signOut();
            await queryClient.invalidateQueries({ queryKey: ["user"] });
            await router.invalidate();
        } catch (error) {
            console.error("Sign out failed:", error);
        }
    };

    return (
        <SidebarProvider defaultOpen={true}>
            <div className="flex h-screen w-full overflow-hidden bg-sidebar">
                <AppSidebar onSignOut={handleSignOut} />
                <SidebarInset className="overflow-auto bg-background text-foreground">
                    <Outlet />
                </SidebarInset>
            </div>
        </SidebarProvider>
    );
}
```

## File: src/routes/(app)/integration.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import { useState } from 'react'
import {
    Search,
    Plus,
    Settings,
    Grid,
    List,
    Clock,
    AlertCircle,
    CheckCircle2,
    Sparkles,
    Info,
} from 'lucide-react'

export const Route = createFileRoute('/(app)/integration')({
    component: IntegrationsComponent,
})

function IntegrationsComponent() {
    const [viewMode, setViewMode] = useState('grid');
    const [filterCategory, setFilterCategory] = useState('all');
    const [searchQuery, setSearchQuery] = useState('');

    // Sample integration data
    const integrations = [
        {
            id: 1,
            name: "Slack",
            description: "Send notifications and updates to your Slack channels",
            category: "communication",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/slack-icon_dkkxeo.svg",
            connected: true,
            popular: true,
            lastSynced: "2 hours ago"
        },
        {
            id: 2,
            name: "Google Drive",
            description: "Sync and manage files directly with Google Drive",
            category: "file-storage",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/gdrive-icon_ftcbbw.svg",
            connected: true,
            popular: true,
            lastSynced: "1 day ago"
        },
        {
            id: 3,
            name: "Stripe",
            description: "Process payments and manage subscriptions",
            category: "payment",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/stripe-icon_iq1mgc.svg",
            connected: false,
            popular: true,
            lastSynced: null
        },
        {
            id: 4,
            name: "Zapier",
            description: "Connect with thousands of apps through automated workflows",
            category: "automation",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/zapier-icon_jjxb7t.svg",
            connected: true,
            popular: true,
            lastSynced: "3 hours ago"
        },
        {
            id: 5,
            name: "HubSpot",
            description: "Sync contacts and manage customer relationships",
            category: "crm",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/hubspot-icon_i9lkyk.svg",
            connected: false,
            popular: false,
            lastSynced: null
        },
        {
            id: 6,
            name: "Salesforce",
            description: "Enterprise-level CRM integration for customer data",
            category: "crm",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/salesforce-icon_u1mpmj.svg",
            connected: false,
            popular: true,
            lastSynced: null
        },
        {
            id: 7,
            name: "Mailchimp",
            description: "Create and manage email marketing campaigns",
            category: "marketing",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/mailchimp-icon_qbylut.svg",
            connected: true,
            popular: false,
            lastSynced: "5 days ago"
        },
        {
            id: 8,
            name: "GitHub",
            description: "Connect repositories and track development progress",
            category: "development",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/github-icon_r47wwq.svg",
            connected: true,
            popular: true,
            lastSynced: "1 hour ago"
        },
        {
            id: 9,
            name: "AWS",
            description: "Connect to Amazon Web Services for cloud resources",
            category: "cloud",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/aws-icon_rmzxvp.svg",
            connected: false,
            popular: false,
            lastSynced: null
        },
        {
            id: 10,
            name: "Dropbox",
            description: "Sync and share files with Dropbox cloud storage",
            category: "file-storage",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/dropbox-icon_pz9xgq.svg",
            connected: false,
            popular: false,
            lastSynced: null
        },
        {
            id: 11,
            name: "Asana",
            description: "Manage projects and tasks within your team",
            category: "productivity",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/asana-icon_gjsphv.svg",
            connected: false,
            popular: false,
            lastSynced: null
        },
        {
            id: 12,
            name: "Zendesk",
            description: "Customer support and ticketing system integration",
            category: "support",
            icon: "https://res.cloudinary.com/dlzlfasou/image/upload/v1741346201/zendesk-icon_xk6vpo.svg",
            connected: false,
            popular: true,
            lastSynced: null
        }
    ];

    // Categories for filtering
    const categories = [
        { id: 'all', name: 'All Integrations' },
        { id: 'connected', name: 'Connected' },
        { id: 'communication', name: 'Communication' },
        { id: 'file-storage', name: 'File Storage' },
        { id: 'payment', name: 'Payment' },
        { id: 'automation', name: 'Automation' },
        { id: 'crm', name: 'CRM' },
        { id: 'marketing', name: 'Marketing' },
        { id: 'development', name: 'Development' },
        { id: 'productivity', name: 'Productivity' },
        { id: 'support', name: 'Support' }
    ];

    // Filter integrations based on category and search query
    const filteredIntegrations = integrations.filter(integration => {
        const matchesCategory =
            filterCategory === 'all' ||
            (filterCategory === 'connected' && integration.connected) ||
            integration.category === filterCategory;

        const matchesSearch =
            integration.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
            integration.description.toLowerCase().includes(searchQuery.toLowerCase());

        return matchesCategory && matchesSearch;
    });

    return (
        <div className="space-y-6 p-4">
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-2xl font-bold tracking-tight">Integrations</h1>
                    <p className="text-muted-foreground mt-1">Connect your workspace with your favorite tools and services</p>
                </div>
                <button className="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90 sm:w-auto w-full justify-center">
                    <Plus className="h-4 w-4" />
                    Add New Integration
                </button>
            </div>

            {/* Connected integrations summary */}
            <div className="rounded-lg border bg-card p-4 shadow-sm">
                <h2 className="font-medium mb-3">Connected Integrations</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                    {integrations
                        .filter(integration => integration.connected)
                        .slice(0, 4)
                        .map(integration => (
                            <div key={integration.id} className="flex items-center gap-3 rounded-lg border p-3">
                                <img
                                    src={integration.icon}
                                    alt={integration.name}
                                    className="h-8 w-8"
                                />
                                <div>
                                    <div className="font-medium">{integration.name}</div>
                                    <div className="flex items-center text-xs text-muted-foreground">
                                        <Clock className="h-3 w-3 mr-1" />
                                        Synced {integration.lastSynced}
                                    </div>
                                </div>
                                <button className="ml-auto rounded-full p-1 hover:bg-muted">
                                    <Settings className="h-4 w-4 text-muted-foreground" />
                                </button>
                            </div>
                        ))}
                </div>
            </div>

            {/* Search and filters */}
            <div className="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between">
                <div className="relative w-full md:w-96">
                    <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                    <input
                        type="text"
                        placeholder="Search integrations..."
                        className="w-full rounded-md border border-input bg-background pl-10 pr-4 py-2 text-sm"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                    />
                </div>
                <div className="flex items-center gap-4 w-full md:w-auto">
                    <div className="flex items-center gap-2 w-full md:w-auto">
                        <select
                            className="rounded-md border border-input bg-background px-3 py-2 text-sm w-full"
                            value={filterCategory}
                            onChange={(e) => setFilterCategory(e.target.value)}
                        >
                            {categories.map(category => (
                                <option key={category.id} value={category.id}>
                                    {category.name}
                                </option>
                            ))}
                        </select>
                    </div>
                    <div className="hidden md:flex items-center rounded-md border bg-card">
                        <button
                            className={`p-2 ${viewMode === 'grid' ? 'bg-muted' : ''}`}
                            onClick={() => setViewMode('grid')}
                        >
                            <Grid className="h-4 w-4" />
                        </button>
                        <button
                            className={`p-2 ${viewMode === 'list' ? 'bg-muted' : ''}`}
                            onClick={() => setViewMode('list')}
                        >
                            <List className="h-4 w-4" />
                        </button>
                    </div>
                </div>
            </div>

            {/* Popular integrations section */}
            {filterCategory === 'all' && searchQuery === '' && (
                <div className="space-y-3">
                    <h2 className="font-medium flex items-center gap-2">
                        <Sparkles className="h-4 w-4 text-yellow-500" />
                        Popular Integrations
                    </h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        {integrations
                            .filter(integration => integration.popular)
                            .map(integration => (
                                <div
                                    key={integration.id}
                                    className="flex flex-col rounded-lg border bg-card overflow-hidden hover:border-primary/50 hover:shadow-md transition-shadow"
                                >
                                    <div className="flex items-center gap-3 p-4 border-b">
                                        <img
                                            src={integration.icon}
                                            alt={integration.name}
                                            className="h-10 w-10"
                                        />
                                        <div>
                                            <div className="font-medium">{integration.name}</div>
                                            {integration.connected ? (
                                                <div className="flex items-center text-xs text-green-600">
                                                    <CheckCircle2 className="h-3 w-3 mr-1" />
                                                    Connected
                                                </div>
                                            ) : (
                                                <div className="flex items-center text-xs text-muted-foreground">
                                                    Not connected
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="p-4 flex-1">
                                        <p className="text-sm text-muted-foreground">{integration.description}</p>
                                    </div>
                                    <div className="p-4 pt-0">
                                        <button
                                            className={`w-full rounded-md px-4 py-2 text-sm font-medium ${integration.connected
                                                ? 'bg-muted hover:bg-muted/80 text-foreground'
                                                : 'bg-primary hover:bg-primary/90 text-primary-foreground'
                                                }`}
                                        >
                                            {integration.connected ? 'Manage Connection' : 'Connect'}
                                        </button>
                                    </div>
                                </div>
                            ))}
                    </div>
                </div>
            )}

            {/* All integrations */}
            <div className="space-y-3">
                <h2 className="font-medium">
                    {filterCategory === 'all' && searchQuery === '' ? 'All Integrations' : 'Results'}
                    <span className="text-muted-foreground ml-2 text-sm">({filteredIntegrations.length})</span>
                </h2>

                {viewMode === 'grid' ? (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        {filteredIntegrations.map(integration => (
                            <div
                                key={integration.id}
                                className="flex flex-col rounded-lg border bg-card overflow-hidden hover:border-primary/50 hover:shadow-md transition-all"
                            >
                                <div className="flex items-center gap-3 p-4 border-b">
                                    <img
                                        src={integration.icon}
                                        alt={integration.name}
                                        className="h-10 w-10"
                                    />
                                    <div>
                                        <div className="font-medium">{integration.name}</div>
                                        {integration.connected ? (
                                            <div className="flex items-center text-xs text-green-600">
                                                <CheckCircle2 className="h-3 w-3 mr-1" />
                                                Connected
                                            </div>
                                        ) : (
                                            <div className="flex items-center text-xs text-muted-foreground">
                                                Not connected
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="p-4 flex-1">
                                    <p className="text-sm text-muted-foreground">{integration.description}</p>
                                    {integration.connected && integration.lastSynced && (
                                        <div className="flex items-center text-xs text-muted-foreground mt-2">
                                            <Clock className="h-3 w-3 mr-1" />
                                            Last synced: {integration.lastSynced}
                                        </div>
                                    )}
                                </div>
                                <div className="p-4 pt-0 flex items-center gap-2">
                                    <button
                                        className={`flex-1 rounded-md px-4 py-2 text-sm font-medium ${integration.connected
                                            ? 'bg-muted hover:bg-muted/80 text-foreground'
                                            : 'bg-primary hover:bg-primary/90 text-primary-foreground'
                                            }`}
                                    >
                                        {integration.connected ? 'Manage' : 'Connect'}
                                    </button>
                                    <button className="p-2 hover:bg-muted rounded-full">
                                        <Info className="h-4 w-4 text-muted-foreground" />
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="space-y-3">
                        {filteredIntegrations.map(integration => (
                            <div
                                key={integration.id}
                                className="flex items-center gap-4 rounded-lg border bg-card p-4 hover:border-primary/50 hover:shadow-md transition-shadow duration-150"
                            >
                                <img
                                    src={integration.icon}
                                    alt={integration.name}
                                    className="h-12 w-12"
                                />
                                <div className="flex-1">
                                    <div className="flex items-center gap-2">
                                        <div className="font-medium">{integration.name}</div>
                                        {integration.popular && (
                                            <Sparkles className="h-4 w-4 text-yellow-500" />
                                        )}
                                    </div>
                                    <p className="text-sm text-muted-foreground mt-1">{integration.description}</p>
                                    {integration.connected && integration.lastSynced && (
                                        <div className="flex items-center text-xs text-muted-foreground mt-1">
                                            <Clock className="h-3 w-3 mr-1" />
                                            Last synced: {integration.lastSynced}
                                        </div>
                                    )}
                                </div>
                                <div className="flex items-center gap-2">
                                    {integration.connected ? (
                                        <div className="flex items-center text-xs text-green-600">
                                            <CheckCircle2 className="h-4 w-4 mr-1" />
                                            Connected
                                        </div>
                                    ) : (
                                        <div className="flex items-center text-xs text-muted-foreground">
                                            <AlertCircle className="h-4 w-4 mr-1" />
                                            Not connected
                                        </div>
                                    )}
                                    <button
                                        className={`rounded-md px-4 py-2 text-sm font-medium ${integration.connected
                                            ? 'bg-muted hover:bg-muted/80 text-foreground'
                                            : 'bg-primary hover:bg-primary/90 text-primary-foreground'
                                            }`}
                                    >
                                        {integration.connected ? 'Manage' : 'Connect'}
                                    </button>
                                    <button className="p-2 hover:bg-muted rounded-full">
                                        <Info className="h-4 w-4 text-muted-foreground" />
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>

            {filteredIntegrations.length === 0 && (
                <div className="text-center py-12">
                    <AlertCircle className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
                    <h3 className="text-lg font-medium">No integrations found</h3>
                    <p className="text-muted-foreground mt-2">Try adjusting your search or filter criteria</p>
                </div>
            )}
        </div>
    );
}
```

## File: src/routes/(app)/layout.tsx

```tsx
import * as React from 'react'
import { createFileRoute } from '@tanstack/react-router'
import { useState, useMemo, useRef } from 'react'

import {
    Layout,
    Model,
    TabNode,
    Actions,
} from '@app/layout'

import { Button } from '@app/ui/components/button'
import { Card, CardContent, CardHeader, CardTitle } from '@app/ui/components/card'
import { Input } from '@app/ui/components/input'

import { LayoutDashboard, Settings, MessageSquare } from 'lucide-react'
import { SidebarTrigger } from '@app/ui/components/sidebar'
import { cn } from '@app/ui/lib/utils'

export const Route = createFileRoute('/(app)/layout')({
    component: LayoutDemoComponent,
})

const initialJson = {
    global: {},
    borders: [],
    layout: {
        type: 'row',
        weight: 100,
        children: [
            {
                type: 'tabset',
                id: 'ts1',
                weight: 50,
                selected: 0,
                children: [
                    {
                        type: 'tab',
                        id: 'tab1',
                        name: 'Dashboard',
                        component: 'dashboard',
                        icon: 'LayoutDashboard',
                    },
                    {
                        type: 'tab',
                        id: 'tab3',
                        name: 'Messages',
                        component: 'messages',
                        icon: 'MessageSquare',
                    },
                ],
            },
            {
                type: 'tabset',
                id: 'ts2',
                weight: 50,
                selected: 0,
                children: [
                    {
                        type: 'tab',
                        id: 'tab2',
                        name: 'Settings',
                        component: 'settings',
                        icon: 'Settings',
                    },
                ],
            },
        ],
    },
}

function factory(node: TabNode): React.ReactNode {
    const component = node.getComponent()
    const tabId = node.getId()

    const IconComponent = ({ name }: { name?: string }) => {
        if (name === 'LayoutDashboard') return <LayoutDashboard className="h-4 w-4 mr-2" />
        if (name === 'Settings') return <Settings className="h-4 w-4 mr-2" />
        if (name === 'MessageSquare') return <MessageSquare className="h-4 w-4 mr-2" />
        return null
    }

    if (component === 'dashboard') {
        return (
            <div className="p-4 h-full w-full box-border overflow-auto">
                <Card>
                    <CardHeader>
                        <CardTitle className="flex items-center">
                            <IconComponent name={node.getIcon()} />
                            {node.getName()}
                        </CardTitle>
                    </CardHeader>
                    <CardContent>
                        <p>Welcome to the dashboard content area!</p>
                        <p className="mt-2 text-sm text-muted-foreground">Tab ID: {tabId}</p>
                        <Button className="mt-4">Dashboard Action</Button>
                    </CardContent>
                </Card>
            </div>
        )
    } else if (component === 'settings') {
        return (
            <div className="p-4 h-full w-full box-border overflow-auto space-y-4">
                <h2 className="text-xl font-semibold flex items-center">
                    <IconComponent name={node.getIcon()} />
                    {node.getName()}
                </h2>
                <p className="text-sm text-muted-foreground">Configure your settings here.</p>
                <div className="space-y-2">
                    <label htmlFor="setting1" className="text-sm font-medium">Setting 1</label>
                    <Input id="setting1" placeholder="Enter value for setting 1" />
                </div>
                <div className="space-y-2">
                    <label htmlFor="setting2" className="text-sm font-medium">Setting 2</label>
                    <Input id="setting2" placeholder="Enter value for setting 2" />
                </div>
                <Button variant="secondary">Save Settings</Button>
            </div>
        )
    } else if (component === 'messages') {
        return (
            <div className="p-4 h-full w-full box-border overflow-auto">
                <h2 className="text-xl font-semibold flex items-center mb-4">
                    <IconComponent name={node.getIcon()} />
                    {node.getName()}
                </h2>
                {[1, 2, 3, 4, 5].map(i => (
                    <Card key={i} className="mb-3">
                        <CardContent className="p-3">
                            <p className="text-sm">Message {i}: Lorem ipsum dolor sit amet...</p>
                            <p className="text-xs text-muted-foreground mt-1">Received: Just now</p>
                        </CardContent>
                    </Card>
                ))}
            </div>
        )
    }

    return (
        <div className="p-4">
            <p>Unknown component type: {component}</p>
            <p>Tab ID: {tabId}</p>
        </div>
    )
}

function LayoutDemoComponent() {
    const initialModel = useMemo(() => Model.fromJson(initialJson), [])
    const [model] = useState<Model>(initialModel)
    const layoutRef = useRef<Layout>(null)

    return (
        <div className="flex flex-col h-full w-full">
            <div className="flex-grow rounded-md overflow-hidden bg-card h-screen relative">
                <SidebarTrigger
                    className={cn(
                        "text-muted-foreground absolute left-2 z-10",
                        "top-2",
                    )}
                />
                <Layout
                    ref={layoutRef}
                    model={model}
                    factory={factory}
                />
            </div>
        </div>
    )
}
```

## File: src/routes/(app)/insights.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import { BarChart, LineChart, PieChart, TrendingUp, Download, ArrowUpRight, ArrowDownRight } from 'lucide-react'

export const Route = createFileRoute('/(app)/insights')({
  component: InsightsComponent,
})

function InsightsComponent() {
  return (
    <div className="space-y-6 p-4">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-bold tracking-tight">Insights</h1>
        <div className="flex items-center gap-2">
          <div className="flex items-center rounded-md border bg-card px-3 py-1">
            <span className="text-sm mr-2">Period:</span>
            <select className="bg-transparent text-sm">
              <option>Last 7 days</option>
              <option>Last 30 days</option>
              <option>Last quarter</option>
              <option>This year</option>
            </select>
          </div>
          <button className="rounded-md border bg-card p-2">
            <Download className="h-4 w-4" />
          </button>
        </div>
      </div>

      {/* Key metrics */}
      <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div className="rounded-lg border bg-card p-4">
          <div className="flex justify-between">
            <div>
              <p className="text-sm text-muted-foreground">Total Revenue</p>
              <p className="text-2xl font-bold">$24,835</p>
            </div>
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10">
              <TrendingUp className="h-5 w-5 text-primary" />
            </div>
          </div>
          <div className="mt-2 flex items-center text-sm">
            <ArrowUpRight className="mr-1 h-4 w-4 text-green-500" />
            <span className="text-green-500">12%</span>
            <span className="ml-1 text-muted-foreground">vs last period</span>
          </div>
        </div>

        <div className="rounded-lg border bg-card p-4">
          <div className="flex justify-between">
            <div>
              <p className="text-sm text-muted-foreground">New Customers</p>
              <p className="text-2xl font-bold">384</p>
            </div>
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-blue-500/10">
              <TrendingUp className="h-5 w-5 text-blue-500" />
            </div>
          </div>
          <div className="mt-2 flex items-center text-sm">
            <ArrowUpRight className="mr-1 h-4 w-4 text-green-500" />
            <span className="text-green-500">8.2%</span>
            <span className="ml-1 text-muted-foreground">vs last period</span>
          </div>
        </div>

        <div className="rounded-lg border bg-card p-4">
          <div className="flex justify-between">
            <div>
              <p className="text-sm text-muted-foreground">Conversion Rate</p>
              <p className="text-2xl font-bold">3.6%</p>
            </div>
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-purple-500/10">
              <PieChart className="h-5 w-5 text-purple-500" />
            </div>
          </div>
          <div className="mt-2 flex items-center text-sm">
            <ArrowDownRight className="mr-1 h-4 w-4 text-red-500" />
            <span className="text-red-500">0.8%</span>
            <span className="ml-1 text-muted-foreground">vs last period</span>
          </div>
        </div>

        <div className="rounded-lg border bg-card p-4">
          <div className="flex justify-between">
            <div>
              <p className="text-sm text-muted-foreground">Avg. Order Value</p>
              <p className="text-2xl font-bold">$175</p>
            </div>
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-green-500/10">
              <LineChart className="h-5 w-5 text-green-500" />
            </div>
          </div>
          <div className="mt-2 flex items-center text-sm">
            <ArrowUpRight className="mr-1 h-4 w-4 text-green-500" />
            <span className="text-green-500">5.3%</span>
            <span className="ml-1 text-muted-foreground">vs last period</span>
          </div>
        </div>
      </div>

      {/* Main chart placeholder */}
      <div className="rounded-lg border bg-card p-4">
        <div className="flex items-center justify-between mb-4">
          <h2 className="font-medium">Revenue Overview</h2>
          <div className="flex items-center gap-2">
            <button className="rounded-md border bg-muted p-1 text-xs">Daily</button>
            <button className="rounded-md p-1 text-xs">Weekly</button>
            <button className="rounded-md p-1 text-xs">Monthly</button>
          </div>
        </div>
        <div className="h-80 w-full bg-muted/20 rounded flex items-center justify-center">
          <div className="text-center">
            <BarChart className="h-10 w-10 text-muted-foreground mx-auto mb-2" />
            <p className="text-muted-foreground">Revenue chart would display here</p>
          </div>
        </div>
      </div>

      {/* Quick insights */}
      <div className="grid gap-4 grid-cols-1 md:grid-cols-2">
        <div className="rounded-lg border bg-card p-4">
          <h3 className="font-medium mb-2">Top Products</h3>
          <div className="space-y-2">
            {['Product A', 'Product B', 'Product C', 'Product D', 'Product E'].map((product, i) => (
              <div key={i} className="flex items-center justify-between py-1 border-b last:border-0">
                <span>{product}</span>
                <span className="font-medium">${(Math.random() * 1000).toFixed(2)}</span>
              </div>
            ))}
          </div>
        </div>

        <div className="rounded-lg border bg-card p-4">
          <h3 className="font-medium mb-2">Traffic Sources</h3>
          <div className="space-y-2">
            {['Direct', 'Organic Search', 'Referral', 'Social Media', 'Email'].map((source, i) => (
              <div key={i} className="flex items-center justify-between py-1 border-b last:border-0">
                <span>{source}</span>
                <div className="flex items-center">
                  <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                    <div
                      className="h-full bg-primary"
                      style={{ width: `${Math.floor(Math.random() * 100)}%` }}
                    ></div>
                  </div>
                  <span className="ml-2 text-sm">{Math.floor(Math.random() * 100)}%</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}
```

## File: src/routes/(app)/help.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import { useState } from 'react'
import {
    Search,
    ThumbsUp,
    MessageCircle,
    HelpCircle,
    Book,
    FileText,
    Video,
    Headphones,
    ArrowRight,
    ChevronRight,
    ChevronDown,
    Clock,
    Users,
    ShieldCheck,
    Settings,
    BarChart2,
    Link
} from 'lucide-react'

export const Route = createFileRoute('/(app)/help')({
    component: HelpCenterComponent,
})

function HelpCenterComponent() {
    const [searchQuery, setSearchQuery] = useState('');
    const [expandedFaq, setExpandedFaq] = useState(0);
    const [activeTab, setActiveTab] = useState('all');

    // Sample help categories
    const categories = [
        { id: 'getting-started', name: 'Getting Started', icon: Book, count: 15 },
        { id: 'account', name: 'Account & Billing', icon: Users, count: 27 },
        { id: 'security', name: 'Privacy & Security', icon: ShieldCheck, count: 19 },
        { id: 'features', name: 'Features & Tools', icon: Settings, count: 34 },
        { id: 'integrations', name: 'Integrations', icon: Link, count: 22 },
        { id: 'analytics', name: 'Reporting & Analytics', icon: BarChart2, count: 18 }
    ];

    // Sample popular articles
    const popularArticles = [
        {
            id: 1,
            title: 'How to set up two-factor authentication',
            category: 'security',
            views: '2.5k',
            helpfulRating: 98,
            timeToRead: '3 min'
        },
        {
            id: 2,
            title: 'Importing data from external sources',
            category: 'features',
            views: '1.8k',
            helpfulRating: 92,
            timeToRead: '5 min'
        },
        {
            id: 3,
            title: 'Setting up your first project dashboard',
            category: 'getting-started',
            views: '3.9k',
            helpfulRating: 96,
            timeToRead: '4 min'
        },
        {
            id: 4,
            title: 'Connecting your Slack workspace',
            category: 'integrations',
            views: '1.2k',
            helpfulRating: 89,
            timeToRead: '2 min'
        }
    ];

    // Sample FAQs
    const faqs = [
        {
            id: 1,
            question: 'How do I change my subscription plan?',
            answer: 'You can change your subscription plan at any time by going to Account Settings > Billing > Subscription. There you\'ll see options to upgrade, downgrade, or cancel your plan. Changes to your subscription will take effect at the start of your next billing cycle.',
            category: 'account'
        },
        {
            id: 2,
            question: 'Can I invite external users to collaborate?',
            answer: 'Yes, you can invite external users to collaborate on specific projects without them needing a full account. Go to the project settings, select "External Collaborators" and enter their email addresses. External users will have limited access based on the permissions you set.',
            category: 'features'
        },
        {
            id: 3,
            question: 'How secure is my data?',
            answer: 'We take security very seriously. All data is encrypted both in transit and at rest using industry-standard AES-256 encryption. We maintain SOC 2 compliance, perform regular security audits, and offer features like SSO and 2FA to ensure your data remains secure.',
            category: 'security'
        },
        {
            id: 4,
            question: 'How do I export my data?',
            answer: 'You can export your data at any time through Settings > Data Management > Export. We support multiple formats including CSV, JSON, and Excel. For large datasets, the export will be processed in the background and you\'ll receive an email when it\'s ready to download.',
            category: 'features'
        },
        {
            id: 5,
            question: 'What happens when my trial ends?',
            answer: 'When your trial period ends, your account will automatically switch to the free plan with limited features. All your data will remain intact. You can upgrade to a paid plan at any time to regain access to premium features. We\'ll send reminder emails before your trial expires.',
            category: 'account'
        }
    ];

    // Sample recent community questions
    const communityQuestions = [
        {
            id: 1,
            title: 'Best practices for organizing large projects?',
            askedBy: 'Alex Johnson',
            category: 'getting-started',
            timeAgo: '2 hours ago',
            replies: 7
        },
        {
            id: 2,
            title: 'How to create custom report templates?',
            askedBy: 'Maria Garcia',
            category: 'analytics',
            timeAgo: '1 day ago',
            replies: 12
        },
        {
            id: 3,
            title: 'Trouble connecting to Google Analytics',
            askedBy: 'Ahmed Hassan',
            category: 'integrations',
            timeAgo: '3 days ago',
            replies: 5
        }
    ];

    // Filter articles based on search and active tab
    const filteredArticles = popularArticles.filter(article => {
        const matchesSearch = article.title.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = activeTab === 'all' || article.category === activeTab;
        return matchesSearch && matchesCategory;
    });

    // Filter FAQs based on search and active tab
    const filteredFaqs = faqs.filter(faq => {
        const matchesSearch =
            faq.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
            faq.answer.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = activeTab === 'all' || faq.category === activeTab;
        return matchesSearch && matchesCategory;
    });

    // Filter community questions based on search and active tab
    const filteredQuestions = communityQuestions.filter(question => {
        const matchesSearch = question.title.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = activeTab === 'all' || question.category === activeTab;
        return matchesSearch && matchesCategory;
    });

    return (
        <div className="space-y-8 p-4">
            {/* Hero section with search */}
            <div className="rounded-xl bg-gradient-to-r from-primary/20 via-primary/10 to-primary/5 p-8 text-center">
                <h1 className="text-3xl font-bold tracking-tight mb-2">How can we help you?</h1>
                <p className="text-muted-foreground mb-6 max-w-2xl mx-auto">
                    Find answers to your questions and learn how to get the most out of our platform
                </p>
                <div className="relative max-w-xl mx-auto">
                    <div className="absolute inset-y-0 left-0 flex items-center pl-4">
                        <Search className="h-5 w-5 text-muted-foreground" />
                    </div>
                    <input
                        type="text"
                        placeholder="Search for articles, topics, or questions..."
                        className="w-full rounded-full border border-input bg-background pl-12 pr-4 py-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                    />
                </div>
            </div>

            {/* Help categories */}
            <div className="space-y-4">
                <h2 className="text-xl font-semibold">Browse by Category</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    {categories.map(category => (
                        <button
                            key={category.id}
                            className={`flex flex-col items-center p-4 rounded-lg border text-center hover:border-primary/50 hover:bg-muted/50 ${activeTab === category.id ? 'border-primary bg-primary/5' : ''}`}
                            onClick={() => setActiveTab(category.id)}
                        >
                            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary mb-2">
                                {<category.icon className="h-5 w-5" />}
                            </div>
                            <span className="font-medium">{category.name}</span>
                            <span className="text-xs text-muted-foreground mt-1">{category.count} articles</span>
                        </button>
                    ))}
                    <button
                        className={`flex flex-col items-center p-4 rounded-lg border text-center hover:border-primary/50 hover:bg-muted/50 transition-all ${activeTab === 'all' ? 'border-primary bg-primary/5' : ''
                            }`}
                        onClick={() => setActiveTab('all')}
                    >
                        <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary mb-2">
                            <HelpCircle className="h-5 w-5" />
                        </div>
                        <span className="font-medium">All Help</span>
                        <span className="text-xs text-muted-foreground mt-1">View all</span>
                    </button>
                </div>
            </div>

            {/* Tab buttons for different content types */}
            <div className="flex border-b">
                <button
                    className={`py-2 px-4 font-medium text-sm border-b-2 ${searchQuery ? 'border-primary text-primary' : 'border-transparent text-muted-foreground hover:text-foreground'}`}
                >
                    {searchQuery ? `Search Results (${filteredArticles.length + filteredFaqs.length + filteredQuestions.length})` : 'All Resources'}
                </button>
                <button
                    className="py-2 px-4 font-medium text-sm border-b-2 border-transparent text-muted-foreground hover:text-foreground"
                >
                    Articles
                </button>
                <button
                    className="py-2 px-4 font-medium text-sm border-b-2 border-transparent text-muted-foreground hover:text-foreground"
                >
                    Videos
                </button>
                <button
                    className="py-2 px-4 font-medium text-sm border-b-2 border-transparent text-muted-foreground hover:text-foreground"
                >
                    Community
                </button>
            </div>

            <div className="grid gap-8 grid-cols-1 lg:grid-cols-3">
                {/* Main content area - 2/3 width */}
                <div className="lg:col-span-2 space-y-8">
                    {/* Popular articles */}
                    <div className="space-y-4">
                        <h2 className="text-xl font-semibold flex items-center gap-2">
                            <FileText className="h-5 w-5 text-primary" />
                            {searchQuery ? 'Relevant Articles' : 'Popular Articles'}
                        </h2>
                        <div className="grid gap-4 grid-cols-1 sm:grid-cols-2">
                            {filteredArticles.length > 0 ? (
                                filteredArticles.map(article => (
                                    <a
                                        key={article.id}
                                        href="#"
                                        className="flex flex-col h-full rounded-lg border bg-card p-5 shadow-sm hover:border-primary/50 hover:shadow transition-all"
                                    >
                                        <h3 className="font-medium mb-2">{article.title}</h3>
                                        <div className="flex items-center gap-3 text-xs text-muted-foreground mt-auto pt-3">
                                            <div className="flex items-center">
                                                <Clock className="h-3.5 w-3.5 mr-1" />
                                                {article.timeToRead}
                                            </div>
                                            <div className="flex items-center">
                                                <ThumbsUp className="h-3.5 w-3.5 mr-1" />
                                                {article.helpfulRating}%
                                            </div>
                                            <div className="flex items-center ml-auto">
                                                <ArrowRight className="h-3.5 w-3.5" />
                                            </div>
                                        </div>
                                    </a>
                                ))
                            ) : (
                                <div className="col-span-2 text-center py-8 border rounded-lg bg-muted/10">
                                    <div className="flex justify-center mb-4">
                                        <FileText className="h-10 w-10 text-muted-foreground" />
                                    </div>
                                    <h3 className="font-medium text-lg mb-1">No articles found</h3>
                                    <p className="text-muted-foreground">Try adjusting your search or browse all articles</p>
                                </div>
                            )}
                        </div>
                        {filteredArticles.length > 0 && (
                            <a href="#" className="flex items-center text-sm text-primary hover:underline">
                                <span>View all articles</span>
                                <ChevronRight className="h-4 w-4 ml-1" />
                            </a>
                        )}
                    </div>

                    {/* FAQs accordion */}
                    <div className="space-y-4">
                        <h2 className="text-xl font-semibold flex items-center gap-2">
                            <HelpCircle className="h-5 w-5 text-primary" />
                            Frequently Asked Questions
                        </h2>
                        <div className="space-y-3 rounded-lg border bg-card divide-y">
                            {filteredFaqs.length > 0 ? (
                                filteredFaqs.map(faq => (
                                    <div key={faq.id} className="overflow-hidden">
                                        <button
                                            className="flex w-full items-center justify-between p-4 text-left font-medium"
                                            onClick={() => setExpandedFaq(expandedFaq === faq.id ? 0 : faq.id)}
                                        >
                                            <span>{faq.question}</span>
                                            {expandedFaq === faq.id ? (
                                                <ChevronDown className="h-5 w-5 text-muted-foreground" />
                                            ) : (
                                                <ChevronRight className="h-5 w-5 text-muted-foreground" />
                                            )}
                                        </button>
                                        {expandedFaq === faq.id && (
                                            <div className="px-4 pb-4 text-sm text-muted-foreground">
                                                {faq.answer}
                                                <div className="mt-3 flex items-center gap-2">
                                                    <button className="flex items-center gap-1 text-xs hover:text-primary">
                                                        <ThumbsUp className="h-3.5 w-3.5" />
                                                        Helpful
                                                    </button>
                                                    <button className="flex items-center gap-1 text-xs hover:text-primary">
                                                        <MessageCircle className="h-3.5 w-3.5" />
                                                        Discuss
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))
                            ) : (
                                <div className="p-6 text-center">
                                    <div className="flex justify-center mb-4">
                                        <HelpCircle className="h-10 w-10 text-muted-foreground" />
                                    </div>
                                    <h3 className="font-medium text-lg mb-1">No FAQs found</h3>
                                    <p className="text-muted-foreground">Try adjusting your search terms</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>

                {/* Sidebar - 1/3 width */}
                <div className="space-y-8">
                    {/* Quick Resources */}
                    <div className="space-y-4">
                        <h2 className="text-xl font-semibold flex items-center gap-2">
                            <Book className="h-5 w-5 text-primary" />
                            Quick Resources
                        </h2>
                        <div className="space-y-2 rounded-lg border bg-card p-4">
                            <a href="#" className="flex items-center gap-2 text-sm hover:text-primary">
                                <Video className="h-4 w-4" />
                                Video Tutorials
                            </a>
                            <a href="#" className="flex items-center gap-2 text-sm hover:text-primary">
                                <Book className="h-4 w-4" />
                                User Guides
                            </a>
                            <a href="#" className="flex items-center gap-2 text-sm hover:text-primary">
                                <Headphones className="h-4 w-4" />
                                Contact Support
                            </a>
                        </div>
                    </div>

                    {/* Community Questions */}
                    <div className="space-y-4">
                        <h2 className="text-xl font-semibold flex items-center gap-2">
                            <MessageCircle className="h-5 w-5 text-primary" />
                            Recent Community Questions
                        </h2>
                        <div className="space-y-4">
                            {filteredQuestions.length > 0 ? (
                                filteredQuestions.map(question => (
                                    <a
                                        key={question.id}
                                        href="#"
                                        className="flex flex-col rounded-lg border bg-card p-4 hover:border-primary/50 transition-all"
                                    >
                                        <h3 className="text-sm font-medium mb-1">{question.title}</h3>
                                        <div className="flex items-center gap-2 text-xs text-muted-foreground">
                                            <span>{question.askedBy}</span>
                                            <span>â€¢</span>
                                            <span>{question.timeAgo}</span>
                                            <span className="ml-auto flex items-center gap-1">
                                                <MessageCircle className="h-3.5 w-3.5" />
                                                {question.replies}
                                            </span>
                                        </div>
                                    </a>
                                ))
                            ) : (
                                <div className="text-center py-6 border rounded-lg bg-muted/10">
                                    <div className="flex justify-center mb-4">
                                        <MessageCircle className="h-10 w-10 text-muted-foreground" />
                                    </div>
                                    <h3 className="font-medium text-lg mb-1">No questions found</h3>
                                    <p className="text-muted-foreground">Try adjusting your search</p>
                                </div>
                            )}
                        </div>
                        {filteredQuestions.length > 0 && (
                            <a href="#" className="flex items-center text-sm text-primary hover:underline">
                                <span>View community forums</span>
                                <ChevronRight className="h-4 w-4 ml-1" />
                            </a>
                        )}
                    </div>

                    {/* Contact Support */}
                    <div className="rounded-lg border bg-card p-6">
                        <h3 className="font-semibold mb-2 flex items-center gap-2">
                            <Headphones className="h-5 w-5 text-primary" />
                            Still Need Help?
                        </h3>
                        <p className="text-sm text-muted-foreground mb-4">
                            Our support team is available 24/7 to assist you.
                        </p>
                        <button className="w-full rounded-md bg-primary py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90">
                            Contact Support
                        </button>
                    </div>
                </div>
            </div>

            {/* Footer Links */}
            <div className="pt-8 border-t">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <h3 className="font-semibold mb-2">Product</h3>
                        <div className="space-y-2 text-sm text-muted-foreground">
                            <a href="#" className="block hover:text-primary">Features</a>
                            <a href="#" className="block hover:text-primary">Pricing</a>
                            <a href="#" className="block hover:text-primary">Integrations</a>
                        </div>
                    </div>
                    <div>
                        <h3 className="font-semibold mb-2">Resources</h3>
                        <div className="space-y-2 text-sm text-muted-foreground">
                            <a href="#" className="block hover:text-primary">Documentation</a>
                            <a href="#" className="block hover:text-primary">Blog</a>
                            <a href="#" className="block hover:text-primary">Webinars</a>
                        </div>
                    </div>
                    <div>
                        <h3 className="font-semibold mb-2">Support</h3>
                        <div className="space-y-2 text-sm text-muted-foreground">
                            <a href="#" className="block hover:text-primary">Help Center</a>
                            <a href="#" className="block hover:text-primary">Status</a>
                            <a href="#" className="block hover:text-primary">Contact Us</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}
```

## File: src/routes/(app)/contacts.tsx

```tsx
import { createFileRoute } from '@tanstack/react-router'
import {
    Users,
    Search,
    Plus,
    Filter,
    Mail,
    Phone,
    Star,
    MoreHorizontal,
    ChevronDown,
    Edit,
    Trash2
} from 'lucide-react'

export const Route = createFileRoute('/(app)/contacts')({
    component: ContactsComponent,
})

function ContactsComponent() {
    // Sample contact data
    const contacts = [
        {
            id: 1,
            name: 'Alex Johnson',
            email: 'alex.johnson@example.com',
            phone: '+1 (555) 123-4567',
            company: 'Acme Corp',
            position: 'Marketing Director',
            tags: ['Client', 'VIP'],
            starred: true,
            avatar: null
        },
        {
            id: 2,
            name: 'Samantha Williams',
            email: 'sam.williams@example.com',
            phone: '+1 (555) 987-6543',
            company: 'TechGiant Inc',
            position: 'Product Manager',
            tags: ['Prospect'],
            starred: false,
            avatar: null
        },
        {
            id: 3,
            name: 'Michael Chen',
            email: 'michael.chen@example.com',
            phone: '+1 (555) 456-7890',
            company: 'StartUp Labs',
            position: 'CEO',
            tags: ['Partner'],
            starred: true,
            avatar: null
        },
        {
            id: 4,
            name: 'Emily Rodriguez',
            email: 'emily.rodriguez@example.com',
            phone: '+1 (555) 234-5678',
            company: 'Global Solutions',
            position: 'Sales Manager',
            tags: ['Client'],
            starred: false,
            avatar: null
        },
        {
            id: 5,
            name: 'David Kim',
            email: 'david.kim@example.com',
            phone: '+1 (555) 876-5432',
            company: 'Innovate Design',
            position: 'Creative Director',
            tags: ['Vendor'],
            starred: false,
            avatar: null
        },
    ];

    return (
        <div className="space-y-6 p-4">
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <h1 className="text-2xl font-bold tracking-tight">Contacts</h1>
                <div className="flex items-center gap-2">
                    <button className="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90">
                        <Plus className="h-4 w-4" />
                        Add Contact
                    </button>
                    <button className="flex items-center gap-2 rounded-lg border bg-card px-4 py-2 text-sm font-medium shadow-sm hover:bg-muted">
                        <Filter className="h-4 w-4" />
                        Filter
                    </button>
                </div>
            </div>

            {/* Search and Filters */}
            <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                <div className="relative w-full sm:w-96">
                    <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                    <input
                        type="text"
                        placeholder="Search contacts..."
                        className="w-full rounded-md border border-input bg-background pl-10 pr-4 py-2 text-sm"
                    />
                </div>
                <div className="flex items-center gap-2">
                    <span className="text-sm text-muted-foreground">View:</span>
                    <select className="rounded-md border border-input bg-background px-3 py-1 text-sm">
                        <option value="all">All Contacts</option>
                        <option value="clients">Clients</option>
                        <option value="prospects">Prospects</option>
                        <option value="partners">Partners</option>
                        <option value="vendors">Vendors</option>
                    </select>
                </div>
            </div>

            {/* Contacts Table */}
            <div className="rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden">
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead>
                            <tr className="border-b bg-muted/50">
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                                    <div className="flex items-center gap-1">
                                        Name
                                        <ChevronDown className="h-4 w-4" />
                                    </div>
                                </th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Company</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Position</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Tags</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y">
                            {contacts.map((contact) => (
                                <tr key={contact.id} className="hover:bg-muted/50">
                                    <td className="px-4 py-4 whitespace-nowrap">
                                        <div className="flex items-center gap-3">
                                            <div className="flex items-center justify-center h-10 w-10 rounded-full bg-primary/10 text-primary">
                                                {contact.avatar ? (
                                                    <img
                                                        src={contact.avatar}
                                                        alt={contact.name}
                                                        className="h-10 w-10 rounded-full"
                                                    />
                                                ) : (
                                                    <span>{contact.name.charAt(0)}</span>
                                                )}
                                            </div>
                                            <div>
                                                <div className="flex items-center gap-1">
                                                    <p className="font-medium">{contact.name}</p>
                                                    {contact.starred && (
                                                        <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                                                    )}
                                                </div>
                                                <div className="flex items-center gap-3 text-xs text-muted-foreground">
                                                    <div className="flex items-center gap-1">
                                                        <Mail className="h-3 w-3" />
                                                        <span>{contact.email}</span>
                                                    </div>
                                                    <div className="flex items-center gap-1">
                                                        <Phone className="h-3 w-3" />
                                                        <span>{contact.phone}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="px-4 py-4 whitespace-nowrap">
                                        <p className="text-sm">{contact.company}</p>
                                    </td>
                                    <td className="px-4 py-4 whitespace-nowrap">
                                        <p className="text-sm">{contact.position}</p>
                                    </td>
                                    <td className="px-4 py-4 whitespace-nowrap">
                                        <div className="flex gap-1">
                                            {contact.tags.map((tag) => (
                                                <span
                                                    key={tag}
                                                    className={`
                                                        inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                                                        ${tag === 'Client' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300' : ''}
                                                        ${tag === 'VIP' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300' : ''}
                                                        ${tag === 'Prospect' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : ''}
                                                        ${tag === 'Partner' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300' : ''}
                                                        ${tag === 'Vendor' ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300' : ''}
                                                    `}
                                                >
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                    </td>
                                    <td className="px-4 py-4 whitespace-nowrap">
                                        <div className="flex items-center gap-2">
                                            <button className="rounded-full p-1 hover:bg-muted">
                                                <Edit className="h-4 w-4 text-muted-foreground" />
                                            </button>
                                            <button className="rounded-full p-1 hover:bg-muted">
                                                <Trash2 className="h-4 w-4 text-muted-foreground" />
                                            </button>
                                            <button className="rounded-full p-1 hover:bg-muted">
                                                <MoreHorizontal className="h-4 w-4 text-muted-foreground" />
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>

                {/* Pagination */}
                <div className="flex items-center justify-between px-4 py-3 border-t">
                    <div className="text-sm text-muted-foreground">
                        Showing <span className="font-medium">1</span> to <span className="font-medium">5</span> of <span className="font-medium">42</span> contacts
                    </div>
                    <div className="flex items-center gap-2">
                        <button
                            className="rounded-md border px-3 py-1 text-sm disabled:opacity-50"
                            disabled
                        >
                            Previous
                        </button>
                        <div className="flex items-center">
                            <button className="px-3 py-1 text-sm rounded-md bg-primary text-primary-foreground">1</button>
                            <button className="px-3 py-1 text-sm">2</button>
                            <button className="px-3 py-1 text-sm">3</button>
                            <span className="px-2">...</span>
                            <button className="px-3 py-1 text-sm">9</button>
                        </div>
                        <button className="rounded-md border px-3 py-1 text-sm">
                            Next
                        </button>
                    </div>
                </div>
            </div>

            {/* Stats Cards */}
            <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
                <div className="rounded-lg border bg-card text-card-foreground p-6 shadow-sm">
                    <div className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <h3 className="text-sm font-medium tracking-tight text-card-foreground">Total Contacts</h3>
                        <Users className="h-4 w-4 text-muted-foreground" />
                    </div>
                    <div className="text-2xl font-bold text-card-foreground">1,245</div>
                    <p className="text-xs text-muted-foreground">+12% from last month</p>
                </div>

                <div className="rounded-lg border bg-card text-card-foreground p-6 shadow-sm">
                    <div className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <h3 className="text-sm font-medium tracking-tight text-card-foreground">Clients</h3>
                        <Users className="h-4 w-4 text-muted-foreground" />
                    </div>
                    <div className="text-2xl font-bold text-card-foreground">543</div>
                    <p className="text-xs text-muted-foreground">+5% from last month</p>
                </div>

                <div className="rounded-lg border bg-card text-card-foreground p-6 shadow-sm">
                    <div className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <h3 className="text-sm font-medium tracking-tight text-card-foreground">Prospects</h3>
                        <Users className="h-4 w-4 text-muted-foreground" />
                    </div>
                    <div className="text-2xl font-bold text-card-foreground">402</div>
                    <p className="text-xs text-muted-foreground">+18% from last month</p>
                </div>

                <div className="rounded-lg border bg-card text-card-foreground p-6 shadow-sm">
                    <div className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <h3 className="text-sm font-medium tracking-tight text-card-foreground">VIP Contacts</h3>
                        <Star className="h-4 w-4 text-muted-foreground" />
                    </div>
                    <div className="text-2xl font-bold text-card-foreground">86</div>
                    <p className="text-xs text-muted-foreground">+2 since last week</p>
                </div>
            </div>
        </div>
    )
}
```

## File: src/routes/auth/signup.tsx

```tsx
import { createFileRoute, Link } from "@tanstack/react-router";
import { RegisterForm } from "@/components/auth/register-form";

export const Route = createFileRoute("/auth/signup")({
    component: SignUpPage,
});

function SignUpPage() {
    return (
        <div className="space-y-5">
            <div className="text-center">
                <h2 className="text-lg font-semibold text-foreground">Create your account</h2>
                <p className="text-sm text-muted-foreground">
                    Fill in the details below to create a new account
                </p>
            </div>

            <RegisterForm />

            <div className="text-center text-sm">
                <span className="text-muted-foreground">Already have an account?</span>{" "}
                <Link
                    to="/auth/signin"
                    className="font-medium text-primary hover:underline"
                >
                    Sign in
                </Link>
            </div>
        </div>
    );
}
```

## File: src/routes/auth/route.tsx

```tsx
import { createFileRoute, Outlet, redirect, useNavigate } from "@tanstack/react-router";
import { LoadingContainer } from "@app/ui/components/loading-container";
import { useState, useEffect } from "react";

import { createContext, useContext } from "react";

interface AuthContextType {
    isLoading: boolean;
    setIsLoading: (value: boolean) => void;
}

export const AuthContext = createContext<AuthContextType>({
    isLoading: false,
    setIsLoading: () => { },
});

export const useAuth = () => useContext(AuthContext);

export const Route = createFileRoute("/auth")({
    component: AuthLayout,
    beforeLoad: ({ context }) => {
        const { user } = context;

        if (user) {
            throw redirect({
                to: '/',
                replace: true,
            });
        }
    },
});

function AuthLayout() {
    const [isLoading, setIsLoading] = useState(false);
    const navigate = useNavigate();
    const { user } = Route.useRouteContext();

    useEffect(() => {
        if (user) {
            navigate({ to: "/", replace: true });
        }
        setIsLoading(false);
    }, [user]);

    useEffect(() => {
        setIsLoading(false);
    }, []);

    return (
        <AuthContext.Provider value={{ isLoading, setIsLoading }}>
            <div className="flex min-h-screen flex-col items-center justify-center p-4 bg-background">
                <div className="w-full max-w-md">
                    <LoadingContainer isLoading={isLoading} className="bg-accent rounded-lg border shadow-sm p-6">
                        <div className="flex flex-col items-center gap-2 mb-6">
                            <div
                                className="flex size-11 shrink-0 items-center justify-center rounded-full border"
                                aria-hidden="true"
                            >
                                <svg
                                    className="stroke-zinc-800 dark:stroke-zinc-100"
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="20"
                                    height="20"
                                    viewBox="0 0 32 32"
                                    aria-hidden="true"
                                >
                                    <circle cx="16" cy="16" r="12" fill="none" strokeWidth="8" />
                                </svg>
                            </div>
                        </div>

                        <Outlet />
                    </LoadingContainer>

                    <div className="mt-4 text-center text-sm text-muted-foreground">
                        <span>&copy; {new Date().getFullYear()} Your Company. All rights reserved.</span>
                    </div>
                </div>
            </div>
        </AuthContext.Provider>
    );
}
```

## File: src/routes/auth/reset-password.tsx

```tsx
import { createFileRoute, Link, redirect } from "@tanstack/react-router";
import { ResetPasswordForm } from "@/components/auth/reset-password-form";

interface ResetPasswordSearchParams {
    token?: string;
}

export const Route = createFileRoute("/auth/reset-password")({
    validateSearch: (search): ResetPasswordSearchParams => {
        return {
            token: search.token as string
        };
    },
    beforeLoad: ({ search }) => {
        if (!search.token) {
            throw redirect({
                to: "/auth/forgot-password",
            });
        }
    },
    component: ResetPasswordPage,
});

function ResetPasswordPage() {
    return (
        <div className="space-y-5">
            <div className="text-center">
                <h2 className="text-lg font-semibold text-foreground">Reset Your Password</h2>
                <p className="text-sm text-muted-foreground">
                    Create a new password for your account
                </p>
            </div>

            <ResetPasswordForm />

            <div className="text-center text-sm">
                <span className="text-muted-foreground">Remember your password?</span>{" "}
                <Link
                    to="/auth/signin"
                    className="font-medium text-primary hover:underline"
                >
                    Back to sign in
                </Link>
            </div>
        </div>
    );
}
```

## File: src/routes/auth/forgot-password.tsx

```tsx
import { createFileRoute, Link } from "@tanstack/react-router";
import { ForgotPasswordForm } from "@/components/auth/forgot-password-form";

interface ForgotPasswordSearchParams {
    email?: string;
}

export const Route = createFileRoute("/auth/forgot-password")({
    validateSearch: (search): ForgotPasswordSearchParams => {
        return {
            email: search.email as string
        };
    },
    component: ForgotPasswordPage,
});

function ForgotPasswordPage() {
    const { email } = Route.useSearch();

    return (
        <div className="space-y-5">
            <div className="text-center">
                <h2 className="text-lg font-semibold text-foreground">Forgot Password</h2>
                <p className="text-sm text-muted-foreground">
                    Enter your email address and we'll send you a link to reset your password
                </p>
            </div>

            <ForgotPasswordForm defaultEmail={email || ""} />

            <div className="text-center text-sm">
                <span className="text-muted-foreground">Remember your password?</span>{" "}
                <Link
                    to="/auth/signin"
                    className="font-medium text-primary hover:underline"
                >
                    Back to sign in
                </Link>
            </div>
        </div>
    );
}
```

## File: src/routes/auth/signin.tsx

```tsx
import { createFileRoute, Link } from "@tanstack/react-router";
import { LoginForm } from "@/components/auth/login-form";
import { useNavigate } from "@tanstack/react-router";

export const Route = createFileRoute("/auth/signin")({
    component: SignInPage,
});

function SignInPage() {
    const navigate = useNavigate();

    const handleForgotPassword = (email: string) => {
        navigate({
            to: "/auth/forgot-password",
            search: { email }
        });
    };

    return (
        <div className="space-y-5">
            <div className="text-center">
                <h2 className="text-lg font-semibold text-foreground">Welcome back</h2>
                <p className="text-sm text-muted-foreground">
                    Enter your credentials to login to your account.
                </p>
            </div>

            <LoginForm onForgotPassword={handleForgotPassword} />

            <div className="text-center text-sm">
                <span className="text-muted-foreground">Don't have an account?</span>{" "}
                <Link
                    to="/auth/signup"
                    className="font-medium text-primary hover:underline"
                >
                    Sign up
                </Link>
            </div>
        </div>
    );
}
```

## File: src/routes/api/auth/$.ts

```typescript
import { auth } from "@app/auth"
import { createAPIFileRoute } from "@tanstack/react-start/api";

export const APIRoute = createAPIFileRoute("/api/auth/$")({
    GET: ({ request }) => auth.handler(request),
    POST: ({ request }) => auth.handler(request)
})
```

